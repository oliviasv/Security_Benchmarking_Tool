#
# This script is Copyright (C) 2004-2020 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
#
# $Revision: 1.1 $
# $Date: 2020/04/15 $
#
# Description   : This .audit is designed against the DISA Infrastructure Router
#                 Technical Implementation Guide Juniper Version 8 Release 29.
#
#                 https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip
#
#<ui_metadata>
#<display_name>DISA STIG Juniper Infrastructure Router V8R29</display_name>
#<spec>
#  <type>DISA STIG</type>
#  <name>Juniper Infrastructure Router</name>
#  <version>8.29.0</version>
#  <link>https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip</link>
#</spec>
#<labels>juniper,disa,junos,infrastructure,router</labels>
#<variables>
#  <variable>
#    <name>EMERGENCY_ACCT</name>
#    <default>emergencyaccount</default>
#    <description>Emergency account</description>
#    <info>The username of the emergency account configured for your organization. The credentials for this account must be stored ina locked safe.</info>
#  </variable>
#  <variable>
#    <name>NTP_SERVER_1</name>
#    <default>192\.168\.3\.1</default>
#    <description>NTP server address 1</description>
#    <info>The IP address of the first NTP server listed for your organization.</info>
#  </variable>
#  <variable>
#    <name>NTP_SERVER_2</name>
#    <default>192\.168\.3\.2</default>
#    <description>NTP server address 2</description>
#    <info>The IP address of the second NTP server listed for your organization.</info>
#  </variable>
#  <variable>
#    <name>NTP_AUTH_KEY</name>
#    <default>1</default>
#    <description>NTP authentication key</description>
#    <info>The authentication key used for NTP messages.</info>
#  </variable>
#  <variable>
#    <name>DNS_SERVER_1</name>
#    <default>192\.168\.3\.1</default>
#    <description>DNS server address 1</description>
#    <info>The IP address of the first DNS server listed for your organization.</info>
#  </variable>
#  <variable>
#    <name>DNS_SERVER_2</name>
#    <default>192\.168\.3\.2</default>
#    <description>DNS server address 2</description>
#    <info>The IP address of the second DNS server listed for your organization.</info>
#  </variable>
#  <variable>
#    <name>LOOPBACK_FILTER_INPUT</name>
#    <default>router-protect-filter</default>
#    <description>Loopback firewall filter</description>
#    <info>This filter is used to restrict all traffic to the router engine.</info>
#  </variable>
#  <variable>
#    <name>OOBM_INTERFACE</name>
#    <default>ge-0/0/0</default>
#    <description>OOBM Egress Interface</description>
#    <info>The OOBM interface name. It is used for VPN connectivity. The management network must be restricted to accessing this interface or information from the managed network will leak.</info>
#  </variable>
#  <variable>
#    <name>OOBM_INGRESS_FILTER</name>
#    <default>oobm-ingress-filter</default>
#    <description>OOBM Ingress Filter</description>
#    <info>The OOBM ingress firewall filter name. The management network must be restricted to accessing this interface or information from the managed network will leak.</info>
#  </variable>
#  <variable>
#    <name>OOBM_EGRESS_FILTER</name>
#    <default>oobm-egress-filter</default>
#    <description>OOBM Egress Filter</description>
#    <info>The OOBM egress firewall filter name. The management network must be restricted to accessing this interface or information from the managed network will leak.</info>
#  </variable>
#  <variable>
#    <name>OOBM_VPN_FILTER</name>
#    <default>oobm-vpn-filter</default>
#    <description>OOBM VPN Filter</description>
#    <info>The OOBM VPN firewall filter name. The management network must be restricted to accessing this interface or information from the managed network will leak.</info>
#  </variable>
#  <variable>
#    <name>MANAGEMENT_QOS_FILTER</name>
#    <default>set-FC-to-network-control</default>
#    <description>Management Network QoS filter</description>
#    <info>The management network QoS filter name, used for DSCP 48/Network-Control QoS.</info>
#  </variable>
#  <variable>
#    <name>RPF_FAIL_FILTER</name>
#    <default>rfp-fail</default>
#    <description>uRPF Fail Filter</description>
#    <info>The uRPF fail firewall filter name. When an incoming packet fails the unicast RPF check, it must be logged.</info>
#  </variable>
#  <variable>
#    <name>PIM_INPUT_FILTER</name>
#    <default>pim-input-filter</default>
#    <description>PIM Firewall Filter</description>
#    <info>Ensure that a PIM neighbor filter is bound to all interfaces that have PIM enabled.</info>
#  </variable>
#  <variable>
#    <name>LOCAL_MANAGEMENT_NETWORK</name>
#    <default>10\.10\.2\.0 0\.0\.0\.255</default>
#    <description>Management network</description>
#    <info>The local management network address and wildcard mask. Access to this network through the out of band management (OOBM) interface must be restricted to the remote management network (e.g. NOC).</info>
#  </variable>
#  <variable>
#    <name>REMOTE_MANAGEMENT_NETWORK</name>
#    <default>10\.10\.1\.0 0\.0\.0\.255</default>
#    <description>Remote management network</description>
#    <info>The remote management network range (such as the NOC's range). This range must be granted access through the out of band management (OOBM) interface.</info>
#  </variable>
#  <variable>
#    <name>MANAGEMENT_INTERFACE</name>
#    <default>fe-0/0/1</default>
#    <description>Management interface</description>
#    <info>The name of the management interface for your organization.</info>
#  </variable>
#  <variable>
#    <name>OOBM_VPN_INTERFACE</name>
#    <default>es-0/1/0</default>
#    <description>OOBM VPN Interface</description>
#    <info>The OOBM VPN interface.</info>
#  </variable>
#  <variable>
#    <name>MANAGEMENT_IP_AND_NETMASK</name>
#    <default>10\.10\.2\.1 255\.255\.255\.0</default>
#    <description>Management interface network</description>
#    <info>The IP address and network mask of the router's management interface.</info>
#  </variable>
#  <variable>
#    <name>NIPRNET_LINK_INTERFACE</name>
#    <default>fe-0/0/1</default>
#    <description>NIPRNet link interface</description>
#    <info>The name of the router's interface that connects to the NIPRNET Provider.</info>
#  </variable>
#  <variable>
#    <name>LOGGING_HOST_IP</name>
#    <default>192\.168\.2\.1</default>
#    <description>Syslog host address</description>
#    <info>The IP address for your organization's logging host. Syslog messages must be sent to this address.</info>
#  </variable>
#  <variable>
#    <name>SSH_ALGORITHM_MAC</name>
#    <default>hmac-sha1 hmac-sha1-96</default>
#    <description>SSH Algorithm MAC</description>
#    <info>The list of SSH algorithm MAC types</info>
#  </variable>
#  <variable>
#    <name>SSH_ALGORITHM_CIPHER</name>
#    <default>aes128-cbc aes192-cbc aes256-cbc</default>
#    <description>SSH Algorithm Encryption</description>
#    <info>The list of SSH algorithm encryption types</info>
#  </variable>
#  <variable>
#    <name>BANNER_LOGIN</name>
#    <default>I've read & consent to terms in IS user agreem't.</default>
#    <description>Banner displayed at login</description>
#    <info>Standard Mandatory DoD Notice and Consent Banner</info>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Juniper">

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0230 - Network devices must be password protected - ssh no-password"
  info        : "Network access control mechanisms interoperate to prevent unauthorized access and to enforce the organization's security policy. Access to the network must be categorized as administrator, user, or guest so the appropriate authorization can be assigned to the user requesting access to the network or a network device. Authorization requires an individual account identifier that has been approved, assigned, and configured on an authentication server. Authentication of user identities is accomplished through the use of passwords, tokens, biometrics, or in the case of multi-factor authentication, some combination thereof. Lack of authentication enables anyone to gain access to the network or possibly a network device providing opportunity for intruders to compromise resources within the network infrastructure."
  solution    : "Configure the network devices so it will require a password to gain administrative access to the device."
  reference   : "800-53|IA-5(1),CAT|I,CSF|PR.AC-1,ITSG-33|IA-5(1),NESA|T5.2.3,Rule-ID|SV-3012r4_rule,STIG-ID|NET0230,SWIFT-CSCv1|4.1,Vuln-ID|V-3012"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system service ssh"
  not_expect  : "set system service ssh no-password"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0230 - Network devices must be password protected - root password set"
  info        : "Network access control mechanisms interoperate to prevent unauthorized access and to enforce the organization's security policy. Access to the network must be categorized as administrator, user, or guest so the appropriate authorization can be assigned to the user requesting access to the network or a network device. Authorization requires an individual account identifier that has been approved, assigned, and configured on an authentication server. Authentication of user identities is accomplished through the use of passwords, tokens, biometrics, or in the case of multi-factor authentication, some combination thereof. Lack of authentication enables anyone to gain access to the network or possibly a network device providing opportunity for intruders to compromise resources within the network infrastructure."
  solution    : "Configure the network devices so it will require a password to gain administrative access to the device."
  reference   : "800-171|3.5.7,800-53|IA-5(1),CAT|I,CIP|007-6-R5,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,HIPAA|164.308(a)(5)(ii)(D),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,PCI-DSSv3.1|8.2.3,PCI-DSSv3.2|8.2.3,Rule-ID|SV-3012r4_rule,STIG-ID|NET0230,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4,Vuln-ID|V-3012"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system root-authentication"
  expect      : "set system root-authentication encrypted-password .+"
</custom_item>

<report type:"WARNING">
  description : "NET0240 - Network devices must not have any default manufacturer passwords."
  info        : "Network devices not protected with strong password schemes provide the opportunity for anyone to crack the password thus gaining access to the device and causing network outage or denial of service. Many default vendor passwords are well-known; hence, not removing them prior to deploying the network devices into production provides an opportunity for a malicious user to gain unauthorized access to the device.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Remove any vendor default passwords from the network devices configuration."
  reference   : "CAT|I,Rule-ID|SV-3143r4_rule,STIG-ID|NET0240,Vuln-ID|V-3143"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<custom_item>
  type        : BANNER_CHECK
  description : "NET0340 - Network devices must display the DoD-approved logon banner warning."
  info        : "All network devices must present a DoD-approved warning banner prior to a system administrator logging on. The banner should warn any unauthorized user not to proceed. It also should provide clear and unequivocal notice to both authorized and unauthorized personnel that access to the device is subject to monitoring to detect unauthorized usage. Failure to display the required logon warning banner prior to logon attempts will limit DoD's ability to prosecute unauthorized access and also presents the potential to give rise to criminal and civil liability for systems administrators and information systems managers. In addition, DISA's ability to monitor the device's usage is limited unless a proper warning banner is displayed.

DoD CIO has issued new, mandatory policy standardizing the wording of 'notice and consent' banners and matching user agreements for all Secret and below DoD information systems, including stand-alone systems by releasing DoD CIO Memo, 'Policy on Use of Department of Defense (DoD) Information Systems Standard Consent Banner and User Agreement', dated 9 May 2008. The banner is mandatory and deviations are not permitted except as authorized in writing by the Deputy Assistant Secretary of Defense for Information and Identity Assurance. Implementation of this banner verbiage is further directed to all DoD components for all DoD assets via USCYBERCOM CTO 08-008A."
  solution    : "Configure all management interfaces to the network device to display the DoD-mandated warning banner verbiage at logon regardless of the means of connection or communication. The required banner verbiage that must be displayed verbatim is as follows:

Option A

You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only.

By using this IS (which includes any device attached to this IS), you consent to the following conditions:

-The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations.

-At any time, the USG may inspect and seize data stored on this IS.

-Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose.

-This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy.

-Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details.

Option B

If the system is incapable of displaying the required banner verbiage due to its size, a smaller banner must be used. The mandatory verbiage follows: 'I've read & consent to terms in IS user agreem't.'"
  reference   : "800-171|3.1.9,800-53|AC-8,8500.2|ECWM-1,CAT|II,ITSG-33|AC-8,NESA|M1.3.6,NESA|M5.2.5,NESA|T5.5.1,NIAv2|AM10a,NIAv2|AM10b,NIAv2|AM10c,NIAv2|AM10d,NIAv2|AM10e,PCI-DSSv3.2|2.2.4,Rule-ID|SV-3013r5_rule,STIG-ID|NET0340,TBA-FIISB|45.2.4,Vuln-ID|V-3013"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "banner login"
# Note: Variable @BANNER_LOGIN@ replaced with "I've read & consent to terms in IS user agreem't." in field "content".
  content     : "I've read & consent to terms in IS user agreem't."
</custom_item>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for OSPF"
      expect      : "set protocols ospf(3)? .+"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      type        : CONFIG_CHECK
      description : "NET0400 - The network element must authenticate all IGP peers - OSPF"
      info        : "A rogue router could send a fictitious routing update to convince a site's premise router to send traffic to an incorrect or even a rogue destination.  This diverted traffic could be analyzed to learn confidential information of the site's network, or merely used to disrupt the network's ability to effectively communicate with other networks."
      solution    : "Configure authentication for all IGP peers."
      reference   : "800-171|3.13.8,800-53|SC-8(1),CAT|II,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-15291r2_rule,STIG-ID|NET0400,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-3034"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex       : "set protocols ospf(3)? .+"
      expect      : "set protocols ospf(3)? .+ authentication(-type)? .+"
    </custom_item>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET0400 - The network element must authenticate all IGP peers - OSPF"
      info        : "A rogue router could send a fictitious routing update to convince a site's premise router to send traffic to an incorrect or even a rogue destination.  This diverted traffic could be analyzed to learn confidential information of the site's network, or merely used to disrupt the network's ability to effectively communicate with other networks.

      NOTE: OSPF does not appear to be configured on the target."
      solution    : "Configure authentication for all IGP peers."
      reference   : "800-171|3.13.8,800-53|SC-8,CAT|II,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8,NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-15291r2_rule,STIG-ID|NET0400,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-3034"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for IS-IS"
      expect      : "set protocols isis .+"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      type        : CONFIG_CHECK
      description : "NET0400 - The network element must authenticate all IGP peers - IS-IS authentication-key"
      info        : "A rogue router could send a fictitious routing update to convince a site's premise router to send traffic to an incorrect or even a rogue destination.  This diverted traffic could be analyzed to learn confidential information of the site's network, or merely used to disrupt the network's ability to effectively communicate with other networks."
      solution    : "Configure authentication for all IGP peers."
      reference   : "800-171|3.13.8,800-53|SC-8(1),CAT|II,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-15291r2_rule,STIG-ID|NET0400,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-3034"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex       : "set protocols isis .+"
      expect      : "set protocols isis .+ authentication-key(-name)? .+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "NET0400 - The network element must authenticate all IGP peers - IS-IS authentication-type"
      info        : "A rogue router could send a fictitious routing update to convince a site's premise router to send traffic to an incorrect or even a rogue destination.  This diverted traffic could be analyzed to learn confidential information of the site's network, or merely used to disrupt the network's ability to effectively communicate with other networks."
      solution    : "Configure authentication for all IGP peers."
      reference   : "800-171|3.13.8,800-53|SC-8(1),CAT|II,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-15291r2_rule,STIG-ID|NET0400,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-3034"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex       : "set protocols isis .+"
      expect      : "set protocols isis .+ authentication(-type)? .+"
    </custom_item>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET0400 - The network element must authenticate all IGP peers - IS-IS authentication-key"
      info        : "A rogue router could send a fictitious routing update to convince a site's premise router to send traffic to an incorrect or even a rogue destination.  This diverted traffic could be analyzed to learn confidential information of the site's network, or merely used to disrupt the network's ability to effectively communicate with other networks.

      NOTE: IS-IS does not appear to be configured on the target."
      solution    : "Configure authentication for all IGP peers."
      reference   : "800-171|3.13.8,800-53|SC-8,CAT|II,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8,NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-15291r2_rule,STIG-ID|NET0400,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-3034"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>

    <report type:"PASSED">
      description : "NET0400 - The network element must authenticate all IGP peers - IS-IS authentication-type"
      info        : "A rogue router could send a fictitious routing update to convince a site's premise router to send traffic to an incorrect or even a rogue destination.  This diverted traffic could be analyzed to learn confidential information of the site's network, or merely used to disrupt the network's ability to effectively communicate with other networks.

      NOTE: IS-IS does not appear to be configured on the target."
      solution    : "Configure authentication for all IGP peers."
      reference   : "800-171|3.13.8,800-53|SC-8,CAT|II,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8,NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-15291r2_rule,STIG-ID|NET0400,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-3034"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for RIP"
      expect      : "set protocols rip .+"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      type        : CONFIG_CHECK
      description : "NET0400 - The network element must authenticate all IGP peers - RIP authentication-key"
      info        : "A rogue router could send a fictitious routing update to convince a site's premise router to send traffic to an incorrect or even a rogue destination.  This diverted traffic could be analyzed to learn confidential information of the site's network, or merely used to disrupt the network's ability to effectively communicate with other networks."
      solution    : "Configure authentication for all IGP peers."
      reference   : "800-171|3.13.8,800-53|SC-8(1),CAT|II,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-15291r2_rule,STIG-ID|NET0400,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-3034"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex       : "set protocols rip .+"
      expect      : "set protocols rip .+ authentication-key(-name)? .+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "NET0400 - The network element must authenticate all IGP peers - RIP authentication-type"
      info        : "A rogue router could send a fictitious routing update to convince a site's premise router to send traffic to an incorrect or even a rogue destination.  This diverted traffic could be analyzed to learn confidential information of the site's network, or merely used to disrupt the network's ability to effectively communicate with other networks."
      solution    : "Configure authentication for all IGP peers."
      reference   : "800-171|3.13.8,800-53|SC-8(1),CAT|II,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-15291r2_rule,STIG-ID|NET0400,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-3034"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex       : "set protocols rip .+"
      expect      : "set protocols rip .+ authentication(-type)? .+"
    </custom_item>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET0400 - The network element must authenticate all IGP peers - RIP authentication-key"
      info        : "A rogue router could send a fictitious routing update to convince a site's premise router to send traffic to an incorrect or even a rogue destination.  This diverted traffic could be analyzed to learn confidential information of the site's network, or merely used to disrupt the network's ability to effectively communicate with other networks.

      NOTE: RIP does not appear to be configured on the target."
      solution    : "Configure authentication for all IGP peers."
      reference   : "800-171|3.13.8,800-53|SC-8,CAT|II,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8,NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-15291r2_rule,STIG-ID|NET0400,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-3034"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>

    <report type:"PASSED">
      description : "NET0400 - The network element must authenticate all IGP peers - RIP authentication-type"
      info        : "A rogue router could send a fictitious routing update to convince a site's premise router to send traffic to an incorrect or even a rogue destination.  This diverted traffic could be analyzed to learn confidential information of the site's network, or merely used to disrupt the network's ability to effectively communicate with other networks.

      NOTE: RIP does not appear to be configured on the target."
      solution    : "Configure authentication for all IGP peers."
      reference   : "800-171|3.13.8,800-53|SC-8,CAT|II,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8,NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-15291r2_rule,STIG-ID|NET0400,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-3034"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<report type:"WARNING">
  description : "NET0405 - A service or feature that calls home to the vendor must be disabled."
  info        : "Call home services or features will routinely send data such as configuration and diagnostic information to the vendor for routine or emergency analysis and troubleshooting.  The risk that transmission of sensitive data sent to unauthorized persons could result in data loss or downtime due to an attack.

  NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Configure the network device to disable the call home service or feature.

Note: This feature can be enabled if the communication is only to a server residing in the local area network or enclave."
  reference   : "CAT|II,Rule-ID|SV-36774r5_rule,STIG-ID|NET0405,Vuln-ID|V-28784"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for BGP"
      expect      : "set protocols bgp .+"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      type        : CONFIG_CHECK
      description : "NET0408 - The network element must authenticate all BGP peers within the same or between autonomous systems (AS)."
      info        : "As specified in RFC 793, TCP utilizes sequence checking to ensure proper ordering of received packets. RFC 793 also specifies that RST (reset) control flags should be processed immediately, without waiting for out of sequence packets to arrive. RFC 793 also requires that sequence numbers are checked against the window size before accepting data or control flags as valid. A router receiving an RST segment will close the TCP session with the BGP peer that is being spoofed; thereby, purging all routes learned from that BGP neighbor. A RST segment is valid as long as the sequence number is within the window. The TCP reset attack is made possible due to the requirements that Reset flags should be processed immediately and that a TCP endpoint must accept out of order packets that are within the range of a window size. This reduces the number of sequence number guesses the attack must make by a factor equivalent to the active window size. Each sequence number guess made by the attacker can be simply incremented by the receiving connections window size. The BGP peering session can protect itself against such an attack by authenticating each TCP segment. The TCP header options include an MD5 signature in every packet and are checked prior to the acceptance and processing of any TCP packet - including RST flags.

      One way to create havoc in a network is to advertise bogus routes to a network. A rogue router could send a fictitious routing update to convince a BGP router to send traffic to an incorrect or rogue destination. This diverted traffic could be analyzed to learn confidential information of the site's network, or merely used to disrupt the network's ability to effectively communicate with other networks. An autonomous system can advertise incorrect information by sending BGP updates messages to routers in a neighboring AS. A malicious AS can advertise a prefix originated from another AS and claim that it is the originator (prefix hijacking). Neighboring autonomous systems receiving this announcement will believe that the malicious AS is the prefix owner and route packets to it."
      solution    : "Configure the device to authenticate all BGP peers."
      reference   : "800-171|3.4.2,800-53|CM-6,CAT|II,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ISO/IEC-27001|A.13.2.3,ITSG-33|CM-6,NESA|T3.2.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-41556r2_rule,STIG-ID|NET0408,SWIFT-CSCv1|2.3,TBA-FIISB|29.1,Vuln-ID|V-31285"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex       : "set protocols bgp .+"
      expect      : "set protocols bgp .+ authentication-key .+"
    </custom_item>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET0408 - The network element must authenticate all BGP peers within the same or between autonomous systems (AS)."
      info        : "As specified in RFC 793, TCP utilizes sequence checking to ensure proper ordering of received packets. RFC 793 also specifies that RST (reset) control flags should be processed immediately, without waiting for out of sequence packets to arrive. RFC 793 also requires that sequence numbers are checked against the window size before accepting data or control flags as valid. A router receiving an RST segment will close the TCP session with the BGP peer that is being spoofed; thereby, purging all routes learned from that BGP neighbor. A RST segment is valid as long as the sequence number is within the window. The TCP reset attack is made possible due to the requirements that Reset flags should be processed immediately and that a TCP endpoint must accept out of order packets that are within the range of a window size. This reduces the number of sequence number guesses the attack must make by a factor equivalent to the active window size. Each sequence number guess made by the attacker can be simply incremented by the receiving connections window size. The BGP peering session can protect itself against such an attack by authenticating each TCP segment. The TCP header options include an MD5 signature in every packet and are checked prior to the acceptance and processing of any TCP packet - including RST flags.

      One way to create havoc in a network is to advertise bogus routes to a network. A rogue router could send a fictitious routing update to convince a BGP router to send traffic to an incorrect or rogue destination. This diverted traffic could be analyzed to learn confidential information of the site's network, or merely used to disrupt the network's ability to effectively communicate with other networks. An autonomous system can advertise incorrect information by sending BGP updates messages to routers in a neighboring AS. A malicious AS can advertise a prefix originated from another AS and claim that it is the originator (prefix hijacking). Neighboring autonomous systems receiving this announcement will believe that the malicious AS is the prefix owner and route packets to it.

      NOTE: BGP does not appear to be configured on the target."
      solution    : "Configure the device to authenticate all BGP peers."
      reference   : "800-171|3.13.8,800-53|SC-8,CAT|II,CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8,NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-41556r2_rule,STIG-ID|NET0408,SWIFT-CSCv1|2.1,TBA-FIISB|29.1,Vuln-ID|V-31285"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<report type:"WARNING">
  description : "NET0422 - Network devices must be configured with rotating keys used for authenticating IGP peers that have a duration of 180 days or less."
  info        : "If the keys used for routing protocol authentication are guessed, the malicious user could create havoc within the network by advertising incorrect routes and redirecting traffic. Changing the keys frequently reduces the risk of them eventually being guessed. When configuring authentication for routing protocols that provide key chains, configure two rotating keys with overlapping expiration dates, both with 180-day or less expirations.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Configure the device so rotating keys expire at 180 days or less."
  reference   : "CAT|III,Rule-ID|SV-15301r4_rule,STIG-ID|NET0422,Vuln-ID|V-14667"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<custom_item>
  type            : CONFIG_CHECK
  description     : "NET0433 - Network devices must use two or more authentication servers for the purpose of granting administrative access"
  info            : "The use of Authentication, Authorization, and Accounting (AAA) affords the best methods for controlling user access, authorization levels, and activity logging.  By enabling AAA on the routers in conjunction with an authentication server such as TACACS+ or RADIUS, the administrators can easily add or remove user accounts, add or remove command authorizations, and maintain a log of user activity.

The use of an authentication server provides the capability to assign router administrators to tiered groups that contain their privilege level that is used for authorization of specific commands.   For example, user mode would be authorized for all authenticated administrators while configuration or edit mode should only be granted to those administrators that are permitted to implement router configuration changes."
  solution        : "Configure the device to use two separate authentication servers."
  reference       : "800-171|3.5.1,800-53|IA-2,CAT|II,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,Rule-ID|SV-16259r4_rule,STIG-ID|NET0433,TBA-FIISB|35.1,TBA-FIISB|36.1,Vuln-ID|V-15432"
  see_also        : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex           : "set system (tacplus|radius)-server .+ secret .+"
  number_of_lines : "^([2-9]|1[0-9]+)$"
</custom_item>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for remote authentication server"
      regex       : "set system (tacplus|radius)-server .+ secret .+"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      type            : CONFIG_CHECK
      description     : "NET0440 - In the event the authentication server is unavailable, the network device must have a single local account of last resort defined."
      info            : "Authentication for administrative access to the device is required at all times. A single account of last resort can be created on the device's local database for use in an emergency such as when the authentication server is down or connectivity between the device and the authentication server is not operable. The console or local account of last resort logon credentials must be stored in a sealed envelope and kept in a safe."
      solution        : "Configure the device to only allow one local account of last resort for emergency access and store the credentials in a secure manner."
      reference       : "800-171|3.1.5,800-53|AC-6(1),CAT|II,CSF|PR.AC-4,ISO/IEC-27001|A.9.4.4,ITSG-33|AC-6(1),NESA|T5.1.1,NESA|T5.4.4,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|VL3b,Rule-ID|SV-30085r5_rule,STIG-ID|NET0440,SWIFT-CSCv1|5.1,Vuln-ID|V-3966"
      see_also        : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex           : "set system login user .+ uid .+"
      number_of_lines : "^1$"
    </custom_item>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET0440 - In the event the authentication server is unavailable, the network device must have a single local account of last resort defined."
      info        : "Authentication for administrative access to the device is required at all times. A single account of last resort can be created on the device's local database for use in an emergency such as when the authentication server is down or connectivity between the device and the authentication server is not operable. The console or local account of last resort logon credentials must be stored in a sealed envelope and kept in a safe.

      NOTE: AAA authentication with a radius or TACACS+ server was not found."
      solution    : "Configure the device to only allow one local account of last resort for emergency access and store the credentials in a secure manner."
      reference   : "800-171|3.1.5,800-53|AC-6,CAT|II,CSF|PR.AC-4,ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.4.4,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|VL3b,Rule-ID|SV-30085r5_rule,STIG-ID|NET0440,SWIFT-CSCv1|5.1,Vuln-ID|V-3966"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0441 - Emergency administration account privilege level is not set."
  info        : "The emergency administration account is to be configured as a local account on the network devices. It is to be used only when the authentication server is offline or not reachable via the network. The emergency account must be set to an appropriate authorization level to perform necessary administrative functions during this time."
  solution    : "Assign a privilege level to the emergency administration account to allow the administrator to perform necessary administrative functions when the authentication server is not online."
  reference   : "800-171|3.1.5,800-53|AC-6(1),CAT|I,CSF|PR.AC-4,ISO/IEC-27001|A.9.4.4,ITSG-33|AC-6(1),NESA|T5.1.1,NESA|T5.4.4,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|VL3b,Rule-ID|SV-16261r5_rule,STIG-ID|NET0441,SWIFT-CSCv1|5.1,Vuln-ID|V-15434"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @EMERGENCY_ACCT@ replaced with "emergencyaccount" in field "regex".
  regex       : "set system login user emergencyaccount"
# Note: Variable @EMERGENCY_ACCT@ replaced with "emergencyaccount" in field "expect".
  expect      : "set system login user emergencyaccount class super-user .+"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0460 - Group accounts must not be configured for use on the network device."
  info        : "Group accounts configured for use on a network device do not allow for accountability or repudiation of individuals using the shared account.  If group accounts are not changed when someone leaves the group, that person could possibly gain control of the network device.  Having group accounts does not allow for proper auditing of who is accessing or changing the network.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure individual user accounts for each authorized person then remove any group accounts."
  reference   : "800-171|3.1.5,800-53|AC-6(1),CAT|I,CSF|PR.AC-4,ISO/IEC-27001|A.9.4.4,ITSG-33|AC-6(1),NESA|T5.1.1,NESA|T5.4.4,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|VL3b,Rule-ID|SV-3056r7_rule,STIG-ID|NET0460,SWIFT-CSCv1|5.1,Vuln-ID|V-3056"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system login user .+ uid .+"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0465 - Authorized accounts must be assigned the least privilege level necessary to perform assigned duties."
  info        : "By not restricting authorized accounts to their proper privilege level, access to restricted functions may be allowed before authorized personell are trained or experienced enough to use those functions.  Network disruptions or outages may occur due to mistakes made by inexperienced persons using accounts with greater privileges than necessary.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure authorized accounts with the least privilege rule. Each user will have access to only the privileges they require to perform their assigned duties."
  reference   : "800-171|3.1.5,800-53|AC-6(1),CAT|II,CSF|PR.AC-4,ISO/IEC-27001|A.9.4.4,ITSG-33|AC-6(1),NESA|T5.1.1,NESA|T5.4.4,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|VL3b,Rule-ID|SV-15472r4_rule,STIG-ID|NET0465,SWIFT-CSCv1|5.1,Vuln-ID|V-3057"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system login user .+ uid .+"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0470 - Unauthorized accounts must not be configured for access to the network device."
  info        : "A malicious user attempting to gain access to the network device may compromise an account that may be unauthorized for use.  The unauthorized account may be a temporary or inactive account that is no longer needed to access the device.  Denial of Service, interception of sensitive information, or other destructive actions could potentially take place if an unauthorized account is configured to access the network device.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Remove any account configured for access to the network device that is not defined in the organization's responsibilities list."
  reference   : "800-171|3.1.5,800-53|AC-6(1),CAT|II,CSF|PR.AC-4,ISO/IEC-27001|A.9.4.4,ITSG-33|AC-6(1),NESA|T5.1.1,NESA|T5.4.4,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|VL3b,Rule-ID|SV-3058r5_rule,STIG-ID|NET0470,SWIFT-CSCv1|5.1,Vuln-ID|V-3058"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system login user .+ uid .+"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0580 - The router administrator will ensure a password is required to gain access to the router's diagnostics port."
  info        : "If unauthorized users gain access to the routers diagnostic port, it is possible to disrupt service."
  solution    : "The router administrator will ensure that a password is required to access the routers diagnostic port."
  reference   : "800-171|3.5.7,800-53|IA-5(1),CAT|III,CIP|007-6-R5,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,HIPAA|164.308(a)(5)(ii)(D),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,PCI-DSSv3.1|8.2.3,PCI-DSSv3.2|8.2.3,Rule-ID|SV-4583r1_rule,STIG-ID|NET0580,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4,Vuln-ID|V-4583"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system diag-port-authentication"
  expect      : "set system diag-port-authentication encrypted-password .+"
</custom_item>

<report type:"PASSED">
  description : "NET0600 - The network element must be configured to ensure passwords are not viewable when displaying configuration information."
  info        : "Many attacks information systems and network elements are launched from within the network. Hence, it is imperative that all passwords are encrypted so they cannot be intercepted by viewing the console or printout of the configuration."
  solution    : "For JUNOS, all passwords are always shown as encrypted. Hence, this would never be a finding."
  reference   : "CAT|I,Rule-ID|SV-41451r2_rule,STIG-ID|NET0600,Vuln-ID|V-3062"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0700 - The network element must be running a current and supported operating system with all IAVMs addressed."
  info        : "Network devices that are not running the latest tested and approved versions of software are vulnerable to network attacks. Running the most current, approved version of system and device software helps the site maintain a stable base of security fixes and patches, as well as enhancements to IP security. Viruses, denial of service attacks, system weaknesses, back doors and other potentially harmful situations could render a system vulnerable, allowing unauthorized access to DoD assets.

  NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Update operating system to a supported version that addresses all related IAVMs."
  reference   : "800-171|3.4.1,800-53|CM-8,CAT|II,CN-L3|8.1.10.2(a),CN-L3|8.1.10.2(b),CSF|DE.CM-7,CSF|ID.AM-1,CSF|ID.AM-2,CSF|PR.DS-3,ISO/IEC-27001|A.8.1.1,ITSG-33|CM-8,NESA|T1.2.1,NESA|T1.2.2,NIAv2|NS35,Rule-ID|SV-15303r2_rule,STIG-ID|NET0700,Vuln-ID|V-3160"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set version .+"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0730 - The network element must have the Finger service disabled."
  info        : "The finger service supports the UNIX finger protocol, which is used for querying a host about the users that are logged on. This service is not necessary for generic users. If an attacker were to find out who is using the network, they may use social engineering practices to try to elicit classified DoD information."
  solution    : "Configure the device to disable the Finger service."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|III,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,Rule-ID|SV-15306r2_rule,STIG-ID|NET0730,SWIFT-CSCv1|2.3,Vuln-ID|V-3079"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system services"
  not_expect  : "set system services finger"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0740 - The network element must have HTTP service for administrative access disabled."
  info        : "The additional services the router is enabled for increases the risk for an attack since the router will listen for these services. In addition, these services provide an unsecured method for an attacker to gain access to the router. Most recent software versions support remote configuration and monitoring using the World Wide Web's HTTP protocol. In general, HTTP access is equivalent to interactive access to the router. The authentication protocol used for HTTP is equivalent to sending a clear-text password across the network, and, unfortunately, there is no effective provision in HTTP for challenge-based or one-time passwords. This makes HTTP a relatively risky choice for use across the public Internet. Any additional services that are enabled increase the risk for an attack since the router will listen for these services. The HTTPS server may be enabled for administrative access."
  solution    : "Configure the device to disable using HTTP (port 80) for administrative access."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,Rule-ID|SV-41468r2_rule,STIG-ID|NET0740,SWIFT-CSCv1|2.3,Vuln-ID|V-3085"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system services"
  not_expect  : "set system services web-management http .*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0742 - The router administrator will ensure FTP server is disabled."
  info        : "The additional services enabled on a router increases the risk for an attack since the router will listen for these services. In addition, these services provide an unsecured method for an attacker to gain access to the router."
  solution    : "Disable FTP server services on the device."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,Rule-ID|SV-15312r1_rule,STIG-ID|NET0742,SWIFT-CSCv1|2.3,Vuln-ID|V-14668"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system services"
  not_expect  : "set system services ftp.*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0744 - The network element must have all BSDr commands disabled."
  info        : "Berkeley Software Distribution (BSD) 'r' commands allow users to execute commands on remote systems using a variety of protocols.  The BSD \"r\" commands (e.g., rsh, rlogin, rcp, rdump, rrestore, and rdist) are designed to provide convenient remote access without passwords to services such as remote command execution (rsh), remote login (rlogin), and remote file copy (rcp and rdist).  The difficulty with these commands is that they use address-based authentication.  An attacker who convinces a server that he is coming from a \"trusted\" machine can essentially get complete and unrestricted access to a system.  The attacker can convince the server by impersonating a trusted machine and using IP address, by confusing DNS so that DNS thinks that the attacker's IP address maps to a trusted machine's name, or by any of a number of other methods"
  solution    : "Configure the device to disable BSDr command services."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,Rule-ID|SV-15315r2_rule,STIG-ID|NET0744,SWIFT-CSCv1|2.3,Vuln-ID|V-14669"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system services"
  not_expect  : "set system services (rsh|rlogin|rcp|rdump|rrestore|rdist).*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0770 - The router must have IP source routing disabled."
  info        : "Source routing is a feature of IP, whereby individual packets can specify routes. This feature is used in several different network attacks by bypassing perimeter and internal defense mechanisms."
  solution    : "Configure the router to disable IP source routing."
  reference   : "800-53|SC-5,CAT|II,CSF|DE.CM-1,CSF|PR.DS-4,ITSG-33|SC-5,NESA|T3.3.1,NIAv2|GS10c,NIAv2|GS8e,Rule-ID|SV-15317r2_rule,STIG-ID|NET0770,Vuln-ID|V-3081"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set chassis"
  expect      : "set chassis no-source-route"
</custom_item>

<report type:"WARNING">
  description : "NET0802 - The router administrator will ensure ICMPv6 unreachable notifications, and redirects are disabled on all external interfaces."
  info        : "The Internet Control Message Protocol version 6 (ICMPv6) supports IPv6 traffic by relaying information about paths, routes, and network conditions. Routers automatically send ICMPv6 messages under a wide variety of conditions. ICMPv6 messages are commonly used by attackers for network mapping and diagnosis: Host unreachable, and Redirect.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "The network element configuration must be changed to ensure ICMPv6 unreachables and redirects are disabled at all external interfaces."
  reference   : "CAT|II,Rule-ID|SV-15322r1_rule,STIG-ID|NET0802,Vuln-ID|V-14670"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0812 - The network element must use two or more NTP servers to synchronize time - NTP Server 1"
  info        : "Without synchronized time, accurately correlating information between devices becomes difficult, if not impossible. If you cannot successfully compare logs between each of your routers, switches, and firewalls, it will be very difficult to determine the exact events that resulted in a network breach incident. NTP provides an efficient and scalable method for network elements to synchronize to an accurate time source."
  solution    : "Configure the device to use two separate NTP servers."
  reference   : "800-171|3.3.7,800-53|AU-8,CAT|III,CN-L3|8.1.4.3(b),CSF|PR.PT-1,ITSG-33|AU-8,NESA|T3.6.2,Rule-ID|SV-41498r1_rule,STIG-ID|NET0812,TBA-FIISB|37.4,Vuln-ID|V-23747"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system ntp"
# Note: Variable @NTP_SERVER_1@ replaced with "192\\.168\\.3\\.1" in field "expect".
  expect      : "set system ntp server 192\\.168\\.3\\.1"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0812 - The network element must use two or more NTP servers to synchronize time - NTP Server 2"
  info        : "Without synchronized time, accurately correlating information between devices becomes difficult, if not impossible. If you cannot successfully compare logs between each of your routers, switches, and firewalls, it will be very difficult to determine the exact events that resulted in a network breach incident. NTP provides an efficient and scalable method for network elements to synchronize to an accurate time source."
  solution    : "Configure the device to use two separate NTP servers."
  reference   : "800-171|3.3.7,800-53|AU-8,CAT|III,CN-L3|8.1.4.3(b),CSF|PR.PT-1,ITSG-33|AU-8,NESA|T3.6.2,Rule-ID|SV-41498r1_rule,STIG-ID|NET0812,TBA-FIISB|37.4,Vuln-ID|V-23747"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system ntp"
# Note: Variable @NTP_SERVER_2@ replaced with "192\\.168\\.3\\.2" in field "expect".
  expect      : "set system ntp server 192\\.168\\.3\\.2"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0813 - The network element must authenticate all NTP messages received from NTP servers and peers - NTP authentication-key"
  info        : "Since NTP is used to ensure accurate log file time stamp information, NTP could pose a security risk if a malicious user were able to falsify NTP information. To launch an attack on the NTP infrastructure, a hacker could inject time that would be accepted by NTP clients by spoofing the IP address of a valid NTP server. To mitigate this risk, the time messages must be authenticated by the client before accepting them as a time source.

Two NTP-enabled devices can communicate in either client-server mode or peer-to-peer mode (aka 'symmetric mode'). The peering mode is configured manually on the device and indicated in the outgoing NTP packets. The fundamental difference is the synchronization behavior: an NTP server can synchronize to a peer with better stratum, whereas it will never synchronize to its client regardless of the client's stratum. From a protocol perspective, NTP clients are no different from the NTP servers. The NTP client can synchronize to multiple NTP servers, select the best server and synchronize with it, or synchronize to the averaged value returned by the servers.

A hierarchical model can be used to improve scalability. With this implementation, an NTP client can also become an NTP server providing time to downstream clients at a higher stratum level and of decreasing accuracy than that of its upstream server. To increase availability, NTP peering can be used between NTP servers. In the event the device loses connectivity to its upstream NTP server, it will be able to choose time from one of its peers.

The NTP authentication model is opposite of the typical client-server authentication model. NTP authentication enables an NTP client or peer to authenticate time received from their servers and peers. It is not used to authenticate NTP clients because NTP servers do not care about the authenticity of their clients, as they never accept any time from them."
  solution    : "Configure the device to authenticate all received NTP messages using a FIPS-approved message authentication code algorithm."
  reference   : "800-53|IA-3,CAT|II,CSF|PR.AC-1,ITSG-33|IA-3,NESA|T5.4.3,Rule-ID|SV-41501r3_rule,STIG-ID|NET0813,TBA-FIISB|27.1,Vuln-ID|V-14671"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system ntp"
# Note: Variable @NTP_AUTH_KEY@ replaced with "1" in field "expect".
  expect      : "set system ntp authentication-key 1 type .+"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0813 - The network element must authenticate all NTP messages received from NTP servers and peers - NTP Server 1 key"
  info        : "Since NTP is used to ensure accurate log file time stamp information, NTP could pose a security risk if a malicious user were able to falsify NTP information. To launch an attack on the NTP infrastructure, a hacker could inject time that would be accepted by NTP clients by spoofing the IP address of a valid NTP server. To mitigate this risk, the time messages must be authenticated by the client before accepting them as a time source.

Two NTP-enabled devices can communicate in either client-server mode or peer-to-peer mode (aka \"symmetric mode\"). The peering mode is configured manually on the device and indicated in the outgoing NTP packets. The fundamental difference is the synchronization behavior: an NTP server can synchronize to a peer with better stratum, whereas it will never synchronize to its client regardless of the client's stratum. From a protocol perspective, NTP clients are no different from the NTP servers. The NTP client can synchronize to multiple NTP servers, select the best server and synchronize with it, or synchronize to the averaged value returned by the servers.

A hierarchical model can be used to improve scalability. With this implementation, an NTP client can also become an NTP server providing time to downstream clients at a higher stratum level and of decreasing accuracy than that of its upstream server. To increase availability, NTP peering can be used between NTP servers. In the event the device loses connectivity to its upstream NTP server, it will be able to choose time from one of its peers.

The NTP authentication model is opposite of the typical client-server authentication model. NTP authentication enables an NTP client or peer to authenticate time received from their servers and peers. It is not used to authenticate NTP clients because NTP servers do not care about the authenticity of their clients, as they never accept any time from them.false"
  solution    : "Configure the device to authenticate all received NTP messages using either PKI (supported in NTP v4) or a FIPS-approved message authentication code algorithm."
  reference   : "800-53|IA-3,CAT|II,CSF|PR.AC-1,ITSG-33|IA-3,NESA|T5.4.3,Rule-ID|SV-41501r3_rule,STIG-ID|NET0813,TBA-FIISB|27.1,Vuln-ID|V-14671"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system ntp"
# Note: Variable @NTP_SERVER_1@ replaced with "192\\.168\\.3\\.1" in field "expect".
# Note: Variable @NTP_AUTH_KEY@ replaced with "1" in field "expect".
  expect      : "set system ntp server 192\\.168\\.3\\.1 key 1"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0813 - The network element must authenticate all NTP messages received from NTP servers and peers - NTP Server 2 key"
  info        : "Since NTP is used to ensure accurate log file time stamp information, NTP could pose a security risk if a malicious user were able to falsify NTP information. To launch an attack on the NTP infrastructure, a hacker could inject time that would be accepted by NTP clients by spoofing the IP address of a valid NTP server. To mitigate this risk, the time messages must be authenticated by the client before accepting them as a time source.

Two NTP-enabled devices can communicate in either client-server mode or peer-to-peer mode (aka \"symmetric mode\"). The peering mode is configured manually on the device and indicated in the outgoing NTP packets. The fundamental difference is the synchronization behavior: an NTP server can synchronize to a peer with better stratum, whereas it will never synchronize to its client regardless of the client's stratum. From a protocol perspective, NTP clients are no different from the NTP servers. The NTP client can synchronize to multiple NTP servers, select the best server and synchronize with it, or synchronize to the averaged value returned by the servers.

A hierarchical model can be used to improve scalability. With this implementation, an NTP client can also become an NTP server providing time to downstream clients at a higher stratum level and of decreasing accuracy than that of its upstream server. To increase availability, NTP peering can be used between NTP servers. In the event the device loses connectivity to its upstream NTP server, it will be able to choose time from one of its peers.

The NTP authentication model is opposite of the typical client-server authentication model. NTP authentication enables an NTP client or peer to authenticate time received from their servers and peers. It is not used to authenticate NTP clients because NTP servers do not care about the authenticity of their clients, as they never accept any time from them.false"
  solution    : "Configure the device to authenticate all received NTP messages using either PKI (supported in NTP v4) or a FIPS-approved message authentication code algorithm."
  reference   : "800-53|IA-3,CAT|II,CSF|PR.AC-1,ITSG-33|IA-3,NESA|T5.4.3,Rule-ID|SV-41501r3_rule,STIG-ID|NET0813,TBA-FIISB|27.1,Vuln-ID|V-14671"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system ntp"
# Note: Variable @NTP_SERVER_2@ replaced with "192\\.168\\.3\\.2" in field "expect".
# Note: Variable @NTP_AUTH_KEY@ replaced with "1" in field "expect".
  expect      : "set system ntp server 192\\.168\\.3\\.2 key 1"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0820 - The network element must have DNS servers defined if it is configured as a client resolver - DNS Server 1"
  info        : "The susceptibility of IP addresses to spoofing translates to DNS host name and IP address mapping vulnerabilities.  For example, suppose a source host wishes to establish a connection with a destination host and queries a DNS server for the IP address of the destination host name.  If the response to this query is the IP address of a host operated by an attacker, the source host will establish a connection with the attackers host, rather than the intended target.  The user on the source host might then provide logon, authentication, and other sensitive data."
  solution    : "Configure the device to include DNS servers or disable domain lookup."
  reference   : "800-53|SC-20,CAT|III,ITSG-33|SC-20,Rule-ID|SV-15331r2_rule,STIG-ID|NET0820,Vuln-ID|V-3020"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system name-server"
# Note: Variable @DNS_SERVER_1@ replaced with "192\\.168\\.3\\.1" in field "expect".
  expect      : "set system name-server 192\\.168\\.3\\.1"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0820 - The network element must have DNS servers defined if it is configured as a client resolver - DNS Server 2"
  info        : "The susceptibility of IP addresses to spoofing translates to DNS host name and IP address mapping vulnerabilities.  For example, suppose a source host wishes to establish a connection with a destination host and queries a DNS server for the IP address of the destination host name.  If the response to this query is the IP address of a host operated by an attacker, the source host will establish a connection with the attackers host, rather than the intended target.  The user on the source host might then provide logon, authentication, and other sensitive data."
  solution    : "Configure the device to include DNS servers or disable domain lookup."
  reference   : "800-53|SC-21,CAT|III,ITSG-33|SC-21,NESA|T4.5.1,Rule-ID|SV-15331r2_rule,STIG-ID|NET0820,Vuln-ID|V-3020"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system name-server"
# Note: Variable @DNS_SERVER_2@ replaced with "192\\.168\\.3\\.2" in field "expect".
  expect      : "set system name-server 192\\.168\\.3\\.2"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0890 - The network element must only allow write and poll SNMP access by authorized internal IP addresses."
  info        : "Detailed information about the network is sent across the network via SNMP.  If this information is discovered by attackers it could be used to trace the network, show the networks topology, and possibly gain access to network devices."
  solution    : "Configure the network devices to only allow SNMP access from only addresses belonging to the management network."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-15333r2_rule,STIG-ID|NET0890,TBA-FIISB|31.3,Vuln-ID|V-3021"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set snmp"
  expect      : "set snmp .+ clients .+"
</custom_item>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for SNMP v1/v2c"
      expect      : "set snmp community"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      type        : CONFIG_CHECK
      description : "NET0894 - The network device must only allow SNMP read-only access - v1/v2c"
      info        : "Enabling write access to the router via SNMP provides a mechanism that can be exploited by an attacker to set configuration variables that can disrupt network operations."
      solution    : "Configure the network device to allow for read-only SNMP access when using SNMPv1, v2c, or basic v3 (no authentication or privacy). Write access may be used if authentication is configured when using SNMPv3."
      reference   : "800-171|3.1.5,800-53|AC-6,CAT|II,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.10.6(a),CN-L3|8.1.4.2(d),CSF|PR.AC-4,CSF|PR.DS-5,ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,Rule-ID|SV-30087r3_rule,STIG-ID|NET0894,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3,Vuln-ID|V-3969"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex       : "set snmp"
      expect      : "set snmp .+ authorization read-only"
    </custom_item>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET0894 - The network device must only allow SNMP read-only access - v1/v2c"
      info        : "Enabling write access to the router via SNMP provides a mechanism that can be exploited by an attacker to set configuration variables that can disrupt network operations.

      NOTE: SNMP v1/v2c does not appear to be configured on the target."
      solution    : "Configure the network device to allow for read-only SNMP access when using SNMPv1, v2c, or basic v3 (no authentication or privacy). Write access may be used if authentication is configured when using SNMPv3."
      reference   : "800-171|3.1.5,800-53|AC-6,CAT|II,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CSF|PR.AC-4,CSF|PR.DS-5,ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,Rule-ID|SV-30087r3_rule,STIG-ID|NET0894,SWIFT-CSCv1|5.1,Vuln-ID|V-3969"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for TACACS+"
      expect      : "set system tacplus-server.+"
    </custom_item>
  </condition>

  <then>
    <if>
      <condition type:"AND">
        <custom_item>
          type        : CONFIG_CHECK
          description : "Check for system default-address-selection"
          expect      : "set system default-address-selection"
        </custom_item>

        <custom_item>
          type        : CONFIG_CHECK
          description : "Check for no tacacs+ source-address"
          not_expect  : "set system tacplus-server .+ source-address .+"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "NET0897 - The router must use its loopback or OOB address as the source address when originating TACACS+ or RADIUS - TACACS+"
          info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. TACACS+, RADIUS messages sent to management servers should use the loopback address as the source address.

          NOTE: System command 'default-address-selection' in place and no source-address config found for TACACS+."
          solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating authentication services traffic."
          reference   : "800-171|3.5.1,800-53|IA-2,CAT|III,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,Rule-ID|SV-16092r2_rule,STIG-ID|NET0897,Vuln-ID|V-14672"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
        </report>
      </then>

      <else>
        <custom_item>
          type        : CONFIG_CHECK
          description : "NET0897 - The router must use its loopback or OOB address as the source address when originating TACACS+ or RADIUS - TACACS+"
          info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. TACACS+, RADIUS messages sent to management servers should use the loopback address as the source address.

          NOTE: System 'default-address-selection' and TACACS+ config with 'source-address' found. A misconfiguration is possible in this scenario.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
          solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating authentication services traffic."
          reference   : "800-171|3.5.1,800-53|IA-2,CAT|III,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,Rule-ID|SV-16092r2_rule,STIG-ID|NET0897,Vuln-ID|V-14672"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
          regex       : "set system tacplus-server .+ source-address .+"
          severity    : MEDIUM
        </custom_item>
      </else>
    </if>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET0897 - The router must use its loopback or OOB address as the source address when originating TACACS+ or RADIUS - TACACS+"
      info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. TACACS+, RADIUS messages sent to management servers should use the loopback address as the source address.

      NOTE: TACACS+ does not appear to be configured on the target."
      solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating authentication services traffic."
      reference   : "800-171|3.5.1,800-53|IA-2,CAT|III,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,Rule-ID|SV-16092r2_rule,STIG-ID|NET0897,Vuln-ID|V-14672"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for RADIUS"
      expect      : "set system radius-server.+"
    </custom_item>
  </condition>

  <then>
    <if>
      <condition type:"AND">
        <custom_item>
          type        : CONFIG_CHECK
          description : "Check for system default-address-selection"
          expect      : "set system default-address-selection"
        </custom_item>

        <custom_item>
          type        : CONFIG_CHECK
          description : "Check for no radius source-address"
          not_expect  : "set system radius-server .+ source-address .+"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "NET0897 - The router must use its loopback or OOB address as the source address when originating TACACS+ or RADIUS - RADIUS"
          info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. TACACS+, RADIUS messages sent to management servers should use the loopback address as the source address.

          NOTE: System command 'default-address-selection' in place and no source-address config found for RADIUS."
          solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating authentication services traffic."
          reference   : "800-171|3.5.1,800-53|IA-2,CAT|III,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,Rule-ID|SV-16092r2_rule,STIG-ID|NET0897,Vuln-ID|V-14672"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
        </report>
      </then>

      <else>
        <custom_item>
          type        : CONFIG_CHECK
          description : "NET0897 - The router must use its loopback or OOB address as the source address when originating TACACS+ or RADIUS - RADIUS"
          info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. TACACS+, RADIUS messages sent to management servers should use the loopback address as the source address.

          NOTE: System 'default-address-selection' and RADIUS config with 'source-address' found. A misconfiguration is possible in this scenario.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
          solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating authentication services traffic."
          reference   : "800-171|3.5.1,800-53|IA-2,CAT|III,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,Rule-ID|SV-16092r2_rule,STIG-ID|NET0897,Vuln-ID|V-14672"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
          regex       : "set system radius-server .+ source-address .+"
          severity    : MEDIUM
        </custom_item>
      </else>
    </if>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET0897 - The router must use its loopback or OOB address as the source address when originating TACACS+ or RADIUS - RADIUS"
      info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. TACACS+, RADIUS messages sent to management servers should use the loopback address as the source address.

      NOTE: RADIUS does not appear to be configured on the target."
      solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating authentication services traffic."
      reference   : "800-171|3.5.1,800-53|IA-2,CAT|III,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,Rule-ID|SV-16092r2_rule,STIG-ID|NET0897,Vuln-ID|V-14672"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for syslog"
      expect      : "set system syslog.+"
    </custom_item>
  </condition>

  <then>
    <if>
      <condition type:"AND">
        <custom_item>
          type        : CONFIG_CHECK
          description : "Check for system default-address-selection"
          expect      : "set system default-address-selection"
        </custom_item>

        <custom_item>
          type        : CONFIG_CHECK
          description : "Check for no syslog source-address"
          not_expect  : "set system syslog .+ source-address .+"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "NET0898 - The router must use its loopback or OOB management interface address as the source address when originating syslog traffic."
          info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. Syslog messages sent to management servers should use the loopback address as the source address.

          NOTE: System command 'default-address-selection' in place and no source-address config found for syslog."
          solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating syslog traffic."
          reference   : "800-53|AU-10,CAT|III,CSF|PR.PT-1,ITSG-33|AU-10,Rule-ID|SV-15341r2_rule,STIG-ID|NET0898,Vuln-ID|V-14673"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
        </report>
      </then>

      <else>
        <custom_item>
          type        : CONFIG_CHECK
          description : "NET0898 - The router must use its loopback or OOB management interface address as the source address when originating syslog traffic."
          info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. Syslog messages sent to management servers should use the loopback address as the source address.

          NOTE: System 'default-address-selection' and syslog config with 'source-address' found. A misconfiguration is possible in this scenario.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
          solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating syslog traffic."
          reference   : "800-53|AU-10(1),CAT|III,CSF|PR.PT-1,ITSG-33|AU-10(1),Rule-ID|SV-15341r2_rule,STIG-ID|NET0898,Vuln-ID|V-14673"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
          regex       : "set system syslog .+ source-address .+"
          severity    : MEDIUM
        </custom_item>
      </else>
    </if>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET0898 - The router must use its loopback or OOB management interface address as the source address when originating syslog traffic."
      info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. Syslog messages sent to management servers should use the loopback address as the source address.

          NOTE: Syslog does not appear to be configured on the target."
      solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating syslog traffic."
      reference   : "800-53|AU-10,CAT|III,CSF|PR.PT-1,ITSG-33|AU-10,Rule-ID|SV-15341r2_rule,STIG-ID|NET0898,Vuln-ID|V-14673"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for ntp"
      expect      : "set system ntp.+"
    </custom_item>
  </condition>

  <then>
    <if>
      <condition type:"AND">
        <custom_item>
          type        : CONFIG_CHECK
          description : "Check for system default-address-selection"
          expect      : "set system default-address-selection"
        </custom_item>

        <custom_item>
          type        : CONFIG_CHECK
          description : "Check for no ntp source-address"
          not_expect  : "set system ntp .+ source-address .+"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "NET0899 - The router must use its loopback or OOB management interface address as the source address when originating NTP traffic."
          info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. NTP messages sent to management servers should use the loopback address as the source address.

          NOTE: System command 'default-address-selection' in place and no source-address config found for ntp."
          solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating NTP traffic."
          reference   : "800-171|3.3.7,800-53|AU-8,CAT|III,CSF|PR.PT-1,ITSG-33|AU-8,NESA|T3.6.2,Rule-ID|SV-15344r2_rule,STIG-ID|NET0899,Vuln-ID|V-14674"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
        </report>
      </then>

      <else>
        <custom_item>
          type        : CONFIG_CHECK
          description : "NET0899 - The router must use its loopback or OOB management interface address as the source address when originating NTP traffic."
          info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. NTP messages sent to management servers should use the loopback address as the source address.

          NOTE: System 'default-address-selection' and ntp config with 'source-address' found. A misconfiguration is possible in this scenario.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
          solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating NTP traffic."
          reference   : "800-171|3.3.7,800-53|AU-8,CAT|III,CN-L3|8.1.4.3(b),CSF|PR.PT-1,ITSG-33|AU-8,NESA|T3.6.2,Rule-ID|SV-15344r2_rule,STIG-ID|NET0899,TBA-FIISB|37.4,Vuln-ID|V-14674"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
          regex       : "set system ntp .+ source-address .+"
          severity    : MEDIUM
        </custom_item>
      </else>
    </if>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET0899 - The router must use its loopback or OOB management interface address as the source address when originating NTP traffic."
      info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. NTP messages sent to management servers should use the loopback address as the source address.

      NOTE: NTP does not appear to be configured on the target."
      solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating NTP traffic."
      reference   : "800-171|3.3.7,800-53|AU-8,CAT|III,CSF|PR.PT-1,ITSG-33|AU-8,NESA|T3.6.2,Rule-ID|SV-15344r2_rule,STIG-ID|NET0899,Vuln-ID|V-14674"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for snmp"
      expect      : "set snmp.+"
    </custom_item>
  </condition>

  <then>
    <if>
      <condition type:"AND">
        <custom_item>
          type        : CONFIG_CHECK
          description : "Check for system default-address-selection"
          expect      : "set system default-address-selection"
        </custom_item>

        <custom_item>
          type        : CONFIG_CHECK
          description : "Check for no snmp source-address"
          not_expect  : "set snmp .+ source-address .+"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "NET0900 - The router must use its loopback or OOB management interface address as the source address when originating SNMP traffic."
          info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. SNMP messages sent to management servers should use the loopback address as the source address.

          NOTE: System command 'default-address-selection' in place and no 'source-address' config found for snmp."
          solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating SNMP traffic."
          reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-15347r2_rule,STIG-ID|NET0900,SWIFT-CSCv1|2.3,Vuln-ID|V-14675"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
        </report>
      </then>

      <else>
        <custom_item>
          type        : CONFIG_CHECK
          description : "NET0900 - The router must use its loopback or OOB management interface address as the source address when originating SNMP traffic."
          info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. SNMP messages sent to management servers should use the loopback address as the source address.

          NOTE: System 'default-address-selection' and snmp config with 'source-address' found. A misconfiguration is possible in this scenario.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
          solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating SNMP traffic."
          reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-15347r2_rule,STIG-ID|NET0900,SWIFT-CSCv1|2.3,Vuln-ID|V-14675"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
          regex       : "set snmp .+ source-address .+"
          severity    : MEDIUM
        </custom_item>
      </else>
    </if>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET0900 - The router must use its loopback or OOB management interface address as the source address when originating SNMP traffic."
      info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. SNMP messages sent to management servers should use the loopback address as the source address.

      NOTE: SNMP does not appear to be configured on the target."
      solution    : "Configure the device to use its loopback or OOB management interface address as the source address when originating SNMP traffic."
      reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-15347r2_rule,STIG-ID|NET0900,SWIFT-CSCv1|2.3,Vuln-ID|V-14675"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for netflow"
      expect      : "set forwarding-options.+(cflowd|flow-server).+"
    </custom_item>
  </condition>

  <then>
    <if>
      <condition type:"AND">
        <custom_item>
          type        : CONFIG_CHECK
          description : "Check for system default-address-selection"
          expect      : "set system default-address-selection"
        </custom_item>

        <custom_item>
          type        : CONFIG_CHECK
          description : "Check for no snmp source-address"
          not_expect  : "set forwarding-options.+(cflowd|flow-server).+source-address.+"
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "NET0901 - The router must use its loopback or OOB management interface address as the source address when originating NetFlow traffic."
          info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. Netflow messages sent to management servers should use the loopback address as the source address.

          NOTE: System command 'default-address-selection' in place and no 'source-address' config found for netflow."
          solution    : "Configure the router to use its loopback or OOB management interface address as the source address when originating NetFlow traffic."
          reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-15350r2_rule,STIG-ID|NET0901,SWIFT-CSCv1|2.3,Vuln-ID|V-14676"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
        </report>
      </then>

      <else>
        <custom_item>
          type        : CONFIG_CHECK
          description : "NET0901 - The router must use its loopback or OOB management interface address as the source address when originating NetFlow traffic."
          info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. Netflow messages sent to management servers should use the loopback address as the source address.

          NOTE: System 'default-address-selection' and netflow config with 'source-address' found. A misconfiguration is possible in this scenario.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
          solution    : "Configure the router to use its loopback or OOB management interface address as the source address when originating NetFlow traffic."
          reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-15350r2_rule,STIG-ID|NET0901,SWIFT-CSCv1|2.3,Vuln-ID|V-14676"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
          regex       : "set forwarding-options.+(cflowd|flow-server).+source-address.+"
          severity    : MEDIUM
        </custom_item>
      </else>
    </if>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET0901 - The router must use its loopback or OOB management interface address as the source address when originating NetFlow traffic."
      info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of routers. It is easier to construct appropriate ingress filters for router management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. Netflow messages sent to management servers should use the loopback address as the source address.

      NOTE: Netflow does not appear to be configured on the target."
      solution    : "Configure the router to use its loopback or OOB management interface address as the source address when originating NetFlow traffic."
      reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-15350r2_rule,STIG-ID|NET0901,SWIFT-CSCv1|2.3,Vuln-ID|V-14676"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for system default-address-selection"
      expect      : "set system default-address-selection"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "NET0902 - The device must use its loopback or OOB management interface address as the source address when originating TFTP or FTP traffic."
      info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of network devices. It is easier to construct appropriate ingress filters for management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. TFTP and FTP messages sent to management servers should use the loopback address as the source address."
      solution    : "Configure the network device to use a loopback or OOB management interface address as the source address when originating TFTP or FTP traffic."
      reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-15353r3_rule,STIG-ID|NET0902,SWIFT-CSCv1|2.3,Vuln-ID|V-14677"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </then>

  <else>
    <custom_item>
      type        : CONFIG_CHECK
      description : "NET0902 - The device must use its loopback or OOB management interface address as the source address when originating TFTP or FTP traffic."
      info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability of network devices. It is easier to construct appropriate ingress filters for management plane traffic destined to the network management subnet since the source addresses will be from the range used for loopback interfaces instead of a larger range of addresses used for physical interfaces. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses. TFTP and FTP messages sent to management servers should use the loopback address as the source address."
      solution    : "Configure the network device to use a loopback or OOB management interface address as the source address when originating TFTP or FTP traffic."
      reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-15353r3_rule,STIG-ID|NET0902,SWIFT-CSCv1|2.3,Vuln-ID|V-14677"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex       : "set system"
      expect      : "set system default-address-selection"
    </custom_item>
  </else>
</if>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0903 - The router must use its loopback interface address as the source address for all iBGP peering sessions."
  info        : "Using a loopback address as the source address offers a multitude of uses for security, access, management, and scalability. It is easier to construct appropriate filters for control plane traffic. Log information recorded by authentication and syslog servers will record the router's loopback address instead of the numerous physical interface addresses.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the network device's loopback address as the source address for iBGP peering."
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-15360r2_rule,STIG-ID|NET0903,SWIFT-CSCv1|2.3,Vuln-ID|V-14681"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set protocols bgp .+"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0965 - The network device must drop half-open TCP connections through filtering thresholds or timeout periods."
  info        : "A TCP connection consists of a three-way handshake message sequence. A connection request is transmitted by the originator, an acknowledgement is returned from the receiver, and then an acceptance of that acknowledgement is sent by the originator.

An attacker's goal in this scenario is to cause a denial of service to the network or device by initiating a high volume of TCP packets, then never sending an acknowledgement, leaving connections in a half-opened state.  Without the device having a connection or time threshold for these half-opened sessions, the device risks being a victim of a denial of service attack.  Setting a TCP timeout threshold will instruct the device to shut down any incomplete connections. Services such as SSH, BGP, SNMP, LDP, etc. are some services that may be prone to these types of denial of service attacks. If the router does not have any BGP connections with BGP neighbors across WAN links, values could be set to even tighter constraints."
  solution    : "Configure the device to drop half-open TCP connections through threshold filtering or timeout periods."
  reference   : "800-171|3.1.11,800-53|AC-12,CAT|II,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv6|16.4,HIPAA|164.312(a)(2)(iii),ITSG-33|AC-12,NIAv2|NS49,PCI-DSSv3.1|12.3.8,PCI-DSSv3.1|8.1.8,PCI-DSSv3.2|12.3.8,PCI-DSSv3.2|8.1.8,Rule-ID|SV-15437r4_rule,STIG-ID|NET0965,Vuln-ID|V-5646"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set security screen"
  expect      : "set security screen .+ tcp syn-flood timeout ([1-9]|10)$"
</custom_item>

<report type:"WARNING">
  description : "NET0966 - Control plane protection is not enabled."
  info        : "The Route Processor (RP) is critical to all network operations as it is the component used to build all forwarding paths for the data plane via control plane processes. It is also instrumental with ongoing network management functions that keep the routers and links available for providing network services. Hence, any disruption to the RP or the control and management planes can result in mission critical network outages.

In addition to control plane and management plane traffic that is in the router's receive path, the RP must also handle other traffic that must be punted to the RP - that is, the traffic must be fast or process switched. This is the result of packets that must be fragmented, require an ICMP response (TTL expiration, unreachable, etc.) have IP options, etc. A DoS attack targeting the RP can be perpetrated either inadvertently or maliciously involving high rates of punted traffic resulting in excessive RP CPU and memory utilization. To maintain network stability, the router must be able to securely handle specific control plane and management plane traffic that is destined to it, as well as other punted traffic.

Using the ingress filter on forwarding interfaces is a method that has been used in the past to filter both forwarding path and receiving path traffic. However, this method does not scale well as the number of interfaces grows and the size of the ingress filters grow. Control plane policing can be used to increase security of routers and multilayer switches by protecting the RP from unnecessary or malicious traffic. Filtering and rate limiting the traffic flow of control plane packets can be implemented to protect routers against reconnaissance and DoS attacks allowing the control plane to maintain packet forwarding and protocol states despite an attack or heavy load on the router or multilayer switch.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Implement control plane protection by classifying traffic types based on importance levels and configure filters to restrict and rate limit the traffic punted to the route processor as according to each class."
  reference   : "CAT|II,Rule-ID|SV-21168r2_rule,STIG-ID|NET0966,Vuln-ID|V-19188"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<report type:"WARNING">
  description : "NET0985 - IGP instances configured on the OOBM gateway router do not peer only with their appropriate routing domain"
  info        : "If the gateway router is not a dedicated device for the OOBM network, several safeguards must be implemented for containment of management and production traffic boundaries. Since the managed network and the management network are separate routing domains, separate IGP routing instances must be configured on the router - one for the managed network and one for the OOBM network.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Ensure that multiple IGP instances configured on the OOBM gateway router peer only with their appropriate routing domain. Verify that the all interfaces are configured for the appropriate IGP instance."
  reference   : "CAT|II,Rule-ID|SV-19298r1_rule,STIG-ID|NET0985,Vuln-ID|V-17815"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0986 - The routes from the two IGP domains are redistributed to each other - policy-options"
  info        : "If the gateway router is not a dedicated device for the OOBM network, several safeguards must be implemented for containment of management and production traffic boundaries. Since the managed network and the management network are separate routing domains, separate IGP routing instances must be configured on the router - one for the managed network and one for the OOBM network. In addition, the routes from the two domains must not be redistributed to each other."
  solution    : "Ensure that the IGP instance used for the managed network does not redistribute routes into the IGP instance used for the management network and vice versa."
  reference   : "800-171|3.13.2,800-171|3.13.5,800-53|SC-7(20),CAT|II,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,NESA|T4.5.3,Rule-ID|SV-19300r1_rule,STIG-ID|NET0986,Vuln-ID|V-17816"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set policy-options"
  not_expect  : "set policy-options .+ from protocol (isis|ospf|ospf2|ospf3|rip|ripng)"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0986 - The routes from the two IGP domains are redistributed to each other - protocols export"
  info        : "If the gateway router is not a dedicated device for the OOBM network, several safeguards must be implemented for containment of management and production traffic boundaries. Since the managed network and the management network are separate routing domains, separate IGP routing instances must be configured on the router - one for the managed network and one for the OOBM network. In addition, the routes from the two domains must not be redistributed to each other.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Ensure that the IGP instance used for the managed network does not redistribute routes into the IGP instance used for the management network and vice versa."
  reference   : "800-171|3.13.2,800-171|3.13.5,800-53|SC-7(20),CAT|II,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,NESA|T4.5.3,Rule-ID|SV-19300r1_rule,STIG-ID|NET0986,Vuln-ID|V-17816"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set protocols .+ export"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0987 - Traffic from the managed network is able to access the OOBM gateway router - loopback filter"
  info        : "If the gateway router is not a dedicated device for the OOBM network, several safeguards must be implemented for containment of management and production traffic boundaries. It is imperative that hosts from the managed network are not able to access the OOBM gateway router."
  solution    : "Ensure that traffic from the managed network is not able to access the OOBM gateway router using either receive path or interface ingress ACLs."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-19302r2_rule,STIG-ID|NET0987,TBA-FIISB|31.3,Vuln-ID|V-17817"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @LOOPBACK_FILTER_INPUT@ replaced with "router-protect-filter" in field "expect".
  expect      : "set interfaces lo0 .+ filter input router-protect-filter"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0987 - Traffic from the managed network is able to access the OOBM gateway router - firewall filter rules"
  info        : "If the gateway router is not a dedicated device for the OOBM network, several safeguards must be implemented for containment of management and production traffic boundaries. It is imperative that hosts from the managed network are not able to access the OOBM gateway router.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Ensure that traffic from the managed network is not able to access the OOBM gateway router using either receive path or interface ingress ACLs."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-19302r2_rule,STIG-ID|NET0987,TBA-FIISB|31.3,Vuln-ID|V-17817"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @LOOPBACK_FILTER_INPUT@ replaced with "router-protect-filter" in field "regex".
  regex       : "set firewall filter router-protect-filter .*"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0988 - Traffic from the managed network will leak into the management network - OOBM Interface"
  info        : "If the gateway router is not a dedicated device for the OOBM network, several safeguards must be implemented for containment of management and production traffic boundaries such as using interface ACLs or filters at the boundaries between the two networks."
  solution    : "Configure the OOBM gateway router interface ACLs to ensure traffic from the managed network does not leak into the management network."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-19304r1_rule,STIG-ID|NET0988,TBA-FIISB|31.3,Vuln-ID|V-17818"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @OOBM_INTERFACE@ replaced with "ge-0/0/0" in field "regex".
  regex       : "set interfaces ge-0/0/0"
# Note: Variable @OOBM_INTERFACE@ replaced with "ge-0/0/0" in field "expect".
# Note: Variable @OOBM_EGRESS_FILTER@ replaced with "oobm-egress-filter" in field "expect".
  expect      : "set interfaces ge-0/0/0 .+ filter output oobm-egress-filter"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0988 - Traffic from the managed network will leak into the management network - OOBM Firewall Egress Filter"
  info        : "If the gateway router is not a dedicated device for the OOBM network, several safeguards must be implemented for containment of management and production traffic boundaries such as using interface ACLs or filters at the boundaries between the two networks."
  solution    : "Configure the OOBM gateway router interface ACLs to ensure traffic from the managed network does not leak into the management network."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-19304r1_rule,STIG-ID|NET0988,TBA-FIISB|31.3,Vuln-ID|V-17818"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @OOBM_EGRESS_FILTER@ replaced with "oobm-egress-filter" in field "regex".
  regex       : "set firewall filter oobm-egress-filter"
# Note: Variable @OOBM_EGRESS_FILTER@ replaced with "oobm-egress-filter" in field "expect".
# Note: Variable @LOCAL_MANAGEMENT_NETWORK@ replaced with "10\\.10\\.2\\.0 0\\.0\\.0\\.255" in field "expect".
  expect      : "set firewall filter oobm-egress-filter .+ from source-address 10\\.10\\.2\\.0 0\\.0\\.0\\.255"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0989 - Management network traffic is leaking into the managed network - OOBM Interface"
  info        : "If the gateway router is not a dedicated device for the OOBM network, several safeguards must be implemented for containment of management and production traffic boundaries. To provide separation, access control lists or filters must be configured to block any traffic from the management network destined for the managed network's production address spaces."
  solution    : "Configure access control lists or filters to block any traffic from the management network destined for the managed network's production address spaces."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-19306r1_rule,STIG-ID|NET0989,TBA-FIISB|31.3,Vuln-ID|V-17819"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @OOBM_INTERFACE@ replaced with "ge-0/0/0" in field "regex".
  regex       : "set interfaces ge-0/0/0"
# Note: Variable @OOBM_INTERFACE@ replaced with "ge-0/0/0" in field "expect".
# Note: Variable @LOOPBACK_FILTER_INPUT@ replaced with "router-protect-filter" in field "expect".
  expect      : "set interfaces ge-0/0/0 .+ filter input router-protect-filter"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0989 - Management network traffic is leaking into the managed network - OOBM Firewall Ingress filter"
  info        : "If the gateway router is not a dedicated device for the OOBM network, several safeguards must be implemented for containment of management and production traffic boundaries. To provide separation, access control lists or filters must be configured to block any traffic from the management network destined for the managed network's production address spaces."
  solution    : "Configure access control lists or filters to block any traffic from the management network destined for the managed network's production address spaces."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-19306r1_rule,STIG-ID|NET0989,TBA-FIISB|31.3,Vuln-ID|V-17819"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @OOBM_INGRESS_FILTER@ replaced with "oobm-ingress-filter" in field "regex".
  regex       : "set firewall filter oobm-ingress-filter"
# Note: Variable @OOBM_INGRESS_FILTER@ replaced with "oobm-ingress-filter" in field "expect".
# Note: Variable @REMOTE_MANAGEMENT_NETWORK@ replaced with "10\\.10\\.1\\.0 0\\.0\\.0\\.255" in field "expect".
  expect      : "set firewall filter oobm-ingress-filter .+ from source-address 10\\.10\\.1\\.0 0\\.0\\.0\\.255"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0991 - The network element's OOBM interface must be configured with an OOBM network address."
  info        : "The OOBM access switch will connect to the management interface of the managed network elements. The management interface of the managed network element will be directly connected to the OOBM network. An OOBM interface does not forward transit traffic; thereby, providing complete separation of production and management traffic. Since all management traffic is immediately forwarded into the management network, it is not exposed to possible tampering.  The separation also ensures that congestion or failures in the managed network do not affect the management of the device. If the OOBM interface does not have an IP address from the managed network address space, it will not have reachability from the NOC using scalable and normal control plane and forwarding mechanisms."
  solution    : "Configure the OOB management interface with an IP address from the address space belonging to the OOBM network."
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|II,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-20206r2_rule,STIG-ID|NET0991,SWIFT-CSCv1|2.3,Vuln-ID|V-17821"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @MANAGEMENT_INTERFACE@ replaced with "fe-0/0/1" in field "regex".
  regex       : "set interfaces fe-0/0/1"
# Note: Variable @MANAGEMENT_INTERFACE@ replaced with "fe-0/0/1" in field "expect".
# Note: Variable @MANAGEMENT_IP_AND_NETMASK@ replaced with "10\\.10\\.2\\.1 255\\.255\\.255\\.0" in field "expect".
  expect      : "set interfaces fe-0/0/1 .+ address 10\\.10\\.2\\.1 255\\.255\\.255\\.0"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0992 - The management interface is not configured with both an ingress and egress ACL - Management Interface Input Filter"
  info        : "The OOBM access switch will connect to the management interface of the managed network elements. The management interface can be a true OOBM interface or a standard interface functioning as the management interface. In either case, the management interface of the managed network element will be directly connected to the OOBM network.

An OOBM interface does not forward transit traffic; thereby, providing complete separation of production and management traffic. Since all management traffic is immediately forwarded into the management network, it is not exposed to possible tampering.  The separation also ensures that congestion or failures in the managed network do not affect the management of the device. If the device does not have an OOBM port, the interface functioning as the management interface must be configured so that management traffic does not leak into the managed network and that production traffic does not leak into the management network"
  solution    : "If the management interface is a routed interface, it must be configured with both an ingress and egress ACL. The ingress ACL should block any transit traffic, while the egress ACL should block any traffic that was not originated by the managed network device."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-20209r1_rule,STIG-ID|NET0992,TBA-FIISB|31.3,Vuln-ID|V-17822"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @MANAGEMENT_INTERFACE@ replaced with "fe-0/0/1" in field "regex".
  regex       : "set interfaces fe-0/0/1"
# Note: Variable @MANAGEMENT_INTERFACE@ replaced with "fe-0/0/1" in field "expect".
# Note: Variable @OOBM_INGRESS_FILTER@ replaced with "oobm-ingress-filter" in field "expect".
  expect      : "set interfaces fe-0/0/1 .+ filter input oobm-ingress-filter"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0992 - The management interface is not configured with both an ingress and egress ACL - Management Interface Output Filter"
  info        : "The OOBM access switch will connect to the management interface of the managed network elements. The management interface can be a true OOBM interface or a standard interface functioning as the management interface. In either case, the management interface of the managed network element will be directly connected to the OOBM network.

An OOBM interface does not forward transit traffic; thereby, providing complete separation of production and management traffic. Since all management traffic is immediately forwarded into the management network, it is not exposed to possible tampering.  The separation also ensures that congestion or failures in the managed network do not affect the management of the device. If the device does not have an OOBM port, the interface functioning as the management interface must be configured so that management traffic does not leak into the managed network and that production traffic does not leak into the management network"
  solution    : "If the management interface is a routed interface, it must be configured with both an ingress and egress ACL. The ingress ACL should block any transit traffic, while the egress ACL should block any traffic that was not originated by the managed network device."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-20209r1_rule,STIG-ID|NET0992,TBA-FIISB|31.3,Vuln-ID|V-17822"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @MANAGEMENT_INTERFACE@ replaced with "fe-0/0/1" in field "regex".
  regex       : "set interfaces fe-0/0/1"
# Note: Variable @MANAGEMENT_INTERFACE@ replaced with "fe-0/0/1" in field "expect".
# Note: Variable @OOBM_INGRESS_FILTER@ replaced with "oobm-ingress-filter" in field "expect".
  expect      : "set interfaces fe-0/0/1 .+ filter output oobm-ingress-filter"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0992 - The management interface is not configured with both an ingress and egress ACL - Firewall Output Filter"
  info        : "The OOBM access switch will connect to the management interface of the managed network elements. The management interface can be a true OOBM interface or a standard interface functioning as the management interface. In either case, the management interface of the managed network element will be directly connected to the OOBM network.

An OOBM interface does not forward transit traffic; thereby, providing complete separation of production and management traffic. Since all management traffic is immediately forwarded into the management network, it is not exposed to possible tampering.  The separation also ensures that congestion or failures in the managed network do not affect the management of the device. If the device does not have an OOBM port, the interface functioning as the management interface must be configured so that management traffic does not leak into the managed network and that production traffic does not leak into the management network"
  solution    : "If the management interface is a routed interface, it must be configured with both an ingress and egress ACL. The ingress ACL should block any transit traffic, while the egress ACL should block any traffic that was not originated by the managed network device."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-20209r1_rule,STIG-ID|NET0992,TBA-FIISB|31.3,Vuln-ID|V-17822"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @OOBM_INGRESS_FILTER@ replaced with "oobm-ingress-filter" in field "regex".
  regex       : "set firewall filter oobm-ingress-filter"
# Note: Variable @OOBM_INGRESS_FILTER@ replaced with "oobm-ingress-filter" in field "expect".
# Note: Variable @REMOTE_MANAGEMENT_NETWORK@ replaced with "10\\.10\\.1\\.0 0\\.0\\.0\\.255" in field "expect".
# Note: Variable @LOCAL_MANAGEMENT_NETWORK@ replaced with "10\\.10\\.2\\.0 0\\.0\\.0\\.255" in field "expect".
  expect      : "set firewall filter oobm-ingress-filter .+ from source-address 10\\.10\\.1\\.0 0\\.0\\.0\\.255 destination-address 10\\.10\\.2\\.0 0\\.0\\.0\\.255"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET0992 - The management interface is not configured with both an ingress and egress ACL - Firewall Input Filter"
  info        : "The OOBM access switch will connect to the management interface of the managed network elements. The management interface can be a true OOBM interface or a standard interface functioning as the management interface. In either case, the management interface of the managed network element will be directly connected to the OOBM network.

An OOBM interface does not forward transit traffic; thereby, providing complete separation of production and management traffic. Since all management traffic is immediately forwarded into the management network, it is not exposed to possible tampering.  The separation also ensures that congestion or failures in the managed network do not affect the management of the device. If the device does not have an OOBM port, the interface functioning as the management interface must be configured so that management traffic does not leak into the managed network and that production traffic does not leak into the management network"
  solution    : "If the management interface is a routed interface, it must be configured with both an ingress and egress ACL. The ingress ACL should block any transit traffic, while the egress ACL should block any traffic that was not originated by the managed network device."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-20209r1_rule,STIG-ID|NET0992,TBA-FIISB|31.3,Vuln-ID|V-17822"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @OOBM_INGRESS_FILTER@ replaced with "oobm-ingress-filter" in field "regex".
  regex       : "set firewall filter oobm-ingress-filter"
# Note: Variable @OOBM_INGRESS_FILTER@ replaced with "oobm-ingress-filter" in field "expect".
# Note: Variable @LOCAL_MANAGEMENT_NETWORK@ replaced with "10\\.10\\.2\\.0 0\\.0\\.0\\.255" in field "expect".
# Note: Variable @REMOTE_MANAGEMENT_NETWORK@ replaced with "10\\.10\\.1\\.0 0\\.0\\.0\\.255" in field "expect".
  expect      : "set firewall filter oobm-ingress-filter .+ from source-address 10\\.10\\.2\\.0 0\\.0\\.0\\.255 destination-address 10\\.10\\.1\\.0 0\\.0\\.0\\.255"
</custom_item>

<report type:"WARNING">
  description : "NET0993 - The network element's management interface is not configured as passive for the IGP instance deployed in the managed network."
  info        : "The OOBM access switch will connect to the management interface of the managed network elements. The management interface can be a true OOBM interface or a standard interface functioning as the management interface. In either case, the management interface of the managed network element will be directly connected to the OOBM network.

An OOBM interface does not forward transit traffic; thereby, providing complete separation of production and management traffic. Since all management traffic is immediately forwarded into the management network, it is not exposed to possible tampering. The separation also ensures congestion or failures in the managed network do not affect the management of the device. If the device does not have an OOBM port, the interface functioning as the management interface must be configured so management traffic, both data plane and control plane, does not leak into the managed network and production traffic does not leak into the management network.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Configure the management interface as passive for the IGP instance configured for the managed network. Depending on the platform and routing protocol, this may simply require that the interface or its IP address is not included in the IGP configuration."
  reference   : "CAT|III,Rule-ID|SV-19335r2_rule,STIG-ID|NET0993,Vuln-ID|V-17823"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for vlan-tagging, assume inter-vlan routing is used"
      expect      : "set interfaces .+ (flexible-|stacked-)?vlan-tagging"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      type        : CONFIG_CHECK
      description : "NET1005 - An inbound ACL is not configured for the management network sub-interface of the trunk link to block non-management traffic."
      info        : "If the management systems reside within the same layer 2 switching domain as the managed network elements, then separate VLANs will be deployed to provide separation at that level. In this case, the management network still has its own subnet while at the same time it is defined as a unique VLAN. Inter-VLAN routing or the routing of traffic between nodes residing in different subnets requires a router or multi-layer switch (MLS). Access control lists must be used to enforce the boundaries between the management network and the network being managed. All physical and virtual (i.e. MLS SVI) routed interfaces must be configured with ACLs to prevent the leaking of unauthorized traffic from one network to the other."
      solution    : " If a router is used to provide inter-VLAN routing, configure an inbound ACL for the management network sub-interface for the trunk link to block non-management traffic."
      reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-19309r1_rule,STIG-ID|NET1005,TBA-FIISB|31.3,Vuln-ID|V-17834"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @NIPRNET_LINK_INTERFACE@ replaced with "fe-0/0/1" in field "regex".
      regex       : "set interfaces fe-0/0/1"
# Note: Variable @NIPRNET_LINK_INTERFACE@ replaced with "fe-0/0/1" in field "expect".
# Note: Variable @OOBM_INGRESS_FILTER@ replaced with "oobm-ingress-filter" in field "expect".
      expect      : "set interfaces fe-0/0/1 .+ filter input oobm-ingress-filter"
    </custom_item>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET1005 - An inbound ACL is not configured for the management network sub-interface of the trunk link to block non-management traffic."
      info        : "If the management systems reside within the same layer 2 switching domain as the managed network elements, then separate VLANs will be deployed to provide separation at that level. In this case, the management network still has its own subnet while at the same time it is defined as a unique VLAN. Inter-VLAN routing or the routing of traffic between nodes residing in different subnets requires a router or multi-layer switch (MLS). Access control lists must be used to enforce the boundaries between the management network and the network being managed. All physical and virtual (i.e. MLS SVI) routed interfaces must be configured with ACLs to prevent the leaking of unauthorized traffic from one network to the other.

    NOTE: Inter-VLAN routing does not appear to be used on the target."
      solution    : " If a router is used to provide inter-VLAN routing, configure an inbound ACL for the management network sub-interface for the trunk link to block non-management traffic."
      reference   : "800-171|3.13.1,800-53|SC-7,CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7,NIAv2|GS7c,Rule-ID|SV-19309r1_rule,STIG-ID|NET1005,Vuln-ID|V-17834"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<report type:"WARNING">
  description : "NET1006 - Traffic entering the tunnels is not restricted to only the authorized management packets based on destination address."
  info        : "Similar to the OOBM model, when the production network is managed in-band, the management network could also be housed at a NOC that is located locally or remotely at a single or multiple interconnected sites. NOC interconnectivity as well as connectivity between the NOC and the managed networks' premise routers would be enabled using either provisioned circuits or VPN technologies such as IPSec tunnels or MPLS VPN services.

  NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Where IPSec technology is deployed to connect the managed network to the NOC, it is imperative that the traffic entering the tunnels is restricted to only the authorized management packets based on destination address."
  reference   : "CAT|II,Rule-ID|SV-19311r1_rule,STIG-ID|NET1006,Vuln-ID|V-17835"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1007 - Management traffic is not classified and marked at the nearest upstream MLS or router - Firewall filter"
  info        : "When network congestion occurs, all traffic has an equal chance of being dropped.
Prioritization of network management traffic must be implemented to ensure that even during periods of severe network congestion, the network can be managed and monitored. Quality of Service (QoS) provisioning categorizes network traffic, prioritizes it according to its relative importance, and provides priority treatment through congestion avoidance techniques. Implementing QoS within the network makes network performance more predictable and bandwidth utilization more effective. Most important, since the same bandwidth is being used to manage the network, it provides some assurance that there will be bandwidth available to troubleshoot outages and restore availability when needed.

When management traffic must traverse several nodes to reach the management network, management traffic should be classified and marked at the nearest upstream MLS or router. In addition, all core routers within the managed network must be configured to provide preferred treatment based on the QoS markings. This will ensure that management traffic receives preferred treatment (per-hop behavior) at each forwarding device along the path to the management network. traffic."
  solution    : "When management traffic must traverse several nodes to reach the management network, classify and mark management traffic at the nearest upstream MLS or router."
  reference   : "800-53|SC-6,CAT|III,CN-L3|7.1.3.7(c),CN-L3|7.1.3.7(d),ITSG-33|SC-6,Rule-ID|SV-19314r1_rule,STIG-ID|NET1007,Vuln-ID|V-17836"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @MANAGEMENT_QOS_FILTER@ replaced with "set-FC-to-network-control" in field "regex".
  regex       : "set firewall filter set-FC-to-network-control"
# Note: Variable @MANAGEMENT_QOS_FILTER@ replaced with "set-FC-to-network-control" in field "expect".
  expect      : "set firewall filter set-FC-to-network-control .+ then forwarding-class network-control"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1007 - Management traffic is not classified and marked at the nearest upstream MLS or router - Interfaces filter"
  info        : "When network congestion occurs, all traffic has an equal chance of being dropped.
Prioritization of network management traffic must be implemented to ensure that even during periods of severe network congestion, the network can be managed and monitored. Quality of Service (QoS) provisioning categorizes network traffic, prioritizes it according to its relative importance, and provides priority treatment through congestion avoidance techniques. Implementing QoS within the network makes network performance more predictable and bandwidth utilization more effective. Most important, since the same bandwidth is being used to manage the network, it provides some assurance that there will be bandwidth available to troubleshoot outages and restore availability when needed.

When management traffic must traverse several nodes to reach the management network, management traffic should be classified and marked at the nearest upstream MLS or router. In addition, all core routers within the managed network must be configured to provide preferred treatment based on the QoS markings. This will ensure that management traffic receives preferred treatment (per-hop behavior) at each forwarding device along the path to the management network. traffic."
  solution    : "When management traffic must traverse several nodes to reach the management network, classify and mark management traffic at the nearest upstream MLS or router."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|III,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-19314r1_rule,STIG-ID|NET1007,TBA-FIISB|31.3,Vuln-ID|V-17836"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @NIPRNET_LINK_INTERFACE@ replaced with "fe-0/0/1" in field "regex".
  regex       : "set interfaces fe-0/0/1"
# Note: Variable @NIPRNET_LINK_INTERFACE@ replaced with "fe-0/0/1" in field "expect".
# Note: Variable @MANAGEMENT_QOS_FILTER@ replaced with "set-FC-to-network-control" in field "expect".
  expect      : "set interfaces fe-0/0/1 .+ filter input set-FC-to-network-control"
</custom_item>

<report type:"WARNING">
  description : "NET1008 - The core router has not been configured to provide preferred treatment for management traffic that must traverse several nodes."
  info        : "When network congestion occurs, all traffic has an equal chance of being dropped.
Prioritization of network management traffic must be implemented to ensure that even during periods of severe network congestion, the network can be managed and monitored. Quality of Service (QoS) provisioning categorizes network traffic, prioritizes it according to its relative importance, and provides priority treatment through congestion avoidance techniques. Implementing QoS within the network makes network performance more predictable and bandwidth utilization more effective. Most important, since the same bandwidth is being used to manage the network, it provides some assurance that there will be bandwidth available to troubleshoot outages and restore availability when needed.

When management traffic must traverse several nodes to reach the management network, management traffic should be classified and marked at the nearest upstream MLS or router. In addition, all core routers within the managed network must be configured to provide preferred treatment based on the QoS markings. This will ensure that management traffic receives preferred treatment (per-hop behavior) at each forwarding device along the path to the management network. traffic.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "When management traffic must traverse several nodes to reach the management network, ensure that all core routers within the managed network have been configured to provide preferred treatment for management traffic."
  reference   : "CAT|III,Rule-ID|SV-19316r1_rule,STIG-ID|NET1008,Vuln-ID|V-17837"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1020 - The network device must log all access control lists (ACL) deny statements."
  info        : "Auditing and logging are key components of any security architecture.  It is essential for security personnel to know what is being done, attempted to be done, and by whom in order to compile an accurate risk assessment.  Auditing the actions on network devices provides a means to recreate an attack, or identify a configuration mistake on the device.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure interface ACLs to log all deny statements."
  reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,CAT|III,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,Rule-ID|SV-15475r3_rule,STIG-ID|NET1020,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-3000"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set firewall filter.*"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1021 - The network element must log all messages except debugging and send all log data to a syslog server."
  info        : "Logging is a critical part of router security. Maintaining an audit trail of system activity logs (syslog) can help identify configuration errors, understand past intrusions, troubleshoot service disruptions, and react to probes and scans of the network. Syslog levels 0-6 are the levels required to collect the necessary information to help in the recovery process."
  solution    : "Configure the network device to log all messages except debugging and send all log data to a syslog server."
  reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-3,CAT|III,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSF|PR.PT-1,ITSG-33|AU-3,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,Rule-ID|SV-15477r2_rule,STIG-ID|NET1021,SWIFT-CSCv1|6.4,Vuln-ID|V-4584"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system syslog"
# Note: Variable @LOGGING_HOST_IP@ replaced with "192\\.168\\.2\\.1" in field "expect".
  expect      : "set system syslog host 192\\.168\\.2\\.1 any (emergency|alert|critical|error|warning|notice|info).*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1623 - The network device must require authentication for console access - Classes"
  info        : "Network devices with no password for administrative access via the console provide the opportunity for anyone with physical access to the device to make configuration changes enabling them to disrupt network operations resulting in a network outage.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure authentication for console access on the network device."
  reference   : "800-171|3.5.1,800-53|IA-2,CAT|I,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,Rule-ID|SV-28747r3_rule,STIG-ID|NET1623,TBA-FIISB|35.1,TBA-FIISB|36.1,Vuln-ID|V-4582"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system login class.*"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1623 - The network device must require authentication for console access - Insecure console"
  info        : "Network devices with no password for administrative access via the console provide the opportunity for anyone with physical access to the device to make configuration changes enabling them to disrupt network operations resulting in a network outage."
  solution    : "Configure authentication for console access on the network device."
  reference   : "800-171|3.1.5,800-53|AC-6(1),CAT|I,CSF|PR.AC-4,ISO/IEC-27001|A.9.4.4,ITSG-33|AC-6(1),NESA|T5.1.1,NESA|T5.4.4,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|VL3b,Rule-ID|SV-28747r3_rule,STIG-ID|NET1623,SWIFT-CSCv1|5.1,Vuln-ID|V-4582"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system ports console"
  expect      : "set system ports console insecure"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1624 - The network element must time out access to the console port after 10 minutes or less of inactivity - All Classes"
  info        : "Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition quickly terminating an idle session will also free up resources committed by the managed network element. Setting the timeout of the session to 10 minutes or less increases the level of protection afforded critical network components.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the timeout for idle console connection to 10 minutes or less."
  reference   : "800-171|3.1.11,800-53|AC-12,CAT|II,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv6|16.4,HIPAA|164.312(a)(2)(iii),ITSG-33|AC-12,NIAv2|NS49,PCI-DSSv3.1|12.3.8,PCI-DSSv3.1|8.1.8,PCI-DSSv3.2|12.3.8,PCI-DSSv3.2|8.1.8,Rule-ID|SV-15445r2_rule,STIG-ID|NET1624,Vuln-ID|V-3967"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system login class .* idle-timeout"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1624 - The network element must time out access to the console port after 10 minutes or less of inactivity - Super-user-local Class"
  info        : "Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition quickly terminating an idle session will also free up resources committed by the managed network element. Setting the timeout of the session to 10 minutes or less increases the level of protection afforded critical network components."
  solution    : "Configure the timeout for idle console connection to 10 minutes or less."
  reference   : "800-171|3.1.11,800-53|AC-12,CAT|II,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv6|16.4,HIPAA|164.312(a)(2)(iii),ITSG-33|AC-12,NIAv2|NS49,PCI-DSSv3.1|12.3.8,PCI-DSSv3.1|8.1.8,PCI-DSSv3.2|12.3.8,PCI-DSSv3.2|8.1.8,Rule-ID|SV-15445r2_rule,STIG-ID|NET1624,Vuln-ID|V-3967"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system login class super-user-local"
  expect      : "set system login class super-user-local idle-timeout ([1-9]|10)$"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1624 - The network element must time out access to the console port after 10 minutes or less of inactivity - Insecure console"
  info        : "Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition quickly terminating an idle session will also free up resources committed by the managed network element. Setting the timeout of the session to 10 minutes or less increases the level of protection afforded critical network components."
  solution    : "Configure the timeout for idle console connection to 10 minutes or less."
  reference   : "800-171|3.1.5,800-53|AC-6(1),CAT|II,CSF|PR.AC-4,ISO/IEC-27001|A.9.4.4,ITSG-33|AC-6(1),NESA|T5.1.1,NESA|T5.4.4,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|VL3b,Rule-ID|SV-15445r2_rule,STIG-ID|NET1624,SWIFT-CSCv1|5.1,Vuln-ID|V-3967"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system ports console"
  expect      : "set system ports console insecure"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1629 - The network element's auxiliary port must be disabled unless it is connected to a secured modem."
  info        : "The use of POTS lines to modems connecting to network devices provides clear text of authentication traffic over commercial circuits that could be captured and used to compromise the network.  Additional war dial attacks on the device could degrade the device and the production network.

Secured modem devices must be able to authenticate users and must negotiate a key exchange before full encryption takes place.  The modem will provide full encryption capability (Triple DES) or stronger.  The technician who manages these devices will be authenticated using a key fob and granted access to the appropriate maintenance port, thus the technician will gain access to the managed device (router, switch, etc.).  The token provides a method of strong (two-factor) user authentication.  The token works in conjunction with a server to generate one-time user passwords that will change values at second intervals.  The user must know a personal identification number (PIN) and possess the token to be allowed access to the device."
  solution    : "Disable the auxiliary port. If used for out-of-band administrative access, the port must be connected to a secured modem providing encryption and authentication."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|III,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,Rule-ID|SV-15447r2_rule,STIG-ID|NET1629,SWIFT-CSCv1|2.3,Vuln-ID|V-7011"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system ports auxiliary"
  expect      : "set system ports auxiliary disable"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1636 - The network device must require authentication prior to establishing a management connection for administrative access - Classes"
  info        : "Network devices with no password for administrative access via a management connection provide the opportunity for anyone with network access to the device to make configuration changes enabling them to disrupt network operations resulting in a network outage.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure authentication for all management connections."
  reference   : "800-171|3.5.1,800-53|IA-2,CAT|I,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,Rule-ID|SV-28748r3_rule,STIG-ID|NET1636,TBA-FIISB|35.1,TBA-FIISB|36.1,Vuln-ID|V-3175"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system login class.*"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1636 - The network device must require authentication prior to establishing a management connection for administrative access - SSH"
  info        : "Network devices with no password for administrative access via a management connection provide the opportunity for anyone with network access to the device to make configuration changes enabling them to disrupt network operations resulting in a network outage."
  solution    : "Configure authentication for all management connections."
  reference   : "800-171|3.1.6,800-53|AC-6(2),CAT|I,CSF|PR.AC-4,ITSG-33|AC-6(2),NESA|T5.1.1,Rule-ID|SV-28748r3_rule,STIG-ID|NET1636,Vuln-ID|V-3175"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system services ssh"
  expect      : "set system services ssh root-login deny"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1637 - The network element must only allow management connections from hosts residing in to the management network - Loopback filter"
  info        : "Remote administration is inherently dangerous because anyone with a sniffer and access to the right LAN segment, could acquire the device account and password information. With this intercepted information they could gain access to the infrastructure and cause denial of service attacks, intercept sensitive information, or perform other destructive actions."
  solution    : "Configure an ACL or filter to restrict management access to the device from only the management network."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-15450r3_rule,STIG-ID|NET1637,TBA-FIISB|31.3,Vuln-ID|V-5611"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set interfaces lo0"
# Note: Variable @LOOPBACK_FILTER_INPUT@ replaced with "router-protect-filter" in field "expect".
  expect      : "set interfaces lo0 .+ filter input router-protect-filter"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1637 - The network element must only allow management connections from hosts residing in to the management network - Loopback filter ssh"
  info        : "Remote administration is inherently dangerous because anyone with a sniffer and access to the right LAN segment, could acquire the device account and password information. With this intercepted information they could gain access to the infrastructure and cause denial of service attacks, intercept sensitive information, or perform other destructive actions."
  solution    : "Configure an ACL or filter to restrict management access to the device from only the management network."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-15450r3_rule,STIG-ID|NET1637,TBA-FIISB|31.3,Vuln-ID|V-5611"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @LOOPBACK_FILTER_INPUT@ replaced with "router-protect-filter" in field "regex".
  regex       : "set firewall filter router-protect-filter"
# Note: Variable @LOOPBACK_FILTER_INPUT@ replaced with "router-protect-filter" in field "expect".
  expect      : "set firewall filter router-protect-filter from port ssh"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1638 - Management connections must be established using secure protocols with FIPS 140-2 modules - SSH v1"
  info        : "Administration and management connections performed across a network are inherently dangerous because anyone with a packet sniffer and access to the right LAN segment can acquire the network device account and password information.  With this intercepted information they could gain access to the router and cause denial of service attacks, intercept sensitive information, or perform other destructive actions."
  solution    : "Configure the network device to use secure protocols with FIPS 140-2 validated cryptographic modules."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,Rule-ID|SV-15452r4_rule,STIG-ID|NET1638,SWIFT-CSCv1|2.3,Vuln-ID|V-3069"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system services ssh"
  not_expect  : "set system services ssh protocol-version.*v1.*"
</custom_item>

<custom_item>
  type        : SHOW_CONFIG_CHECK
  description : "NET1638 - Management connections must be established using secure protocols with FIPS 140-2 modules - SSH macs"
  info        : "Administration and management connections performed across a network are inherently dangerous because anyone with a packet sniffer and access to the right LAN segment can acquire the network device account and password information.  With this intercepted information they could gain access to the router and cause denial of service attacks, intercept sensitive information, or perform other destructive actions."
  solution    : "Configure the network device to use secure protocols with FIPS 140-2 validated cryptographic modules."
  reference   : "800-171|3.13.11,800-53|SC-13,CAT|II,CIP|005-5-R2,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CSF|PR.DS-5,HIPAA|164.312(e)(1),ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,PCI-DSSv3.2|4.1,Rule-ID|SV-15452r4_rule,STIG-ID|NET1638,Vuln-ID|V-3069"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @SSH_ALGORITHM_MAC@ replaced with "hmac-sha1 hmac-sha1-96" in field "expect".
  expect      : "\\[ hmac-sha1 hmac-sha1-96 \\];"
  find        : "ssh"
  hierarchy   : "system services"
  match       : "macs"
</custom_item>

<custom_item>
  type        : SHOW_CONFIG_CHECK
  description : "NET1638 - Management connections must be established using secure protocols with FIPS 140-2 modules - SSH ciphers"
  info        : "Administration and management connections performed across a network are inherently dangerous because anyone with a packet sniffer and access to the right LAN segment can acquire the network device account and password information.  With this intercepted information they could gain access to the router and cause denial of service attacks, intercept sensitive information, or perform other destructive actions."
  solution    : "Configure the network device to use secure protocols with FIPS 140-2 validated cryptographic modules."
  reference   : "800-171|3.13.11,800-53|SC-13,CAT|II,CIP|005-5-R2,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CSF|PR.DS-5,HIPAA|164.312(e)(1),ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,PCI-DSSv3.2|4.1,Rule-ID|SV-15452r4_rule,STIG-ID|NET1638,Vuln-ID|V-3069"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @SSH_ALGORITHM_CIPHER@ replaced with "aes128-cbc aes192-cbc aes256-cbc" in field "expect".
  expect      : "\\[ aes128-cbc aes192-cbc aes256-cbc \\];"
  find        : "ssh"
  hierarchy   : "system services"
  match       : "ciphers"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1638 - Management connections must be established using secure protocols with FIPS 140-2 modules - HTTP"
  info        : "Administration and management connections performed across a network are inherently dangerous because anyone with a packet sniffer and access to the right LAN segment can acquire the network device account and password information.  With this intercepted information they could gain access to the router and cause denial of service attacks, intercept sensitive information, or perform other destructive actions."
  solution    : "Configure the network device to use secure protocols with FIPS 140-2 validated cryptographic modules."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,Rule-ID|SV-15452r4_rule,STIG-ID|NET1638,SWIFT-CSCv1|2.3,Vuln-ID|V-3069"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system services web-management"
  not_expect  : "set system services web-management http[\\s]+"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1638 - Management connections must be established using secure protocols with FIPS 140-2 modules - HTTPS"
  info        : "Administration and management connections performed across a network are inherently dangerous because anyone with a packet sniffer and access to the right LAN segment can acquire the network device account and password information.  With this intercepted information they could gain access to the router and cause denial of service attacks, intercept sensitive information, or perform other destructive actions."
  solution    : "Configure the network device to use secure protocols with FIPS 140-2 validated cryptographic modules."
  reference   : "800-171|3.13.11,800-53|SC-13,CAT|II,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,Rule-ID|SV-15452r4_rule,STIG-ID|NET1638,Vuln-ID|V-3069"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system services web-management"
  expect      : "set system services web-management https[\\s]+"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1638 - Management connections must be established using secure protocols with FIPS 140-2 modules - telnet"
  info        : "Administration and management connections performed across a network are inherently dangerous because anyone with a packet sniffer and access to the right LAN segment can acquire the network device account and password information.  With this intercepted information they could gain access to the router and cause denial of service attacks, intercept sensitive information, or perform other destructive actions."
  solution    : "Configure the network device to use secure protocols with FIPS 140-2 validated cryptographic modules."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,Rule-ID|SV-15452r4_rule,STIG-ID|NET1638,SWIFT-CSCv1|2.3,Vuln-ID|V-3069"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system services"
  not_expect  : "set system services telnet"
</custom_item>

<report type:"WARNING">
  description : "NET1638 - Management connections must be established using secure protocols with FIPS 140-2 modules - other services"
  info        : "Administration and management connections performed across a network are inherently dangerous because anyone with a packet sniffer and access to the right LAN segment can acquire the network device account and password information.  With this intercepted information they could gain access to the router and cause denial of service attacks, intercept sensitive information, or perform other destructive actions.

NOTE: Please ensure other possible management connections are established using secure protocols using FIPS 140-2 validated cryptographic modules.
NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Configure the network device to use secure protocols with FIPS 140-2 validated cryptographic modules."
  reference   : "CAT|II,Rule-ID|SV-15452r4_rule,STIG-ID|NET1638,Vuln-ID|V-3069"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1639 - The network element must timeout management connections for administrative access after 10 minutes or less of inactivity."
  info        : "Setting the timeout of the session to 10 minutes or less increases the level of protection afforded critical network components."
  solution    : "Configure the network devices to ensure the timeout for unattended administrative access connections is no longer than 10 minutes."
  reference   : "800-171|3.1.11,800-53|AC-12,CAT|II,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv6|16.4,HIPAA|164.312(a)(2)(iii),ITSG-33|AC-12,NIAv2|NS49,PCI-DSSv3.1|12.3.8,PCI-DSSv3.1|8.1.8,PCI-DSSv3.2|12.3.8,PCI-DSSv3.2|8.1.8,Rule-ID|SV-15454r2_rule,STIG-ID|NET1639,Vuln-ID|V-3014"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system login class super-user-local"
  expect      : "set system login class super-user-local idle-timeout ([1-9]|10)$"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1640 - The network element must log all attempts to establish a management connection for administrative access."
  info        : "Audit logs are necessary to provide a trail of evidence in case the network is compromised.  Without an audit trail that provides a when, where, who and how set of information, repeat offenders could continue attacks against the network indefinitely.  With this information, the network administrator can devise ways to block the attack and possibly identify and prosecute the attacker."
  solution    : "Configure the device to log all access attempts to the device to establish a management connection for administrative access."
  reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,CAT|III,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,Rule-ID|SV-15456r2_rule,STIG-ID|NET1640,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-3070"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @LOOPBACK_FILTER_INPUT@ replaced with "router-protect-filter" in field "regex".
  regex       : "set firewall filter router-protect-filter"
# Note: Variable @LOOPBACK_FILTER_INPUT@ replaced with "router-protect-filter" in field "expect".
  expect      : "set firewall filter router-protect-filter .+ then (log|syslog)"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1645 - The network element must be configured to timeout after 60 seconds or less for incomplete or broken SSH sessions."
  info        : "An attacker may attempt to connect to the device using SSH by guessing the authentication method, encryption algorithm, and keys. Limiting the amount of time allowed for authenticating and negotiating the SSH session reduces the window of opportunity for the malicious user attempting to make a connection to the network element."
  solution    : "Configure the network devices so it will require a secure shell timeout of 60 seconds or less."
  reference   : "800-171|3.1.8,800-53|AC-7,CAT|II,CN-L3|8.1.4.1(b),CSCv6|16.7,ITSG-33|AC-7,NESA|T5.5.1,NIAv2|AM24,Rule-ID|SV-28744r2_rule,STIG-ID|NET1645,TBA-FIISB|36.2.4,TBA-FIISB|45.1.2,TBA-FIISB|45.2.1,TBA-FIISB|45.2.2,Vuln-ID|V-5612"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system login retry-options"
  expect      : "set system login retry-options maximum-time ([1-9]|[1-5][0-9]|60)$"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1646 - The network element must be configured for a maximum number of unsuccessful SSH login attempts set at 3 before resetting."
  info        : "An attacker may attempt to connect to the device using SSH by guessing the authentication method and authentication key or shared secret. Setting the authentication retry to 3 or less strengthens against a Brute Force attack."
  solution    : "Configure the network device to require a maximum number of unsuccessful SSH logon attempts at 3."
  reference   : "800-171|3.1.8,800-53|AC-7,CAT|II,CN-L3|8.1.4.1(b),CSCv6|16.7,ITSG-33|AC-7,NESA|T5.5.1,NIAv2|AM24,Rule-ID|SV-28745r2_rule,STIG-ID|NET1646,TBA-FIISB|36.2.4,TBA-FIISB|45.1.2,TBA-FIISB|45.2.1,TBA-FIISB|45.2.2,Vuln-ID|V-5613"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system login retry-options"
  expect      : "set system login retry-options tries-before-disconnect 3$"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1647 - The network element must not use SSH Version 1 for administrative access."
  info        : "SSH Version 1 is a protocol that has never been defined in a standard.  Since SSH-1 has inherent design flaws which make it vulnerable to, e.g., man-in-the-middle attacks, it is now generally considered obsolete and should be avoided by explicitly disabling fallback to SSH-1."
  solution    : "Configure the network device to use SSH version 2."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,Rule-ID|SV-15461r2_rule,STIG-ID|NET1647,SWIFT-CSCv1|2.3,Vuln-ID|V-14717"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set system services ssh"
  not_expect  : "set system services ssh protocol-version v1"
</custom_item>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for SNMP v3"
      expect      : "set snmp v3 snmp-community"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      type        : CONFIG_CHECK
      description : "NET1660 - The network device must use SNMPv3 Security Model with FIPS 140-2 validated cryptography - authentication-sha"
      info        : "SNMP Versions 1 and 2 are not considered secure. Without the strong authentication and privacy that is provided by the SNMP Version 3 User-based Security Model (USM), an unauthorized user can gain access to network management information used to launch an attack against the network."
      solution    : "If SNMP is enabled, configure the network device to use SNMP Version 3 Security Model with FIPS 140-2 validated cryptography (i.e., SHA authentication and AES encryption)."
      reference   : "800-171|3.13.11,800-53|SC-13,CAT|I,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,Rule-ID|SV-3196r4_rule,STIG-ID|NET1660,Vuln-ID|V-3196"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex       : "set snmp v3 usm"
      expect      : "set snmp v3 usm .+ authentication-sha .+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "NET1660 - The network device must use SNMPv3 Security Model with FIPS 140-2 validated cryptography - privacy-aes128"
      info        : "SNMP Versions 1 and 2 are not considered secure. Without the strong authentication and privacy that is provided by the SNMP Version 3 User-based Security Model (USM), an unauthorized user can gain access to network management information used to launch an attack against the network."
      solution    : "If SNMP is enabled, configure the network device to use SNMP Version 3 Security Model with FIPS 140-2 validated cryptography (i.e., SHA authentication and AES encryption)."
      reference   : "800-171|3.13.11,800-53|SC-13,CAT|I,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,Rule-ID|SV-3196r4_rule,STIG-ID|NET1660,Vuln-ID|V-3196"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex       : "set snmp v3 usm"
      expect      : "set snmp v3 usm .+ privacy-aes128 .+"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "NET1660 - The network device must use SNMPv3 Security Model with FIPS 140-2 validated cryptography - privacy-none"
      info        : "SNMP Versions 1 and 2 are not considered secure. Without the strong authentication and privacy that is provided by the SNMP Version 3 User-based Security Model (USM), an unauthorized user can gain access to network management information used to launch an attack against the network."
      solution    : "If SNMP is enabled, configure the network device to use SNMP Version 3 Security Model with FIPS 140-2 validated cryptography (i.e., SHA authentication and AES encryption)."
      reference   : "800-171|3.13.11,800-53|SC-13,CAT|I,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,Rule-ID|SV-3196r4_rule,STIG-ID|NET1660,Vuln-ID|V-3196"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex       : "set snmp v3 usm"
      not_expect  : "set snmp v3 usm .+ privacy-none"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "NET1660 - The network device must use SNMPv3 Security Model with FIPS 140-2 validated cryptography - authentication-none"
      info        : "SNMP Versions 1 and 2 are not considered secure. Without the strong authentication and privacy that is provided by the SNMP Version 3 User-based Security Model (USM), an unauthorized user can gain access to network management information used to launch an attack against the network."
      solution    : "If SNMP is enabled, configure the network device to use SNMP Version 3 Security Model with FIPS 140-2 validated cryptography (i.e., SHA authentication and AES encryption)."
      reference   : "800-171|3.13.11,800-53|SC-13,CAT|I,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,Rule-ID|SV-3196r4_rule,STIG-ID|NET1660,Vuln-ID|V-3196"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex       : "set snmp v3 usm"
      not_expect  : "set snmp v3 usm .+ authentication-none"
    </custom_item>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET1660 - The network device must use SNMPv3 Security Model with FIPS 140-2 validated cryptography - authentication-sha"
      info        : "SNMP Versions 1 and 2 are not considered secure. Without the strong authentication and privacy that is provided by the SNMP Version 3 User-based Security Model (USM), an unauthorized user can gain access to network management information used to launch an attack against the network.

      NOTE: SNMPv3 does not appear to be enabled."
      solution    : "If SNMP is enabled, configure the network device to use SNMP Version 3 Security Model with FIPS 140-2 validated cryptography (i.e., SHA authentication and AES encryption)."
      reference   : "800-171|3.13.11,800-53|SC-13,CAT|I,CSF|PR.DS-5,ITSG-33|SC-13,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,Rule-ID|SV-3196r4_rule,STIG-ID|NET1660,Vuln-ID|V-3196"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>

    <report type:"PASSED">
      description : "NET1660 - The network device must use SNMPv3 Security Model with FIPS 140-2 validated cryptography - privacy-aes128"
      info        : "SNMP Versions 1 and 2 are not considered secure. Without the strong authentication and privacy that is provided by the SNMP Version 3 User-based Security Model (USM), an unauthorized user can gain access to network management information used to launch an attack against the network.

      NOTE: SNMPv3 does not appear to be enabled."
      solution    : "If SNMP is enabled, configure the network device to use SNMP Version 3 Security Model with FIPS 140-2 validated cryptography (i.e., SHA authentication and AES encryption)."
      reference   : "800-171|3.13.11,800-53|SC-13,CAT|I,CSF|PR.DS-5,ITSG-33|SC-13,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,Rule-ID|SV-3196r4_rule,STIG-ID|NET1660,Vuln-ID|V-3196"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>

    <report type:"PASSED">
      description : "NET1660 - The network device must use SNMPv3 Security Model with FIPS 140-2 validated cryptography - privacy-none"
      info        : "SNMP Versions 1 and 2 are not considered secure. Without the strong authentication and privacy that is provided by the SNMP Version 3 User-based Security Model (USM), an unauthorized user can gain access to network management information used to launch an attack against the network.

      NOTE: SNMPv3 does not appear to be enabled."
      solution    : "If SNMP is enabled, configure the network device to use SNMP Version 3 Security Model with FIPS 140-2 validated cryptography (i.e., SHA authentication and AES encryption)."
      reference   : "800-171|3.13.11,800-53|SC-13,CAT|I,CSF|PR.DS-5,ITSG-33|SC-13,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,Rule-ID|SV-3196r4_rule,STIG-ID|NET1660,Vuln-ID|V-3196"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>

    <report type:"PASSED">
      description : "NET1660 - The network device must use SNMPv3 Security Model with FIPS 140-2 validated cryptography - authentication-none"
      info        : "SNMP Versions 1 and 2 are not considered secure. Without the strong authentication and privacy that is provided by the SNMP Version 3 User-based Security Model (USM), an unauthorized user can gain access to network management information used to launch an attack against the network.

      NOTE: SNMPv3 does not appear to be enabled."
      solution    : "If SNMP is enabled, configure the network device to use SNMP Version 3 Security Model with FIPS 140-2 validated cryptography (i.e., SHA authentication and AES encryption)."
      reference   : "800-171|3.13.11,800-53|SC-13,CAT|I,CSF|PR.DS-5,ITSG-33|SC-13,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,Rule-ID|SV-3196r4_rule,STIG-ID|NET1660,Vuln-ID|V-3196"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1660 - The network device must use SNMPv3 Security Model with FIPS 140-2 validated cryptography - SNMP v1/2"
  info        : "SNMP Versions 1 and 2 are not considered secure. Without the strong authentication and privacy that is provided by the SNMP Version 3 User-based Security Model (USM), an unauthorized user can gain access to network management information used to launch an attack against the network."
  solution    : "If SNMP is enabled, configure the network device to use SNMP Version 3 Security Model with FIPS 140-2 validated cryptography (i.e., SHA authentication and AES encryption)."
  reference   : "800-171|3.5.2,800-53|IA-5,CAT|I,CN-L3|7.1.2.7(d),CN-L3|8.1.4.1(a),CSF|PR.AC-1,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,NESA|T5.2.1,NESA|T5.2.3,NESA|T5.5.2,NESA|T5.5.3,Rule-ID|SV-3196r4_rule,STIG-ID|NET1660,Vuln-ID|V-3196"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set snmp community.*"
  not_expect  : "set snmp community.*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1665 - The network device must not use the default or well-known SNMP community strings public and private - SNMPv3 public"
  info        : "Network devices may be distributed by the vendor pre-configured with an SNMP agent using the well-known SNMP community strings public for read only and private for read and write authorization. An attacker can obtain information about a network device using the read community string \"public\". In addition, an attacker can change a system configuration using the write community string \"private\"."
  solution    : "Configure unique SNMP community strings replacing the default community strings."
  reference   : "800-171|3.5.2,800-53|IA-5,CAT|I,CN-L3|7.1.2.7(d),CN-L3|8.1.4.1(a),CSF|PR.AC-1,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,NESA|T5.2.1,NESA|T5.2.3,NESA|T5.5.2,NESA|T5.5.3,Rule-ID|SV-3210r4_rule,STIG-ID|NET1665,Vuln-ID|V-3210"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set snmp v3 snmp-community"
  not_expect  : "set snmp v3 snmp-community public.*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1665 - The network device must not use the default or well-known SNMP community strings public and private - SNMPv3 private"
  info        : "Network devices may be distributed by the vendor pre-configured with an SNMP agent using the well-known SNMP community strings public for read only and private for read and write authorization. An attacker can obtain information about a network device using the read community string \"public\". In addition, an attacker can change a system configuration using the write community string \"private\"."
  solution    : "Configure unique SNMP community strings replacing the default community strings."
  reference   : "800-171|3.5.2,800-53|IA-5,CAT|I,CN-L3|7.1.2.7(d),CN-L3|8.1.4.1(a),CSF|PR.AC-1,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,NESA|T5.2.1,NESA|T5.2.3,NESA|T5.5.2,NESA|T5.5.3,Rule-ID|SV-3210r4_rule,STIG-ID|NET1665,Vuln-ID|V-3210"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set snmp v3 snmp-community"
  not_expect  : "set snmp v3 snmp-community private.*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1665 - The network device must not use the default or well-known SNMP community strings public and private - SNMPv1/2 public"
  info        : "Network devices may be distributed by the vendor pre-configured with an SNMP agent using the well-known SNMP community strings public for read only and private for read and write authorization. An attacker can obtain information about a network device using the read community string \"public\". In addition, an attacker can change a system configuration using the write community string \"private\"."
  solution    : "Configure unique SNMP community strings replacing the default community strings."
  reference   : "800-171|3.5.2,800-53|IA-5,CAT|I,CN-L3|7.1.2.7(d),CN-L3|8.1.4.1(a),CSF|PR.AC-1,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,NESA|T5.2.1,NESA|T5.2.3,NESA|T5.5.2,NESA|T5.5.3,Rule-ID|SV-3210r4_rule,STIG-ID|NET1665,Vuln-ID|V-3210"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set snmp community"
  not_expect  : "set snmp community public.*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1665 - The network device must not use the default or well-known SNMP community strings public and private - SNMPv1/2 private"
  info        : "Network devices may be distributed by the vendor pre-configured with an SNMP agent using the well-known SNMP community strings public for read only and private for read and write authorization. An attacker can obtain information about a network device using the read community string \"public\". In addition, an attacker can change a system configuration using the write community string \"private\"."
  solution    : "Configure unique SNMP community strings replacing the default community strings."
  reference   : "800-171|3.5.2,800-53|IA-5,CAT|I,CN-L3|7.1.2.7(d),CN-L3|8.1.4.1(a),CSF|PR.AC-1,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,NESA|T5.2.1,NESA|T5.2.3,NESA|T5.5.2,NESA|T5.5.3,Rule-ID|SV-3210r4_rule,STIG-ID|NET1665,Vuln-ID|V-3210"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set snmp community"
  not_expect  : "set snmp community private.*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1675 - The network device must use different SNMP community names or groups for various levels of read and write access - SNMPv3"
  info        : "Numerous vulnerabilities exist with SNMP; therefore, without unique SNMP community names, the risk of compromise is dramatically increased. This is especially true with vendors default community names which are widely known by hackers and other networking experts. If a hacker gains access to these devices and can easily guess the name, this could result in denial of service, interception of sensitive information, or other destructive actions.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the SNMP community strings on the network device and change them from the default values. SNMP community strings and user passwords must be unique and not match any other network device passwords. Different community strings (V1/2) or groups (V3) must be configured for various levels of read and write access."
  reference   : "800-171|3.5.2,800-53|IA-5,CAT|II,CN-L3|7.1.2.7(d),CN-L3|8.1.4.1(a),CSF|PR.AC-1,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,NESA|T5.2.1,NESA|T5.2.3,NESA|T5.5.2,NESA|T5.5.3,Rule-ID|SV-3043r4_rule,STIG-ID|NET1675,Vuln-ID|V-3043"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set snmp v3 (usm|vacm)"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1675 - The network device must use different SNMP community names or groups for various levels of read and write access - SNMPv1/2"
  info        : "Numerous vulnerabilities exist with SNMP; therefore, without unique SNMP community names, the risk of compromise is dramatically increased. This is especially true with vendors default community names which are widely known by hackers and other networking experts. If a hacker gains access to these devices and can easily guess the name, this could result in denial of service, interception of sensitive information, or other destructive actions.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the SNMP community strings on the network device and change them from the default values. SNMP community strings and user passwords must be unique and not match any other network device passwords. Different community strings (V1/2) or groups (V3) must be configured for various levels of read and write access."
  reference   : "800-171|3.5.2,800-53|IA-5,CAT|II,CN-L3|7.1.2.7(d),CN-L3|8.1.4.1(a),CSF|PR.AC-1,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,NESA|T5.2.1,NESA|T5.2.3,NESA|T5.5.2,NESA|T5.5.3,Rule-ID|SV-3043r4_rule,STIG-ID|NET1675,Vuln-ID|V-3043"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set snmp community"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1800 - The IAO will ensure IPSec VPNs are established as tunnel type VPNs when transporting management traffic across an ip backbone."
  info        : "Using dedicated paths, the OOBM backbone connects the OOBM gateway routers located at the premise of the managed networks and at the NOC.  Dedicated links can be deployed using provisioned circuits (ATM, Frame Relay, SONET, T-carrier, and others or VPN technologies such as subscribing to MPLS Layer 2 and Layer 3 VPN services) or implementing a secured path with gateway-to-gateway IPsec tunnel.  The tunnel mode ensures that the management traffic will be logically separated from any other traffic traversing the same path."
  solution    : "Establish the VPN as a tunneled VPN.

Terminate the tunneled VPN outside of the firewall.

Ensure all host-to-host VPN are established between trusted known hosts."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,Rule-ID|SV-3008r1_rule,STIG-ID|NET1800,SWIFT-CSCv1|2.3,Vuln-ID|V-3008"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set security ipsec"
  not_expect  : "set security ipsec .+ mode transport"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1807 - IPSec tunnels used for management traffic must be restricted to only the authorized packets - VPN Firewall Filter source"
  info        : "The Out-of-Band Management (OOBM) network is an IP network used exclusively for the transport of OAM&P data from the network being managed to the OSS components located at the NOC. Its design provides connectivity to each managed network device enabling network management traffic to flow between the managed NEs and the NOC.  This allows the use of paths separate from those used by the network being managed. Traffic from the managed network to the management network and vice-versa must be secured via IPSec encapsulation."
  solution    : "Configure filters based on source and destination IP address to restrict only authorized management traffic into IPSec tunnels used for transiting management data."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-18945r2_rule,STIG-ID|NET1807,TBA-FIISB|31.3,Vuln-ID|V-17754"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @OOBM_VPN_FILTER@ replaced with "oobm-vpn-filter" in field "regex".
  regex       : "set firewall filter oobm-vpn-filter"
# Note: Variable @OOBM_VPN_FILTER@ replaced with "oobm-vpn-filter" in field "expect".
# Note: Variable @LOCAL_MANAGEMENT_NETWORK@ replaced with "10\\.10\\.2\\.0 0\\.0\\.0\\.255" in field "expect".
  expect      : "set firewall filter oobm-vpn-filter .+ from source-address 10\\.10\\.2\\.0 0\\.0\\.0\\.255"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1807 - IPSec tunnels used for management traffic must be restricted to only the authorized packets - VPN Firewall Filter dest"
  info        : "The Out-of-Band Management (OOBM) network is an IP network used exclusively for the transport of OAM&P data from the network being managed to the OSS components located at the NOC. Its design provides connectivity to each managed network device enabling network management traffic to flow between the managed NEs and the NOC.  This allows the use of paths separate from those used by the network being managed. Traffic from the managed network to the management network and vice-versa must be secured via IPSec encapsulation."
  solution    : "Configure filters based on source and destination IP address to restrict only authorized management traffic into IPSec tunnels used for transiting management data."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-18945r2_rule,STIG-ID|NET1807,TBA-FIISB|31.3,Vuln-ID|V-17754"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @OOBM_VPN_FILTER@ replaced with "oobm-vpn-filter" in field "regex".
  regex       : "set firewall filter oobm-vpn-filter"
# Note: Variable @OOBM_VPN_FILTER@ replaced with "oobm-vpn-filter" in field "expect".
# Note: Variable @REMOTE_MANAGEMENT_NETWORK@ replaced with "10\\.10\\.1\\.0 0\\.0\\.0\\.255" in field "expect".
  expect      : "set firewall filter oobm-vpn-filter .+ from destination-address 10\\.10\\.1\\.0 0\\.0\\.0\\.255"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET1807 - IPSec tunnels used for management traffic must be restricted to only the authorized packets - VPN Firewall Filter Iface"
  info        : "The Out-of-Band Management (OOBM) network is an IP network used exclusively for the transport of OAM&P data from the network being managed to the OSS components located at the NOC. Its design provides connectivity to each managed network device enabling network management traffic to flow between the managed NEs and the NOC.  This allows the use of paths separate from those used by the network being managed. Traffic from the managed network to the management network and vice-versa must be secured via IPSec encapsulation."
  solution    : "Configure filters based on source and destination IP address to restrict only authorized management traffic into IPSec tunnels used for transiting management data."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-18945r2_rule,STIG-ID|NET1807,TBA-FIISB|31.3,Vuln-ID|V-17754"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @OOBM_VPN_INTERFACE@ replaced with "es-0/1/0" in field "regex".
  regex       : "set interfaces es-0/1/0"
# Note: Variable @OOBM_VPN_INTERFACE@ replaced with "es-0/1/0" in field "expect".
# Note: Variable @OOBM_VPN_FILTER@ replaced with "oobm-vpn-filter" in field "expect".
  expect      : "set interfaces es-0/1/0 .+ filter input oobm-vpn-filter"
</custom_item>

<report type:"WARNING">
  description : "NET1808 - Gateway configuration at the remote VPN end-point is a not a mirror of the local gateway"
  info        : "The IPSec tunnel end points may be configured on the OOBM gateway routers connecting the managed network and the NOC. They may also be configured on a firewall or VPN concentrator located behind the gateway router. In either case, the crypto access-list used to identify the traffic to be protected must be a mirror (both IP source and destination address) of the crypto access list configured at the remote VPN peer.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Configure he crypto access-list used to identify the traffic to be protected so that it is a mirror (both IP source and destination address) of the crypto access list configured at the remote VPN peer."
  reference   : "CAT|II,Rule-ID|SV-19063r1_rule,STIG-ID|NET1808,Vuln-ID|V-17814"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET-IPV6-025 - The network device must be configured to ensure IPv6 Site Local Unicast addresses are not defined in the enclave, (FEC0::/10)"
  info        : "As currently defined, site local addresses are ambiguous and can be present in multiple sites.  The address itself does not contain any indication of the site to which it belongs.  The use of site-local addresses has the potential to adversely affect network security through leaks, ambiguity and potential misrouting, as documented in section 2 of RFC3879.  RFC3879 formally deprecates the IPv6 site-local unicast prefix defined in RFC3513, i.e., 1111111011 binary or FEC0::/10."
  solution    : "Configure the device using authorized IP addresses."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,Rule-ID|SV-15397r2_rule,STIG-ID|NET-IPV6-025,SWIFT-CSCv1|2.3,Vuln-ID|V-14693"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set interfaces .* inet6 address"
  not_expect  : "set interfaces .* inet6 address (fed0|fec|fed|fee|fef).*"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET-IPV6-034 - The network element must be configured via egress ACL or by enabling uRPF in an IPv6 enclave - uRPF enabled"
  info        : "Unicast Reverse Path Forwarding (uRPF) provides a mechanism for IP address spoof protection.  When uRPF is enabled on an interface, the router examines all packets received as input on that interface to make sure that the source address and source interface appear in the routing table and match the interface on which the packet was received.  If the packet was received from one of the best reverse path routes, the packet is forwarded as normal.  If there is no reverse path route on the same interface from which the packet was received, it might mean that the source address was modified.  If Unicast RPF does not find a reverse path for the packet, the packet is dropped.

If internal nodes automatically configure an address based on a prefix from a bogus Router Advertisement a dangerous situation may exist. An internal host may contact an internal server which responds with a packet that could be routed outside of the network via default routing (because the routers do not recognize the destination address as an internal address).

To prevent this, filtering should be applied to network interfaces between internal host LANs and internal server LANs to insure that source addresses have valid prefixes."
  solution    : "The network element must be configured to ensure that an ACL is configured to restrict the router from accepting any outbound IP packet that contains an external IP address in the source field."
  reference   : "800-171|3.13.1,800-53|SC-7(16),CAT|II,CSF|PR.PT-4,ITSG-33|SC-7(16),NIAv2|GS8d,Rule-ID|SV-15430r1_rule,STIG-ID|NET-IPV6-034,Vuln-ID|V-14707"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set routing-options"
  expect      : "set routing-options forwarding-table unicast-reverse-path (feasible|active)-paths"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET-IPV6-034 - The network element must be configured via egress ACL or by enabling uRPF in an IPv6 enclave - uRPF interfaces fail-filter"
  info        : "Unicast Reverse Path Forwarding (uRPF) provides a mechanism for IP address spoof protection.  When uRPF is enabled on an interface, the router examines all packets received as input on that interface to make sure that the source address and source interface appear in the routing table and match the interface on which the packet was received.  If the packet was received from one of the best reverse path routes, the packet is forwarded as normal.  If there is no reverse path route on the same interface from which the packet was received, it might mean that the source address was modified.  If Unicast RPF does not find a reverse path for the packet, the packet is dropped.

If internal nodes automatically configure an address based on a prefix from a bogus Router Advertisement a dangerous situation may exist. An internal host may contact an internal server which responds with a packet that could be routed outside of the network via default routing (because the routers do not recognize the destination address as an internal address).

To prevent this, filtering should be applied to network interfaces between internal host LANs and internal server LANs to insure that source addresses have valid prefixes.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "The network element must be configured to ensure that an ACL is configured to restrict the router from accepting any outbound IP packet that contains an external IP address in the source field."
  reference   : "800-171|3.13.1,800-53|SC-7(16),CAT|II,CSF|PR.PT-4,ITSG-33|SC-7(16),NIAv2|GS8d,Rule-ID|SV-15430r1_rule,STIG-ID|NET-IPV6-034,Vuln-ID|V-14707"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set interfaces"
# Note: Variable @RPF_FAIL_FILTER@ replaced with "rfp-fail" in field "expect".
  expect      : "set interfaces .* family inet6 rpf-check fail-filter rfp-fail"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET-IPV6-034 - The network element must be configured via egress ACL or by enabling uRPF in an IPv6 enclave - uRPF firewall filter log"
  info        : "Unicast Reverse Path Forwarding (uRPF) provides a mechanism for IP address spoof protection.  When uRPF is enabled on an interface, the router examines all packets received as input on that interface to make sure that the source address and source interface appear in the routing table and match the interface on which the packet was received.  If the packet was received from one of the best reverse path routes, the packet is forwarded as normal.  If there is no reverse path route on the same interface from which the packet was received, it might mean that the source address was modified.  If Unicast RPF does not find a reverse path for the packet, the packet is dropped.

If internal nodes automatically configure an address based on a prefix from a bogus Router Advertisement a dangerous situation may exist. An internal host may contact an internal server which responds with a packet that could be routed outside of the network via default routing (because the routers do not recognize the destination address as an internal address).

To prevent this, filtering should be applied to network interfaces between internal host LANs and internal server LANs to insure that source addresses have valid prefixes."
  solution    : "The network element must be configured to ensure that an ACL is configured to restrict the router from accepting any outbound IP packet that contains an external IP address in the source field."
  reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,CAT|II,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,Rule-ID|SV-15430r1_rule,STIG-ID|NET-IPV6-034,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1,Vuln-ID|V-14707"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set firewall"
# Note: Variable @RPF_FAIL_FILTER@ replaced with "rfp-fail" in field "expect".
  expect      : "set firewall family inet6 filter rfp-fail term .* then log"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET-IPV6-034 - The network element must be configured via egress ACL or by enabling uRPF in an IPv6 enclave - uRPF firewall filter reject"
  info        : "Unicast Reverse Path Forwarding (uRPF) provides a mechanism for IP address spoof protection.  When uRPF is enabled on an interface, the router examines all packets received as input on that interface to make sure that the source address and source interface appear in the routing table and match the interface on which the packet was received.  If the packet was received from one of the best reverse path routes, the packet is forwarded as normal.  If there is no reverse path route on the same interface from which the packet was received, it might mean that the source address was modified.  If Unicast RPF does not find a reverse path for the packet, the packet is dropped.

If internal nodes automatically configure an address based on a prefix from a bogus Router Advertisement a dangerous situation may exist. An internal host may contact an internal server which responds with a packet that could be routed outside of the network via default routing (because the routers do not recognize the destination address as an internal address).

To prevent this, filtering should be applied to network interfaces between internal host LANs and internal server LANs to insure that source addresses have valid prefixes."
  solution    : "The network element must be configured to ensure that an ACL is configured to restrict the router from accepting any outbound IP packet that contains an external IP address in the source field."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-15430r1_rule,STIG-ID|NET-IPV6-034,TBA-FIISB|31.3,Vuln-ID|V-14707"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set firewall"
# Note: Variable @RPF_FAIL_FILTER@ replaced with "rfp-fail" in field "expect".
  expect      : "set firewall family inet6 filter rfp-fail term .* then reject"
</custom_item>

<if>
  <condition type:"AND">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for current-hop-limit set"
      expect      : "set protocols router-advertisement .* current-hop-limit"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      type        : CONFIG_CHECK
      description : "NET-IPV6-059 - The administrator must ensure that the maximum hop limit is at least 32."
      info        : "The Neighbor Discovery protocol allows a hop limit value to be advertised by routers in a Router Advertisement message to be used by hosts instead of the standardized default value. If a very small value was configured and advertised to hosts on the LAN segment, communications would fail due to hop limit reaching zero before the packets sent by a host reached its destination."
      solution    : "Configure maximum hop limit to at least 32."
      reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-40390r1_rule,STIG-ID|NET-IPV6-059,SWIFT-CSCv1|2.3,Vuln-ID|V-30617"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
      regex       : "set protocols"
      expect      : "set protocols router-advertisement interface .+ current-hop-limit (3[2-9]|[4-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$"
    </custom_item>
  </then>

  <else>
    <report type:"PASSED">
      description : "NET-IPV6-059 - The administrator must ensure that the maximum hop limit is at least 32."
      info        : "The Neighbor Discovery protocol allows a hop limit value to be advertised by routers in a Router Advertisement message to be used by hosts instead of the standardized default value. If a very small value was configured and advertised to hosts on the LAN segment, communications would fail due to hop limit reaching zero before the packets sent by a host reached its destination.

      NOTE: current-hop-limit config was not found. The default JUNOS hop limit is 64, therefore the target is in compliance."
      solution    : "Configure maximum hop limit to at least 32."
      reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-40390r1_rule,STIG-ID|NET-IPV6-059,SWIFT-CSCv1|2.3,Vuln-ID|V-30617"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<report type:"PASSED">
  description : "NET-IPV6-065 - The administrator must ensure the 6-to-4 router is configured to drop any IPv4 packets with protocol 41."
  info        : "The 6to4 specific filters accomplish the role of endpoint verification and provide assurance that the tunnels are being used properly. This primary guidance assumes that only the designated 6to4 router is allowed to form tunnel packets. If they are being formed inside an enclave and passed to the 6to4 router, they are suspicious and must be dropped. In accordance with DoD IPv6 IA Guidance for MO3 (S5-C7-8), packets as such must be dropped and logged as a security event.

NOTE: Currently JUNOS does not support 6to4 automatic tunneling so this vulnerability is not applicable."
  solution    : "If the router is functioning as a 6to4 router, configure an egress filter (inbound on the internal-facing interface) to drop any outbound IPv4 packets that are tunneling IPv6 packets."
  reference   : "CAT|II,Rule-ID|SV-40455r1_rule,STIG-ID|NET-IPV6-065,Vuln-ID|V-30660"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<report type:"PASSED">
  description : "NET-IPV6-066 - The administrator must ensure the 6-to-4 router is configured to drop any outbound IPv6 packets from the internal network."
  info        : "An automatic 6to4 tunnel allows isolated IPv6 domains to be connected over an IPv4 network and allows connections to remote IPv6 networks. The key difference between this deployment and manually configured tunnels is that the routers are not configured in pairs and thus do not require manual configuration because they treat the IPv4 infrastructure as a virtual non-broadcast link, using an IPv4 address embedded in the IPv6 address to find the remote end of the tunnel. In other words, the tunnel destination is determined by the IPv4 address of the external interface of the 6to4 router that is concatenated to the 2002::/16 prefix in the format 2002: V4ADDR::/48.  Hence, the imbedded V4ADDR of the 6to4 prefix must belong to the same ipv4 prefix as configured on the external-facing interface of the 6to4 router.

NOTE: Currently JUNOS does not support 6to4 automatic tunneling so this vulnerability is not applicable."
  solution    : "If the router is functioning as a 6to4 router, configure an egress filter (inbound on the internal-facing interface) to drop any outbound IPv6 packets from the internal network with a source address that is not within the 6to4 prefix 2002:V4ADDR::/48 where V4ADDR is the designated IPv4 6to4 address for the enclave."
  reference   : "CAT|III,Rule-ID|SV-40541r1_rule,STIG-ID|NET-IPV6-066,Vuln-ID|V-30736"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET-MCAST-001 - The administrator must ensure that PIM is disabled on all interfaces that are not required to support multicast routing."
  info        : "A scope zone is an instance of a connected region of a given scope. Zones of the same scope cannot overlap while zones of a smaller scope will fit completely within a zone of a larger scope. For example, Admin-local scope is smaller than Site-local scope, so the administratively configured boundary fits within the bounds of a site. According to RFC 4007 IPv6 Scoped Address Architecture (section 5), scope zones are also required to be 'convex from a routing perspective' - that is, packets routed within a zone must not pass through any links that are outside of the zone. This requirement forces each zone to be one contiguous island rather than a series of separate islands. As stated in the DoD IPv6 IA Guidance for MO3, 'One should be able to identify all interfaces of a zone by drawing a closed loop on their network diagram, engulfing some routers and passing through some routers to include only some of their interfaces.' Hence, it is imperative that the network has documented their multicast topology and thereby knows which interfaces are enabled for multicast.  Once, this is done, the zones can be scoped as required.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "If IPv4 or IPv6 multicast routing is enabled, ensure that all interfaces enabled for PIM is documented in the network's multicast topology diagram. Enable PIM only on the applicable interfaces according to the multicast topology diagram."
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,Rule-ID|SV-40313r1_rule,STIG-ID|NET-MCAST-001,SWIFT-CSCv1|2.3,Vuln-ID|V-30577"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
  regex       : "set protocols pim interface .*"
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET-MCAST-002 - A PIM neighbor filter is bound to all interfaces that have PIM enabled - PIM Filter Destination Address"
  info        : "Protocol Independent Multicast (PIM) is a routing protocol used to build multicast distribution tress for forwarding multicast traffic across the network infrastructure. PIM traffic must be limited to only known PIM neighbors by configuring and binding a PIM neighbor filter to those interfaces that have PIM enabled."
  solution    : "If IPv4 or IPv6 multicast routing is enabled, ensure that all interfaces enabled for PIM has a neighbor filter to only accept PIM control plane traffic from the documented routers according to the multicast topology diagram."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-40316r1_rule,STIG-ID|NET-MCAST-002,TBA-FIISB|31.3,Vuln-ID|V-30578"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @PIM_INPUT_FILTER@ replaced with "pim-input-filter" in field "regex".
  regex       : "set firewall filter pim-input-filter"
# Note: Variable @PIM_INPUT_FILTER@ replaced with "pim-input-filter" in field "expect".
  expect      : "set firewall filter pim-input-filter .* destination-address 224.0.0.13/32"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET-MCAST-002 - A PIM neighbor filter is bound to all interfaces that have PIM enabled - PIM Filter Protocol PIM"
  info        : "Protocol Independent Multicast (PIM) is a routing protocol used to build multicast distribution tress for forwarding multicast traffic across the network infrastructure. PIM traffic must be limited to only known PIM neighbors by configuring and binding a PIM neighbor filter to those interfaces that have PIM enabled."
  solution    : "If IPv4 or IPv6 multicast routing is enabled, ensure that all interfaces enabled for PIM has a neighbor filter to only accept PIM control plane traffic from the documented routers according to the multicast topology diagram."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-40316r1_rule,STIG-ID|NET-MCAST-002,TBA-FIISB|31.3,Vuln-ID|V-30578"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @PIM_INPUT_FILTER@ replaced with "pim-input-filter" in field "regex".
  regex       : "set firewall filter pim-input-filter"
# Note: Variable @PIM_INPUT_FILTER@ replaced with "pim-input-filter" in field "expect".
  expect      : "set firewall filter pim-input-filter .* protocol pim"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET-MCAST-002 - A PIM neighbor filter is bound to all interfaces that have PIM enabled - PIM Filter Accept"
  info        : "Protocol Independent Multicast (PIM) is a routing protocol used to build multicast distribution tress for forwarding multicast traffic across the network infrastructure. PIM traffic must be limited to only known PIM neighbors by configuring and binding a PIM neighbor filter to those interfaces that have PIM enabled."
  solution    : "If IPv4 or IPv6 multicast routing is enabled, ensure that all interfaces enabled for PIM has a neighbor filter to only accept PIM control plane traffic from the documented routers according to the multicast topology diagram."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-40316r1_rule,STIG-ID|NET-MCAST-002,TBA-FIISB|31.3,Vuln-ID|V-30578"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @PIM_INPUT_FILTER@ replaced with "pim-input-filter" in field "regex".
  regex       : "set firewall filter pim-input-filter"
# Note: Variable @PIM_INPUT_FILTER@ replaced with "pim-input-filter" in field "expect".
  expect      : "set firewall filter pim-input-filter .* then accept"
</custom_item>

<custom_item>
  type        : CONFIG_CHECK
  description : "NET-MCAST-002 - A PIM neighbor filter is bound to all interfaces that have PIM enabled - Interfaces"
  info        : "Protocol Independent Multicast (PIM) is a routing protocol used to build multicast distribution tress for forwarding multicast traffic across the network infrastructure. PIM traffic must be limited to only known PIM neighbors by configuring and binding a PIM neighbor filter to those interfaces that have PIM enabled.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "If IPv4 or IPv6 multicast routing is enabled, ensure that all interfaces enabled for PIM has a neighbor filter to only accept PIM control plane traffic from the documented routers according to the multicast topology diagram."
  reference   : "800-171|3.13.1,800-53|SC-7(11),CAT|II,CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(11),NIAv2|GS7c,Rule-ID|SV-40316r1_rule,STIG-ID|NET-MCAST-002,TBA-FIISB|31.3,Vuln-ID|V-30578"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
# Note: Variable @PIM_INPUT_FILTER@ replaced with "pim-input-filter" in field "regex".
  regex       : "set interfaces .* filter input pim-input-filter"
  severity    : MEDIUM
</custom_item>

<if>
  <condition type:"OR">
    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for routing-options multicast scope"
      expect      : "set routing-options multicast scope"
    </custom_item>

    <custom_item>
      type        : CONFIG_CHECK
      description : "Check for policy-options route-filters"
      expect      : "set policy-options .* route-filter"
    </custom_item>
  </condition>

  <then>
    <if>
      <condition type:"AND">
        <custom_item>
          type        : CONFIG_CHECK
          description : "Check for routing-options multicast scope"
          expect      : "set routing-options multicast scope"
        </custom_item>
      </condition>

      <then>
        <custom_item>
          type        : CONFIG_CHECK
          description : "NET-MCAST-010 - Ensure that multicast routers are configured to establish boundaries for Admin-local or Site-local scope multicast traffic."
          info        : "A scope zone is an instance of a connected region of a given scope. Zones of the same scope cannot overlap while zones of a smaller scope will fit completely within a zone of a larger scope. For example, Admin-local scope is smaller than Site-local scope, so the administratively configured boundary fits within the bounds of a site. According to RFC 4007 IPv6 Scoped Address Architecture (section 5), scope zones are also required to be \"convex from a routing perspective\"-that is, packets routed within a zone must not pass through any links that are outside of the zone. This requirement forces each zone to be one contiguous island rather than a series of separate islands. As stated in the DoD IPv6 IA Guidance for MO3, \"One should be able to identify all interfaces of a zone by drawing a closed loop on their network diagram, engulfing some routers and passing through some routers to include only some of their interfaces.\"

          Administrative scoped multicast addresses are locally assigned and are to be used exclusively by the enterprise network or enclave. Hence, administrative scoped multicast traffic must not cross the perimeter of the enclave in either direction. Admin-local scope could be used to contain multicast traffic to a portion of an enclave or within a site. This can make it more difficult for a malicious user to access sensitive traffic if the traffic is restricted to links that the user does not have access to. Admin-local scope is encouraged for any multicast traffic within a network that is intended for network management as well as control plane traffic that must reach beyond link-local destinations.

          NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
          solution    : "Local Scope range is 239.255.0.0/16 and can expand into the reserved ranges 239.254.0.0/16 and 239.253.0.0/16 if 239.255.0.0/16 is exhausted. The scope of IPv6 multicast packets are determined by the scope value where 4 is Admin-local and 5 is Site-local. Configure the necessary boundary to ensure packets addressed to these administratively scoped multicast addresses do not cross the applicable administrative boundaries."
          reference   : "800-171|3.13.1,800-171|3.13.5,800-53|SC-7,CAT|III,CN-L3|8.1.10.6(j),CSF|DE.CM-1,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,ISO/IEC-27001|A.13.1.3,ITSG-33|SC-7,NESA|T4.5.4,NIAv2|GS1,NIAv2|GS2a,NIAv2|GS2b,Rule-ID|SV-21170r1_rule,STIG-ID|NET-MCAST-010,TBA-FIISB|43.1,Vuln-ID|V-19189"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
          regex       : "set routing-options multicast scope .*"
          severity    : MEDIUM
        </custom_item>
      </then>

      <else>
        <custom_item>
          type        : CONFIG_CHECK
          description : "NET-MCAST-010 - Ensure that multicast routers are configured to establish boundaries for Admin-local or Site-local scope multicast traffic."
          info        : "A scope zone is an instance of a connected region of a given scope. Zones of the same scope cannot overlap while zones of a smaller scope will fit completely within a zone of a larger scope. For example, Admin-local scope is smaller than Site-local scope, so the administratively configured boundary fits within the bounds of a site. According to RFC 4007 IPv6 Scoped Address Architecture (section 5), scope zones are also required to be \"convex from a routing perspective\"-that is, packets routed within a zone must not pass through any links that are outside of the zone. This requirement forces each zone to be one contiguous island rather than a series of separate islands. As stated in the DoD IPv6 IA Guidance for MO3, \"One should be able to identify all interfaces of a zone by drawing a closed loop on their network diagram, engulfing some routers and passing through some routers to include only some of their interfaces.\"

          Administrative scoped multicast addresses are locally assigned and are to be used exclusively by the enterprise network or enclave. Hence, administrative scoped multicast traffic must not cross the perimeter of the enclave in either direction. Admin-local scope could be used to contain multicast traffic to a portion of an enclave or within a site. This can make it more difficult for a malicious user to access sensitive traffic if the traffic is restricted to links that the user does not have access to. Admin-local scope is encouraged for any multicast traffic within a network that is intended for network management as well as control plane traffic that must reach beyond link-local destinations.

          NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
          solution    : "Local Scope range is 239.255.0.0/16 and can expand into the reserved ranges 239.254.0.0/16 and 239.253.0.0/16 if 239.255.0.0/16 is exhausted. The scope of IPv6 multicast packets are determined by the scope value where 4 is Admin-local and 5 is Site-local. Configure the necessary boundary to ensure packets addressed to these administratively scoped multicast addresses do not cross the applicable administrative boundaries."
          reference   : "800-171|3.13.2,800-171|3.13.5,800-53|SC-7(20),CAT|III,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,NESA|T4.5.3,Rule-ID|SV-21170r1_rule,STIG-ID|NET-MCAST-010,Vuln-ID|V-19189"
          see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
          regex       : "set policy-options .* route-filter .*"
          severity    : MEDIUM
        </custom_item>
      </else>
    </if>
  </then>

  <else>
    <report type:"FAILED">
      description : "NET-MCAST-010 - Ensure that multicast routers are configured to establish boundaries for Admin-local or Site-local scope multicast traffic."
      info        : "A scope zone is an instance of a connected region of a given scope. Zones of the same scope cannot overlap while zones of a smaller scope will fit completely within a zone of a larger scope. For example, Admin-local scope is smaller than Site-local scope, so the administratively configured boundary fits within the bounds of a site. According to RFC 4007 IPv6 Scoped Address Architecture (section 5), scope zones are also required to be \"convex from a routing perspective\"-that is, packets routed within a zone must not pass through any links that are outside of the zone. This requirement forces each zone to be one contiguous island rather than a series of separate islands. As stated in the DoD IPv6 IA Guidance for MO3, \"One should be able to identify all interfaces of a zone by drawing a closed loop on their network diagram, engulfing some routers and passing through some routers to include only some of their interfaces.\"

      Administrative scoped multicast addresses are locally assigned and are to be used exclusively by the enterprise network or enclave. Hence, administrative scoped multicast traffic must not cross the perimeter of the enclave in either direction. Admin-local scope could be used to contain multicast traffic to a portion of an enclave or within a site. This can make it more difficult for a malicious user to access sensitive traffic if the traffic is restricted to links that the user does not have access to. Admin-local scope is encouraged for any multicast traffic within a network that is intended for network management as well as control plane traffic that must reach beyond link-local destinations.

      NOTE: Scope or scope-policy statements were not found."
      solution    : "Local Scope range is 239.255.0.0/16 and can expand into the reserved ranges 239.254.0.0/16 and 239.253.0.0/16 if 239.255.0.0/16 is exhausted. The scope of IPv6 multicast packets are determined by the scope value where 4 is Admin-local and 5 is Site-local. Configure the necessary boundary to ensure packets addressed to these administratively scoped multicast addresses do not cross the applicable administrative boundaries."
      reference   : "800-171|3.13.2,800-171|3.13.5,800-53|SC-7,CAT|III,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,NESA|T4.5.3,Rule-ID|SV-21170r1_rule,STIG-ID|NET-MCAST-010,Vuln-ID|V-19189"
      see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
    </report>
  </else>
</if>

<report type:"WARNING">
  description : "NET-SRVFRM-003 - Server VLAN interfaces must be protected by restrictive ACLs using a deny-by-default security posture."
  info        : "Protecting data sitting in a server VLAN is necessary and can be accomplished using access control lists on VLANs provisioned for servers.  Without proper access control of traffic entering or leaving the server VLAN, potential threats such as a denial of service, data corruption, or theft could occur, resulting in the inability to complete mission requirements by authorized users.

NOTE: Nessus did not perform this check as it requires manual verification as to whether or not server VLANS have ACLs defined with a deny-by-default security posture assigned to the appropriate interface(s) if applicable.
NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Configure an ACL to protect the server VLAN interface.  The ACL must be in a deny-by-default security posture."
  reference   : "CAT|II,Rule-ID|SV-20061r3_rule,STIG-ID|NET-SRVFRM-003,Vuln-ID|V-18522"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<report type:"WARNING">
  description : "NET-TUNL-012 - Default routes must not be directed to the tunnel entry point."
  info        : "Routing in the network containing the tunnel entry point must be configured to direct the intended traffic into the tunnel.  Depending on the router products used this may be done by creating routes to a tunnel by name, by address, or by interface.

If multiple tunnels are defined or IPv6 interfaces, you must be selective with static routes, policy based routing, or even let the interior gateway protocol (IGP) make the decision since a ipv4 or ipv6 address has been configured on the tunnel. The key is the administrator should carefully plan and configure or let the IGP determine what goes into each tunnel.

NOTE: Nessus did not perform this check as it requires manual verification to identify the tunnel endpoints, then review all routing devices to ensure the tunnel entry point is not used as a default route.
NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "The SA must carefully plan and configure or let IGP determine what goes into each tunnel."
  reference   : "CAT|II,Rule-ID|SV-20504r2_rule,STIG-ID|NET-TUNL-012,Vuln-ID|V-18790"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<report type:"WARNING">
  description : "NET-TUNL-017 - ISATAP tunnels must terminate at an interior router."
  info        : "ISATAP is an automatic tunnel mechanism that does not provide authentication such as IPSec.  As a result of this limitation, ISATAP is thought of as a tool that is used inside the enclave among trusted hosts, which would limit it to internal attacks.  ISATAP is a service versus a product, and is readily available to most users.  If a user knows the ISATAP router IP address, they can essentially get onto the IPv6 intranet.  To control the vulnerability of this tunnel mechanism, it is critical to control the use of protocol 41 and use IPv4 filters to control what IPv4 nodes can send protocol 41 packets to an ISATAP router interface.  Although the ISATAP tunneling mechanism is similar to other automatic tunneling mechanisms, such as IPv6 6to4 tunneling, ISATAP is designed for transporting IPv6 packets between sites within an enclave, not between enclaves.

NOTE: Nessus did not perform this check as it requires manual verification that the ISATAP tunnel is terminate at the Intra Enclave Security Zone.
NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Terminate ISATAP tunnels at the infrastructure router to prohibit tunneled traffic from exiting the enclave perimeter prior to inspection by the IDS, IPS, or firewall."
  reference   : "CAT|II,Rule-ID|SV-16067r2_rule,STIG-ID|NET-TUNL-017,Vuln-ID|V-15288"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

<report type:"PASSED">
  description : "NET-TUNL-034 - The administrator must ensure the that all L2TPv3 sessions are authenticated prior to transporting traffic."
  info        : "L2TPv3 sessions can be used to transport layer-2 protocols across an IP backbone. These protocols were intended for link-local scope only and are therefore less defended and not as well-known. As stated in DoD IPv6 IA Guidance for MO3 (S4-C7-1), the L2TP tunnels can also carry IP packets that are very difficult to filter because of the additional encapsulation. Hence, it is imperative that L2TP sessions are authenticated prior to transporting traffic.

NOTE: Currently JUNOS does not support L2TPv3 so this vulnerability is not applicable."
  solution    : "Configure L2TPv3 to use authentication for any peering sessions."
  reference   : "CAT|II,Rule-ID|SV-40557r1_rule,STIG-ID|NET-TUNL-034,Vuln-ID|V-30744"
  see_also    : "https://iasecontent.disa.mil/stigs/zip/U_Network_Infrastructure_Router_L3_Switch_V8R29_STIG.zip"
</report>

</check_type>
