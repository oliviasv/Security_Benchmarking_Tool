#
# This script is Copyright (C) 2004-2020 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.0 $
# $Date: 2020/07/13 $
#
# Description : This document implements the security configuration as recommended by the
#               DISA Windows PAW v1r3 STIG.
#
#<ui_metadata>
#<display_name>DISA MS Windows Privileged Access Workstation v1r3</display_name>
#<spec>
#  <type>DISA STIG</type>
#  <name>DISA STIG MS Windows Privileged Access Workstation v1r1</name>
#  <version>1.3.0</version>
#  <link>https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip</link>
#</spec>
#<labels>windows,disa,miscrosoft</labels>
#<benchmark_refs>CAT,CCI,Rule-ID,STIG-ID,Vuln-ID,Group-ID</benchmark_refs>
#<variables>
#  <variable>
#    <name>WSUSSERVER_URL</name>
#    <default>http://wuserver</default>
#    <description>WSUS Server URL</description>
#    <info>This is the URL to your organization's WSUS server</info>
#  </variable>
#  <variable>
#    <name>LOG_ON_LOCALLY_USERS</name>
#    <default>'administrators'</default>
#    <description>users allowed to log on locally</description>
#    <info>users allowed to log on locally</info>
#  </variable>
#  <variable>
#    <name>LOG_ON_LOCALLY_USERS_DOM_ADMIN</name>
#    <default>'enterprise administrators'</default>
#    <description>domain admins allowed to log on locally</description>
#    <info>WPAW-00-001400 - domain admins allowed to log on locally</info>
#  </variable>
#  <variable>
#    <name>WSUS_SCHED_INSTALL_TIME</name>
#    <default>3</default>
#    <description>WUS Scheduled install time</description>
#    <info>WUS Scheduled install time</info>
#  </variable>
#  <variable>
#    <name>DENY_SERV_LOGON</name>
#    <default>'enterprise administrators'</default>
#    <description>users not allowed to log on as a service</description>
#    <info>users not allowed to log on as a service</info>
#  </variable>
#  <variable>
#    <name>DENY_BATCH_LOGON</name>
#    <default>'enterprise administrators'</default>
#    <description>users not allowed to log on in a batch job</description>
#    <info>users not allowed to log on in a batch job</info>
#  </variable>
#  <variable>
#    <name>DENY_INTERACTIVE_LOGON</name>
#    <default>'enterprise administrators'</default>
#    <description>users not allowed to log on locally</description>
#    <info>users not allowed to log on locally</info>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Windows" version:"2">
<group_policy:"MS Windows PAW">

<report type:"WARNING">
  description : "WPAW-00-000100 - Administrators of high-value IT resources must complete required training."
  info        : "Required training helps to mitigate the risk of administrators not following required procedures. High-value IT resources are the most important and critical IT resources within an organization. They contain the most sensitive data in an organization, perform the most critical tasks of an organization, or have access to and can control all or nearly all IT resources within an organization. Requiring a PAW used exclusively for remote administrative management of designated high-value IT resources, including servers, workstations, directory services, applications, databases, and network components, will provide a separate 'channel' for the performance of administrative tasks on high-value IT resources and isolate these functions from the majority of threats and attack vectors found on higher-risk standard client systems. A main security architectural construct of a PAW is to remove non-administrative applications and functions from the PAW. Technical controls for securing high-value IT resources will be ineffective if administrators are not aware of key security requirements.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Add the following topics to initial and annual update training modules for system administrators of high-value IT resources:

- Remotely manage high-value IT resources only via a PAW.
- Administrative accounts will not be used for non-administrative functions (for example, read email, browse Internet)."
  reference   : "800-53|CM-6,CAT|III,CCI|CCI-000101,Rule-ID|SV-92847r1_rule,STIG-ID|WPAW-00-000100,Vuln-ID|V-78141"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
</report>

<report type:"WARNING">
  description : "WPAW-00-000200 - Site IT resources designated as high value by the Authorizing Official (AO) must be remotely managed only via a Windows privileged access workstation (PAW) - AO must be remotely managed only via PAW"
  info        : "The AO must designate which IT resources are high value. The list must include the following IT resources:

- Directory service (including Active Directory)
- Cloud service
- Identity management service
- Privileged access management service
- Credential management service
- Security management service (anti-virus, network monitoring/scanning, IDS/IPS, etc.)
- Any sensitive business/mission service
- Any other IT resource designated as high value by the AO

Note: A high-value IT resource is defined as any IT resource whose purpose is considered critical to the organization or whose loss or compromise would cause a significant impact on the organization.

Note: Sensitive business/mission service is any business or mission service that needs additional protection from higher-risk IT services based on the nature of the function it provides; sensitivity of the data it consumes, processes, or stores; or criticality to the operation of the organization.

High-value IT resources are the most important and critical IT resources within an organization. They contain the most sensitive data in an organization, perform the most critical tasks of an organization, or have access to and can control all or nearly all IT resources within an organization. Administrator accounts for high-value IT resources must be protected against various threats and attacks because threats to sensitive privileged accounts are high and risk of compromise is increasing. Requiring a PAW used exclusively for remote administrative management of designated high-value IT resources, including servers, workstations, directory services, applications, databases, and network components, will provide a separate 'channel' for the performance of administrative tasks on high-value IT resources and isolate these functions from the majority of threats and attack vectors found on higher-risk standard client systems.

Some IT resources, by the nature of the function they perform, should always be considered high value and should be remotely administered only via a PAW. The IT resources listed above are in this category.

Note: The term 'manage' in the Requirement statement includes any remote connection to a high-value IT resource (for example, to view resource status and current configuration or to make changes to any resource configuration).

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "The Information System Security Manager (ISSM) or other site personnel will assist the Authorizing Official (AO) in designating and documenting which IT resources in the organization are high value. The organization's list of high-value IT resources will include the following:

- Active Directory
- Cloud service
- Identity management service
- Privileged access management service
- Credential management service
- Security management service (anti-virus, network monitoring/scanning, IDS/IPS, etc.)
- Any sensitive business service
- Any other IT resource designated as high value by the AO

Set up procedures to ensure a Windows PAW is used to remotely manage each of these types of IT resources."
  reference   : "800-53|CM-6,CAT|II,CCI|CCI-000366,Rule-ID|SV-92849r1_rule,STIG-ID|WPAW-00-000200,Vuln-ID|V-78143"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
</report>

<report type:"WARNING">
  description : "WPAW-00-000400 - Administrative accounts of all high-value IT resources must be assigned to a specific administrative tier in Active Directory to separate highly privileged administrative accounts from less privileged administrative accounts."
  info        : "Note: The Microsoft Tier 0-2 AD administrative tier model (https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/securing-privileged-access-reference-material#ADATM_BM) is an example.

A key security construct of a PAW is to separate administrative accounts into specific trust levels so that an administrator account used to manage an IT resource at one trust level cannot be used to manage IT resources at another trust level. This architecture protects IT resources in a tier from threats from higher-risk tiers. Isolating administrative accounts by forcing them to operate only within their assigned trust zone implements the concept of containment of security risks and adversaries within a specific zone. The Tier model prevents escalation of privilege by restricting what administrators can control and where they can log on.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Set up an administrative tier model for the domain (for example, the Microsoft recommended Tier 0-2 AD administrative tier model).

Note: Details of the Tier model are found at https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/securing-privileged-access-reference-material#ADATM_BM.

Set up an Admin Organizational Unit (OU) Framework to host site PAWs. (Recommend the Microsoft PAW scripts be used to set up the PAW OU and group framework. They can be downloaded at http://aka.ms/PAWmedia.)

For example:

- Admin\Tier 0\Accounts
- Admin\Tier 1\Accounts
- Admin\Tier 2\Accounts
- Admin\Tier 0\Groups
- Admin\Tier 1\Groups
- Admin\Tier 2\Groups
- Admin\Tier 0\Devices
- Admin\Tier 1\Devices
- Admin\Tier 2\Devices

Note: If using the Microsoft scripts, after running the scripts, PAW Users Tier 0, PAW Users Tier 1, and PAW Users Tier 2 groups may need to be created under Admin/Tier 0/Groups, Admin/Tier 1/Groups, and Admin/Tier 2/Groups, respectively.

Set up administrative accounts for each assigned administrator for high-value IT resources.

Based on the list of high-value IT resources with assigned administrative tier level, move Tier 0-2 administrative accounts to the appropriate Organizational Units and add the appropriate members to the relevant groups. Make sure each account and group has been assigned to one and only one tier.

(Reference-defined groups in the Active Directory Domain STIG)"
  reference   : "800-53|AC-6,800-53|CM-6,CAT|II,CCI|CCI-002227,Rule-ID|SV-92851r1_rule,STIG-ID|WPAW-00-000400,Vuln-ID|V-78145"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
</report>

<report type:"WARNING">
  description : "WPAW-00-000500 - A Windows PAW must only be used to manage high-value IT resources assigned to the same tier."
  info        : "Note: Allowed exception - For sites that are constrained in the number of available workstations, an acceptable approach is to install lower-tier administrative accounts on a separate virtual machine (VM) on the PAW workstation where higher-tier administrative accounts are installed on the host OS and lower-tier administrative accounts are installed in a VM. The VM will provide acceptable isolation between administrative accounts of different tiers.

Note: Relationship between the exception in WPAW-00-000500 and WPAW-00-001000 and requirement WPAW-00-001800: WPAW-00-000500 and WPAW-00-001000 allow an exception to the requirement for sites constrained in the number of available workstations. Lower-tier, high-value admin accounts can operate in a VM if the higher-tier, high-value admin accounts operate in the VM host-OS, but WPAW-00-001800 is more appropriate for a multiple PAW VM environment.

If administrative accounts assigned to different tiers were installed on the same PAW, it would be impossible to isolate administrative accounts to specific trust zones and protect IT resources from one trust zone (tier) from threats from high-risk trust zones.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Set aside one or more PAWs for remote management of high-value IT resources assigned to a specific tier. For example, using the Microsoft Tier 0-2 model, each PAW would be assigned to manage either Tier 0, Tier 1, or Tier 2 high-value IT resources."
  reference   : "800-53|CM-6,CAT|II,CCI|CCI-000366,Rule-ID|SV-92853r1_rule,STIG-ID|WPAW-00-000500,Vuln-ID|V-78147"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
</report>

<report type:"WARNING">
  description : "WPAW-00-000600 - All high-value IT resources must be assigned to a specific administrative tier to separate highly sensitive resources from less sensitive resources."
  info        : "Note: The Microsoft Tier 0-2 AD administrative tier model (https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/securing-privileged-access-reference-material#ADATM_BM) is an example.

A key security construct of a PAW is to separate high-value IT resources into specific trust levels so that if a device at one trust level is compromised the risk of compromise of more critical IT resources at a different tier is reduced. This architecture protects IT resources in a tier from threats from higher-risk tiers. Isolating administrative accounts by forcing them to operate only within their assigned trust zone implements the concept of containment of security risks and adversaries within a specific zone.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Set up an administrative tier model for the domain (for example, the Microsoft-recommended Tier 0-2 AD administrative tier model). (Details of the Tier model are found at https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/securing-privileged-access-reference-material#ADATM_BM.)

Using the list of site designated high-value IT resources (see check WPAW-00-000200), indicate on the list the administrative Tier level the resource is assigned to. (Note: The updated list will be used in check WPAW-00-000400.)

In Active Directory, assign all high-value IT resources to the appropriate Organizational Units (for example):

- Admin\Tier 0\Devices
- Admin\Tier 1\Devices
- Admin\Tier 2\Devices"
  reference   : "800-53|CM-6,CAT|II,CCI|CCI-000366,Rule-ID|SV-92855r1_rule,STIG-ID|WPAW-00-000600,Vuln-ID|V-78149"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
</report>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "WPAW-00-000700 - The Windows PAW must be configured with a vendor-supported version of Windows 10 and applicable security patches that are DoD approved - ProductName"
  info            : "Older versions of operating systems usually contain vulnerabilities that have been fixed in later released versions. In addition, most operating system patches contain fixes for recently discovered security vulnerabilities. Due to the highly privileged activities of a PAW, it must be maintained at the highest security posture possible and therefore must have one of the current vendor-supported operating system versions installed.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution        : "Install one of the current vendor-supported versions of Windows 10 on site PAWs, including the most recently released patches.

Note: There is no central list in the DoD of 'approved' operating system versions. The Microsoft website will list supported versions of Windows 10 and patches. If a STIG is available for one or more of the vendor-supported versions of Windows 10, the version can be considered to be DoD approved. Local AOs usually have implemented a procedure for testing Windows updates before they are deployed. Check with the local AO's staff to determine the latest approved version of Windows 10."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92857r1_rule,STIG-ID|WPAW-00-000700,SWIFT-CSCv1|2.3,Vuln-ID|V-78151"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : ".*"
  powershell_args : "Get-ItemProperty -Path 'hklm:Software\Microsoft\Windows Nt\Currentversion' -name 'ProductName'|Select ProductName"
  severity        : MEDIUM
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "WPAW-00-000700 - The Windows PAW must be configured with a vendor-supported version of Windows 10 and applicable security patches that are DoD approved - CurrentBuild"
  info            : "Older versions of operating systems usually contain vulnerabilities that have been fixed in later released versions. In addition, most operating system patches contain fixes for recently discovered security vulnerabilities. Due to the highly privileged activities of a PAW, it must be maintained at the highest security posture possible and therefore must have one of the current vendor-supported operating system versions installed.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution        : "Install one of the current vendor-supported versions of Windows 10 on site PAWs, including the most recently released patches.

Note: There is no central list in the DoD of 'approved' operating system versions. The Microsoft website will list supported versions of Windows 10 and patches. If a STIG is available for one or more of the vendor-supported versions of Windows 10, the version can be considered to be DoD approved. Local AOs usually have implemented a procedure for testing Windows updates before they are deployed. Check with the local AO's staff to determine the latest approved version of Windows 10."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92857r1_rule,STIG-ID|WPAW-00-000700,SWIFT-CSCv1|2.3,Vuln-ID|V-78151"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : ".*"
  powershell_args : "Get-ItemProperty -Path 'hklm:Software\Microsoft\Windows Nt\Currentversion' -name 'CurrentBuild'|Select CurrentBuild"
  severity        : MEDIUM
</custom_item>

<custom_item>
  type        : REGISTRY_SETTING
  description : "WPAW-00-000800 - A Windows update service must be available to provide software updates for the PAW platform - WUServer"
  info        : "Older versions of operating systems usually contain vulnerabilities that have been fixed in later versions. In addition, most operating system patches contain fixes for recently discovered security vulnerabilities. Due to the highly privileged activities of a PAW, it must be maintained at the highest security posture possible and therefore must have the latest operating system updates installed.

Because a PAW is isolated from online operating system update services, a software update service must be available on the intranet to manage operating system and other software updates for site PAWs. A separate software update service is not required at each tier.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Install a Windows update service (for example, Microsoft WSUS or System Center Configuration Manager [SCCM]) to provide software updates to all Windows-based PAWs in the organization.

Configure the Windows update service to download available operating system updates and install them when approved.

Based on site policy, configure the Windows update service to either automatically approve new updates for installation or to not install updates until installation is initiated by an authorized PAW maintenance administrator.

If WSUS is being used, configure Windows Update for WSUS on each PAW (use appropriate configuration procedures if an alternate Windows update service is used).

Go to Computer Configuration\Administrative Templates\Windows Components\Windows Updates and follow the steps below:

1. Enable the Configure Automatic Updates policy.
2. Select option 4 - Auto download and schedule the install.
3. Change the option 'Scheduled install day' to '0 - Every Day' and the option 'Scheduled install time' to your organizational preference.
4. Enable option 'Specify intranet Microsoft update service location' policy, and specify in both options the URL of the WSUS server."
  reference   : "800-171|3.14.1,800-53|SI-2(5),CAT|II,CCI|CCI-000366,CSF|ID.RA-1,CSF|PR.IP-12,NIAv2|NS26b,Rule-ID|SV-92859r1_rule,STIG-ID|WPAW-00-000800,SWIFT-CSCv1|2.2,Vuln-ID|V-78153"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_TEXT
# Note: Variable @WSUSSERVER_URL@ replaced with "http://wuserver" in field "value_data".
  value_data  : "http://wuserver"
  reg_key     : "HKLM\Software\Policies\Microsoft\Windows\Windowsupdate"
  reg_item    : "WUServer"
  reg_option  : CAN_NOT_BE_NULL
  severity    : MEDIUM
</custom_item>

<custom_item>
  type        : REGISTRY_SETTING
  description : "WPAW-00-000800 - A Windows update service must be available to provide software updates for the PAW platform - AUOptions"
  info        : "Older versions of operating systems usually contain vulnerabilities that have been fixed in later versions. In addition, most operating system patches contain fixes for recently discovered security vulnerabilities. Due to the highly privileged activities of a PAW, it must be maintained at the highest security posture possible and therefore must have the latest operating system updates installed.

Because a PAW is isolated from online operating system update services, a software update service must be available on the intranet to manage operating system and other software updates for site PAWs. A separate software update service is not required at each tier."
  solution    : "Install a Windows update service (for example, Microsoft WSUS or System Center Configuration Manager [SCCM]) to provide software updates to all Windows-based PAWs in the organization.

Configure the Windows update service to download available operating system updates and install them when approved.

Based on site policy, configure the Windows update service to either automatically approve new updates for installation or to not install updates until installation is initiated by an authorized PAW maintenance administrator.

If WSUS is being used, configure Windows Update for WSUS on each PAW (use appropriate configuration procedures if an alternate Windows update service is used).

Go to Computer Configuration\Administrative Templates\Windows Components\Windows Updates and follow the steps below:

1. Enable the Configure Automatic Updates policy.
2. Select option 4 - Auto download and schedule the install.
3. Change the option 'Scheduled install day' to '0 - Every Day' and the option 'Scheduled install time' to your organizational preference.
4. Enable option 'Specify intranet Microsoft update service location' policy, and specify in both options the URL of the WSUS server."
  reference   : "800-171|3.14.1,800-53|SI-2(5),CAT|II,CCI|CCI-000366,CSCv6|4.5,CSF|ID.RA-1,CSF|PR.IP-12,NIAv2|NS26b,Rule-ID|SV-92859r1_rule,STIG-ID|WPAW-00-000800,SWIFT-CSCv1|2.2,Vuln-ID|V-78153"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_DWORD
  value_data  : 4
  reg_key     : "HKLM\Software\Policies\Microsoft\Windows\Windowsupdate\Au"
  reg_item    : "AUOptions"
</custom_item>

<custom_item>
  type        : REGISTRY_SETTING
  description : "WPAW-00-000800 - A Windows update service must be available to provide software updates for the PAW platform - ScheduledInstallDay"
  info        : "Older versions of operating systems usually contain vulnerabilities that have been fixed in later versions. In addition, most operating system patches contain fixes for recently discovered security vulnerabilities. Due to the highly privileged activities of a PAW, it must be maintained at the highest security posture possible and therefore must have the latest operating system updates installed.

Because a PAW is isolated from online operating system update services, a software update service must be available on the intranet to manage operating system and other software updates for site PAWs. A separate software update service is not required at each tier."
  solution    : "Install a Windows update service (for example, Microsoft WSUS or System Center Configuration Manager [SCCM]) to provide software updates to all Windows-based PAWs in the organization.

Configure the Windows update service to download available operating system updates and install them when approved.

Based on site policy, configure the Windows update service to either automatically approve new updates for installation or to not install updates until installation is initiated by an authorized PAW maintenance administrator.

If WSUS is being used, configure Windows Update for WSUS on each PAW (use appropriate configuration procedures if an alternate Windows update service is used).

Go to Computer Configuration\Administrative Templates\Windows Components\Windows Updates and follow the steps below:

1. Enable the Configure Automatic Updates policy.
2. Select option 4 - Auto download and schedule the install.
3. Change the option 'Scheduled install day' to '0 - Every Day' and the option 'Scheduled install time' to your organizational preference.
4. Enable option 'Specify intranet Microsoft update service location' policy, and specify in both options the URL of the WSUS server."
  reference   : "800-171|3.14.1,800-53|SI-2(5),CAT|II,CCI|CCI-000366,CSCv6|4.5,CSF|ID.RA-1,CSF|PR.IP-12,NIAv2|NS26b,Rule-ID|SV-92859r1_rule,STIG-ID|WPAW-00-000800,SWIFT-CSCv1|2.2,Vuln-ID|V-78153"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_DWORD
  value_data  : 0
  reg_key     : "HKLM\Software\Policies\Microsoft\Windows\Windowsupdate\Au"
  reg_item    : "ScheduledInstallDay"
</custom_item>

<custom_item>
  type        : REGISTRY_SETTING
  description : "WPAW-00-000800 - A Windows update service must be available to provide software updates for the PAW platform - ScheduledInstallTime"
  info        : "Older versions of operating systems usually contain vulnerabilities that have been fixed in later versions. In addition, most operating system patches contain fixes for recently discovered security vulnerabilities. Due to the highly privileged activities of a PAW, it must be maintained at the highest security posture possible and therefore must have the latest operating system updates installed.

Because a PAW is isolated from online operating system update services, a software update service must be available on the intranet to manage operating system and other software updates for site PAWs. A separate software update service is not required at each tier."
  solution    : "Install a Windows update service (for example, Microsoft WSUS or System Center Configuration Manager [SCCM]) to provide software updates to all Windows-based PAWs in the organization.

Configure the Windows update service to download available operating system updates and install them when approved.

Based on site policy, configure the Windows update service to either automatically approve new updates for installation or to not install updates until installation is initiated by an authorized PAW maintenance administrator.

If WSUS is being used, configure Windows Update for WSUS on each PAW (use appropriate configuration procedures if an alternate Windows update service is used).

Go to Computer Configuration\Administrative Templates\Windows Components\Windows Updates and follow the steps below:

1. Enable the Configure Automatic Updates policy.
2. Select option 4 - Auto download and schedule the install.
3. Change the option 'Scheduled install day' to '0 - Every Day' and the option 'Scheduled install time' to your organizational preference.
4. Enable option 'Specify intranet Microsoft update service location' policy, and specify in both options the URL of the WSUS server."
  reference   : "800-171|3.14.1,800-53|SI-2(5),CAT|II,CCI|CCI-000366,CSCv6|4.5,CSF|ID.RA-1,CSF|PR.IP-12,NIAv2|NS26b,Rule-ID|SV-92859r1_rule,STIG-ID|WPAW-00-000800,SWIFT-CSCv1|2.2,Vuln-ID|V-78153"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_DWORD
# Note: Variable @WSUS_SCHED_INSTALL_TIME@ replaced with "3" in field "value_data".
  value_data  : 3
  reg_key     : "HKLM\Software\Policies\Microsoft\Windows\Windowsupdate\Au"
  reg_item    : "ScheduledInstallTime"
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "WPAW-00-001000 - The Windows PAW must be configured so that all non-administrative-related applications and functions are blocked or removed from the PAW platform, including but not limited to email, Internet browsing, and line-of-business applications."
  info            : "Note: The intent of this requirement is that a PAW must not be used for any function not related to the management of high-value IT resources.

Note: Authorized exception - It is noted that administrators will need access to non-administrative functions, such as email and the Internet, but a PAW must not be used for these activities. For sites that are constrained in the number of available workstations, an acceptable approach is to install the non-administrative services on a separate virtual machine (VM) on the workstation where the PAW service is installed. The VM will provide acceptable isolation between high-value administrative management accounts and non-administrative services.

Note: Relationship between the exception in WPAW-00-000500 and WPAW-00-001000 and requirement WPAW-00-001800: WPAW-00-000500 and WPAW-00-001000 allow an exception to the requirement for sites constrained in the number of available workstations. Lower-tier, high-value admin accounts can operate in a VM if the higher-tier, high-value admin accounts operate in the VM host-OS, but WPAW-00-001800 is more appropriate for a multiple PAW VM environment.

A main security architectural construct of a PAW is to remove non-administrative applications and functions from the PAW workstation. Many standard user applications and functions, including email processing, Internet browsing, and using business applications, can increase the security risk to the workstation. These apps and functions are susceptible to many security vulnerabilities, including phishing attacks and embedded malware. This increased risk is not acceptable for the highly privileged activities of a PAW.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution        : "Remove email applications and all line-of business applications from the PAW.

Note: Internet browsing is blocked using the PAW host-based firewall or by configuring a proxy address with a loopback address on the PAW. (See STIG check WPAW-00-002200.)"
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92861r1_rule,STIG-ID|WPAW-00-001000,SWIFT-CSCv1|2.3,Vuln-ID|V-78155"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : ""
  powershell_args : "echo `n'Applications'`n;Get-Wmiobject -Class Win32_Product|Select name;echo `n'Windows Features'`n;Get-WindowsFeature | where {$_.installstate -eq 'installed' }|select name"
  severity        : MEDIUM
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "WPAW-00-001050 - Device Guard Code Integrity Policy must be used on the Windows PAW to restrict applications that can run on the system (Device Guard Code Integrity Policy)."
  info            : "A main security architectural construct of a PAW is to restrict non-administrative applications and functions from the PAW workstation. Many standard user applications and functions, including email processing, Internet browsing, and using business applications, can increase the security risk to the workstation. These apps and functions are susceptible to many security vulnerabilities, including phishing attacks and embedded malware. This increased risk is not acceptable for the highly privileged activities of a PAW."
  solution        : "Implement a whitelist of authorized PAW applications using Device Guard. See the Device Guard Deployment Guide (https://docs.microsoft.com/en-us/windows/device-security/device-guard/device-guard-deployment-guide) for deployment information and hardware requirements and the IAD Device Guard document 'Implementing a Secure Administrative Workstation using Device Guard' at https://github.com/iadgov/Secure-Host-Baseline/tree/master/Device%20Guard."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92863r2_rule,STIG-ID|WPAW-00-001050,SWIFT-CSCv1|2.3,Vuln-ID|V-78157"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : "CodeIntegrityPolicyEnforcementStatus : 2"
  powershell_args : "Get-CimInstance -ClassName Win32_DeviceGuard -Namespace root\Microsoft\Windows\DeviceGuard | Format-List CodeIntegrityPolicyEnforcementStatus"
</custom_item>

<custom_item>
  type        : GROUP_MEMBERS_POLICY
  description : "WPAW-00-002400 - Local privileged groups (excluding Administrators) on the Windows PAW must be restricted to include no members - Backup Operators"
  info        : "A main security architectural construct of a PAW is to restrict access to the PAW from only specific privileged accounts designated for managing the high-value IT resources the PAW has been designated to manage. If unauthorized standard user accounts or unauthorized high-value administrative accounts are able to access a specific PAW, high-value IT resources and critical DoD information could be compromised."
  solution    : "Complete the following configuration procedures to restrict access to privileged accounts on the PAW (see the instructions for use of group policy to define membership, PAW Installation instructions in the Microsoft PAW paper).

Configure membership of all local privileged groups (except for 'Administrators (built-in)' group) so it is empty*. This procedure applies to the following local privileged groups:

- Backup Operators (built-in)
- Hyper-V Administrators
- Network Configuration Operators
- Power Users
- Remote Desktop Users
- Replicator

Link the PAW group policy object (GPO) to the appropriate Tier devices Organizational Unit (OU).

*Allowed exception: If a Hyper-V environment is used, the Hyper-V Administrators group may include members."
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92865r1_rule,STIG-ID|WPAW-00-002400,SWIFT-CSCv1|2.3,Vuln-ID|V-78159"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_MULTI_TEXT
  value_data  : ""
  group_name  : "Backup Operators"
</custom_item>

<custom_item>
  type        : GROUP_MEMBERS_POLICY
  description : "WPAW-00-002400 - Local privileged groups (excluding Administrators) on the Windows PAW must be restricted to include no members - Cryptographic Operators"
  info        : "A main security architectural construct of a PAW is to restrict access to the PAW from only specific privileged accounts designated for managing the high-value IT resources the PAW has been designated to manage. If unauthorized standard user accounts or unauthorized high-value administrative accounts are able to access a specific PAW, high-value IT resources and critical DoD information could be compromised."
  solution    : "Complete the following configuration procedures to restrict access to privileged accounts on the PAW (see the instructions for use of group policy to define membership, PAW Installation instructions in the Microsoft PAW paper).

Configure membership of all local privileged groups (except for 'Administrators (built-in)' group) so it is empty*. This procedure applies to the following local privileged groups:

- Backup Operators (built-in)
- Hyper-V Administrators
- Network Configuration Operators
- Power Users
- Remote Desktop Users
- Replicator

Link the PAW group policy object (GPO) to the appropriate Tier devices Organizational Unit (OU).

*Allowed exception: If a Hyper-V environment is used, the Hyper-V Administrators group may include members."
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92865r1_rule,STIG-ID|WPAW-00-002400,SWIFT-CSCv1|2.3,Vuln-ID|V-78159"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_MULTI_TEXT
  value_data  : ""
  group_name  : "Cryptographic Operators"
</custom_item>

<custom_item>
  type        : GROUP_MEMBERS_POLICY
  description : "WPAW-00-002400 - Local privileged groups (excluding Administrators) on the Windows PAW must be restricted to include no members - Hyper-V Administrators"
  info        : "A main security architectural construct of a PAW is to restrict access to the PAW from only specific privileged accounts designated for managing the high-value IT resources the PAW has been designated to manage. If unauthorized standard user accounts or unauthorized high-value administrative accounts are able to access a specific PAW, high-value IT resources and critical DoD information could be compromised."
  solution    : "Complete the following configuration procedures to restrict access to privileged accounts on the PAW (see the instructions for use of group policy to define membership, PAW Installation instructions in the Microsoft PAW paper).

Configure membership of all local privileged groups (except for 'Administrators (built-in)' group) so it is empty*. This procedure applies to the following local privileged groups:

- Backup Operators (built-in)
- Hyper-V Administrators
- Network Configuration Operators
- Power Users
- Remote Desktop Users
- Replicator

Link the PAW group policy object (GPO) to the appropriate Tier devices Organizational Unit (OU).

*Allowed exception: If a Hyper-V environment is used, the Hyper-V Administrators group may include members."
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92865r1_rule,STIG-ID|WPAW-00-002400,SWIFT-CSCv1|2.3,Vuln-ID|V-78159"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_MULTI_TEXT
  value_data  : ""
  group_name  : "Hyper-V Administrators"
</custom_item>

<custom_item>
  type        : GROUP_MEMBERS_POLICY
  description : "WPAW-00-002400 - Local privileged groups (excluding Administrators) on the Windows PAW must be restricted to include no members - Network Configuration Operators"
  info        : "A main security architectural construct of a PAW is to restrict access to the PAW from only specific privileged accounts designated for managing the high-value IT resources the PAW has been designated to manage. If unauthorized standard user accounts or unauthorized high-value administrative accounts are able to access a specific PAW, high-value IT resources and critical DoD information could be compromised."
  solution    : "Complete the following configuration procedures to restrict access to privileged accounts on the PAW (see the instructions for use of group policy to define membership, PAW Installation instructions in the Microsoft PAW paper).

Configure membership of all local privileged groups (except for 'Administrators (built-in)' group) so it is empty*. This procedure applies to the following local privileged groups:

- Backup Operators (built-in)
- Hyper-V Administrators
- Network Configuration Operators
- Power Users
- Remote Desktop Users
- Replicator

Link the PAW group policy object (GPO) to the appropriate Tier devices Organizational Unit (OU).

*Allowed exception: If a Hyper-V environment is used, the Hyper-V Administrators group may include members."
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92865r1_rule,STIG-ID|WPAW-00-002400,SWIFT-CSCv1|2.3,Vuln-ID|V-78159"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_MULTI_TEXT
  value_data  : ""
  group_name  : "Network Configuration Operators"
</custom_item>

<custom_item>
  type        : GROUP_MEMBERS_POLICY
  description : "WPAW-00-002400 - Local privileged groups (excluding Administrators) on the Windows PAW must be restricted to include no members - excluding Administrators must be restricted to include no members -Power Users"
  info        : "A main security architectural construct of a PAW is to restrict access to the PAW from only specific privileged accounts designated for managing the high-value IT resources the PAW has been designated to manage. If unauthorized standard user accounts or unauthorized high-value administrative accounts are able to access a specific PAW, high-value IT resources and critical DoD information could be compromised."
  solution    : "Complete the following configuration procedures to restrict access to privileged accounts on the PAW (see the instructions for use of group policy to define membership, PAW Installation instructions in the Microsoft PAW paper).

Configure membership of all local privileged groups (except for 'Administrators (built-in)' group) so it is empty*. This procedure applies to the following local privileged groups:

- Backup Operators (built-in)
- Hyper-V Administrators
- Network Configuration Operators
- Power Users
- Remote Desktop Users
- Replicator

Link the PAW group policy object (GPO) to the appropriate Tier devices Organizational Unit (OU).

*Allowed exception: If a Hyper-V environment is used, the Hyper-V Administrators group may include members."
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92865r1_rule,STIG-ID|WPAW-00-002400,SWIFT-CSCv1|2.3,Vuln-ID|V-78159"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_MULTI_TEXT
  value_data  : ""
  group_name  : "Power Users"
</custom_item>

<custom_item>
  type        : GROUP_MEMBERS_POLICY
  description : "WPAW-00-002400 - Local privileged groups (excluding Administrators) on the Windows PAW must be restricted to include no members - Remote Desktop Users"
  info        : "A main security architectural construct of a PAW is to restrict access to the PAW from only specific privileged accounts designated for managing the high-value IT resources the PAW has been designated to manage. If unauthorized standard user accounts or unauthorized high-value administrative accounts are able to access a specific PAW, high-value IT resources and critical DoD information could be compromised."
  solution    : "Complete the following configuration procedures to restrict access to privileged accounts on the PAW (see the instructions for use of group policy to define membership, PAW Installation instructions in the Microsoft PAW paper).

Configure membership of all local privileged groups (except for 'Administrators (built-in)' group) so it is empty*. This procedure applies to the following local privileged groups:

- Backup Operators (built-in)
- Hyper-V Administrators
- Network Configuration Operators
- Power Users
- Remote Desktop Users
- Replicator

Link the PAW group policy object (GPO) to the appropriate Tier devices Organizational Unit (OU).

*Allowed exception: If a Hyper-V environment is used, the Hyper-V Administrators group may include members."
  reference   : "800-171|3.1.1,800-171|3.1.2,800-53|AC-17,CAT|II,CCI|CCI-000366,CIP|005-5-R2,CN-L3|8.1.10.6(i),CN-L3|8.1.4.4(c),CSF|PR.AC-3,CSF|PR.PT-4,ISO/IEC-27001|A.6.2.2,ITSG-33|AC-17,NESA|T5.4.5,Rule-ID|SV-92865r1_rule,STIG-ID|WPAW-00-002400,SWIFT-CSCv1|2.6,Vuln-ID|V-78159"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_MULTI_TEXT
  value_data  : ""
  group_name  : "Remote Desktop Users"
</custom_item>

<custom_item>
  type        : GROUP_MEMBERS_POLICY
  description : "WPAW-00-002400 - Local privileged groups (excluding Administrators) on the Windows PAW must be restricted to include no members - Replicator"
  info        : "A main security architectural construct of a PAW is to restrict access to the PAW from only specific privileged accounts designated for managing the high-value IT resources the PAW has been designated to manage. If unauthorized standard user accounts or unauthorized high-value administrative accounts are able to access a specific PAW, high-value IT resources and critical DoD information could be compromised."
  solution    : "Complete the following configuration procedures to restrict access to privileged accounts on the PAW (see the instructions for use of group policy to define membership, PAW Installation instructions in the Microsoft PAW paper).

Configure membership of all local privileged groups (except for 'Administrators (built-in)' group) so it is empty*. This procedure applies to the following local privileged groups:

- Backup Operators (built-in)
- Hyper-V Administrators
- Network Configuration Operators
- Power Users
- Remote Desktop Users
- Replicator

Link the PAW group policy object (GPO) to the appropriate Tier devices Organizational Unit (OU).

*Allowed exception: If a Hyper-V environment is used, the Hyper-V Administrators group may include members."
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92865r1_rule,STIG-ID|WPAW-00-002400,SWIFT-CSCv1|2.3,Vuln-ID|V-78159"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_MULTI_TEXT
  value_data  : ""
  group_name  : "Replicator"
</custom_item>

<custom_item>
  type        : REGISTRY_SETTING
  description : "WPAW-00-002500 - Restricted remote administration must be enabled for high-value systems - DisableRestrictedAdmin"
  info        : "Restricted remote administration features, RestrictedAdmin mode, and Remote Credential Guard for Remote Desktop Protocol (RDP), are an additional safeguard against 'pass the hash' attacks, where hackers attempt to gain higher administrative privileges from a single compromised machine. Restricted remote administration protects administrator accounts by ensuring that reusable credentials are not stored in memory on remote devices that could potentially be compromised. When restricted remote administration is implemented, the local RDP service tries to log on to the remote device using a network logon, so the user's credentials are not sent across the network. Therefore, if the high-value IT resource is compromised, the credentials of the administrator connecting to the IT resource from the PAW are not compromised."
  solution    : "Enable RestrictedAdmin mode or Remote Credential Guard on high-value systems.

On target systems (high-value assets), configure the following registry value:

- HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa
- Name: DisableRestrictedAdmin
- Type: REG_DWORD
- Value: 0

On PAW systems:

Configure the policy value for Computer Configuration >> Administrative Templates >> System >> Credentials Delegation 'Restrict delegation of credentials to remote servers' to 'Enabled'.

Starting with v1607 of Windows 10, this setting also requires selection of an option for 'Use the following restricted mode:' which includes the following:

Prefer Remote Credential Guard (v1703 - Restrict Credential Delegation)
Require Remote Credential Guard
Require Restricted Admin"
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92867r1_rule,STIG-ID|WPAW-00-002500,SWIFT-CSCv1|2.3,Vuln-ID|V-78161"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_DWORD
  value_data  : 0
  reg_key     : "HKLM\System\CurrentControlSet\Control\Lsa"
  reg_item    : "DisableRestrictedAdmin"
  reg_option  : CAN_NOT_BE_NULL
</custom_item>

<custom_item>
  type        : REGISTRY_SETTING
  description : "WPAW-00-002500 - Restricted remote administration must be enabled for high-value systems - RestrictedRemoteAdministration"
  info        : "Restricted remote administration features, RestrictedAdmin mode, and Remote Credential Guard for Remote Desktop Protocol (RDP), are an additional safeguard against 'pass the hash' attacks, where hackers attempt to gain higher administrative privileges from a single compromised machine. Restricted remote administration protects administrator accounts by ensuring that reusable credentials are not stored in memory on remote devices that could potentially be compromised. When restricted remote administration is implemented, the local RDP service tries to log on to the remote device using a network logon, so the user's credentials are not sent across the network. Therefore, if the high-value IT resource is compromised, the credentials of the administrator connecting to the IT resource from the PAW are not compromised."
  solution    : "Enable RestrictedAdmin mode or Remote Credential Guard on high-value systems.

On target systems (high-value assets), configure the following registry value:

- HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa
- Name: DisableRestrictedAdmin
- Type: REG_DWORD
- Value: 0

On PAW systems:

Configure the policy value for Computer Configuration >> Administrative Templates >> System >> Credentials Delegation 'Restrict delegation of credentials to remote servers' to 'Enabled'.

Starting with v1607 of Windows 10, this setting also requires selection of an option for 'Use the following restricted mode:' which includes the following:

Prefer Remote Credential Guard (v1703 - Restrict Credential Delegation)
Require Remote Credential Guard
Require Restricted Admin"
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92867r1_rule,STIG-ID|WPAW-00-002500,SWIFT-CSCv1|2.3,Vuln-ID|V-78161"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_DWORD
  value_data  : 1
  reg_key     : "HKLM\Software\Policies\Microsoft\Windows\CredentialsDelegation"
  reg_item    : "RestrictedRemoteAdministration"
  reg_option  : CAN_NOT_BE_NULL
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "WPAW-00-001060 - Device Guard Code Integrity Policy must be used on the Windows PAW to restrict applications that can run on the system (Device Guard User Mode Code Integrity)."
  info            : "A main security architectural construct of a PAW is to restrict non-administrative applications and functions from the PAW workstation. Many standard user applications and functions, including email processing, Internet browsing, and using business applications, can increase the security risk to the workstation. These apps and functions are susceptible to many security vulnerabilities, including phishing attacks and embedded malware. This increased risk is not acceptable for the highly privileged activities of a PAW."
  solution        : "Implement a whitelist of authorized PAW applications using Device Guard. See the Device Guard Deployment Guide (https://docs.microsoft.com/en-us/windows/device-security/device-guard/device-guard-deployment-guide) for deployment information and hardware requirements and the IAD Device Guard document 'Implementing a Secure Administrative Workstation using Device Guard' at https://github.com/iadgov/Secure-Host-Baseline/tree/master/Device%20Guard."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92869r2_rule,STIG-ID|WPAW-00-001060,SWIFT-CSCv1|2.3,Vuln-ID|V-78163"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : "UsermodeCodeIntegrityPolicyEnforcementStatus : 2"
  powershell_args : "Get-CimInstance -ClassName Win32_DeviceGuard -Namespace root\Microsoft\Windows\DeviceGuard | Format-List UsermodeCodeIntegrityPolicyEnforcementStatus"
</custom_item>

<custom_item>
  type        : USER_RIGHTS_POLICY
  description : "WPAW-00-001100 - Windows PAWs must be restricted to only allow groups used to manage high-value IT resources and members of the local Administrators group to log on locally."
  info        : "A main security architectural construct of a PAW is to limit users of the PAW to only administrators of high-value IT resources. This will mitigate some of the risk of attack on administrators of high-value IT resources."
  solution    : "Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Local Policies >> User Rights Assignment >> 'Allow log on locally' to only include the following groups or accounts:

- Administrators
- Groups specifically designated to manage high-value IT resources"
  reference   : "800-53|AC-6(7),CAT|II,CCI|CCI-000366,CSCv6|16,CSF|PR.AC-4,ISO/IEC-27001|A.9.2.5,NESA|M1.1.3,NESA|T5.1.1,Rule-ID|SV-92871r1_rule,STIG-ID|WPAW-00-001100,Vuln-ID|V-78165"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : USER_RIGHT
# Note: Variable @LOG_ON_LOCALLY_USERS@ replaced with "'administrators'" in field "value_data".
  value_data  : 'administrators'
  right_type  : SeInteractiveLogonRight
</custom_item>

<custom_item>
  type        : USER_RIGHTS_POLICY
  description : "WPAW-00-001200 - The domain must be configured to restrict privileged administrator accounts from logging on to lower-tier hosts - Deny log on as a service"
  info        : "If the domain is not configured to restrict privileged administrator accounts from logging on to lower-tier hosts, it would be impossible to isolate administrative accounts to specific trust zones and protect IT resources from threats from high-risk trust zones. Blocking logon to lower-tier assets helps protect IT resources in a tier from being attacked from a lower tier."
  solution    : "Configure domain systems to prevent higher-tier administrative accounts from logging on to lower-tier hosts.

Assign higher-tier administrative groups to the Deny log on user rights of lower-tier hosts. This includes the following user rights:

Deny log on as a batch job
Deny log on as a service
Deny log on locally

Domain and Enterprise Admins are currently required to be included in the appropriate deny user rights in the Windows STIGs for member servers and workstations."
  reference   : "800-53|AC-6(7),CAT|II,CCI|CCI-000366,CSCv6|16,CSF|PR.AC-4,ISO/IEC-27001|A.9.2.5,NESA|M1.1.3,NESA|T5.1.1,Rule-ID|SV-92873r1_rule,STIG-ID|WPAW-00-001200,Vuln-ID|V-78167"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : USER_RIGHT
# Note: Variable @DENY_SERV_LOGON@ replaced with "'enterprise administrators'" in field "value_data".
  value_data  : 'enterprise administrators'
  right_type  : SeDenyServiceLogonRight
</custom_item>

<custom_item>
  type        : USER_RIGHTS_POLICY
  description : "WPAW-00-001200 - The domain must be configured to restrict privileged administrator accounts from logging on to lower-tier hosts - Deny log on as a batch job"
  info        : "If the domain is not configured to restrict privileged administrator accounts from logging on to lower-tier hosts, it would be impossible to isolate administrative accounts to specific trust zones and protect IT resources from threats from high-risk trust zones. Blocking logon to lower-tier assets helps protect IT resources in a tier from being attacked from a lower tier."
  solution    : "Configure domain systems to prevent higher-tier administrative accounts from logging on to lower-tier hosts.

Assign higher-tier administrative groups to the Deny log on user rights of lower-tier hosts. This includes the following user rights:

Deny log on as a batch job
Deny log on as a service
Deny log on locally

Domain and Enterprise Admins are currently required to be included in the appropriate deny user rights in the Windows STIGs for member servers and workstations."
  reference   : "800-53|AC-6(7),CAT|II,CCI|CCI-000366,CSCv6|16,CSF|PR.AC-4,ISO/IEC-27001|A.9.2.5,NESA|M1.1.3,NESA|T5.1.1,Rule-ID|SV-92873r1_rule,STIG-ID|WPAW-00-001200,Vuln-ID|V-78167"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : USER_RIGHT
# Note: Variable @DENY_BATCH_LOGON@ replaced with "'enterprise administrators'" in field "value_data".
  value_data  : 'enterprise administrators'
  right_type  : SeDenyBatchLogonRight
</custom_item>

<custom_item>
  type        : USER_RIGHTS_POLICY
  description : "WPAW-00-001200 - The domain must be configured to restrict privileged administrator accounts from logging on to lower-tier hosts - Deny log on locally"
  info        : "If the domain is not configured to restrict privileged administrator accounts from logging on to lower-tier hosts, it would be impossible to isolate administrative accounts to specific trust zones and protect IT resources from threats from high-risk trust zones. Blocking logon to lower-tier assets helps protect IT resources in a tier from being attacked from a lower tier."
  solution    : "Configure domain systems to prevent higher-tier administrative accounts from logging on to lower-tier hosts.

Assign higher-tier administrative groups to the Deny log on user rights of lower-tier hosts. This includes the following user rights:

Deny log on as a batch job
Deny log on as a service
Deny log on locally

Domain and Enterprise Admins are currently required to be included in the appropriate deny user rights in the Windows STIGs for member servers and workstations."
  reference   : "800-53|AC-6(7),CAT|II,CCI|CCI-000366,CSCv6|16,CSF|PR.AC-4,ISO/IEC-27001|A.9.2.5,NESA|M1.1.3,NESA|T5.1.1,Rule-ID|SV-92873r1_rule,STIG-ID|WPAW-00-001200,Vuln-ID|V-78167"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : USER_RIGHT
# Note: Variable @DENY_INTERACTIVE_LOGON@ replaced with "'enterprise administrators'" in field "value_data".
  value_data  : 'enterprise administrators'
  right_type  : SeDenyInteractiveLogonRight
</custom_item>

<report type:"WARNING">
  description : "WPAW-00-001300 - A Windows PAW used to manage domain controllers and directory services must not be used to manage any other type of high-value IT resource."
  info        : "Domain controllers (DC) are usually the most sensitive, high-value IT resources in a domain. Dedicating a PAW to be used solely for managing domain controllers will aid in protecting privileged domain accounts from being compromised.

For Windows, this includes the management of Active Directory itself and the DCs that run Active Directory, including such activities as domain-level user and computer management, administering trusts, replication, schema changes, site topology, domain-wide group policy, the addition of new DCs, DC software installation, and DC backup and restore operations.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Set aside one or more PAWs for remote management of Active Directory.

Ensure they are used only for the purpose of managing directory services. Otherwise, use the local domain controller console to manage Active Directory."
  reference   : "800-53|CM-6,800-53|SC-2,CAT|I,CCI|CCI-001082,Rule-ID|SV-92875r1_rule,STIG-ID|WPAW-00-001300,Vuln-ID|V-78169"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
</report>

<custom_item>
  type        : USER_RIGHTS_POLICY
  description : "WPAW-00-001400 - PAWs used to manage Active Directory must only allow groups specifically designated to manage Active Directory, such as Enterprise and Domain Admins and members of the local Administrators group, to log on locally."
  info        : "PAW platforms are used for highly privileged activities. The accounts that have administrative privileges on domain-level PAW platforms must not be used on or used to manage any non-domain-level PAW platforms. Otherwise, there would be a clear path for privilege escalation to Enterprise Admin (EA)/Domain Admin (DA) privileges.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Configure the group policy that applies to the PAW.

Install only administrative accounts designated to be used to manage domain controllers and Active Directory remotely in the PAW User group on PAWs designated for the management of domain controllers and Active Directory.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Local Policies >> User Rights Assignment >> 'Allow log on locally' to only include the following groups or accounts:

- Administrators
- Groups specifically designated to manage domain controllers and Active Directory"
  reference   : "800-53|AC-6(7),CAT|II,CCI|CCI-000366,CSCv6|16,CSF|PR.AC-4,ISO/IEC-27001|A.9.2.5,NESA|M1.1.3,NESA|T5.1.1,Rule-ID|SV-92877r1_rule,STIG-ID|WPAW-00-001400,Vuln-ID|V-78171"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : USER_RIGHT
# Note: Variable @LOG_ON_LOCALLY_USERS_DOM_ADMIN@ replaced with "'enterprise administrators'" in field "value_data".
  value_data  : 'enterprise administrators'
  right_type  : SeInteractiveLogonRight
  severity    : MEDIUM
</custom_item>

<report type:"WARNING">
  description : "WPAW-00-001500 - In a Windows PAW, administrator accounts used for maintaining the PAW must be separate from administrative accounts used to manage high-value IT resources."
  info        : "Note: PAW accounts used to manage high-value IT resources have privileged rights on managed systems but no administrative or maintenance rights on the PAW. They only have user rights on the PAW. PAW administrative/maintenance accounts only have administrative rights on a PAW and are used only to perform administrative functions on the PAW.  PAW administrative/maintenance accounts are the only admin accounts that have admin rights on a PAW.  It is not required that PAW administrative/maintenance accounts be organized by tier.

The PAW platform should be protected from high-value IT resource administrators accidently or deliberately modifying the security settings of the PAW. Therefore, high-value IT resource administrators must not have the ability to perform maintenance functions on the PAW platform. Separate PAW admin accounts must be set up that only have rights to manage PAW platforms.

PAW administrators have the capability to compromise Domain Admin accounts; therefore, personnel assigned as PAW administrators must be the most trusted and experienced administrators within an organization, at least equal to personnel assigned as domain administrators.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Set up separate domain administrative accounts to manage PAWs from domain administrative accounts used to manage high-value IT resources. Each of these accounts is not to be used for any other purpose.

Note: Personnel assigned as PAW administrators should be the most trusted and experienced administrators within an organization."
  reference   : "800-53|CM-6,800-53|SC-2,CAT|II,CCI|CCI-001082,Rule-ID|SV-92879r1_rule,STIG-ID|WPAW-00-001500,Vuln-ID|V-78173"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
</report>

<custom_item>
  type        : REGISTRY_SETTING
  description : "WPAW-00-001600 - The Windows PAW must be configured to enforce two-factor authentication and use Active Directory for authentication management."
  info        : "Due to the highly privileged functions of a PAW, a high level of trust must be implemented for access to the PAW, including non-repudiation of the user session. One-factor authentication, including username and password and shared administrator accounts, does not provide adequate assurance."
  solution    : "In Active Directory, configure group policy to enable either smart card or another DoD-approved two-factor authentication method for all PAWs.

- Go to Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options.
- Set 'Interactive logon: Require smart card' to 'Enabled'."
  reference   : "800-53|IA-5(11),CAT|II,CCI|CCI-000767,CN-L3|7.1.3.1(f),CSF|PR.AC-1,Rule-ID|SV-92881r1_rule,STIG-ID|WPAW-00-001600,SWIFT-CSCv1|4.2,SWIFT-CSCv1|5.2,Vuln-ID|V-78175"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_DWORD
  value_data  : 1
  reg_key     : "HKLM\Software\Microsoft\Windows\Currentversion\Policies\System"
  reg_item    : "scforceoption"
  reg_option  : CAN_NOT_BE_NULL
</custom_item>

<custom_item>
  type        : REGISTRY_SETTING
  description : "WPAW-00-001700 - The Windows PAW must use a trusted channel for all connections between a PAW and IT resources managed from the PAW."
  info        : "Note: The Common Criteria Security Functional Requirement (SFR) FTP_ITC.1.1(1) defines 'trusted channel' as 'a channel that uses IPsec, SSH, TLS, or TLS/HTTPS to provide a trusted communications channel between itself and authorized IT entity that is logically distinct from other communication channels and provides assured identification of its end points and protection of the channel data from modification or disclosure.' The trusted channel uses IPsec, TLS, DTLS, or HTTPS as the protocol that preserves the confidentiality and integrity of PAW communications.

The confidentiality and integrity of the communications between the PAW and high-value IT resources being managed from the PAW must be protected due to the highly sensitive nature of the administrative functions being performed. A trusted channel provides the requisite assured identification of its end points and protection of the channel data from modification or disclosure."
  solution    : "Configure the PAWs to use IPsec, SSH, TLS, or TLS/HTTPS for all connections between the PAW and managed IT resources on the intranet.

Configure the policy value for Computer Configuration >> Windows Settings >> Security Settings >> Local Policies >> Security Options >> 'System cryptography: Use FIPS compliant algorithms for encryption, hashing, and signing' to 'Enabled'."
  reference   : "800-171|3.13.11,800-53|SC-13,CAT|I,CCI|CCI-001135,CCI|CCI-001136,CCI|CCI-002426,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e,Rule-ID|SV-92883r1_rule,STIG-ID|WPAW-00-001700,Vuln-ID|V-78177"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_DWORD
  value_data  : 1
  reg_key     : "HKLM\System\Currentcontrolset\Control\Lsa\Fipsalgorithmpolicy"
  reg_item    : "Enabled"
  reg_option  : CAN_NOT_BE_NULL
</custom_item>

<report type:"WARNING">
  description : "WPAW-00-001800 - If several Windows PAWs are set up in virtual machines (VMs) on a host server, the host server must only contain PAW VMs."
  info        : "A main security architectural construct of a PAW is to remove non-administrative functions from the PAW. Many standard user functions, including email processing, Internet browsing, and using business applications, can increase the security risk of the workstation. These apps and functions are susceptible to many security vulnerabilities, including phishing attacks and embedded malware. This increased risk is not acceptable for the highly privileged activities of a PAW. This requirement enforces this security concept in an environment where multiple PAW VMs are installed on a host server.

Note: Relationship between the exception in WPAW-00-000500 and WPAW-00-001000 and requirement WPAW-00-001800: WPAW-00-000500 and WPAW-00-001000 allow an exception to the requirement for sites constrained in the number of available workstations. Lower-tier, high-value admin accounts can operate in a VM if the higher-tier, high-value admin accounts operate in the VM host-OS, but WPAW-00-001800 is more appropriate for a multiple PAW VM environment.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Install only PAW VMs on a host server designated for PAWs."
  reference   : "800-53|CM-6,CAT|II,CCI|CCI-000366,Rule-ID|SV-92885r1_rule,STIG-ID|WPAW-00-001800,Vuln-ID|V-78179"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
</report>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "WPAW-00-002100 - The Windows PAW must be configured so that all inbound ports and services to a PAW are blocked except as needed for monitoring, scanning, and management tools or when the inbound communication is a response to an outbound connection request."
  info            : "A main security architectural construct of a PAW is that the workstation is isolated from most Internet threats, including phishing, impersonation, and credential theft attacks. This isolation is partially implemented by blocking unsolicited inbound traffic to the PAW.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution        : "Determine which inbound ports, services, addresses, or subnets are needed on the PAW for the organization's monitoring, scanning, and management tools.

Configure the host-based firewall on the PAW to block all inbound connection requests except for organizational monitoring, scanning, and management tools or for inbound connections that are responses to outbound connection requests.

Configure the host-based firewall on the PAW to block users with local administrative access from creating or modifying local firewall rules.

Note: The exact configuration procedure will depend on which host-based firewall (for example, Host-Based Security System [HBSS]) is used on the PAW. DoD sites should refer to DoD policies and firewall STIGs to determine acceptable firewalls products."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-002403,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92887r1_rule,STIG-ID|WPAW-00-002100,SWIFT-CSCv1|2.3,Vuln-ID|V-78181"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : ".*"
  powershell_args : "netstat.exe -ano;netsh advfirewall show domain;netsh advfirewall show public;netsh advfirewall show private"
  severity        : MEDIUM
</custom_item>

<custom_item>
  type            : AUDIT_POWERSHELL
  description     : "WPAW-00-002200 - The Windows PAW must be configured so that all outbound connections to the Internet from a PAW are blocked."
  info            : "Note: Internal domain connections from a PAW to communicate with IT resources being managed via the PAW with domain controllers or with a digital credential verification service (for example, Online Certificate Status Protocol [OCSP]) are allowed.

A main security architectural construct of a PAW is that the workstation is isolated from most Internet threats, including phishing, impersonation, and credential theft attacks. This isolation is partially implemented by blocking all outbound connections to the Internet.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution        : "Configure the PAW host-based firewall to block outbound connection requests to the Internet gateway or configure the PAW with an Internet proxy address with a loopback address. Allowed exceptions include connections to communicate with IT resources being managed via the PAW, including the management console of authorized public cloud services; with domain controllers; or with a digital credential verification service (for example, OCSP).

If the PAW host-based firewall method is used, configure the firewall to block outbound connection requests to the Internet gateway. The exact configuration procedure will depend on which host-based firewall (for example, Host-Based Security System [HBSS]) is used on the PAW. DoD sites should refer to DoD policies and firewall STIGs to determine acceptable firewalls products.

If the Internet proxy address with a loopback address method is used, consider using the configuration instructions listed in of the Microsoft Privileged Access Workstation paper.

In addition, disable the capability of the administrator to manually override the proxy settings on each PAW."
  reference       : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-002399,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92889r1_rule,STIG-ID|WPAW-00-002200,SWIFT-CSCv1|2.3,Vuln-ID|V-78183"
  see_also        : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type      : POLICY_TEXT
  value_data      : ".*"
  powershell_args : "netstat.exe -ano;netsh advfirewall show domain;netsh advfirewall show public;netsh advfirewall show private"
  severity        : MEDIUM
</custom_item>

<custom_item>
  type        : GROUP_MEMBERS_POLICY
  description : "WPAW-00-002300 - The local Administrators group on the Windows PAW must only include groups with accounts specifically designated to administer the PAW."
  info        : "A main security architectural construct of a PAW is to restrict access to the PAW from only specific privileged accounts designated for managing the high-value IT resources the PAW has been designated to manage. If unauthorized standard user accounts or unauthorized high-value administrative accounts are able to access a specific PAW, high-value IT resources and critical DoD information could be compromised.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
  solution    : "Restrict membership of the local Administrators group to only include members of the group specifically designated to manage the PAW and local administrator(s).

See the Microsoft PAW paper (https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/privileged-access-workstations) for more information (go to PAW Installation instructions)."
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,Rule-ID|SV-92891r1_rule,STIG-ID|WPAW-00-002300,SWIFT-CSCv1|2.3,Vuln-ID|V-78185"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
  value_type  : POLICY_MULTI_TEXT
  value_data  : ""
  group_name  : "Administrators"
  severity    : MEDIUM
</custom_item>

<report type:"WARNING">
  description : "WPAW-00-002600 - If several PAWs are set up in virtual machines (VMs) on a host server, domain administrative accounts used to manage high-value IT resources must not have access to the VM host operating system (OS) (only domain administrative accounts designated to manage PAWs should be able to access the VM host OS)."
  info        : "The VM host OS should be protected from high-value IT resource administrators accidently or deliberately modifying the security settings of the host OS. Therefore, high-value IT resource administrators must not have the ability to perform maintenance functions on the VM host OS platform.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Configure the VM host OS so only domain administrative accounts designated to manage PAWs have administrative rights on the VM host OS."
  reference   : "800-53|CM-6,CAT|II,CCI|CCI-000366,Rule-ID|SV-92893r1_rule,STIG-ID|WPAW-00-002600,Vuln-ID|V-78187"
  see_also    : "https://dl.dod.cyber.mil/wp-content/uploads/stigs/zip/U_MS_Windows_PAW_V1R3_STIG.zip"
</report>

</group_policy>
</check_type>
