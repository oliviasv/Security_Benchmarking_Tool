#
# This script is Copyright (C) 2004-2020 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
#
# $Revision: 1.30 $
# $Date: 2020/04/23 $
#
# description	: This .audit is designed against the CIS Security Configuration Benchmark For
# 			Microsoft IIS 5.0 and 6.0 for Microsoft Windows 2000, XP, and Server 2003,
# 			Version 1.0 August 15, 2007.
#
# NOTE 			: Some queries in this .audit require site-specific data to be known to the query in order to function properly.
# 	 		Please note the following queries and edit their values accordingly.
#
# 			2.4 Worker Process Identities - 'WAMUserName'
#
#<ui_metadata>
#<display_name>CIS IIS 6.0 v1.0.0</display_name>
#<spec>
#  <type>CIS</type>
#  <name>IIS 6.0</name>
#  <version>1.0.0</version>
#</spec>
#<labels>windows,cis,microsoft,internet,information,server,iis,iis_6</labels>
#<variables>
#  <variable>
#    <name>POOL_IDENTITY</name>
#    <default>IWAM_Machinename</default>
#    <description>Application Pool Identity</description>
#    <info>The name of the identity used for the application pool.</info>
#  </variable>
#  <variable>
#    <name>DOTNET_FRAMEWORK_VERSION_VALUE</name>
#    <default>v2.0.50727</default>
#    <description>.NET Framework version</description>
#    <info>The version of the .NET framework used in your organization.</info>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Windows" version:"2">
<group_policy:"CIS Microsoft IIS 6.0 Benchmark v1.0">

<if>
  <condition type:"AND">
    <custom_item>
      type        : REGISTRY_SETTING
      description : "Microsoft Internet Information Server (IIS) 6.0 is installed - 'Major Version = 6'"
      value_type  : POLICY_DWORD
      value_data  : "6"
      reg_key     : "HKLM\SOFTWARE\Microsoft\INetStp"
      reg_item    : "MajorVersion"
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "Microsoft Internet Information Server (IIS) 6.0 is installed - 'Minor Version = 0'"
      value_type  : POLICY_DWORD
      value_data  : "0"
      reg_key     : "HKLM\SOFTWARE\Microsoft\INetStp"
      reg_item    : "MinorVersion"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "CIS_v1.0_MS_IIS_6.audit"
    </report>

#
## 1 - Legacy IIS settings
#

    <custom_item>
      type        : FILE_CHECK
      description : "1.1 Default Install Files - '%systemdrive%\inetpub\wwwroot\aspnet_client'"
      info        : "1. Remove the contents of the inetpub\wwwroot folder.  Removing unnecessary files and folders will help to reduce attack surface thus mitigating unnecessary attack vectors."
      solution    : "Make sure '%systemdrive%\inetpub\aspnet_client' does not exist."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemdrive%\inetpub\aspnet_client"
      file_option : MUST_NOT_EXIST
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "1.1 Default Install Files - '%systemdrive%\inetpub\wwwroot\iisstart.htm'"
      info        : "1. Remove the contents of the inetpub\wwwroot folder.  Removing unnecessary files and folders will help to reduce attack surface thus mitigating unnecessary attack vectors."
      solution    : "Make sure '%systemdrive%\inetpub\iisstart.htm' does not exist."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemdrive%\inetpub\iisstart.htm"
      file_option : MUST_NOT_EXIST
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "1.1 Default Install Files - '%systemdrive%\inetpub\wwwroot\pagerror.gif'"
      info        : "1. Remove the contents of the inetpub\wwwroot folder.  Removing unnecessary files and folders will help to reduce attack surface thus mitigating unnecessary attack vectors."
      solution    : "Make sure '%systemdrive%\inetpub\wwwroot\pagerror.gif' does not exist."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemdrive%\inetpub\pagerror.gif"
      file_option : MUST_NOT_EXIST
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "1.1 Default Install Files - '%systemdrive%\inetpub\scripts'"
      info        : "2. Remove the inetpub/scripts folder.  Removing unnecessary files and folders will help to reduce  attack surface thus mitigating unnecessary attack vectors."
      solution    : "Make sure '%systemdrive%\inetpub\scripts' does not exist."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemdrive%\inetpub\scripts"
      file_option : MUST_NOT_EXIST
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "1.1 Default Install Files - '/scripts'"
      info          : "3. Remove the /scripts Virtual Directory mapping if it exists. Removing unnecessary files and folders will help to reduce attack surface thus mitigating unnecessary attack vectors."
      solution      : "Make sure '/scripts' does not exist."
      reference     : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
      value_data    : "/scripts"
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name FROM IIsWebVirtualDir"
      wmi_attribute : "Name"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "1.1 Default Install Files - '%systemdrive%\inetpub\scripts\IISSamples'"
      info        : "4. Remove the inetpub\scripts\IISSamples folder.  Removing unnecessary files and folders will help to reduce attack surface thus mitigating unnecessary attack vectors."
      solution    : "Make sure '%systemdrive%\inetpub\scripts\IISSamples' does not exist."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemdrive%\inetpub\scripts\IISSamples"
      file_option : MUST_NOT_EXIST
    </custom_item>

#
# NOTE: Metabase.xml Settings and values were obtained from http://msdn.microsoft.com/en-us/library/ms525644%28v=VS.90%29.aspx

    <custom_item>
      type          : WMI_POLICY
      description   : "1.1 Default Install Files - '/iissamples'"
      info          : "5. Remove the /iissamples Virtual Directory mapping if it exists.  Removing unnecessary files and  folders will help to reduce attack surface thus mitigating unnecessary attack vectors."
      solution      : "Make sure '/iissamples' does not exist."
      reference     : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
      value_data    : "/iissamples"
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name FROM IIsWebVirtualDir"
      wmi_attribute : "Name"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "1.1 Default Install Files - 'iisadmpwd' Check if exist"
      info          : "6. Restrict access to iisadmpwd Virtual Directory to Windows Authenticated users if it exist or remove the virtual directory mapping. Removing unnecessary files and folders will help to reduce attack surface thus mitigating unnecessary attack vectors."
      solution      : "Make sure 'iisadmpwd' does not exist."
      reference     : "800-171|3.1.5,800-53|AC-6(1),CCE|CCE-19797-0,CSF|PR.AC-4,ISO/IEC-27001|A.9.4.4,ITSG-33|AC-6(1),NESA|T5.1.1,NESA|T5.4.4,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM31,NIAv2|GS3,NIAv2|GS4,NIAv2|GS8c,NIAv2|VL3b,PCI-DSS|2.2.3,SWIFT-CSCv1|5.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
      value_data    : "iisadmpwd"
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name FROM IIsWebVirtualDir"
      wmi_attribute : "Name"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "1.1 Default Install Files - 'iisadmpwd' Check if using Integrated Windows Authentication"
      info          : "6. Restrict access to iisadmpwd Virtual Directory to Windows Authenticated users if it exist or remove the virtual directory mapping.  Removing unnecessary files and folders will help to reduce attack  surface thus mitigating unnecessary attack vectors."
      solution      : "Make sure 'iisadmpwd' does not exist or access is restricted to Windows Authenticated users."
      reference     : "800-171|3.1.5,800-53|AC-6,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.10.6(a),CN-L3|8.1.4.2(d),CSF|PR.AC-4,CSF|PR.DS-5,ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.1|7.1.2,PCI-DSSv3.2|7.1.2,PCI-DSS|2.2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 1
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AuthNTLM FROM IIsWebVirtualDirSetting WHERE Name='W3SVC/1/ROOT/iisadmpwd'"
      wmi_attribute : "AuthNTLM"
      wmi_key       : "AuthNTLM"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "1.1 Default Install Files - '/IISHelp'"
      info          : "7. Remove the /IISHelp Virtual Directory mapping if it exists. Removing unnecessary files and  folders will help to reduce attack surface thus mitigating unnecessary attack vectors."
      solution      : "Make sure '/IISHelp' does not exist."
      reference     : "800-171|3.4.2,800-53|CM-6,CCE|CCE-19956-2,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
      value_data    : "/IISHelp"
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name FROM IIsWebVirtualDir"
      wmi_attribute : "Name"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "1.1 Default Install Files - '/Printers'"
      info          : "8. Remove the /Printers Virtual Directory mapping if it exists. Removing unnecessary  files and folders will help to reduce attack surface thus mitigating unnecessary attack vectors."
      solution      : "Make sure '/Printers' does not exist."
      reference     : "800-171|3.4.2,800-53|CM-6,CCE|CCE-19991-9,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
      value_data    : "/Printers"
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name FROM IIsWebVirtualDir"
      wmi_attribute : "Name"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "1.2 Remote Data Services (RDS) - '%programfiles%\Common Files\System\Msadc\Samples'"
      info        : "1. Delete the MSADC samples located in \Program Files\Common Files\System\Msadc\Samples. A vulnerability in this feature led to the development of the virii and worms such as Code Red and Nimda."
      solution    : "Make sure '%programfiles%\Common Files\System\Msadc\Samples' does not exist. Delete the MSADC samples located in \Program Files\Common Files\System\Msadc\Samples."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CCE|CCE-19737-6,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%programfiles%\Common Files\System\msadc\Samples"
      file_option : MUST_NOT_EXIST
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "1.2 Remote Data Services (RDS) - '%programfiles%\Common Files\System\Msadc'"
      info        : "1. Delete the MSADC samples located in \Program Files\Common Files\System\Msadc\Samples. A vulnerability in this feature led to the development of the virii and worms such as Code Red and Nimda."
      solution    : "Make sure '%programfiles%\Common Files\System\Msadc' does not exist. Delete the MSADC samples located in \Program Files\Common Files\System\Msadc."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%programfiles%\Common Files\System\msadc"
      file_option : MUST_NOT_EXIST
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "1.2 Remote Data Services (RDS) - '/Msadc Virtual Directory'"
      info          : "1. Delete the MSADC samples located in \Program Files\Common Files\System\Msadc\Samples A vulnerability in this feature led to the development of the virii and worms such as Code Red and Nimda."
      solution      : "Make sure '/MSADC' does not exist (delete /MSADC)."
      reference     : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
      value_data    : "/MSADC"
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name FROM IIsWebVirtualDirSetting"
      wmi_attribute : "Name"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type        : REG_CHECK
      description : "1.2 Remote Data Services (RDS) - 'HKLM\System\CurrentControlSet\Services\W3SVC\Parameters\ADCLaunch\VbBusObj.VbBusObjCls'"
      info        : "2. Remove the registry key located in HKLM\System\CurrentControlSet\Services\W3SVC\Parameters\ADCLaunch\V bBusObj.VbBusObjCls. A vulnerability in this feature led to the development of the virii and worms such as Code Red and Nimda."
      solution    : "Make sure the registry item located in 'HKLM\System\CurrentControlSet\Services\W3SVC\Parameters\ADCLaunch' does not exist (delete the key VbBusObj.VbBusObjCls)"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CCE|CCE-19384-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "HKLM\System\CurrentControlSet\Services\W3SVC\Parameters\ADCLaunch"
      reg_option  : MUST_NOT_EXIST
      key_item    : "VbBusObj.VbBusObjCls"
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "1.2 Remote Data Services (RDS) - 'HKLM\Software\Microsoft\DataFactory\HandlerInfo'"
      info        : "3. Create a HandlerRequired registry key here: HKLM\Software\Microsoft\DataFactory\HandlerInfo\ 4. Create a DWORD = 1 (safe mode). A vulnerability in this feature led to the development of the virii and worms such as Code Red and Nimda."
      solution    : "Make sure the registry item 'HandlerRequired' has been created in the given registry location 'HKLM\Software\Microsoft\DataFactory\HandlerInfo' and the value_type is DWORD = 1 for safe mode."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_DWORD
      value_data  : 1
      reg_key     : "HKLM\Software\Microsoft\DataFactory\HandlerInfo"
      reg_item    : "HandlerRequired"
      reg_option  : MUST_EXIST
    </custom_item>

    <custom_item>
      type        : REGISTRY_SETTING
      description : "1.3 Internet Printing - 'HKLM\Software\Policies\Microsoft\Windows NT\Printers\DisableWebPrinting'"
      info        : "Enabled Internet Printing Protocol on the Windows 2000 server (and above) creates an attack  vector in which printers attached to the server are accessible through a web page."
      solution    : "Make sure the registry key 'DisableWebPrinting' exists and is set to 1 (disabled)."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_DWORD
      value_data  : 1
      reg_key     : "HKLM\Software\Policies\Microsoft\Windows NT\Printers"
      reg_item    : "DisableWebPrinting"
      reg_option  : MUST_EXIST
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK_NOT
      description : "1.3 Internet Printing - 'Internet Printing Protocol script mappings - .printer'"
      info        : "Enabled Internet Printing Protocol on the Windows 2000 server (and above) creates an attack  vector in which printers attached to the server are accessible through a web page."
      solution    : "Make sure anything with the extension '.printer' is removed."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CCE|CCE-20023-8,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemroot%\system32\inetsrv\MetaBase.xml"
      regex       : '([\/A-Za-z0-9\-])+\.[Pp][Rr][Ii][Nn][Tt][Ee][Rr]'
      expect      : '([\/A-Za-z0-9\-])+\.[Pp][Rr][Ii][Nn][Tt][Ee][Rr]'
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "1.4 URLScan - '%systemroot%\system32\inetsrv\urlscan\urlscan.exe'"
      info        : "It is recommended that URLScan be installed for IIS 5.0. IIS 6.0 implements a number of these features by default and may not gain additional security."
      solution    : "Make sure 'URLScan' is installed."
      reference   : "800-171|3.4.2,800-53|CM-6,CCE|CCE-19097-5,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemroot%\system32\inetsrv\urlscan\urlscan.exe"
      file_option : MUST_EXIST
    </custom_item>

    <report type:"WARNING">
      description : "1.5 IIS Lockdown (not scored)"
      info        : "The IIS Lockdown tool reduces the attack surface of IIS-dependent Microsoft products by disabling unnecessary features, such as FTP, SMTP, and NNTP. NOTE: The IIS Lockdown automates many of the hardening steps listed in this document. The default settings for IIS 6.0 should not require hardening. NOTE: Nessus did not perform this check as it requires manual verification the system has been hardened by the IIS Lockdown tool.

      NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Make sure 'IIS Lockdown' is installed."
      reference   : "PCI-DSS|2.2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
    </report>

#
## 2 - IIS Configuration (Services)
#

    <custom_item>
      type          : WMI_POLICY
      description   : "2.1 FTP User Isolation"
      info          : "FTP User Isolation provides the ability to separate users between sites by disallowing users from viewing or modifying other user's content."
      solution      : "Make sure 'FTP User Isolation' is set to No isolation: Does not enable user isolation or Isolation: Enabled isolation by authentication against local or domain accounts."
      reference     : "800-171|3.13.3,800-53|SC-2,ITSG-33|SC-2,NESA|T3.4.1,NIAv2|SS15b,PCI-DSS|2.2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : [1..2]
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT UserIsolationMode FROM IIsFTPServerSetting"
      wmi_attribute : "UserIsolationMode"
      wmi_key       : "UserIsolationMode"
    </custom_item>

    <report type:"WARNING">
      description : "2.2 SMTP"
      info        : "Securing SMTP involves requiring users to authenticate to the SMTP server before relaying messages, setting operator permissions, and requiring TLS encryption. NOTE: Nessus did not perform this check as it requires manual verification that the system is configured to utilize authentication for SMTP. NOTE: The Nessus Plugin Family 'SMTP Problems' contains many checks related to SMTP security and should be enabled in your scan policy.

      NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "It is recommended to use Windows Authentication before using the SMTP."
      reference   : "PCI-DSS|2.2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
    </report>

    <custom_item>
      type          : WMI_POLICY
      description   : "2.2 SMTP - 'AuthNTLM = True'"
      info          : "Securing SMTP involves requiring users to authenticate to the SMTP server before relaying messages, setting operator permissions, and requiring TLS encryption."
      solution      : "Make sure SMTP security is set so AuthNTLM is enabled."
      reference     : "800-171|3.1.13,800-53|AC-17(2),CIP|005-5-R2,CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.4.1(c),CSF|PR.AC-3,CSF|PR.PT-4,ITSG-33|AC-17(2),NESA|T5.4.2,NIAv2|AM37,PCI-DSS|2.2.3,SWIFT-CSCv1|2.6"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 1
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AuthNTLM FROM IisSmtpServerSetting"
      wmi_attribute : "AuthNTLM"
      wmi_key       : "AuthNTLM"
    </custom_item>

    <report type:"WARNING">
      description : "2.2 SMTP - 'Relay Restrictions'"
      info        : "Securing SMTP involves requiring users to authenticate to the SMTP server before relaying messages, setting operator permissions, and requiring TLS encryption. NOTE: Nessus did not perform this check as it requires manual verification that only required SMTP relays are listed in the Relay Restrictions list. NOTE: The Nessus Plugin Family 'SMTP Problems' contains many checks related to SMTP security and should be enabled in your scan policy.

      NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Make sure 'computer relay restrictions' is set to your organization's security policy."
      reference   : "PCI-DSS|2.2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
    </report>

    <custom_item>
      type          : WMI_POLICY
      description   : "2.2 SMTP - 'AccessSSL = True'"
      info          : "Securing SMTP involves requiring users to authenticate to the SMTP server before relaying messages, setting operator permissions, and requiring TLS encryption."
      solution      : "Make sure 'SMTP AccessSSL' is set to true."
      reference     : "800-171|3.1.13,800-53|AC-17(2),CIP|005-5-R2,CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.4.1(c),CSF|PR.AC-3,CSF|PR.PT-4,ITSG-33|AC-17(2),NESA|T5.4.2,NIAv2|AM37,PCI-DSS|2.2.3,SWIFT-CSCv1|2.6"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 1
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AccessSSL FROM IisSmtpServerSetting"
      wmi_attribute : "AccessSSL"
      wmi_key       : "AccessSSL"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "2.2 SMTP - 'AccessSSL128 = True'"
      info          : "Securing SMTP involves requiring users to authenticate to the SMTP server before relaying messages, setting operator permissions, and requiring TLS encryption."
      solution      : "Make sure 'SMTP AccessSSL128' is set to true."
      reference     : "800-171|3.1.13,800-53|AC-17(2),CIP|005-5-R2,CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.4.1(c),CSF|PR.AC-3,CSF|PR.PT-4,ITSG-33|AC-17(2),NESA|T5.4.2,NIAv2|AM37,PCI-DSS|2.2.3,SWIFT-CSCv1|2.6"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 1
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AccessSSL128 FROM IisSmtpServerSetting"
      wmi_attribute : "AccessSSL128"
      wmi_key       : "AccessSSL128"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "2.3 SSL - 'Global Setting - AccessSSL = True'"
      info          : "Use SSL when passing secure information such as credit card information over a channel."
      solution      : "Make sure 'SSL AccessSSL128' is set to true."
      reference     : "800-171|3.13.8,800-53|SC-8(1),CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,PCI-DSS|2.2.3,SWIFT-CSCv1|2.1,TBA-FIISB|29.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 1
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AccessSSL FROM IisWebServerSetting"
      wmi_attribute : "AccessSSL"
      wmi_key       : "AccessSSL"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "2.3 SSL - 'Virtual Dir Setting - AccessSSL = True'"
      info          : "Use SSL when passing secure information such as credit card information over a channel."
      solution      : "Make sure 'SSL AccessSSL128' is set to true."
      reference     : "800-171|3.13.8,800-53|SC-8(1),CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,PCI-DSS|2.2.3,SWIFT-CSCv1|2.1,TBA-FIISB|29.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AccessSSL FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AccessSSL"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "2.3 SSL - 'Global Setting - AccessSSL128 = True'"
      info          : "Use SSL when passing secure information such as credit card information over a channel."
      solution      : "Make sure 'SSL AccessSSL128' is set to true"
      reference     : "800-171|3.13.8,800-53|SC-8(1),CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,PCI-DSS|2.2.3,SWIFT-CSCv1|2.1,TBA-FIISB|29.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 1
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AccessSSL128 FROM IisWebServerSetting"
      wmi_attribute : "AccessSSL128"
      wmi_key       : "AccessSSL128"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "2.3 SSL - 'Virtual Dir Setting - AccessSSL128 = True'"
      info          : "Use SSL when passing secure information such as credit card information over a channel."
      solution      : "Make sure 'SSL AccessSSL128' is set to true"
      reference     : "800-171|3.13.8,800-53|SC-8(1),CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,PCI-DSS|2.2.3,SWIFT-CSCv1|2.1,TBA-FIISB|29.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AccessSSL128 FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AccessSSL128"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <report type:"WARNING">
      description : "2.3 SSL - 'Host configured for Secure communication'"
      info        : "Use SSL when passing secure information such as credit card information over a channel. NOTE: Ensure Nessus Plugin ID 22964 'Service detection' is enabled in your policy. This plugin will find whether the service is configured for SSL authentication or not.

      NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Make sure 'SSL Host configured for Secure communication' is set to configure SSL authentication"
      reference   : "PCI-DSS|2.2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
    </report>

    <custom_item>
      type          : WMI_POLICY
      description   : "2.4 Worker Process Identities - 'AppPoolIdentityType = SYSTEM,LOCAL SERVICE,NETWORK SERVICE, or SPECIFIC USER'"
      info          : "Applications that use worker process identities have a reduced attack surface when an application has been compromised because they have a limited set of privileges and permissions."
      solution      : "Make sure 'Worker Process Identities' is set to SYSTEM,LOCAL SERVICE,NETWORK SERVICE, or SPECIFIC USER"
      reference     : "800-171|3.1.5,800-53|AC-6,CCE|CCE-19840-8,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.10.6(a),CN-L3|8.1.4.2(d),CSF|PR.AC-4,CSF|PR.DS-5,ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.1|7.1.2,PCI-DSSv3.2|7.1.2,PCI-DSS|2.2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : [0..3]
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AppPoolIdentityType FROM IIsApplicationPoolsSetting"
      wmi_attribute : "AppPoolIdentityType"
      wmi_key       : "AppPoolIdentityType"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "2.4 Worker Process Identities - 'WAMUserName'"
      info          : "Applications that use worker process identities have a reduced attack surface when an application has been compromised because they have a limited set of privileges and permissions."
      info          : "NOTE: Update POOL_IDENTITY with the appropriate value for the local environment"
      solution      : "Make sure this value is changed to the specific user that was established for the worker process identity if one exist."
      reference     : "800-171|3.1.5,800-53|AC-6,CCE|CCE-20015-4,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.10.6(a),CN-L3|8.1.4.2(d),CSF|PR.AC-4,CSF|PR.DS-5,ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.1|7.1.2,PCI-DSSv3.2|7.1.2,PCI-DSS|2.2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
# Note: Variable @POOL_IDENTITY@ replaced with "IWAM_Machinename" in field "value_data".
      value_data    : "IWAM_Machinename"
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT WAMUserName FROM IIsApplicationPoolsSetting"
      wmi_attribute : "WAMUserName"
      wmi_key       : "WAMUserName"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "2.5 WebDAV Authentication - 'Global Setting - AuthNTLM = True'"
      info          : "WebDAV utilizes authentication and encryption, a feature that FTP does not utilize."
      solution      : "Make sure 'IisWebServerSetting AuthNTLM' is set to true."
      reference     : "800-171|3.1.13,800-53|AC-17(2),CIP|005-5-R2,CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.4.1(c),CSF|PR.AC-3,CSF|PR.PT-4,ITSG-33|AC-17(2),NESA|T5.4.2,NIAv2|AM37,PCI-DSS|2.2.3,SWIFT-CSCv1|2.6"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 1
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name,AuthNTLM FROM IIsWebServerSetting"
      wmi_attribute : "AuthNTLM"
      wmi_key       : "Name"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "2.5 WebDAV Authentication - 'Virtual Dir Setting - AuthNTLM = True'"
      info          : "WebDAV utilizes authentication and encryption, a feature that FTP does not utilize."
      solution      : "Make sure 'IIsWebVirtualDirSetting AuthNTLM' is set to true."
      reference     : "800-171|3.1.13,800-53|AC-17(2),CIP|005-5-R2,CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.4.1(c),CSF|PR.AC-3,CSF|PR.PT-4,ITSG-33|AC-17(2),NESA|T5.4.2,NIAv2|AM37,PCI-DSS|2.2.3,SWIFT-CSCv1|2.6"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 1
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name,AuthNTLM FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AuthNTLM"
      wmi_key       : "Name"
    </custom_item>

# 3 - IIS Configuration (MetaBase)

    <custom_item>
      type          : WMI_POLICY
      description   : "3.1 Anonymous User (anonymousUserName) - 'Global Setting - AnonymousUserName = IUSR_'"
      info          : "The principle of a non-privileged user is one that is running under least privilege, meaning they are non-admin users with limited functionality."
      solution      : "Make sure 'Anonymous User: anonymousUserName' is set to IUSR_(anyAlphaNumericSequenceHere) the 'IUSR' isn't case sensitive."
      reference     : "800-171|3.1.5,800-53|AC-6,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.10.6(a),CN-L3|8.1.4.2(d),CSF|PR.AC-4,CSF|PR.DS-5,ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.1|7.1.2,PCI-DSSv3.2|7.1.2,PCI-DSS|2.2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
      value_data    : "[Ii][Uu][Ss][Rr]_([A-Za-z0-9\-_])+"
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AnonymousUserName FROM IIsWebServerSetting"
      wmi_attribute : "AnonymousUserName"
      wmi_key       : "AnonymousUserName"
      check_type    : CHECK_REGEX
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.1 Anonymous User (anonymousUserName) - 'Virtual Dir Setting - AnonymousUserName = IUSR_'"
      info          : "The principle of a non-privileged user is one that is running under least privilege, meaning they are non-admin users with limited functionality."
      solution      : "Make sure 'Anonymous User: anonymousUserName' is set to IUSR_(anyAlphaNumericSequenceHere) the 'IUSR' isn't case sensitive."
      reference     : "800-171|3.1.5,800-53|AC-6,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.10.6(a),CN-L3|8.1.4.2(d),CSF|PR.AC-4,CSF|PR.DS-5,ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.1|7.1.2,PCI-DSSv3.2|7.1.2,PCI-DSS|2.2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
      value_data    : "[Ii][Uu][Ss][Rr]_([A-Za-z0-9\-_])+"
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AnonymousUserName FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AnonymousUserName"
      wmi_key       : "Name"
      check_type    : CHECK_REGEX
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.2 Client-side Application Debugging (AppAllowClientDebug) - 'Global Setting - AppAllowClientDebug = FALSE'"
      info          : "When this option is enabled detailed debugging information is sent to the end-user's browser."
      solution      : "Make sure 'AppAllowClientDebug' is set to FALSE."
      reference     : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AppAllowClientDebug FROM IIsWebServerSetting"
      wmi_attribute : "AppAllowClientDebug"
      wmi_key       : "AppAllowClientDebug"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.2 Client-side Application Debugging (AppAllowClientDebug) - 'Virtual Dir Setting - AppAllowClientDebug = FALSE'"
      info          : "When this option is enabled detailed debugging information is sent to the end-user's browser."
      solution      : "Make sure 'AppAllowClientDebug' is set to FALSE."
      reference     : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AppAllowClientDebug FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AppAllowClientDebug"
      wmi_key       : "Name"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.3 Server-side Application Debugging (AppAllowDebugging) - 'Global Setting - AppAllowDebugging = FALSE'"
      info          : "Disallowing server-side application debugging will prevent users from debugging the application."
      solution      : "Make sure 'AppAllowDebugging' is set to FALSE."
      reference     : "800-53|SI-11,ITSG-33|SI-11,PCI-DSS|2.2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AppAllowDebugging FROM IIsWebServerSetting"
      wmi_attribute : "AppAllowDebugging"
      wmi_key       : "AppAllowDebugging"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.3 Server-side Application Debugging (AppAllowDebugging) - 'Virtual Dir Setting - AppAllowDebugging = FALSE'"
      info          : "Disallowing server-side application debugging will prevent users from debugging the application."
      solution      : "Make sure 'AppAllowDebugging' is set to FALSE."
      reference     : "800-53|SI-11,ITSG-33|SI-11,PCI-DSS|2.2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AppAllowDebugging FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AppAllowDebugging"
      wmi_key       : "Name"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.4 ASP Parent Paths (AspEnableParentPaths) - 'Global Setting - AspEnableParentPaths = FALSE'"
      info          : "Setting this property to false will disallow an ASP page to traverse relative to its directory when calling scripts."
      solution      : "Make sure 'ASP Parent Paths (AspEnableParentPaths)' is set to FALSE."
      reference     : "800-171|3.1.5,800-53|AC-6,CCE|CCE-20044-4,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.10.6(a),CN-L3|8.1.4.2(d),CSF|PR.AC-4,CSF|PR.DS-5,ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.1|7.1.2,PCI-DSSv3.2|7.1.2,PCI-DSS|2.2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AspEnableParentPaths FROM IIsWebServerSetting"
      wmi_attribute : "AspEnableParentPaths"
      wmi_key       : "AspEnableParentPaths"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.4 ASP Parent Paths (AspEnableParentPaths) - 'Virtual Dir Setting - AspEnableParentPaths = FALSE'"
      info          : "Setting this property to false will disallow an ASP page to traverse relative to its directory when calling scripts."
      solution      : "Make sure 'ASP Parent Paths (AspEnableParentPaths)' is set to FALSE."
      reference     : "800-171|3.13.13,800-53|SC-18,CCE|CCE-20044-4,CSF|DE.CM-5,ITSG-33|SC-18,NIAv2|NS26a,NIAv2|NS26d,NIAv2|SU3,PCI-DSS|2.2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AspEnableParentPaths FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AspEnableParentPaths"
      wmi_key       : "Name"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.5 Logging to Windows Event Log (AspLogErrorRequests) - 'Global Setting - AspLogErrorRequests = FALSE'"
      info          : "IIS logging provides more extensive logging capabilities than the Windows Event Log and the various logging formats allow for easier manipulation of the log files."
      solution      : "Make sure 'Logging to Windows Event Log (AspLogErrorRequests)' is set to FALSE."
      reference     : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,CCE|CCE-19932-3,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,PCI-DSS|2.2.3,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AspLogErrorRequests FROM IIsWebServerSetting"
      wmi_attribute : "AspLogErrorRequests"
      wmi_key       : "AspLogErrorRequests"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.5 Logging to Windows Event Log (AspLogErrorRequests) - 'Virtual Dir Setting - AspLogErrorRequests = FALSE'"
      info          : "IIS logging provides more extensive logging capabilities than the Windows Event Log and the various logging formats allow for easier manipulation of the log files."
      solution      : "Make sure 'Logging to Windows Event Log (AspLogErrorRequests)' is set to FALSE."
      reference     : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,CCE|CCE-19932-3,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,PCI-DSS|2.2.3,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AspLogErrorRequests FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AspLogErrorRequests"
      wmi_key       : "Name"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.6 ASP Error Messages Setting (AspScriptErrorSentToBrowser) - 'Global Setting - AspScriptErrorSentToBrowser = FALSE'"
      info          : "Setting this property to FALSE will prevent detailed error information from being sent to the client."
      solution      : "Make sure 'ASP Error Messages Setting (AspScriptErrorSentToBrowser)' is set to FALSE."
      reference     : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AspScriptErrorSentToBrowser FROM IIsWebServerSetting"
      wmi_attribute : "AspScriptErrorSentToBrowser"
      wmi_key       : "AspScriptErrorSentToBrowser"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.6 ASP Error Messages Setting (AspScriptErrorSentToBrowser) - 'Virtual Dir Setting - AspScriptErrorSentToBrowser = FALSE'"
      info          : "Setting this property to FALSE will prevent detailed error information from being sent to the client."
      solution      : "Make sure 'ASP Error Messages Setting (AspScriptErrorSentToBrowser)' is set to FALSE."
      reference     : "800-53|SI-11,ITSG-33|SI-11,PCI-DSS|2.2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AspScriptErrorSentToBrowser FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AspScriptErrorSentToBrowser"
      wmi_key       : "Name"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.7 Custom ASP Error Message (AspScriptErrorMessage) - 'Global Setting - AspScriptErrorMessage"
      info          : "Changing this value from the default prevents a number of automated scanners from detecting that an error has occurred."
      solution      : "Make sure 'Custom ASP Error Message (AspScriptErrorMessage)' is set to send as little information to the user as possible."
      reference     : "800-53|SI-11,ITSG-33|SI-11,PCI-DSS|2.2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
      value_data    : "An error occurred on the server when processing the URL. Please contact the system administrator."
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AspScriptErrorMessage FROM IIsWebServerSetting"
      wmi_attribute : "AspScriptErrorMessage"
      wmi_key       : "AspScriptErrorMessage"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.7 Custom ASP Error Message (AspScriptErrorMessage) - 'Virtual Dir Setting - AspScriptErrorMessage"
      info          : "Changing this value from the default prevents a number of automated scanners from detecting that an error has occurred."
      solution      : "Make sure 'Custom ASP Error Message (AspScriptErrorMessage)' is set to send as little information to the user as possible."
      reference     : "800-53|SI-11,ITSG-33|SI-11,PCI-DSS|2.2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
      value_data    : "An error occurred on the server when processing the URL. Please contact the system administrator."
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AspScriptErrorMessage FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AspScriptErrorMessage"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.8 ASP Session Object Timeout (AspSessionTimeout) - 'Global Setting - AspSessionTimeout <= 10'"
      info          : "Setting the AspSessionTimeout property will prevent session objects from using extraneously consuming memory resources as well as minimizing session replay attacks."
      solution      : "Make sure 'ASP Session Object Timeout (AspSessionTimeout)' is set from a minimum of 1 minute to a maximum of 10 minutes."
      reference     : "800-171|3.1.11,800-53|AC-12,800-53|SC-5,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv6|16.4,CSF|DE.CM-1,CSF|PR.DS-4,HIPAA|164.312(a)(2)(iii),ITSG-33|AC-12,ITSG-33|SC-5,NESA|T3.3.1,NIAv2|GS10c,NIAv2|GS8e,NIAv2|NS49,PCI-DSSv3.1|12.3.8,PCI-DSSv3.1|8.1.8,PCI-DSSv3.2|12.3.8,PCI-DSSv3.2|8.1.8,PCI-DSS|2.2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : [1..10]
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AspSessionTimeout FROM IIsWebServerSetting"
      wmi_attribute : "AspSessionTimeout"
      wmi_key       : "AspSessionTimeout"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.8 ASP Session Object Timeout (AspSessionTimeout) - 'Virtual Dir Setting - AspSessionTimeout <= 10'"
      info          : "Setting the AspSessionTimeout property will prevent session objects from using extraneously consuming memory resources as well as minimizing session replay attacks."
      solution      : "Make sure 'ASP Session Object Timeout (AspSessionTimeout)' is set from a minimum of 1 minute to a maximum of 10 minutes."
      reference     : "800-171|3.1.11,800-53|AC-12,800-53|SC-5,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv6|16.4,CSF|DE.CM-1,CSF|PR.DS-4,HIPAA|164.312(a)(2)(iii),ITSG-33|AC-12,ITSG-33|SC-5,NESA|T3.3.1,NIAv2|GS10c,NIAv2|GS8e,NIAv2|NS49,PCI-DSSv3.1|12.3.8,PCI-DSSv3.1|8.1.8,PCI-DSSv3.2|12.3.8,PCI-DSSv3.2|8.1.8,PCI-DSS|2.2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : [1..10]
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AspSessionTimeout FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AspSessionTimeout"
      wmi_key       : "Name"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.9  Authentication Flags (AuthFlags) - 'Global Setting - AuthAnonymous = True'"
      info          : "Setting the appropriate authentication level can protect against inappropriate levels of access for web roots or virtual directories. NOTE: This check verifies if AuthAnonymous is set to true. If your organization does not require AuthAnonymous authentication comment out or remove this check."
      solution      : "Make sure 'Authentication Flags (AuthFlags)' is set to AuthAnonymous = true."
      reference     : "800-171|3.5.1,800-53|IA-2,CCE|CCE-19903-4,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|2.2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AuthAnonymous FROM IIsWebServerSetting"
      wmi_attribute : "AuthAnonymous"
      wmi_key       : "AuthAnonymous"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.9  Authentication Flags (AuthFlags) - 'Virtual Dir Setting - AuthAnonymous = True'"
      info          : "Setting the appropriate authentication level can protect against inappropriate levels of access for web roots or virtual directories. NOTE: This check verifies if AuthAnonymous is set to true. If your organization does not require AuthAnonymous authentication comment out or remove this check."
      solution      : "Make sure 'Authentication Flags (AuthFlags)' is set to AuthAnonymous = true."
      reference     : "800-171|3.5.1,800-53|IA-2,CCE|CCE-19903-4,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|2.2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AuthAnonymous FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AuthAnonymous"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.9  Authentication Flags (AuthFlags) - 'Global Setting - AuthBasic = True'"
      info          : "Setting the appropriate authentication level can protect against inappropriate levels of access for web roots or virtual directories. NOTE: This check verifies if AuthAnonymous is set to true. If your organization does not require AuthAnonymous authentication comment out or remove this check."
      solution      : "Make sure 'Authentication Flags (AuthFlags)' is set to AuthBasic = true."
      reference     : "800-171|3.5.1,800-53|IA-2,CCE|CCE-19903-4,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|2.2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AuthBasic FROM IIsWebServerSetting"
      wmi_attribute : "AuthBasic"
      wmi_key       : "AuthBasic"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.9  Authentication Flags (AuthFlags) - 'Virtual Dir Setting - AuthBasic = True'"
      info          : "Setting the appropriate authentication level can protect against inappropriate levels of access for web roots or virtual directories. NOTE: This check verifies if AuthAnonymous is set to true. If your organization does not require AuthAnonymous authentication comment out or remove this check."
      solution      : "Make sure 'Authentication Flags (AuthFlags)' is set to AuthBasic = true."
      reference     : "800-171|3.5.1,800-53|IA-2,CCE|CCE-19903-4,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|2.2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AuthBasic FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AuthBasic"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.9  Authentication Flags (AuthFlags) - 'Global Setting - AuthMD5 = True'"
      info          : "Setting the appropriate authentication level can protect against inappropriate levels of access for web roots or virtual directories. NOTE: This check verifies if AuthAnonymous is set to true. If your organization does not require AuthAnonymous authentication comment out or remove this check."
      solution      : "Make sure 'Authentication Flags (AuthFlags)' is set to AuthMD5 = true."
      reference     : "800-171|3.5.1,800-53|IA-2,CCE|CCE-19903-4,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|2.2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AuthMD5 FROM IIsWebServerSetting"
      wmi_attribute : "AuthMD5"
      wmi_key       : "AuthMD5"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.9  Authentication Flags (AuthFlags) - 'Virtual Dir Setting - AuthMD5 = True'"
      info          : "Setting the appropriate authentication level can protect against inappropriate levels of access for web roots or virtual directories. NOTE: This check verifies if AuthAnonymous is set to true. If your organization does not require AuthAnonymous authentication comment out or remove this check."
      solution      : "Make sure 'Authentication Flags (AuthFlags)' is set to AuthMD5 = true."
      reference     : "800-171|3.5.1,800-53|IA-2,CCE|CCE-19903-4,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|2.2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AuthMD5 FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AuthMD5"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.9  Authentication Flags (AuthFlags) - 'Global Setting - AuthNTLM = True'"
      info          : "Setting the appropriate authentication level can protect against inappropriate levels of access for web roots or virtual directories. NOTE: This check verifies if AuthAnonymous is set to true. If your organization does not require AuthAnonymous authentication comment out or remove this check."
      solution      : "Make sure 'Authentication Flags (AuthFlags)' is set to AuthNTLM = true."
      reference     : "800-171|3.5.1,800-53|IA-2,CCE|CCE-19903-4,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|2.2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AuthNTLM FROM IIsWebServerSetting"
      wmi_attribute : "AuthNTLM"
      wmi_key       : "AuthNTLM"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.9  Authentication Flags (AuthFlags) - 'Virtual Dir Setting - AuthNTLM = True'"
      info          : "Setting the appropriate authentication level can protect against inappropriate levels of access for web roots or virtual directories. NOTE: This check verifies if AuthAnonymous is set to true. If your organization does not require AuthAnonymous authentication comment out or remove this check."
      solution      : "Make sure 'Authentication Flags (AuthFlags)' is set to AuthNTLM = true."
      reference     : "800-171|3.5.1,800-53|IA-2,CCE|CCE-19903-4,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|2.2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AuthNTLM FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AuthNTLM"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.9  Authentication Flags (AuthFlags) - 'Global Setting - AuthPassport = True'"
      info          : "Setting the appropriate authentication level can protect against inappropriate levels of access for web roots or virtual directories. NOTE: This check verifies if AuthAnonymous is set to true. If your organization does not require AuthAnonymous authentication comment out or remove this check."
      solution      : "Make sure 'Authentication Flags (AuthFlags)' is set to AuthPassport = true."
      reference     : "800-171|3.5.1,800-53|IA-2,CCE|CCE-19903-4,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|2.2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT AuthPassport FROM IIsWebServerSetting"
      wmi_attribute : "AuthPassport"
      wmi_key       : "AuthPassport"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.9  Authentication Flags (AuthFlags) - 'Virtual Dir Setting - AuthPassport = True'"
      info          : "Setting the appropriate authentication level can protect against inappropriate levels of access for web roots or virtual directories. NOTE: This check verifies if AuthAnonymous is set to true. If your organization does not require AuthAnonymous authentication comment out or remove this check."
      solution      : "Make sure 'Authentication Flags (AuthFlags)' is set to AuthPassport = true."
      reference     : "800-171|3.5.1,800-53|IA-2,CCE|CCE-19903-4,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|2.2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 0
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, AuthPassport FROM IIsWebVirtualDirSetting"
      wmi_attribute : "AuthPassport"
      wmi_key       : "Name"
      check_type    : CHECK_NOT_EQUAL
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.10 HTTP Connection Timeout (ConnectionTimeout and ServerListenTimeout) - ConnectionTimeout"
      info          : "The ConnectionTimeout and ServerListenTimeout properties will protect against session stealing attacks."
      solution      : "Make sure 'HTTP Connection Timeout - ConnectionTimeout' is set from a minimum of 1 second to a maximum of 120 seconds."
      reference     : "800-171|3.1.11,800-53|AC-12,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv6|16.4,HIPAA|164.312(a)(2)(iii),ITSG-33|AC-12,NIAv2|NS49,PCI-DSSv3.1|12.3.8,PCI-DSSv3.1|8.1.8,PCI-DSSv3.2|12.3.8,PCI-DSSv3.2|8.1.8,PCI-DSS|2.2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : [1..120]
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT ConnectionTimeout FROM IIsWebServerSetting"
      wmi_attribute : "ConnectionTimeout"
      wmi_key       : "ConnectionTimeout"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.10 HTTP Connection Timeout (ConnectionTimeout and ServerListenTimeout) - ServerListenTimeout"
      info          : "The ConnectionTimeout and ServerListenTimeout properties will protect against session stealing attacks."
      solution      : "Make sure 'HTTP Connection Timeout - ServerListenTimeout' is set from a minimum of 1 second to a maximum of 120 seconds."
      reference     : "800-171|3.1.11,800-53|AC-12,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv6|16.4,HIPAA|164.312(a)(2)(iii),ITSG-33|AC-12,NIAv2|NS49,PCI-DSSv3.1|12.3.8,PCI-DSSv3.1|8.1.8,PCI-DSSv3.2|12.3.8,PCI-DSSv3.2|8.1.8,PCI-DSS|2.2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : [1..120]
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT ServerListenTimeout FROM IIsWebServerSetting"
      wmi_attribute : "ServerListenTimeout"
      wmi_key       : "ServerListenTimeout"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.11 Directory Browsing (DirBrowseFlags) - 'Global Setting - DirBrowseFlags'"
      info          : "If Directory Browsing is disabled a listing of all files / sub-directories in the current directory will not be returned to the end user."
      solution      : "Make sure 'Directory Browsing (DirBrowseFlags) - EnableDirBrowsing' is set to False."
      reference     : "800-171|3.4.2,800-53|CM-6,CCE|CCE-19479-5,CCE|CCE-19655-0,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 1073741886
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT DirBrowseFlags FROM IIsWebServerSetting"
      wmi_attribute : "DirBrowseFlags"
      wmi_key       : "DirBrowseFlags"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.11 Directory Browsing (DirBrowseFlags) - 'Virtual Dir Setting - DirBrowseFlags'"
      info          : "If Directory Browsing is disabled a listing of all files / sub-directories in the current directory will not be returned to the end user."
      solution      : "Make sure 'Directory Browsing (DirBrowseFlags) - EnableDirBrowsing' is set to False."
      reference     : "800-171|3.4.2,800-53|CM-6,CCE|CCE-19479-5,CCE|CCE-19655-0,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 1073741886
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, DirBrowseFlags FROM IIsWebVirtualDirSetting"
      wmi_attribute : "DirBrowseFlags"
      wmi_key       : "Name"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.12 FrontPage Extensions Disable (FrontPageWeb) - 'Global Setting - EnableFrontPageWeb = false'"
      info          : "It is recommended to disable FrontPage extensions because they greatly increase the attack surface of the web server and historically have presented numerous vulnerabilities."
      solution      : "Make sure 'FrontPage Extensions Disable (FrontPageWeb) EnableFrontPageWeb' is set to false"
      reference     : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
      value_data    : "[\[(0-9)+: 0\]]+"
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT FrontPageWeb FROM IIsWebServerSetting"
      wmi_attribute : "FrontPageWeb"
      wmi_key       : "FrontPageWeb"
      wmi_option    : CAN_BE_NULL
      check_type    : CHECK_REGEX
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.12 FrontPage Extensions Disable (FrontPageWeb) - 'Virtual Dir Setting - EnableFrontPageWeb = false'"
      info          : "It is recommended to disable FrontPage extensions because they greatly increase the attack surface of the web server and historically have presented numerous vulnerabilities."
      solution      : "Make sure 'FrontPage Extensions Disable (FrontPageWeb) EnableFrontPageWeb' is set to false"
      reference     : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
      value_data    : "[\[(0-9)+: 0\]]+"
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT Name, FrontPageWeb FROM IIsWebVirtualDirSetting"
      wmi_attribute : "FrontPageWeb"
      wmi_key       : "Name"
      wmi_option    : CAN_BE_NULL
      check_type    : CHECK_REGEX
    </custom_item>

    <custom_item>
      type                 : AUDIT_POWERSHELL
      description          : "3.13 Custom HTTP Error Messages (HTTPErrors)"
      info                 : "Custom HTTP error messages should be used to display error messages. Using the default error pages increases the reliability of certian automated web scanners due to the presence of known text when a given error occurs."
      solution             : "Make sure 'Custom HTTP Error Messages' is set to an appropriate message for each HTTP error. (default is recommended)"
      reference            : "800-53|SI-11,ITSG-33|SI-11,PCI-DSS|2.2.3"
      see_also             : "https://workbench.cisecurity.org/files/657"
      value_type           : POLICY_TEXT
      value_data           : ""
      powershell_args      : '(Get-WmiObject -namespace "root\\MicrosoftIISv2" -Class IIsWebServiceSetting).httperrors | select HttpErrorCode,HandlerLocation | format-list'
      only_show_cmd_output : YES
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "3.14 In Process ISAPI DLL (InProcessIsapiApps) - 'idq.dll'"
      info        : "Removing unnecessary DLLs can reduce attack surface. NOTE: If the DLL is not used, ensure it is removed from the InProcessIsapiApps list."
      solution    : "Make sure 'idq.dll' is removed"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemroot%\system32\idq.dll"
      file_option : MUST_NOT_EXIST
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "3.14 In Process ISAPI DLL (InProcessIsapiApps) - 'httpext.dll'"
      info        : "Removing unnecessary DLLs can reduce attack surface. NOTE: If the DLL is not used, ensure it is removed from the InProcessIsapiApps list."
      solution    : "Make sure 'httpext.dll' is removed"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemroot%\system32\inetsrv\httpext.dll"
      file_option : MUST_NOT_EXIST
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "3.14 In Process ISAPI DLL (InProcessIsapiApps) - 'httpodbc.dll'"
      info        : "Removing unnecessary DLLs can reduce attack surface. NOTE: If the DLL is not used, ensure it is removed from the InProcessIsapiApps list."
      solution    : "Make sure 'httpodbc.dll' is removed"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemroot%\system32\inetsrv\httpodbc.dll"
      file_option : MUST_NOT_EXIST
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "3.14 In Process ISAPI DLL (InProcessIsapiApps) - 'ssinc.dll'"
      info        : "Removing unnecessary DLLs can reduce attack surface. NOTE: If the DLL is not used, ensure it is removed from the InProcessIsapiApps list."
      solution    : "Make sure 'ssinc.dll' is removed"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemroot%\system32\inetsrv\ssinc.dll"
      file_option : MUST_NOT_EXIST
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "3.14 In Process ISAPI DLL (InProcessIsapiApps) - 'msw3prt.dll'"
      info        : "Removing unnecessary DLLs can reduce attack surface. NOTE: If the DLL is not used, ensure it is removed from the InProcessIsapiApps list."
      solution    : "Make sure 'msw3prt.dll' is removed"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemroot%\system32\msw3prt.dll"
      file_option : MUST_NOT_EXIST
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "3.14 In Process ISAPI DLL (InProcessIsapiApps) - 'author.dll'"
      info        : "Removing unnecessary DLLs can reduce attack surface. NOTE: If the DLL is not used, ensure it is removed from the InProcessIsapiApps list."
      solution    : "Make sure 'author.dll' is removed"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemroot%\system32\author.dll"
      file_option : MUST_NOT_EXIST
    </custom_item>

    <custom_item>
      type        : FILE_CHECK
      description : "3.14 In Process ISAPI DLL (InProcessIsapiApps) - 'admin.dll'"
      info        : "Removing unnecessary DLLs can reduce attack surface. NOTE: If the DLL is not used, ensure it is removed from the InProcessIsapiApps list."
      solution    : "Make sure 'admin.dll' is removed"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%programfiles%\FrontPage\admin.dll"
      file_option : MUST_NOT_EXIST
    </custom_item>

# Values for LogExtFileFlags can be found at http://msdn.microsoft.com/en-us/library/ms524906%28v=VS.90%29.aspx

    <custom_item>
      type          : WMI_POLICY
      description   : "3.15 Logging Options (LogExtFileFlags)"
      info          : "Setting the LogExtFileFlags property in the MetaBase on sites can log detailed event information such as visitor information, content visited, etc."
      solution      : "NOTE: This check uses the default LogExtFileTime, LogExtFileClientIp, LogExtFileMethod, LogExtFileUriStem, and LogExtFileHttpStatus flags. If your organization has different flags please adjust this check accordingly."
      reference     : "800-171|3.3.1,800-171|3.3.2,800-53|AU-3,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSCv6|6.2,CSF|PR.PT-1,ITSG-33|AU-3,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.1|10.3,PCI-DSSv3.2|10.3,PCI-DSS|2.2.4,SWIFT-CSCv1|6.4"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 2199519
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT LogExtFileFlags FROM IIsWebServerSetting"
      wmi_attribute : "LogExtFileFlags"
      wmi_key       : "LogExtFileFlags"
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK_NOT
      description : "3.16 Local Path (Path)"
      info        : "Locating the path on a non-system drive helps mitigate directory traversal and other types A secure path would not be located on a system drive."
      solution    : "Make sure 'Local Path' does not use the same drive as the system folder."
      reference   : "800-171|3.4.7,800-53|CM-7,CSCv6|8.4,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
      value_data  : "%systemroot%\system32\inetsrv\MetaBase.xml"
      regex       : 'Path *= *"(.+)"'
      expect      : 'Path *= *"[Cc]\:(.+)"'
    </custom_item>

    <custom_item>
      type                 : AUDIT_POWERSHELL
      description          : "3.17 Script Mappings (ScriptMaps)"
      info                 : "Disabling script processor maps which are not being used reduces the attack surface."
      solution             : "Make sure any unnecessary script mappings that are marked with a flag value of 0 is disabled."
      reference            : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CCE|CCE-19691-5,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.4,SWIFT-CSCv1|2.3"
      see_also             : "https://workbench.cisecurity.org/files/657"
      value_type           : POLICY_TEXT
      value_data           : ""
      powershell_args      : '(Get-WmiObject -namespace "root\\MicrosoftIISv2" -Class IIsWebServiceSetting).scriptmaps | select ScriptProcessor,Flag,IncludedVerbs | format-list'
      only_show_cmd_output : YES
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.18 Use Hostname in Redirects (UseHostName)"
      info          : "The UseHostName property will prevent IIS from revealing internal IP addresses when performing redirects."
      solution      : "Make sure 'Use Hostname in Redirects (UseHostName)' is set to TRUE."
      reference     : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_DWORD
      value_data    : 1
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT UseHostName FROM IIsWebServerSetting"
      wmi_attribute : "UseHostName"
      wmi_key       : "UseHostName"
    </custom_item>

    <custom_item>
      type          : WMI_POLICY
      description   : "3.19 Application Pool Identity (WAMUserName)"
      info          : "Setting the WAMUserName to an account with least privileges will limit the actions that this user may perform and therefore reducing the amount of damage in the event of a compromise."
      info          : "NOTE: Update POOL_IDENTITY with the appropriate value for the local environment"
      solution      : "Make sure you change this value to the specific user account that was established for the WAMUserName (should be a non-privileged account)."
      reference     : "800-171|3.1.5,800-53|AC-6,CCE|CCE-20015-4,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.10.6(a),CN-L3|8.1.4.2(d),CSF|PR.AC-4,CSF|PR.DS-5,ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.1|7.1.2,PCI-DSSv3.2|7.1.2,PCI-DSS|2.2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also      : "https://workbench.cisecurity.org/files/657"
      value_type    : POLICY_TEXT
# Note: Variable @POOL_IDENTITY@ replaced with "IWAM_Machinename" in field "value_data".
      value_data    : "IWAM_Machinename"
      wmi_namespace : "root/MicrosoftIISv2"
      wmi_request   : "SELECT WAMUserName FROM IIsWebServiceSetting"
      wmi_attribute : "WAMUserName"
      wmi_key       : "WAMUserName"
    </custom_item>

    <custom_item>
      type                 : AUDIT_POWERSHELL
      description          : "3.20 Web Service Extension Restriction List (WebSvcExtRestrictionList)"
      info                 : "Removing unnecessary extensions can reduce the attack surface in the event of a compromise."
      solution             : "Make sure any unnecessary scripting extension restrictions that are marked with a flag value of 0 is disabled."
      reference            : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also             : "https://workbench.cisecurity.org/files/657"
      value_type           : POLICY_TEXT
      value_data           : ""
      powershell_args      : '(Get-WmiObject -namespace "root\\MicrosoftIISv2" -Class IIsWebServiceSetting).websvcextrestrictionlist | select Description, FilePath | format-list'
      only_show_cmd_output : YES
    </custom_item>

# 4 - IIS Configuration (ASP .NET)
# NOTE: Settings and value information were obtained from http://msdn.microsoft.com/en-us/library/dayb112d.aspx

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.1 SessionState"
      info        : "Disabling the session state will prevent the application from being more vulnerable to session stealing attacks. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization."
      solution    : "Make sure 'SessionState' is disabled/off."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\machine.config"
      regex       : '<sessionState *(.*) *mode *= *"([A-Za-z])+" *(.*) *(.*)>'
      expect      : '<sessionState *(.*) *mode *= *"[Oo][Ff][Ff]" *(.*) *(.*)>'
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.2 Authorization - 'deny users'"
      info        : "If authorization is determined, the user will be automatically redirected to a page where they must submit their credentials. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization. NOTE3: In .NET Framework 2.0 and above, authorization element is configured in the web.config file. NOTE4: In .NET Framework 1.1 and 1.0, authorization element is configured in the machine.config file."
      solution    : "Make sure 'Authorization - 'deny users'' is set to restrict users to authenticated and SSL access only."
      reference   : "800-171|3.5.1,800-53|IA-2,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|2.2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\web.config"
      regex       : '<deny users *= *"(.+)" *.+>'
      expect      : '<deny users *= *"\\?" *.+>'
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.2 Authorization - 'allow users'"
      info        : "If authorization is determined, the user will be automatically redirected to a page where they must submit their credentials. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization. NOTE3: In .NET Framework 2.0 and above, authorization element is configured in the web.config file. NOTE4: In .NET Framework 1.1 and 1.0, authorization element is configured in the machine.config file."
      solution    : "Make sure 'Authorization - 'allow users'' is for unauthenticated users to view Virtual Directories, and they do not need to be secured with SSL, set allow users."
      reference   : "800-171|3.5.1,800-53|IA-2,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|2.2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\web.config"
      regex       : '<allow users *= *"(.+)" *.+>'
      expect      : '<allow users *= *"\\*" *.+>'
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.3 Forms - 'slidingExpiration'"
      info        : "Setting the sliding expiration to false will protect against reduce risk in case the authentication token is hijacked. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization."
      solution    : "Make sure 'Forms - 'slidingExpiration'' is set to false."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\machine.config"
      regex       : 'slidingExpiration *= *"[A-Za-z]+"'
      expect      : 'slidingExpiration *= *"[Ff][Aa][Ll][Ss][Ee]"'
    </custom_item>

# Multiple timeout values exist which does not make checking the value possible when the forms authentication items are listed on multiple lines.

    <report type:"WARNING">
      description : "4.3 Forms 'timeout'"
      info        : "Setting the sliding expiration to false will protect against reduce risk in case the authentication token is hijacked. Setting a cookie with a short life time will provide an attacker a short amount of time to impersonate the user.

      NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Make sure that forms authentication cookies are protected, and that the authentication cookie life time is reduced when SSL is not used. The authentication cookie should be protected over the network. Set slidingExpiration to 'false' when SSL is not used if concerned about cross-site scripting attacks and cookie hijacking"
      reference   : "PCI-DSS|2.2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
    </report>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.4 Authentication"
      info        : "If authorization is determined, the user will be automatically be prompted to submit their credentials to access sensitive pages. NOTE: This check audits the default system drive. If your organization's configuration is differentthe '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization."
      solution    : "Make sure 'Authentication' is set to 1 of the following modes 'authentication mode = '[Windows|Froms|Passport|None]'."
      reference   : "800-171|3.5.1,800-53|IA-2,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|2.2.3,TBA-FIISB|35.1,TBA-FIISB|36.1"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\machine.config"
      regex       : '<authentication *(.*) *mode *= *"[A-Za-z]+" *(.*)>'
      expect      : '<authentication *(.*) *mode *= *"([Ww][Ii][Nn][Dd][Oo][Ww][Ss]|[Ff][Oo][Rr][Mm][Ss]|[Pp][Aa][Ss][Ss][Pp][Oo][Rr][Tt]|[Nn][Oo][Nn][Ee])" *(.*)>'
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.5 Compilation"
      info        : "Removing the debugging information will prevent extraneous information such as stack traces and exception messages from being sent to the user in the event of an error. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization."
      solution    : "Make sure 'Compilation' is set to debug = false."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\web.config"
      regex       : '<compilation *(.*) *debug *= *"[A-Za-z]+" *(.*)>'
      expect      : '<compilation *(.*) *debug *= *"[Ff][Aa][Ll][Ss][Ee]" *(.*)>'
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.6 Custom Errors - 'mode'"
      info        : "Enabling this property will send a generic message to the user in the event of an error and not leak information. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization."
      solution    : "Make sure 'Custom Errors mode' is set to On."
      reference   : "800-53|SI-11,ITSG-33|SI-11,PCI-DSS|2.2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\web.config"
      regex       : '<customErrors *(.*) *mode *= *"[A-Za-z]+" *(.*)>'
      expect      : '<customErrors *(.*) *mode *= *"[Oo][Nn]" *(.*)>'
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.6 Custom Errors - 'defaultRedirect'"
      info        : "Enabling this property will send a generic message to the user in the event of an error and not leak information. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization. NOTE3: Change <PATH> to the directory path to your custom error page."
      solution    : "Make sure 'Custom Errors defaultRedirect' is set to redirect to a custom error page."
      reference   : "800-53|SI-11,ITSG-33|SI-11,PCI-DSS|2.2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\web.config"
      regex       : '<customErrors *(.*) *defaultRedirect *= *"[A-Za-z0-9:\\. _]+" *(.*)>'
      expect      : '<customErrors *(.*) *defaultRedirect *= *"<PATH>" *(.*)>'
    </custom_item>

    <report type:"WARNING">
      description : "4.7 HTTPForbiddenHandler"
      info        : "HTTPForbiddenHandler will prevent the download of unused file types. NOTE: Nessus did not perform this check as it requires a manual review that unused file types are mapped to the HttpForbiddenHandler.

      NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "Unused extensions should be mapped to HTTPForbiddenHandler. Remote extensions, such as .soap, .rem, on internet facing web servers should be mapped to HTTPForbiddenHandler."
      reference   : "PCI-DSS|2.2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
    </report>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.8 HttpRunTime"
      info        : "httpRunTime can prevent the uploading of very large files with maximum size of 4, 000 MB. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization."
      solution    : "Make sure 'HTTPRunTime maxRequestLength' is set to 4,000 MB."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\machine.config"
      regex       : '<httpRuntime *(.*) *maxRequestLength *= *"[0-9]+" *(.*)>'
      expect      : '<httpRuntime *(.*) *maxRequestLength *= *"([1-9][0-9]{0,5}|[1-3][0-9]{6}|40([0-8][0-9]{4}|9([0-5][0-9]{3}|6000)))" *(.*)>'
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.9 Identity"
      info        : "Setting the Identity property will set fixed identities for specific virtual directories by using the following setting. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization."
      solution    : "Make sure 'Identity impersonate' is set to True."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\machine.config"
      regex       : '<identity *(.*) *impersonate *= *"[A-Za-z]+" *(.*)>'
      expect      : '<identity *(.*) *impersonate *= *"[Tt][Rr][Uu][Ee]" *(.*)>'
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.10 MachineKey"
      info        : "The MachineKey property ensures authentication encryption. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization."
      solution    : "Make sure 'MachineKey validation' is set to SHA1."
      reference   : "800-171|3.1.13,800-53|AC-17(2),CIP|005-5-R2,CN-L3|7.1.2.7(g),CN-L3|7.1.3.1(d),CN-L3|8.1.4.1(c),CSF|PR.AC-3,CSF|PR.PT-4,ITSG-33|AC-17(2),NESA|T5.4.2,NIAv2|AM37,PCI-DSS|2.2.3,SWIFT-CSCv1|2.6"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\machine.config"
      regex       : '<machineKey *(.*) *validation *= *"[A-Za-z0-9]+" *(.*)>'
      expect      : '<machineKey *(.*) *validation *= *"[Ss][Hh][Aa]1" *(.*)>'
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.11 Pages - 'enableViewState'"
      info        : "The Pages element specifies configuration information for ASP .NET pages. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization."
      solution    : "Make sure 'Pages - 'enableViewState'' is set to true."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\web.config"
      regex       : '<pages *(.*) *enableViewState *= *"[A-Za-z0-9]+" *(.*)>'
      expect      : '<pages *(.*) *enableViewState *= *"[Tt][Rr][Uu][Ee]" *(.*)>'
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.11 Pages - 'enableViewStateMac'"
      info        : "The Pages element specifies configuration information for ASP .NET pages. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization."
      solution    : "Make sure 'Pages - 'enableViewStateMac'' is set to true."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\web.config"
      regex       : '<pages *(.*) *enableViewStateMac *= *"[A-Za-z0-9]+" *(.*)>'
      expect      : '<pages *(.*) *enableViewStateMac *= *"[Tt][Rr][Uu][Ee]" *(.*)>'
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.12 ProcessModel"
      info        : "The principle of a non-privileged user is one that is running under least privilege, meaning they are non-admin users with limited functionality. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization."
      solution    : "Make sure 'ProcessModel password' is set use Aspnet_setreg.exe utility to store encrypted credentials in the registry."
      reference   : "800-53|IA-5(7),CSF|PR.AC-1,ITSG-33|IA-5(7),PCI-DSS|7.1.1,SWIFT-CSCv1|2.3,TBA-FIISB|26.1"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\machine.config"
      regex       : '<processModel *(.*) *password *= *"(.+)" *(.*)>'
      expect      : '<processModel *(.*) *password *= *"[Rr][Ee][Gg][Ii][Ss][Tt][Rr][Yy]:[Hh][Kk][Ll][Mm]\\\\[Ss][Oo][Ff][Tt][Ww][Aa][Rr][Ee]\\\\[Aa][Ss][Pp][Nn][Ee][Tt][Pp][Rr][Oo][Cc][Ee][Ss][Ss],[Pp][Ww][Dd]" *(.*)>'
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.13 Trace"
      info        : "Disabling tracing will reduce the amount of information leakage in the event of an error. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization."
      solution    : "Make sure 'Trace enabled' is set to false."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,PCI-DSS|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\machine.config"
      regex       : '<trace *(.*) *enabled *= *"[A-Za-z0-9]+" *(.*)>'
      expect      : '<trace *(.*) *enabled *= *"[Ff][Aa][Ll][Ss][Ee]" *(.*)>'
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "4.14 Trust"
      info        : "Setting the trust level element will ensure that the appropriate security level is used for applications and Web services. NOTE: This check audits the default system drive. If your organization's configuration is different the '%systemdrive%' variable will need to be adjusted. NOTE2: Change <framework_version> to the version of .NET that is in use by your organization."
      solution    : "Make sure 'Trust level' is set to medium."
      reference   : "800-171|3.1.5,800-53|AC-6,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.10.6(a),CN-L3|8.1.4.2(d),CSF|PR.AC-4,CSF|PR.DS-5,ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.1|7.1.2,PCI-DSSv3.2|7.1.2,PCI-DSS|2.2.3,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://workbench.cisecurity.org/files/657"
      value_type  : POLICY_TEXT
# Note: Variable @DOTNET_FRAMEWORK_VERSION_VALUE@ replaced with "v2.0.50727" in field "value_data".
      value_data  : "%systemroot%\Microsoft.NET\Framework\v2.0.50727\CONFIG\web.config"
      regex       : '<trust *(.*) *level *= *"[A-Za-z0-9]+" *(.*)>'
      expect      : '<trust *(.*) *level *= *"[Mm][Ee][Dd][Ii][Uu][Mm]" *(.*)>'
    </custom_item>
  </then>

  <else>
    <report type:"WARNING">
      description : "CIS_v1.0_MS_IIS_6.audit"
      info        : "Microsoft Internet Information Server (IIS) 6.0 is not installed or Remote Registry Service is disabled.

      NOTE: Nessus has not identified that the chosen audit applies to the target device."
      see_also    : "https://workbench.cisecurity.org/files/657"
    </report>
  </else>
</if>

</group_policy>
</check_type>
