#
# This script is Copyright (C) 2004-2020 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.3 $
# $Date: 2020/04/22 $
#
# Description	: This audit file implements the security settings included in DISA VMware ESXi Server 5 STIG v1r10 (Jan 27, 2017).
#
# 			DISA Virtualization STIG list:
#
# 	  		http://iase.disa.mil/stigs/os/virtualization/Pages/index.aspx
#
# 			DISA VMware ESXi v5 Security Technical Implementation Guides:
#
#         http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip
#
#       NOTE: Some queries in this .audit require site-specific data to be known to the query in order to function properly.
# 			Please note the following queries and edit their values accordingly.
#
#         GEN000100-ESXI5-000062 - The operating system must be a supported release
#         GEN000240-ESXI5-000058 - The system clock must be synchronized to an authoritative DoD time source
#         GEN005440-ESXI5-000078 - The system must not be used as a syslog server (log host) for systems external to the enclave
#         GEN005460-ESXI5-000060 - The system must only use remote syslog servers justified and documented using site-defined procedures
#         SRG-OS-000197-ESXI5 - Remote logging for ESXi hosts must be configured
#         SRG-OS-000215-ESXI5 - The OS must back up audit records on an org-defined frequency onto a different system or media
#         SRG-OS-000217-ESXI5 - OS must protect audit records of non-local access to privileged accounts and execution of privileged functions
#         SRG-OS-99999-ESXI5-000131 - NTP time synchronization must be configured
#
#<ui_metadata>
#<display_name>DISA STIG VMWare ESXi Server 5 STIG v1r10</display_name>
#<spec>
#  <type>DISA STIG</type>
#  <name>VMWare ESXi Server 5</name>
#  <version>1.10.0</version>
#  <link>http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip</link>
#</spec>
#<labels>vmware,disa,esxi,server</labels>
#<variables>
#  <variable>
#    <name>ESXI_VERSION</name>
#    <default>5\.0</default>
#    <description>ESXi version supported</description>
#    <info>The version number of ESXi that is supported by your organization.</info>
#  </variable>
#  <variable>
#    <name>NTP_SERVER</name>
#    <default>0\.us\.pool\.ntp\.org</default>
#    <description>NTP server pool host</description>
#    <info>The NTP pool host name for your organization.</info>
#  </variable>
#  <variable>
#    <name>LOG_HOST</name>
#    <default>192\.168\.0\.1</default>
#    <description>Remote syslog address</description>
#    <info>The IP address of the centralized syslog server for your organization.</info>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"VMware">

<report type:"WARNING">
  description : "ESXI5-VMNET-000001 - All dvPortgroup VLAN IDs must be fully documented"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39356,PCI-DSS|1.1.2,Rule-ID|SV-51214r2_rule,STIG-ID|ESXI5-VMNET-000001"
  info        : "If using VLAN tagging on a dvPortgroup, tags must correspond to the IDs on external VLAN-aware upstream switches if any. If VLAN IDs are not tracked completely, mistaken re-use of IDs could allow for traffic to be allowed between inappropriate physical and virtual machines. Similarly, wrong or missing VLAN IDs may lead to traffic not passing between appropriate physical and virtual machines."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "From the vSphere Client log into vCS. Home >> Inventory >> Networking. Select dvSwitch and dvPortgroup and Edit Settings >> Policies >> VLAN >> VLAN ID. Record all VLAN IDs in an organization defined tracking system."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "ESXI5-VMNET-000002 - All dvSwitch Private VLAN IDs must be fully documented"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39357,PCI-DSS|1.1.2,Rule-ID|SV-51215r1_rule,STIG-ID|ESXI5-VMNET-000002"
  info        : "dvSwitch Private VLANs (PVLANs) require primary and secondary VLAN IDs. The IDs must correspond to the IDs on external PVLAN-aware upstream switches, if any. If VLAN IDs are not tracked completely, mistaken re-use of IDs could allow for traffic to be allowed between inappropriate physical and virtual machines. Similarly, wrong or missing PVLAN IDs may lead to traffic not passing between appropriate physical and virtual machines."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "From the vSphere Client connect to the vCenter Server and as administrator go to 'Home>> Inventory>> Hosts and Clusters'. Select each ESXi host with virtual switches connected to active VMs requiring securing. Go to 'Configuration>> Network>> vSwitch(?)>> Properties>> Ports>> [Portgroup Name]>> VLAN ID'. Record all configured VLAN IDs in an organization-defined tracking system"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXI5-VMNET-000003 - All virtual switches must have a clear network label"
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CCI|CCI-000366,CSCv6|3.1,CSF|PR.IP-1,Group-ID|V-39358,ITSG-33|CM-6,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|1.1.2,Rule-ID|SV-51216r1_rule,STIG-ID|ESXI5-VMNET-000003"
  info        : "Network labels must identify each port group with a name. These names are important because they serve as a functional descriptor for the port group. Without these descriptions, identifying port groups and their functions becomes difficult as the network becomes more complex."
  solution    : "From the vSphere Client/vCenter, navigate to Home>> Inventory>> Networking. Clearly label/rename all port groups with a meaningful name"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\">"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:spec/audit:name\"/>)<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> (portgroup name NOT configured)</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : ".+ \\("
  not_expect  : "(portgroup name NOT configured)"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXI5-VMNET-000004 - Virtual switch VLANs must be fully documented and have only the required VLANs"
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CCI|CCI-000366,CSCv6|3.1,CSF|PR.IP-1,Group-ID|V-39359,ITSG-33|CM-6,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|1.1.2,Rule-ID|SV-51217r1_rule,STIG-ID|ESXI5-VMNET-000004"
  info        : "When defining a physical switch port for trunk mode, only specified VLANs must be configured on the VLAN trunk link. The risk with not fully documenting all VLANs on the vSwitch is that it is possible that a physical trunk port might be configured without needed VLANs, or with unneeded VLANs, potentially enabling an administrator to either accidentally or maliciously connect a VM to an unauthorized VLAN."
  solution    : "Both standard and distributed vSwitch configurations can be viewed in the vSphere Client. For vSwitch: Home>> Inventory>> Hosts and Clusters, then select an ESXi host in Inventory panel on left. In the Configuration tab, Hardware window, under Networking, select each vSwitch, and for each port group on the vSwitch, verify and record the VLAN IDs used. For dvSwitches, go to Home>> Inventory>> Networking and for each dvSwitch in the inventory, and for each dvPortGroup in each dvSwitch, select Edit Settings>> Policies>> VLAN and record all VLAN IDs"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:network/audit:vswitch\">"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val/audit:network/audit:vswitch\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:name\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXI5-VMNET-000005 - All vSwitch and VLAN IDs must be fully documented - 'vSwitch labels'"
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CCI|CCI-000366,CSCv6|3.1,CSF|PR.IP-1,Group-ID|V-39360,ITSG-33|CM-6,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|1.1.2,Rule-ID|SV-51218r1_rule,STIG-ID|ESXI5-VMNET-000005"
  info        : "VLAN tagging used on a vSwitch must correspond to the IDs on external VLAN-aware upstream switches, if any. If VLAN IDs are not tracked completely, mistaken re-use of IDs could allow for traffic to be allowed between inappropriate physical and virtual machines. Similarly, wrong or missing VLAN IDs may lead to traffic not passing between appropriate physical and virtual machines."
  solution    : "From the vSphere Client/vCenter: Go to 'Home>> Inventory>> Hosts and Clusters'. Select each ESXi host with virtual switches connected to active VMs. Go to 'Configuration>> Network>> vSwitch(?)>> Properties>> Ports>> [Portgroup Name]>> VLAN ID'. Record all VLAN IDs in a (site-specific) tracking system"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:network/audit:vswitch\">"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val/audit:network/audit:vswitch\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:name\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
</custom_item>

<report type:"WARNING">
  description : "ESXI5-VMNET-000006 - All IP-based storage traffic must be isolated"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39361,PCI-DSS|1.1.2,Rule-ID|SV-51219r1_rule,STIG-ID|ESXI5-VMNET-000006"
  info        : "Virtual machines might share virtual switches and VLANs with the IP-based storage configurations. IP-based storage includes iSCSI and NFS. This configuration might expose IP-based storage traffic to unauthorized virtual machine users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network. To restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from the production traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from the VMkernel management and service console network will limit unauthorized users from viewing the traffic."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "If IP-based storage is not used, this check is not applicable. To modify VMkernel Networking configuration, from the vSphere Client/vCenter as administrator: Select the host in the inventory pane. On the host Configuration tab, click Networking. In the vSphere Standard Switch view, select Properties and ensure at least one physical network adaptor is dedicated to a management-only network. If at least one physical network adaptor is not dedicated to a management-only network, this is a finding."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "ESXI5-VMNET-000007 - Only authorized administrators must have access to virtual networking components"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39364,PCI-DSS|1.1.2,Rule-ID|SV-51222r1_rule,STIG-ID|ESXI5-VMNET-000007"
  info        : "This control mitigates the risk of misconfiguration, whether accidental or malicious, and enforces key security concepts of separation of duties and least privilege. It is important to leverage the role-based access controls within vSphere to ensure that only authorized administrators have access to the different virtual networking components. For example, VM administrators should have access only to port groups in which their VMs reside. Network administrators should have permissions to all virtual networking components but not have access to VMs. These controls will depend very much on the organization's policy on separation of duties, least privilege, and the responsibilities of the administrators within the organization."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "vSphere permissions to specific port groups must be granted only to individuals who need it. From the vSphere Client/vCenter as a user with full Administrator Role rights to the Inventory object to be checked: (1) Select '[Inventory Object]>> Permissions'. Assign users with the appropriate Role to the all Inventory object(s)."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "ESXI5-VMNET-000008 - All physical switch ports must be configured with spanning tree disabled"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39365,PCI-DSS|1.1.2,Rule-ID|SV-51223r1_rule,STIG-ID|ESXI5-VMNET-000008"
  info        : "Due to the integration of the ESXi Server into the physical network, the physical network (switch) adaptors must have spanning tree disabled or portfast configured for external switches, because VMware virtual switches do not support STP. Virtual switch uplinks do not create loops within the physical switch network. If these are not set, potential performance and connectivity issues might arise."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Note that this check refers to an entity outside the scope of the ESXi-v5 server system. Document the upstream physical switch configuration for spanning tree protocol disablement and/or portfast configuration for all physical ports connected to ESXi hosts. Log in to the physical switch(es) and disable spanning tree protocol and/or configure portfast for all physical ports connected to ESXi hosts. Update the documentation on an organization-defined frequency or whenever modifications are made to either ESXi hosts or the upstream physical switches"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXI5-VMNET-000009 - All port groups must be configured with a clear network label"
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|III,CCI|CCI-000366,CSCv6|3.1,CSF|PR.IP-1,Group-ID|V-39366,ITSG-33|CM-6,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,PCI-DSS|1.1.2,Rule-ID|SV-51224r1_rule,STIG-ID|ESXI5-VMNET-000009"
  info        : "Each port group must be identified with a network label/name. Names serve as a functional descriptor for the port group. Without these descriptions, identifying port groups and functions becomes difficult as the network becomes more complex."
  solution    : "From the vSphere Client/vCenter, navigate to Home>> Inventory>> Networking. Clearly label all individual port groups with a meaningful name"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\">"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:spec/audit:name\"/>)<xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> (portgroup name NOT configured)</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : ".+ \\("
  not_expect  : "(portgroup name NOT configured)"
</custom_item>

<report type:"WARNING">
  description : "ESXI5-VMNET-000010 - All port groups must be configured to a value other than that of the native VLAN"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39367,PCI-DSS|1.1.2,Rule-ID|SV-51225r1_rule,STIG-ID|ESXI5-VMNET-000010"
  info        : "ESXi does not use the concept of native VLAN. Frames with VLAN specified in the port group will have a tag, but frames with VLAN not specified in the port group are not tagged and therefore will end up as belonging to native VLAN of the physical switch. For example, frames on VLAN 1 from a Cisco physical switch will be untagged, because this is considered as the native VLAN. However, frames from ESXi specified as VLAN 1 will be tagged with a '1'; therefore, traffic from ESXi that is destined for the native VLAN will not be correctly routed (because it is tagged with a '1' instead of being untagged), and traffic from the physical switch coming from the native VLAN will not be visible (because it is not tagged). If the ESXi virtual switch port group uses the native VLAN ID, traffic from those VMs will not be visible to the native VLAN on the switch, because the switch is expecting untagged traffic."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the ESXi Shell and run the command to set the value to something other than the default value.
 esxcli network vswitch standard portgroup set --portgroup-name=<name> --vlan-id=<non-default_id_number>
 Re-enable Lockdown Mode on the host."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXI5-VMNET-000011 - All port groups must not be configured to VLAN 4095 except for Virtual Guest Tagging (VGT)"
  reference   : "800-171|3.4.2,800-53|CM-6,CAT|II,CCI|CCI-000366,CN-L3|8.1.10.6(d),CSF|PR.IP-1,Group-ID|V-39368,ITSG-33|CM-6,NESA|T3.2.1,PCI-DSS|1.1.2,Rule-ID|SV-51226r1_rule,STIG-ID|ESXI5-VMNET-000011,SWIFT-CSCv1|2.3"
  info        : "When a port group is set to VLAN 4095, this activates VGT mode. In this mode, the vSwitch passes all network frames to the guest VM without modifying the VLAN tags, leaving it up to the guest to deal with them. VLAN 4095 should be used only if the guest has been specifically configured to manage VLAN tags itself. If VGT is enabled inappropriately, it might cause denial-of-service or allow a guest VM to interact with traffic on an unauthorized VLAN."
  solution    : "As root, log in to the ESXi Shell and run the command to set the value to something other than the VGT 4095 value.
 esxcli network vswitch standard portgroup set --portgroup-name=<name> --vlan-id=<non-default_id_number>
 Re-enable Lockdown Mode on the host."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\">"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:spec/audit:name\"/>) - vlanId = <xsl:value-of select=\"audit:spec/audit:vlanId\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - vlanId = NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "vlanId ="
  not_expect  : "vlanId = 4095"
</custom_item>

<report type:"WARNING">
  description : "ESXI5-VMNET-000012 - All port groups must not be configured to VLAN values reserved by upstream physical switches"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39369,Rule-ID|SV-51227r1_rule,STIG-ID|ESXI5-VMNET-000012"
  info        : "Physical vendor-specific switches reserve certain VLAN IDs for internal purposes and often disallow traffic configured to these values. Use of reserved VLAN IDs can result in a network denial-of-service."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the ESXi Shell and run the command to set the value to something other than the vendor-specific reserved value.
 esxcli network vswitch standard portgroup set --portgroup-name=<name> --vlan-id=<non-default_id_number>
 Re-enable Lockdown Mode on the host."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXI5-VMNET-000013 - The system must ensure that the virtual switch Forged Transmits policy is set to reject"
  reference   : "800-171|3.13.1,800-53|SC-7,CAT|II,CCI|CCI-000366,CSCv6|9.2,Group-ID|V-39370,ITSG-33|SC-7,PCI-DSS|2.2.3,Rule-ID|SV-51228r1_rule,STIG-ID|ESXI5-VMNET-000013"
  info        : "If the virtual machine operating system changes the MAC address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network. Forged transmissions should be set to accept by default. This means the virtual switch does not compare the source and effective MAC addresses. To protect against MAC address impersonation, all virtual switches should have forged transmissions set to reject."
  solution    : "From the vSphere Client/vCenter as administrator, using the vSphere Client to connect to the vCenter Server and as administrator: 1. Go to 'Home > Inventory > Hosts and clusters'. 2. Select each ESXi host with active virtual switches connected to active VM's requiring securing. 3. Go to tab 'Configuration > Network > vSwitch(?) > Properties > Ports > vSwitch > Default Policies > Security' 4. Set 'Forged Transmits' = 'Reject'."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:vswitch\">"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:vswitch\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:name\"/>) - forgedTransmits = <xsl:value-of select=\"audit:spec/audit:policy/audit:security/audit:forgedTransmits\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - forgedTransmits = NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "forgedTransmits ="
  expect      : "forgedTransmits = False"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXI5-VMNET-000014 - The system must ensure that the dvPortgroup Forged Transmits policy is set to reject"
  reference   : "800-171|3.13.1,800-53|SC-7,CAT|II,CCI|CCI-000366,CSCv6|9.2,Group-ID|V-39371,ITSG-33|SC-7,PCI-DSS|2.2.3,Rule-ID|SV-51229r2_rule,STIG-ID|ESXI5-VMNET-000014"
  info        : "If the virtual machine operating system changes the MAC address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network. Forged transmissions should be set to accept by default. This means the virtual switch does not compare the source and effective MAC addresses. To protect against MAC address impersonation, all virtual switches should have forged transmissions set to reject."
  solution    : "The 'Forged Transmits' parameter must be set to 'Reject' on all dvPortgroups.

From the vSphere Client/vCenter as administrator:

Go to Home >> Inventory >> Networking.
Select each dvPortgroup connected to VMs.
Go to tab Summary >> Edit Settings >> Policies >> Security.
Set 'Forged Transmits' = 'Reject'."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\">"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:spec/audit:name\"/>) - forgedTransmits = <xsl:value-of select=\"audit:computedPolicy/audit:security/audit:forgedTransmits\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - forgedTransmits = NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "forgedTransmits ="
  expect      : "forgedTransmits = False"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXI5-VMNET-000015 - The system must ensure the dvPortGroup MAC Address Change policy is set to reject"
  reference   : "800-171|3.13.1,800-53|SC-7,CAT|II,CCI|CCI-000366,CSCv6|9.2,Group-ID|V-39372,ITSG-33|SC-7,PCI-DSS|2.2.3,Rule-ID|SV-51230r2_rule,STIG-ID|ESXI5-VMNET-000015"
  info        : "If the virtual machine operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network. This will prevent VMs from changing their effective MAC address. It will affect applications that require this functionality. An example of an application like this is Microsoft Clustering, which requires systems to effectively share a MAC address. This will also affect how a layer 2 bridge will operate. This will also affect applications that require a specific MAC address for licensing. VMs, guest OSs, and/or applications that require specific MAC settings must be placed in a separate, specially-configured dvPortgroup on the vDistributed Switch (vDS)."
  solution    : "Verify by using the vSphere Client to connect to the vCenter Server and as administrator:
Go to Home >> Inventory >> Networking. Select each dvPortgroup connected to active VMs requiring securing.
Go to tab Summary >> Edit Settings >> Policies >> Security. Change the 'Mac Address Changes' = 'Reject'."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\">"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:spec/audit:name\"/>) - macChanges = <xsl:value-of select=\"audit:computedPolicy/audit:security/audit:macChanges\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - macChanges = NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "macChanges ="
  expect      : "macChanges = False"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXI5-VMNET-000016 - The system must ensure the virtual switches MAC Address Change policy is set to reject"
  reference   : "800-171|3.13.1,800-53|SC-7,CAT|II,CCI|CCI-000366,CSCv6|9.2,Group-ID|V-39373,ITSG-33|SC-7,PCI-DSS|2.2.3,Rule-ID|SV-51231r1_rule,STIG-ID|ESXI5-VMNET-000016"
  info        : "If the virtual machine operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network. This will prevent VMs from changing their effective MAC address. It will affect applications that require this functionality. An example of an application like this is Microsoft Clustering, which requires systems to effectively share a MAC address. This will also affect how a layer 2 bridge will operate. This will also affect applications that require a specific MAC address for licensing. An exception should be made for the dvPortgroups that these applications are connected to."
  solution    : "From the vSphere Client, connect to the vCenter Server and as administrator: Go to 'Home>> Inventory>> Hosts and clusters'. Select each ESXi host with active virtual switches connected to active VMs requiring securing. Go to tab 'Configuration>> Network>> vSwitch(?)>> Properties>> Ports>> vSwitch>> Default Policies>> Security'. Change the 'Mac Address Changes' = 'Reject'."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:vswitch\">"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:vswitch\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:name\"/>) - macChanges = <xsl:value-of select=\"audit:spec/audit:policy/audit:security/audit:macChanges\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - macChanges = NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "macChanges ="
  expect      : "macChanges = False"
</custom_item>

<report type:"WARNING">
  description : "ESXI5-VMNET-000017 - Non-negotiate must be configured for trunk links between physical switches and virtual switches in VST mod"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39374,PCI-DSS|1.1.2,Rule-ID|SV-51232r1_rule,STIG-ID|ESXI5-VMNET-000017"
  info        : "In order to communicate with virtual switches in VST mode, external switch ports must be configured as trunk ports. VST mode does not support Dynamic Trunking Protocol (DTP), so the trunk must be static and unconditional. The auto or desirable physical switch settings do not work with the ESXi Server because the physical switch communicates with the ESXi Server using DTP. The non-negotiate and on options unconditionally enable VLAN trunking on the physical switch and create a VLAN trunk link between the ESXi Server and the physical switch. The difference between non-negotiate and on options is that on mode still sends out DTP frames, whereas the non-negotiate option does not. The non-negotiate option should be used for all VLAN trunks, to minimize unnecessary network traffic for virtual switches in VST mode."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Note that this check refers to an entity outside the physical scope of the ESXi-v5 server system. Document the configuration of external switch ports as trunk ports. Log in to the vendor-specific physical switch and disable DTP on the physical switch ports connected to the ESXi Host. Update the documentation on an organization-defined frequency or whenever modifications are made to either ESXi hosts or the upstream external switch ports. If DTP is enabled on the physical switch ports connected to the ESXi Host, this is a finding."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXI5-VMNET-000018 - The system must ensure the virtual switch Promiscuous Mode policy is set to reject"
  reference   : "800-171|3.13.1,800-53|SC-7,CAT|II,CCI|CCI-000366,CSCv6|9.2,Group-ID|V-39375,ITSG-33|SC-7,PCI-DSS|2.2.3,Rule-ID|SV-51233r1_rule,STIG-ID|ESXI5-VMNET-000018"
  info        : "When promiscuous mode is enabled for a virtual switch, all virtual machines connected to the dvPortgroup have the potential of reading all packets across that network, meaning only the virtual machines connected to that dvPortgroup. Promiscuous mode is disabled by default on the ESXi Server."
  solution    : "From the vSphere Client/vCenter Server as administrator: Go to 'Home>> Inventory>> Hosts and clusters'. Select each ESXi host with active virtual switches connected to active VMs requiring securing. Go to tab 'Configuration>> Network>> vSwitch(?)>> Properties>> Ports>> vSwitch>> Default Policies>> Security'. Set 'Promiscuous Mode' = 'Reject'."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:vswitch\">"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:vswitch\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:name\"/>) - allowPromiscuous = <xsl:value-of select=\"audit:spec/audit:policy/audit:security/audit:allowPromiscuous\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - allowPromiscuous = NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "allowPromiscuous ="
  expect      : "allowPromiscuous = False"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "ESXI5-VMNET-000019 - The system must ensure the dvPortgroup Promiscuous Mode policy is set to reject"
  reference   : "800-171|3.13.1,800-53|SC-7,CAT|II,CCI|CCI-000366,CSCv6|9.2,Group-ID|V-39376,ITSG-33|SC-7,PCI-DSS|2.2.3,Rule-ID|SV-51234r2_rule,STIG-ID|ESXI5-VMNET-000019"
  info        : "When promiscuous mode is enabled for a dvPortgroup, all virtual machines connected to the dvPortgroup have the potential of reading all packets across that network, meaning only the virtual machines connected to that dvPortgroup. Promiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting. However, there might be a legitimate reason to enable it for debugging, monitoring or troubleshooting reasons. Security devices might require the ability to see all packets on a vSwitch. An exception should be made for the dvPortgroups that these applications are connected to, in order to allow for full-time visibility to the traffic on that dvPortgroup."
  solution    : "From the vSphere Client/vCenter Server as administrator:

Go to Home >> Inventory >> Hosts and clusters.
Select each ESXi host with active virtual switches connected to active VMs requiring securing.
Go to tab Home >> Inventory >> Networking. Individually select each dvPortgroup, then go to tab Summary >> Edit Settings >> Policies >> Security.
Set the 'Promiscuous Mode' keyword to 'Reject'."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\">"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:portgroup\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:spec/audit:name\"/>) - allowPromiscuous = <xsl:value-of select=\"audit:computedPolicy/audit:security/audit:allowPromiscuous\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - allowPromiscuous = NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "allowPromiscuous ="
  expect      : "allowPromiscuous = False"
</custom_item>

<report type:"WARNING">
  description : "ESXI5-VMNET-000020 - The system must ensure there are no unused ports on a distributed virtual port group"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39377,PCI-DSS|1.1.2,PCI-DSS|2.2.2,Rule-ID|SV-51235r3_rule,STIG-ID|ESXI5-VMNET-000020"
  info        : "The number of ports available on a dvSwitch distributed port group must be adjusted to exactly match the number of virtual machine vNICs that need to be assigned to that dvPortgroup. Limiting the number of ports to just what is needed also limits the accidental or malicious potential to move a virtual machine to an unauthorized network. This is especially relevant if the management network is on a dvPortgroup, because it could help prevent putting a rogue virtual machine on this network."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As administrator, find all dvSwitches from the vSphere Client/vCenter:
Home >> Inventory >> Networking view.

For dvSwitches with dvPortgroups, edit the settings for that dvPortgroup. Limit (match or approximate) the number of ports in that port group to the number of vNICs residing in that port group."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "ESXI5-VMNET-000021 - vMotion traffic must be isolated"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39378,PCI-DSS|1.1.3,Rule-ID|SV-51236r1_rule,STIG-ID|ESXI5-VMNET-000021"
  info        : "The security issue with vMotion migrations is that information is transmitted in plain text, and anyone with access to the network over which this information flows can view it. Potential attackers can intercept vMotion traffic to obtain memory contents of a virtual machine. They might also potentially stage a MiTM attack in which the contents are modified during migration. vMotion traffic must be sequestered from production traffic on an isolated network. This network must be non-routable (no layer-3 router spanning this and other networks), preventing outside access to the network."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To create a vMotion vSwitch from the vSphere Client/vCenter, select the ESXi host, and select the configuration tab. In the hardware panel, select Networking; click the Add Network link; choose VMKernel and click next; select the desired NIC(s). In the port groups dialog box type a name, (example: 'vMotion'). Next, select the 'use this port group for vMotion' and set the IP address and subnet mask and gateway where/as required"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "ESXI5-VMNET-000023 - Access to the management network must be strictly controlled"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39400,PCI-DSS|1.3.1,Rule-ID|SV-51258r1_rule,STIG-ID|ESXI5-VMNET-000023"
  info        : "A controlled gateway or other controlled method must be configured to access the management network. The management network must be isolated in order to prevent access by internal and external, unauthorized personnel."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Implement and document a controlled gateway or other controlled access method to the management network. Note that this check refers to an entity outside the scope of the ESXi-v5 server system"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "ESXI5-VMNET-000024 - Access to the management network must be strictly controlled through a network jump box"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39401,PCI-DSS|2.2,Rule-ID|SV-51259r1_rule,STIG-ID|ESXI5-VMNET-000024"
  info        : "Based upon a local site-specific risk assessment, jump boxes that run vSphere Client and other management clients (e.g., VSphere Management Assistant) must be configured. The management network must be isolated in order to prevent access by internal and external, unauthorized personnel."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Implement and document a management network jump box solution. Note that this check refers to an entity outside the scope of the ESXi-v5 server system"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "ESXI5-VMNET-000025 - Spanning tree enabled and BPDU guard and Portfast disabled on the upstream port for VMs that route/bridge traffic"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39379,PCI-DSS|2.2,Rule-ID|SV-51237r1_rule,STIG-ID|ESXI5-VMNET-000025"
  info        : "If an ESXi host guest VM is configured to perform a bridging function, the VM will generate BPDU frames to send out to the VDS. The VDS forwards the BPDU frames through the network adapter to the physical switch port. When the switch port configured with 'BPDU guard' receives the BPDU frame, the switch will disable the port and the VM will lose connectivity. To avoid this network failure scenario while running a software-bridging function on an ESXI host, the 'portfast' and 'BPDU guard' configuration must be disabled on the port and spanning tree protocol must be enabled."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Organization and vendor specific fix. If a guest VM is configured to perform a bridging function, enable spanning tree protocol for the VMs switch port. Note that this check refers to an entity outside the scope of the ESXi server system."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "ESXI5-VMNET-000026 - The system must disable the autoexpand option for VDS dvPortgroups"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39380,PCI-DSS|1.1.1,Rule-ID|SV-51238r3_rule,STIG-ID|ESXI5-VMNET-000026"
  info        : "If the 'no-unused-dvports' guideline is followed, there should be only the amount of ports on a VDS that are actually needed. The Autoexpand feature on VDS dvPortgroups can override that limit. The feature allows dvPortgroups to automatically add 10 virtual distributed switch ports to a dvPortgroup that has run out of available ports. The risk is that maliciously or inadvertently, a virtual machine that is not supposed to be part of that portgroup is able to affect confidentiality, integrity, or authenticity of data of other virtual machines on that portgroup. To reduce the risk of inappropriate dvPortgroup access, the autoexpand option on VDS should be disabled. By default the option is disabled, but regular monitoring must be implemented to verify this has not been changed."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Temporarily disable Lockdown Mode and enable the ESXi Shell via the vSphere Client.

1. Open the vSphere/VMware Infrastructure (VI) Client and log in with appropriate credentials.
2. If connecting to vCenter Server, click on the desired host.
3. Click the Configuration tab.
4. Click Software, Security Profile, Services, Properties, ESXi Shell and Options, respectively.
5. Start the ESXi Shell service, where/as required.

As root, log in to the ESXi Shell and determine if the managed object browser (MOB) is enabled:
# vim-cmd proxysvc/service_list | grep proxy-mob

If the command return lists 'proxy-mob', the mob is enabled. If not, re-enable the MOB:
# vim-cmd proxysvc/add_np_service '/mob' httpsWithRedirect /var/run/vmware/proxy-mob

The autoexpand property is disabled by default, but it can be enabled using the MOB:
1. In a browser, enter the address http://vc-ip-address/mob/.
2. When prompted, enter the vCenter Server appropriate username and password.
3. Click the Content link.
4. In the left pane, search for the row with the word rootFolder.
5. Open the link in the right pane of the row. The link should be similar to group-d1 (Datacenters).
6. In the left pane, search for the row with the word childEntity. In the right pane, you see a list of datacenter links.
7. Click the datacenter link in which the vDS is defined.
8. In the left pane, search for the row with the word networkFolder and open the link in the right pane. The link should be similar to group-n123 (network).
9. In the left pane, search for the row with the word childEntity. You see a list of vDS and distributed port group links in the right pane.
10.Click the distributed port group for which you want to change this property.
11.In the left pane, search for the row with the word config and click the link in the right pane.
12.In the left pane, search for the row with the word autoExpand. It is usually the first row.
13.Note the corresponding value displayed in the right pane. The value should be false by default.
14. In the left pane, search for the row with the word configVersion. The value should be 1 only if it has not been previously modified.
15. Note the corresponding value displayed in the right pane as it is needed in step 18.
16. Go back to the distributed port group page.
17. Click the link that reads ReconfigureDvs_Task. A new window appears.
18. In the Spec text field, enter this text:

<spec><autoExpand>false</autoExpand><configversion>configVersion</configversion></spec>

where configVersion is what was recorded directly above in step 15.

19. Click the Invoke Method link.
20. Close the window.
21. Repeat Steps 10 through 14 to verify the new value for autoExpand.

Disable the MOB.
# vim-cmd proxysvc/remove_service '/mob' 'httpsWithRedirect'

Re-enable Lockdown Mode on the host."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "ESXI5-VMNET-000036 - IP-based storage traffic must be isolated to a management-only network using a dedicated, management-only vSwitch"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39362,PCI-DSS|2.2,Rule-ID|SV-51220r1_rule,STIG-ID|ESXI5-VMNET-000036"
  info        : "Virtual machines might share virtual switches and VLANs with the IP-based storage configurations. IP-based storage includes iSCSI and NFS. This configuration might expose IP-based storage traffic to unauthorized virtual machine users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network. To restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from the production traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from the VMkernel management and service console network will limit unauthorized users from viewing the traffic."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To restrict physical network access to management-only entities, modify the VMkernel Networking configuration. From the vSphere Client/vCenter as administrator: Select the host in the inventory pane. On the host Configuration tab, click Networking. In the vSphere Standard Switch view, select Properties. Modify the storage port group property to ensure the storage port group is located on a management-only vSwitch."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "ESXI5-VMNET-000046 - All IP-based storage traffic must be isolated using a vSwitch containing management-only port groups"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39363,PCI-DSS|2.2,Rule-ID|SV-51221r1_rule,STIG-ID|ESXI5-VMNET-000046"
  info        : "Virtual machines might share virtual switches and VLANs with the IP-based storage configurations. IP-based storage includes iSCSI and NFS. This configuration might expose IP-based storage traffic to unauthorized virtual machine users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network. To restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from the production traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from the VMkernel management and service console network will limit unauthorized users from viewing the traffic."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To restrict physical network access to management-only entities, modify the VMkernel Networking configuration. From the vSphere Client/vCenter as administrator: Select the host in the inventory pane. On the host Configuration tab, click Networking. In the vSphere Standard Switch view, and select Properties. Modify the storage port group vSwitch property to ensure the storage port group vSwitch exclusively contains management-only port groups."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "GEN000100-ESXI5-000062 - The operating system must be a supported release"
  reference   : "800-171|3.14.1,800-53|SI-2,CAT|I,CCI|CCI-000366,CSF|ID.RA-1,CSF|PR.IP-12,Group-ID|V-39429,ITSG-33|SI-2,PCI-DSS|6.1,Rule-ID|SV-51287r1_rule,STIG-ID|GEN000100-ESXI5-000062"
  info        : "An operating system release is considered supported if the vendor continues to provide security patches for the product. With an unsupported release, it will not be possible to resolve security issues discovered in the system software."
  info        : "Update ESXI_VERSION to the appropriate value for the local environment"
  solution    : "Upgrade to a supported version"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:product/audit:licenseProductVersion\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - Product Version : <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:product/audit:licenseProductVersion\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Product Version : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
# Note: Variable @ESXI_VERSION@ replaced with "5\\.0" in field "expect".
  expect      : "Product Version : 5\\.0"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "GEN000240-ESXI5-000058 - The system clock must be synchronized to an authoritative DoD time source"
  reference   : "800-171|3.3.7,800-53|AU-8(1),CAT|II,CCI|CCI-000366,CSCv6|6.1,CSF|PR.PT-1,Group-ID|V-39430,ISO/IEC-27001|A.12.4.4,ITSG-33|AU-8(1),NESA|T3.6.7,NIAv2|NS44,NIAv2|NS45,NIAv2|NS46,NIAv2|NS47,PCI-DSSv3.1|10.4,PCI-DSSv3.2|10.4,PCI-DSS|10.4.1,PCI-DSS|10.4.3,Rule-ID|SV-51288r1_rule,STIG-ID|GEN000240-ESXI5-000058"
  info        : "To assure the accuracy of the system clock, it must be synchronized with an authoritative time source within DoD. Many system functions, including time-based login and activity restrictions, automated reports, system logs, and audit records depend on an accurate system clock. If there is no confidence in the correctness of the system clock, time-based functions may not operate as intended and records may be of diminished value."
  info        : "Update NTP_SERVER to the appropriate value for the local environment"
  solution    : "From the vSphere Client: Select the host and click 'Configuration >> Time Configuration'. Select the properties link and chose 'Options'. From the General tab start the NTP service and select 'Start and stop with host'. From the NTP Settings tab click the 'Add' button to add the organization-defined, authoritative time source within DoD NTP servers"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:dateTimeInfo/audit:ntpConfig/audit:server\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - NTP Server : <xsl:value-of select=\"audit:propSet/audit:val/audit:dateTimeInfo/audit:ntpConfig/audit:server\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>NTP Server : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "NTP Server : "
# Note: Variable @NTP_SERVER@ replaced with "0\\.us\\.pool\\.ntp\\.org" in field "expect".
  expect      : "NTP Server : 0\\.us\\.pool\\.ntp\\.org"
</custom_item>

<report type:"WARNING">
  description : "GEN000380-ESXI5-000043 - The GID assigned to a user must exist"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39274,PCI-DSS|7.1.4,Rule-ID|SV-51090r1_rule,STIG-ID|GEN000380-ESXI5-000043"
  info        : "If a user is assigned the GID of a group not existing on the system, and a group with that GID is subsequently created, the user may have unintended rights to that group."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "From the vSphere Client/vCenter, click on the 'Local Users and Groups' tab, then select Groups. Highlight the user, right click the user and select Edit. Select/highlight/assign the user's correct primary GID. Click OK"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN000585-ESXI5-000080 - The system must enforce the entire password during authentication"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39263,PCI-DSS|8.5,Rule-ID|SV-51079r1_rule,STIG-ID|GEN000585-ESXI5-000080"
  info        : "Some common password hashing schemes only process the first eight characters of a user's password, which reduces the effective strength of the password."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host and verify the expected settings are configured in the /etc/pam.d/passwd file. The entry format is 'password requisite /lib/security/pam_passwdqc.so similar=deny retry=N min=N0,N1,N2,N3,N4'. The 'N4' field controls the behavior requiring at least one character each of the 4 different character classes, with a minimum required length of 14 characters.
vi /etc/pam.d/passwd
Set the 'N4' password complexity field to '14' and set the 'N0' thru 'N3' fields to 'disabled'."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN000790-ESXI5-000085 - The system must prevent the use of dictionary words for passwords (V-39246)"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39246,PCI-DSS|8.5.11,Rule-ID|SV-51062r1_rule,STIG-ID|GEN000790-ESXI5-000085"
  info        : "An easily guessable password provides an open door to any external or internal malicious intruder. Many computer compromises occur as the result of account name and password guessing. This is generally done by someone with an automated script using repeated logon attempts until the correct account and password pair is guessed. Utilities, such as cracklib, can be used to validate passwords are not dictionary words and meet other criteria during password changes."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host and ensure the expected settings of the 'min' keyword are configured in the /etc/pam.d/passwd file.
vi /etc/pam.d/passwd
Set the 'N2' password complexity field to 'disabled', ie: min=disabled,disabled,disabled,disabled,14"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN000790-ESXI5-000085 - The system must prevent the use of dictionary words for passwords (V-39418)"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39418,PCI-DSS|8.5.11,Rule-ID|SV-51276r1_rule,STIG-ID|GEN000790-ESXI5-000085"
  info        : "An easily guessable password provides an open door to any external or internal malicious intruder. Many computer compromises occur as the result of account name and password guessing. This is generally done by someone with an automated script using repeated logon attempts until the correct account and password pair is guessed. Utilities, such as cracklib, can be used to validate passwords are not dictionary words and meet other criteria during password changes."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host and ensure the expected settings of the 'min' keyword are configured in the /etc/pam.d/passwd file.
vi /etc/pam.d/passwd
Set the 'N2' password complexity field to 'disabled', ie: min=disabled,disabled,disabled,disabled,14"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN000940-ESXI5-000042 - The root account's executable search path must be the vendor default and must contain only absolute paths"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39273,PCI-DSS|2.2.3,Rule-ID|SV-51089r1_rule,STIG-ID|GEN000940-ESXI5-000042"
  info        : "The executable search path (typically the PATH environment variable) contains a list of directories for the shell to search to find executables. If this path includes the current working directory or other relative paths, executables in these directories may be executed instead of system commands. This variable is formatted as a colon-separated list of directories. If there is an empty entry, such as a leading or trailing colon or two consecutive colons, this is interpreted as the current working directory. Entries starting with a slash (/) are absolute paths."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Execute the following command(s):
vi /etc/profile
Set the 'PATH' to '/bin:/sbin'."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN000945-ESXI5-000333 - The root accounts library search path must be the system default and must contain only absolute paths"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39382,PCI-DSS|2.2.3,Rule-ID|SV-51240r1_rule,STIG-ID|GEN000945-ESXI5-000333"
  info        : "The library search path environment variable(s) contain a list of directories for the dynamic linker to search to find libraries. If this path includes the current working directory or other relative paths, libraries in these directories may be loaded instead of system libraries. This variable is formatted as a colon-separated list of directories. If there is an empty entry, such as a leading or trailing colon or two consecutive colons, this is interpreted as the current working directory. Entries starting with a slash (/) are absolute paths."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Execute the following command(s):
vi /etc/vmware/config
Set the 'libdir' path to '/usr/lib/vmware'"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN000950-ESXI5-444 - The root accounts list of preloaded libraries must be empty"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39383,PCI-DSS|2.2.3,Rule-ID|SV-51241r2_rule,STIG-ID|GEN000950-ESXI5-444"
  info        : "The library preload list environment variable contains a list of libraries for the dynamic linker to load before loading the libraries required by the binary. If this list contains paths to libraries relative to the current working directory, unintended libraries may be preloaded. This variable is formatted as a space-separated list of libraries. Paths starting with (/) are absolute paths."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/vmware/config

Set the LD_PRELOAD to ''.

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "GEN001375-ESXI5-000086 - For systems using DNS resolution, at least two name servers must be configured"
  reference   : "800-53|SC-20,CAT|III,CCI|CCI-000366,Group-ID|V-39427,ITSG-33|SC-20,PCI-DSS|1.1.3,PCI-DSS|2.2.2,Rule-ID|SV-51285r1_rule,STIG-ID|GEN001375-ESXI5-000086"
  info        : "To provide availability for name resolution services, multiple redundant name servers are mandated. A failure in name resolution could lead to the failure of security functions requiring name resolution, which may include time synchronization, centralized authentication, and remote system logging."
  solution    : "Click the Configuration tab and view the listed DNS server setting(s).
 If DNS is configured has less than 2 servers configured, add a second server."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:dnsConfig\">"
  xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:network/audit:dnsConfig\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> - <xsl:for-each select=\"audit:address\"><xsl:value-of select=\".\"/><xsl:text> </xsl:text></xsl:for-each><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/><xsl:text> - DNS Servers NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  expect      : "- [0-9.]+ [0-9.]+"
</custom_item>

<report type:"WARNING">
  description : "GEN002120-ESXI5-000045 - The /etc/shells (or equivalent) file must exist"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39275,PCI-DSS|2.2.3,Rule-ID|SV-51091r1_rule,STIG-ID|GEN002120-ESXI5-000045"
  info        : "The shells file (or equivalent) lists approved default shells. It helps provide layered defense to the security approach by ensuring users cannot change their default shell to an unauthorized shell that may not be secure."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Execute the following command(s):
 > /etc/shells"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN002140-ESXI5-000046 - All shells referenced in /etc/passwd must be listed in the /etc/shells file, except shells preventing logins"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39276,PCI-DSS|2.2.3,Rule-ID|SV-51092r1_rule,STIG-ID|GEN002140-ESXI5-000046"
  info        : "The shells file lists approved default shells. It helps provide layered defense to the security approach by ensuring users cannot change their default shell to an unauthorized shell that may not be secure. By default, the shells file contains the only shell files in the ESXi file system, /bin/ash and /bin/sh. Users not granted shell access are assigned the shell /sbin/nologin."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Available shells for ESXi are '/bin/sh' and '/bin/ash'.
 Ensure both the above interactive shell(s) are listed in the /etc/shells file. If necessary, add them:
 vi /etc/shells"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN002260-ESXI5-000047 - The system must be checked for extraneous device files at least weekly"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39424,PCI-DSS|2.2.3,Rule-ID|SV-51282r3_rule,STIG-ID|GEN002260-ESXI5-000047"
  info        : "If an unauthorized device is allowed to exist on the system, there is the possibility the system may perform unauthorized operations."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Configure the system to check for extraneous device files on a weekly basis. Refer to the Check Content section above for the basic command structure to search the file system. Additionally, ensure persistence of the command output by storing results to a target located on persistent storage."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN002400-ESXI5-10047 - The system must be checked weekly for unauthorized setuid files and unauthorized changes to authorized setuid files"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39425,PCI-DSS|2.2.3,Rule-ID|SV-51283r2_rule,STIG-ID|GEN002400-ESXI5-10047"
  info        : "Files with the setuid bit set will allow anyone running these files to be temporarily assigned the UID of the file. While many system files depend on these attributes for proper operation, security problems can result if setuid is assigned to programs that allow reading and writing of files, or shell escapes."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Configure the system to check for unauthorized setuid files on a weekly basis. Refer to the Check Content section above for the basic command structure to search the file system. Additionally, ensure persistence of the command output by storing results to a target located on persistent storage."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN002420-ESXI5-00878 - Removable media, remote file systems and file systems that do not contain setuid files must be mounted nosuid"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39422,PCI-DSS|2.2.4,Rule-ID|SV-51280r1_rule,STIG-ID|GEN002420-ESXI5-00878"
  info        : "The 'nosuid' mount option causes the system to not execute setuid files with owner privileges. This option must be used for mounting any file system that does not contain approved setuid files. Executing setuid files from untrusted file systems, or file systems that do not contain approved setuid files, increases the opportunity for unprivileged users to attain unauthorized administrative access."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host. Edit /etc/fstab and add the nosuid mount option to all file systems mounted from removable media or network shares, and any file system not containing approved setuid or setgid files."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN002430-ESXI5 - Removable media, remote file systems and file systems that do not contain device files must be mounted nodev"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39381,PCI-DSS|2.2.4,Rule-ID|SV-51239r1_rule,STIG-ID|GEN002430-ESXI5"
  info        : "The 'nodev' (or equivalent) mount option causes the system to not handle device files as system devices. This option must be used for mounting any file system that does not contain approved device files. Device files can provide direct access to system hardware and can compromise security if not protected."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host. Edit /etc/fstab and add the nodev option for all NFS file systems."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN002460-ESXI5-20047 - The system must be checked weekly for unauthorized setgid files and unauthorized changes to authorized setgid files"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39426,PCI-DSS|2.2.4,Rule-ID|SV-51284r2_rule,STIG-ID|GEN002460-ESXI5-20047"
  info        : "Files with the setgid bit set will allow anyone running these files to be temporarily assigned the GID of the file. While many system files depend on these attributes for proper operation, security problems can result if setgid is assigned to programs that allow reading and writing of files, or shell escapes."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Configure the system to check for unauthorized setgid files on a weekly basis. Refer to the Check Content section above for the basic command structure to search the file system. Additionally, ensure persistence of the command output by storing results to a target located on persistent storage."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN003510-ESXI5-006660 - Kernel core dumps must be disabled unless needed"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39355,PCI-DSS|2.2.4,Rule-ID|SV-51213r2_rule,STIG-ID|GEN003510-ESXI5-006660"
  info        : "Kernel core dumps may contain the full contents of system memory at the time of the crash. Kernel core dumps may consume a considerable amount of disk space and may result in Denial-of-Service by exhausting the available space on the target file system. The kernel core dump process may increase the amount of time a system is unavailable due to a crash. Kernel core dumps can be useful for kernel debugging."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "For ESXi 5.0 servers (standalone or managed by vCenter Server) that have kernel core dumps configured locally:
To create a diagnostic coredump partition on disk, select a storage device with at least 100MB of free space (200MB recommended) that is accessible by the ESXi host. Ensure the storage device you intend to use does not contain any useful data as it will be overwritten. Use the partedUtil command line utility (refer to the vendor's documentation) to create a new partition. Then use the esxcli command line utility to list all accessible diagnostic partitions.
# esxcli system coredump partition list

The output appears similar to:
Name					Path				Active	Configured
----------------------------------		------				---------	----------------
mpx.vmhba2:C0:T0:L0:7	/vmfs/devices/...	false	false

Configure and activate one of the accessible diagnostic partitions using the esxcli command line utility.
# esxcli system coredump partition set --partition='Partition_Name'
# esxcli system coredump partition set --enable true

Validate that the diagnostic partition is now active using the command:
# esxcli system coredump partition list

The output should now appear similar to:
Name					Path				Active	Configured
----------------------------------		------				---------	----------------
mpx.vmhba2:C0:T0:L0:7	/vmfs/devices/...	true		true


For ESXi 5.0 servers managed by vCenter Server using a network core dump server:
View the current network configuration.
# esxcli system coredump network get

Specify the VMkernel network interface to use for outbound traffic and the IP address/UDP port number of the remote network coredump server.
# esxcli system coredump network set --interface-name <VMkernelInterface> --server-ipv4 <IPAddress> --server-port PortNumber

Enable the above selected network coredump configuration.
# esxcli system coredump network set --enable true

Confirm the configuration.
# esxcli system coredump network get"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005300-ESXI5-000099 - SNMP communities, users, and passphrases must be changed from the default"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39247,PCI-DSS|2.2.4,Rule-ID|SV-51063r1_rule,STIG-ID|GEN005300-ESXI5-000099"
  info        : "Whether active or inactive, default communities, users, and passwords must be changed to maintain security. A service running with default authenticators allows acquisition of data about the system and the network to potentially compromise the integrity of the system or network(s)."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "From the Power/v CLI, run the (below example) command: >
vicfg-snmp.pl --server <hostname|IP address> --username <username> --password <password> -E -c <community_name>
In the above example, -E enables the VMware SNMP agent, and -c sets communities to the provided name."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "GEN005440-ESXI5-000078 - The system must not be used as a syslog server (log host) for systems external to the enclave"
  reference   : "800-171|3.3.8,800-53|AU-9,CAT|II,CCI|CCI-000366,CSF|PR.PT-1,Group-ID|V-39279,ITSG-33|AU-9,PCI-DSSv3.1|10.5.3,PCI-DSSv3.1|10.5.4,PCI-DSSv3.2|10.5.3,PCI-DSSv3.2|10.5.4,PCI-DSS|2.2.4,Rule-ID|SV-51095r1_rule,STIG-ID|GEN005440-ESXI5-000078"
  info        : "Syslog messages are typically unencrypted and may contain sensitive information and are, therefore, restricted to the enclave."
  info        : "Update LOG_HOST to the appropriate value for the local environment"
  solution    : "Step 1: Verify that the vSphere Syslog Collector syslog host has been configured. If not, install/enable the vSphere Syslog Collector.
 Step 2: From the vSphere Client: Select the host and click 'Configuration >> Advanced Settings >> Syslog >> Global'.
 Step 3: Set 'Syslog.global.logHost' to the syslog server hostname restricted to the enclave."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:value/text()\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Syslog.global.logHost : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog\.global\.logHost : "
# Note: Variable @LOG_HOST@ replaced with "192\\.168\\.0\\.1" in field "expect".
  expect      : "Syslog\.global\.logHost : 192\\.168\\.0\\.1"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "GEN005460-ESXI5-000060 - The system must only use remote syslog servers justified and documented using site-defined procedures"
  reference   : "800-171|3.3.8,800-53|AU-9,CAT|II,CCI|CCI-000366,CSF|PR.PT-1,Group-ID|V-39278,ITSG-33|AU-9,PCI-DSSv3.1|10.5.3,PCI-DSSv3.1|10.5.4,PCI-DSSv3.2|10.5.3,PCI-DSSv3.2|10.5.4,PCI-DSS|2.2.4,Rule-ID|SV-51094r1_rule,STIG-ID|GEN005460-ESXI5-000060"
  info        : "If a remote log host is in use and it has not been justified and documented with the IAO, sensitive information could be obtained by unauthorized users without the SA's knowledge. A remote log host is any host to which the system is sending syslog messages over a network."
  info        : "Update LOG_HOST to the appropriate value for the local environment"
  solution    : "Step 1: Verify that the vSphere Syslog Collector syslog host has been configured. If not, install/enable the vSphere Syslog Collector. Step 2: From the vSphere Client: Select the host and click 'Configuration >> Advanced Settings >> Syslog >> Global'. Step 3: Set 'Syslog.global.logHost' to the syslog server hostname justified and documented with the IAO."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:value/text()\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Syslog.global.logHost : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog\.global\.logHost : "
# Note: Variable @LOG_HOST@ replaced with "192\\.168\\.0\\.1" in field "expect".
  expect      : "Syslog\.global\.logHost : 192\\.168\\.0\\.1"
</custom_item>

<report type:"WARNING">
  description : "GEN005501-ESXI5-9778 - The SSH client must be configured to only use the SSHv2 protocol"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39414,PCI-DSS|2.2.2,Rule-ID|SV-51272r2_rule,STIG-ID|GEN005501-ESXI5-9778"
  info        : "SSHv1 is not a DoD-approved protocol and has many well-known vulnerability exploits. Exploits of the SSH client could provide access to the system with the privileges of the user running the client."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode.
Enable the ESXi Shell.

Edit the SSH client  configuration and add/modify the 'Protocol' configuration for Protocol 2 only.
# vi /etc/ssh/ssh_config

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005515-ESXI5-000100 - The SSH daemon must be configured to not allow TCP connection forwarding"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39248,PCI-DSS|2.2.2,Rule-ID|SV-51064r1_rule,STIG-ID|GEN005515-ESXI5-000100"
  info        : "SSH TCP connection forwarding provides a mechanism to establish TCP connections proxied by the SSH server. This function can provide similar convenience to a Virtual Private Network (VPN) with the similar risk of providing a path to circumvent firewalls and network ACLs."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Edit the SSH daemon configuration and add/modify the 'AllowTCPForwarding' configuration setting it to 'no'.
 vi /etc/ssh/sshd_config"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005516-ESXI5-703 - The SSH client must be configured to not allow TCP forwarding"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39249,PCI-DSS|2.2.2,Rule-ID|SV-51065r3_rule,STIG-ID|GEN005516-ESXI5-703"
  info        : "SSH TCP connection forwarding provides a mechanism to establish TCP connections proxied by the SSH server. This function can provide similar convenience to a Virtual Private Network (VPN) with the similar risk of providing a path to circumvent firewalls and network ACLs."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/ssh/ssh_config

Add/modify the attribute line entry to the following (quotes for emphasis only):
'ForwardAgent no'
'ForwardX11 no'
'ForwardX11Trusted no'

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005517-ESXI5-000101 - The SSH daemon must be configured to not allow gateway ports"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39250,PCI-DSS|2.2.2,Rule-ID|SV-51066r2_rule,STIG-ID|GEN005517-ESXI5-000101"
  info        : "SSH TCP connection forwarding provides a mechanism to establish TCP connections proxied by the SSH server. This function can provide similar convenience to a Virtual Private Network (VPN) with the similar risk of providing a path to circumvent firewalls and network ACLs. Gateway ports allow remote forwarded ports to bind to non-loopback addresses on the server."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/ssh/sshd_config

Add/modify the attribute line entry to the following (quotes for emphasis only):
'GatewayPorts no'

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005518-ESXI5-704 - The SSH client must be configured to not allow gateway ports"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39251,PCI-DSS|2.2.2,Rule-ID|SV-51067r2_rule,STIG-ID|GEN005518-ESXI5-704"
  info        : "SSH TCP connection forwarding provides a mechanism to establish TCP connections proxied by the SSH server. This function can provide similar convenience to a Virtual Private Network (VPN) with the similar risk of providing a path to circumvent firewalls and network ACLs. Gateway ports allow remote forwarded ports to bind to non-loopback addresses on the server."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode.
Enable the ESXi Shell. Edit the SSH client configuration and add/modify the 'GatewayPorts' configuration, setting it to 'no'.
# vi /etc/ssh/ssh_config

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005519-ESXI5-000102 - The SSH daemon must be configured to not allow X11 forwarding"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39265,PCI-DSS|2.2.2,Rule-ID|SV-51081r1_rule,STIG-ID|GEN005519-ESXI5-000102"
  info        : "X11 forwarding over SSH allows for the secure remote execution of X11-based applications. This feature can increase the attack surface of an SSH connection and should not be enabled unless needed."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Edit the SSH daemon configuration and add/modify the 'X11Forwarding' configuration, setting it to 'no'.
 vi /etc/ssh/sshd_config"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005520-ESXI5-705 - The SSH client must be configured to not allow X11 forwarding"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39271,PCI-DSS|2.2.2,Rule-ID|SV-51087r2_rule,STIG-ID|GEN005520-ESXI5-705"
  info        : "X11 forwarding over SSH allows for the secure remote execution of X11-based applications. This feature can increase the attack surface of an SSH connection and should not be enabled unless needed."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode.
Enable the ESXi Shell.

Edit the SSH client configuration and add/modify the 'ForwardX11' configuration to 'no'.
# vi /etc/ssh/ssh_config

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005528-ESXI5-000106 - The SSH daemon must not accept environment variables from the client or must only accept those pertaining to locale"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39266,PCI-DSS|2.2.2,Rule-ID|SV-51082r2_rule,STIG-ID|GEN005528-ESXI5-000106"
  info        : "Environment variables can be used to change the behavior of remote sessions and should be limited. Locale environment variables that specify the language, character set, and other features modifying the operation of software to match the user's preferences."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/ssh/sshd_config

Add/modify the attribute line entry to the following (quotes for emphasis only):
'AcceptEnv LOCALE'
or
'AcceptEnv'

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005529-ESXI5-708 - The SSH client must not send environment variables to the server or must only send those pertaining to locale"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39269,PCI-DSS|2.2.2,Rule-ID|SV-51085r3_rule,STIG-ID|GEN005529-ESXI5-708"
  info        : "Environment variables can be used to change the behavior of remote sessions and should be limited. Locale environment variables specify the language, character set, and other features modifying the operation of software to match the user's preferences."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/ssh/ssh_config

Add/modify the attribute line entry to one of the following (quotes for emphasis only):
'SendEnv LOCALE'
or
'SendEnv'

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005530-ESXI5-000107 - The SSH daemon must not permit user environment settings"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39267,PCI-DSS|2.2.2,Rule-ID|SV-51083r2_rule,STIG-ID|GEN005530-ESXI5-000107"
  info        : "SSH may be used to provide limited functions other than an interactive shell session, such as file transfer. If local, user-defined environment settings (such as, those configured in ~/.ssh/authorized_keys and ~/.ssh/environment) are configured by the user and permitted by the SSH daemon, they could be used to alter the behavior of the limited functions, potentially granting unauthorized access to the system."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/ssh/sshd_config

Add/modify the attribute line entry to the following (quotes for emphasis only):
'PermitUserEnvironment no'

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005531-ESXI5-000108 - The SSH daemon must not permit tunnels."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39268,PCI-DSS|2.2.2,Rule-ID|SV-51084r2_rule,STIG-ID|GEN005531-ESXI5-000108"
  info        : "OpenSSH has the ability to create network tunnels (layer-2 and layer-3) over an SSH connection. This function can provide similar convenience to a Virtual Private Network (VPN) with the similar risk of providing a path to circumvent firewalls and network ACLs."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/ssh/sshd_config

Add/modify the attribute line entry to the following (quotes for emphasis only):
'PermitTunnel no'

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005532-ESXI5-709 - The SSH client must not permit tunnels"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39270,PCI-DSS|2.2.2,Rule-ID|SV-51086r3_rule,STIG-ID|GEN005532-ESXI5-709"
  info        : "OpenSSH has the ability to create network tunnels (layer-2 and layer-3) over an SSH connection. This function can provide similar convenience to a Virtual Private Network (VPN) with the similar risk of providing a path to circumvent firewalls and network ACLs."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/ssh/ssh_config

Add/modify the attribute line entry to the following (quotes for emphasis only):
'Tunnel no'

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005536-ESXI5-000110 - The SSH daemon must perform strict mode checking of home directory configuration files"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39420,PCI-DSS|2.2.2,Rule-ID|SV-51278r2_rule,STIG-ID|GEN005536-ESXI5-000110"
  info        : "If other users have access to modify user-specific SSH configuration files, they may be able to log into the system as another user."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/ssh/sshd_config

Add/modify the attribute line entry to the following (quotes for emphasis only):
'StrictModes yes'

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005539-ESXI5-000113 - The SSH daemon must not allow compression or must only allow compression after successful authentication"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39285,PCI-DSS|2.2.2,Rule-ID|SV-51101r2_rule,STIG-ID|GEN005539-ESXI5-000113"
  info        : "If compression is allowed in an SSH connection prior to authentication, vulnerabilities in the compression software could result in compromise of the system from an unauthenticated connection, potentially with root privileges."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/ssh/sshd_config

Add/modify the attribute line entry to the following (quotes for emphasis only):
'Compression no'
or
'Compression delayed'

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005570-ESXI5-000115 - System must be configured with a default gateway for IPv6 if the system uses IPv6, unless it is a router"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39286,PCI-DSS|1.1.2,Rule-ID|SV-51102r1_rule,STIG-ID|GEN005570-ESXI5-000115"
  info        : "If a system has no default gateway defined, the system is at increased risk of man-in-the-middle, monitoring, and Denial-of-Service attacks. NOTE that IPv6 is not enabled by default."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "The following fix text applies only if the system uses IPv6. From the vSphere Client/vCenter; click on the 'Configuration' tab; click on 'Networking'; click on 'Standard Switch/Properties'; click on 'Management NetworkProperties/Edit/IP Settings'. Select 'Use the following IP settings'; fill in the field(s) (at a minimum, the default gateway IP Address is required) per the local site requirements and click 'OK'."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN005900-ESXI5-00891 - The nosuid option must be enabled on all NFS client mounts"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39423,PCI-DSS|2.2.2,Rule-ID|SV-51281r1_rule,STIG-ID|GEN005900-ESXI5-00891"
  info        : "Enabling the nosuid mount option prevents the system from granting owner or group owner privileges to programs with the suid or sgid bit set. If the system does not restrict this access, users with unprivileged access to the local system may be able to acquire privileged access by executing setuid or setgid files located on the mounted NFS file system."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host. Edit /etc/fstab and add the nosuid option for all NFS file systems."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "GEN007840-ESXI5-000119 - The DHCP client must be disabled if not needed"
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CCI|CCI-000366,CSF|PR.IP-1,CSF|PR.PT-3,Group-ID|V-39287,ITSG-33|CM-7,NIAv2|SS15a,PCI-DSS|2.2.2,Rule-ID|SV-51103r1_rule,STIG-ID|GEN007840-ESXI5-000119,SWIFT-CSCv1|2.3"
  info        : "DHCP allows for the unauthenticated configuration of network parameters on the system by exchanging information with a DHCP server."
  solution    : "From the vSphere Client/vCenter, click on the 'Configuration' tab; click on 'Networking'; click on 'Standard Switch/Properties'; click on 'Management NetworkProperties/Edit/IP Settings'; select 'Use the following IP settings'; fill in the IPAddress fields per local site requirements and click 'OK'."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:network/audit:vnic/audit:spec/audit:ip/audit:dhcp\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - DHCP Enabled : <xsl:value-of select=\"audit:propSet/audit:val/audit:network/audit:vnic/audit:spec/audit:ip/audit:dhcp\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>DHCP Enabled : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "DHCP Enabled : "
  not_expect  : "DHCP Enabled : True"
</custom_item>

<report type:"WARNING">
  description : "GEN007841-ESXI5-000120 - Wireless network adapters must be disabled."
  reference   : "CAT|II,CCI|CCI-001443,CCI|CCI-001444,CCI|CCI-002418,Group-ID|V-73127,Rule-ID|SV-87779r1_rule,STIG-ID|GEN007841-ESXI5-000120"
  info        : "The use of wireless networking can introduce many different attack vectors into the organization's network. Common attack vectors such as malicious association and ad hoc networks will allow an attacker to spoof a wireless access point (AP), allowing validated systems to connect to the malicious AP and enabling the attacker to monitor and record network traffic. These malicious APs can also serve to create a man-in-the-middle attack or be used to create a denial of service to valid network resources."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Configure the system to disable all wireless network interfaces."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN008460-ESXI5-000121 - The system must have USB disabled unless needed"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39288,PCI-DSS|2.2.2,Rule-ID|SV-51104r1_rule,STIG-ID|GEN008460-ESXI5-000121"
  info        : "USB is a common computer peripheral interface. USB devices may include storage devices that could be used to install malicious software on a system or exfiltrate data."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To modify hardware enabled options: Interrupt the host computer's boot process and enter the BIOS menu. Inspect the menu option for USB device connectivity. Disable USB"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN008480-ESXI5-000122 - The system must have USB Mass Storage disabled unless needed"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39289,PCI-DSS|2.2.2,Rule-ID|SV-51105r1_rule,STIG-ID|GEN008480-ESXI5-000122"
  info        : "USB is a common computer peripheral interface. USB devices may include storage devices that could be used to install malicious software on a system or exfiltrate data."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To modify hardware enabled options: Interrupt the host computer's boot process and enter the BIOS menu. Inspect the menu option for USB mass storage connectivity. Disable USB mass storage connectivity"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN008500-ESXI5-000123 - The system must have IEEE 1394 (Firewire) disabled unless needed"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39291,PCI-DSS|2.2.2,Rule-ID|SV-51107r1_rule,STIG-ID|GEN008500-ESXI5-000123"
  info        : "Firewire is a common computer peripheral interface. Firewire devices may include storage devices that could be used to install malicious software on a system or exfiltrate data."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To modify hardware enabled options: Interrupt the host computer's boot process and enter the BIOS menu. Inspect the menu option for IEEE 1394 device connectivity. Disable IEEE 1394"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN008600-ESXI5-000050 - The system must be configured to only boot from the system boot device"
  reference   : "CAT|I,CCI|CCI-000366,Group-ID|V-39384,PCI-DSS|2.2.2,Rule-ID|SV-51242r1_rule,STIG-ID|GEN008600-ESXI5-000050"
  info        : "The ability to boot from removable media is the same as being able to boot into single user or maintenance mode without a password. This ability could allow a malicious user to boot the system and perform changes possibly compromising or damaging the system. It could also allow the system to be used for malicious purposes by a malicious anonymous user."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Note: Checking a system's BIOS is vendor and hardware dependent. To ensure media boot options: Interrupt the host computer's boot process and enter the BIOS menu. Inspect the menu option for boot order. Remove all boot media options except for ESXi. Save the change and exit to verify the boot cycle."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN008640-ESXI5-000055 - The system must not use removable media as the boot loader"
  reference   : "CAT|I,CCI|CCI-000366,Group-ID|V-39277,PCI-DSS|2.2.2,Rule-ID|SV-51093r1_rule,STIG-ID|GEN008640-ESXI5-000055"
  info        : "Malicious users with removable boot media can gain access to a system configured to use removable media as the boot loader."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To ensure media boot options: Interrupt the host computer's boot process and enter the BIOS menu. Inspect the menu option for boot order. Remove all boot media options except for ESXi-v5. Save the change and exit to verify the boot cycle"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "GEN008680-ESXI5-000056 - If the system boots from removable media, it must be stored in a safe or similarly secured container"
  reference   : "CAT|I,CCI|CCI-000366,Group-ID|V-39428,PCI-DSS|2.2.2,Rule-ID|SV-51286r1_rule,STIG-ID|GEN008680-ESXI5-000056"
  info        : "Storing the boot loader on removable media in an insecure location could allow a malicious user to modify the systems boot instructions or boot to an insecure operating system."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Store the system boot media in a secure container when not in use"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000023-ESXI5 - The SSH daemon must be configured with the Department of Defense (DoD) logon banner"
  reference   : "CAT|II,CCI|CCI-000048,Group-ID|V-39394,PCI-DSS|2.2.2,Rule-ID|SV-51252r2_rule,STIG-ID|SRG-OS-000023-ESXI5"
  info        : "Failure to display the DoD logon banner prior to a log in attempt will negate legal proceedings resulting from unauthorized access to system resources."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Configure the /etc/issue (or otherwise configured) SSHD banner file in order to display one of the DoD login banners (based on the character limitations imposed by the system) prior to any local login attempt. DoD Login Banners: You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only. By using this IS (which includes any device attached to this IS), you consent to the following conditions: -The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to, penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE), and counterintelligence (CI) investigations. -At any time, the USG may inspect and seize data stored on this IS. -Communications using, or data stored on, this IS are not private, are subject to routine monitoring, interception, and search, and may be disclosed or used for any USG-authorized purpose. -This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not for your personal benefit or privacy. -Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching or monitoring of the content of privileged communications, or work product, related to personal representation or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work product are private and confidential. See User Agreement for details. OR I've read & consent to terms in IS user agreem't."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000027-ESXI5 - The SSH daemon must limit connections to a single session"
  reference   : "CAT|II,CCI|CCI-000054,Group-ID|V-39253,PCI-DSS|2.2.2,Rule-ID|SV-51069r2_rule,STIG-ID|SRG-OS-000027-ESXI5"
  info        : "The SSH protocol has the ability to provide multiple sessions over a single connection without reauthentication. A compromised client could use this feature to establish additional sessions to a system without consent or knowledge of the user."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/ssh/sshd_config

Add/modify the attribute line entry to the following (quotes for emphasis only):
'MaxSessions 1'

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000033-ESXI5 - The operating system must use cryptography to protect the confidentiality of remote access sessions"
  reference   : "CAT|I,CCI|CCI-000068,Group-ID|V-39411,PCI-DSS|2.2.2,Rule-ID|SV-51269r1_rule,STIG-ID|SRG-OS-000033-ESXI5"
  info        : "Remote network access is accomplished by leveraging common communication protocols and establishing a remote connection. These connections will occur over the public Internet. Remote access is any access to an organizational information system by a user (or an information system) communicating through an external, non-organization-controlled network (e.g., the Internet). Examples of remote access methods include dial-up, broadband, and wireless. Using cryptography ensures confidentiality of the remote access connections."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Edit the SSH daemon configuration and add/modify the 'Protocol' configuration for Protocol 2 only.
 vi /etc/ssh/sshd_config"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000056-ESXI5 - The system must use time sources local to the enclave"
  reference   : "CAT|II,CCI|CCI-000160,Group-ID|V-39254,PCI-DSS|2.2.2,Rule-ID|SV-51070r1_rule,STIG-ID|SRG-OS-000056-ESXI5"
  info        : "A synchronized system clock is critical for the enforcement of time-based policies and the correlation of logs and audit records with other systems. The network architecture should provide multiple time servers (at least two) within an enclave providing local service to the enclave and synchronize with time sources outside of the enclave."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "From the vSphere Client: Select the host and click 'Configuration >> Time Configuration'. Select the properties link and chose 'Options'. From the General tab start the NTP service and select 'Start and stop with host'. From the NTP Settings tab click the 'Add' button to add NTP server(s) local to the enclave."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000069-ESXI5 - The system must require that passwords contain at least one uppercase alphabetic character"
  reference   : "CAT|II,CCI|CCI-000192,Group-ID|V-39255,PCI-DSS|8.5.11,Rule-ID|SV-51071r1_rule,STIG-ID|SRG-OS-000069-ESXI5"
  info        : "To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated. The use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host and ensure the expected settings of the 'min' keyword are configured in the /etc/pam.d/passwd file.
 vi /etc/pam.d/passwd
 Set the 'N4' password complexity field to '14' or greater and set the 'N0' thru 'N3' fields to 'disabled', ie: min=disabled,disabled,disabled,disabled,14"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000070-ESXI5 - The system must require passwords contain at least one lowercase alphabetic character (V-39256)"
  reference   : "CAT|II,CCI|CCI-000193,Group-ID|V-39256,PCI-DSS|8.5.11,Rule-ID|SV-51072r1_rule,STIG-ID|SRG-OS-000070-ESXI5"
  info        : "To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated. The use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host and ensure the expected settings of the 'min' keyword are configured in the /etc/pam.d/passwd file.
 vi /etc/pam.d/passwd
 Set the 'min' keyword's 'N4' flag password complexity field to '14' or greater and set the 'N0' thru 'N3' flag fields to 'disabled', ie: min=disabled,disabled,disabled,disabled,14"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000071-ESXI5 - The system must require that passwords contain at least one numeric character"
  reference   : "CAT|II,CCI|CCI-000194,Group-ID|V-39258,PCI-DSS|8.5.11,Rule-ID|SV-51074r1_rule,STIG-ID|SRG-OS-000071-ESXI5"
  info        : "To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated. The use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host and ensure the expected settings of the 'min' keyword are configured in the /etc/pam.d/passwd file.
 vi /etc/pam.d/passwd
 Set the 'N4' password complexity field to '14' or greater and set the 'N0' thru 'N3' fields to 'disabled', ie: min=disabled,disabled,disabled,disabled,14"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000072-ESXI5 - System must require at least 4 characters changed between old and new passwords during a password change"
  reference   : "CAT|II,CCI|CCI-000195,Group-ID|V-39259,PCI-DSS|8.5.12,Rule-ID|SV-51075r1_rule,STIG-ID|SRG-OS-000072-ESXI5"
  info        : "To ensure password changes are effective in their goals, the system must ensure old and new passwords have significant differences. Without significant changes, new passwords may be easily guessed based on the value of a previously compromised password."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host and ensure the expected settings of the 'min' keyword are configured in the /etc/pam.d/passwd file.
 vi /etc/pam.d/passwd
 Set the 'similar' keyword complexity field to 'deny', ie: similar=deny"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000077-ESXI5 - The system must prohibit the reuse of passwords within five iterations"
  reference   : "CAT|II,CCI|CCI-000200,Group-ID|V-39261,PCI-DSS|8.5.12,Rule-ID|SV-51077r2_rule,STIG-ID|SRG-OS-000077-ESXI5"
  info        : "If a user, or root, used the same password continuously or was allowed to change it back shortly after being forced to change it to something else, it would provide a potential intruder with the opportunity to keep guessing at one user's password until it was guessed correctly."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Temporarily disable Lockdown Mode and enable the ESXi Shell via the vSphere Client. Open the vSphere/VMware Infrastructure (VI) Client and log in with appropriate credentials. If connecting to vCenter Server, click on the desired host. Click the Configuration tab. Click Software, Security Profile, Services, Properties, ESXi Shell and Options, respectively. Start the ESXi Shell service, where/as required. 'remember' is an option to pam_unix.so.
As root, log in to the host and modify the 'remember' keyword value, example: 'remember=5'.
# vi /etc/pam.d/passwd

Re-enable Lockdown Mode on the host."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000078-ESXI5 - The system must require that passwords contain a minimum of 14 characters"
  reference   : "CAT|II,CCI|CCI-000205,Group-ID|V-39262,PCI-DSS|8.5.10,Rule-ID|SV-51078r1_rule,STIG-ID|SRG-OS-000078-ESXI5"
  info        : "The use of longer passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques by increasing the password search space."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host and ensure the expected settings of the 'min' keyword are configured in the /etc/pam.d/passwd file.
 vi /etc/pam.d/passwd
 Set the 'N4' password complexity field to '14' or greater and set the 'N0' thru 'N3' fields to 'disabled', ie: min=disabled,disabled,disabled,disabled,14"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000080-ESXI5 - BIOS or system controllers supporting password protection must have admin accounts configured, and no others"
  reference   : "CAT|II,CCI|CCI-000213,Group-ID|V-39264,PCI-DSS|8.5,Rule-ID|SV-51080r1_rule,STIG-ID|SRG-OS-000080-ESXI5"
  info        : "A system's BIOS or system controller handles the initial startup of a system and its configuration must be protected from unauthorized modification. When the BIOS or system controller supports the creation of user accounts or passwords, such protections must be used and accounts/passwords only assigned to system administrators. Failure to protect BIOS or system controller settings could result in Denial-of-Service or compromise of the system resulting from unauthorized configuration changes."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "On systems with a BIOS or system controller, set the supervisor or administrator password"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000090-ESXI5 - The system must verify the integrity of the installation media before installing ESXi"
  reference   : "CAT|I,CCI|CCI-000352,Group-ID|V-39387,PCI-DSS|9.6,Rule-ID|SV-51245r1_rule,STIG-ID|SRG-OS-000090-ESXI5"
  info        : "Any changes to the hardware, software, and/or firmware components of the information system and/or application can potentially have significant effects on the overall security of the system. Accordingly, software defined by the organization as critical software must be signed with a certificate that is recognized and approved by the organization."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "If the hash returned from the md5sum or sha1sum commands do not match the vendor's hash, the downloaded software must be discarded. If the physical media is obtained from VMware and the security seal is broken, the software must be returned to VMware for replacement"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000092-ESXI5 - The system must enable lockdown mode to restrict remote access"
  reference   : "CAT|II,CCI|CCI-000371,Group-ID|V-39385,PCI-DSS|2.2.3,Rule-ID|SV-51243r2_rule,STIG-ID|SRG-OS-000092-ESXI5"
  info        : "Enabling lockdown prevents all API-based access by the accounts to the ESXi host. Enabling lockdown mode disables all remote access to ESXi machines.

There are some operations, such as backup and troubleshooting that require direct access to the host. In these cases Lockdown Mode can be disabled on a temporary basis for specific hosts as needed, and then re-enabled when the task is completed. Lockdown restricts access to the ESXi console to the root user only, requiring non-root users access the host through vSphere Client/vCenter where RBAC and logging can be used to restrict and log activity. By forcing all interaction to occur through vCenter Server, the risk of someone inadvertently attaining elevated privileges or performing tasks that are not properly audited is greatly reduced.

Note:  Lockdown mode does not apply to root users who log in using authorized keys. When an authorized key file is used for root user authentication, root users are not prevented from accessing a host with SSH even when the host is in lockdown mode. Use of an authorized key file for root must therefore be disallowed."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "To enable Lockdown mode on an ESXi host managed by a vCenter Server, log in directly the ESXi host as root. Open the DCUI on the host. Press F2 for Initial Setup. Toggle the Configure Lockdown Mode setting and configure Lockdown Mode"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000095-ESXI5 - Inetd and xinetd must be disabled or removed if no network services utilizing them are enabled"
  reference   : "CAT|I,CCI|CCI-000381,Group-ID|V-39386,PCI-DSS|2.2.4,Rule-ID|SV-51244r2_rule,STIG-ID|SRG-OS-000095-ESXI5"
  info        : "Unnecessary services should be disabled to decrease the attack surface of the system."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Temporarily disable Lockdown Mode and enable the ESXi Shell via the vSphere Client. Open the vSphere/VMware Infrastructure (VI) Client and log in with appropriate credentials. If connecting to vCenter Server, click on the desired host. Click the Configuration tab. Click Software, Security Profile, Services, Properties, ESXi Shell and Options, respectively. Start the ESXi Shell service, where/as required.

As root, log in to the ESXi Shell and edit the /var/run/inetd.conf file. Comment (do not remove) any service line entries that cannot be accounted for.

Re-enable Lockdown Mode on the host."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000104-ESXI5 - All accounts must be assigned unique User Identification Numbers (UIDs)"
  reference   : "CAT|II,CCI|CCI-000764,Group-ID|V-39389,PCI-DSS|7.1.4,Rule-ID|SV-51247r1_rule,STIG-ID|SRG-OS-000104-ESXI5"
  info        : "Accounts sharing a UID have full access to each others' files. This has the same effect as sharing a login. There is no way to assure identification, authentication, and accountability because the system sees them as the same user. If the duplicate UID is 0, this gives potential intruders another privileged account to attack."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Modify user accounts to provide unique UIDs for each account. From the vSphere Client/vCenter: Click on the 'Users and Groups' tab. Click on the 'Users' button Right click and select 'Add'. Specify the desired User Name, Password, etc and Click 'OK'"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000109-ESXI5 - The system must not permit root logins using remote access programs, such as SSH"
  reference   : "CAT|II,CCI|CCI-000770,Group-ID|V-39391,PCI-DSS|2.2.3,Rule-ID|SV-51249r2_rule,STIG-ID|SRG-OS-000109-ESXI5"
  info        : "Even though communications are encrypted, an additional layer of security may be gained by extending the policy of not logging directly on as root. In addition, logging in with a user-specific account preserves the audit trail."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "This step assumes that root access to the system is available via the vSphere Client/vCenter Server, local availability via the DCUI, or that remote systems are accessible at the remote site via touch labor by an authorized (root) user.
Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/ssh/sshd_config

Add/modify the attribute line entry to the following (quotes for emphasis only):
'PermitRootLogin no'

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000112-ESXI5 - The SSH daemon must be configured to only use the SSHv2 protocol"
  reference   : "CAT|I,CCI|CCI-000774,Group-ID|V-39412,PCI-DSS|2.2.2,Rule-ID|SV-51270r1_rule,STIG-ID|SRG-OS-000112-ESXI5"
  info        : "SSHv1 is not a DoD-approved protocol and has many well-known vulnerability exploits. Exploits of the SSH daemon could provide immediate root access to the system. Permanent not a finding - v2 is used."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Edit the SSH daemon configuration and add/modify the 'Protocol' configuration for Protocol 2 only.
 vi /etc/ssh/sshd_config"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000113-ESXI5 - The OS must use org-defined replay-resistant auth mechanisms for network access to non-privileged accounts"
  reference   : "CAT|I,CCI|CCI-000776,Group-ID|V-39413,PCI-DSS|2.2.2,Rule-ID|SV-51271r2_rule,STIG-ID|SRG-OS-000113-ESXI5"
  info        : "An authentication process resists replay attacks if it is impractical to achieve a successful authentication by recording and replaying a previous authentication message. Techniques used to address this include protocols using challenges (e.g., TLS, WS_Security), time synchronous, or challenge-response one-time authenticators."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode.
Enable the ESXi Shell.

Edit the SSH client configuration and add/modify the 'Protocol' configuration for Protocol 2 only.
# vi /etc/ssh/ssh_config

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000120-ESXI5 - Password hashes stored on the system must be generated using FIPS 140-2 approved crypto hashing algorithm"
  reference   : "CAT|II,CCI|CCI-000803,Group-ID|V-39260,PCI-DSS|8.5.11,Rule-ID|SV-51076r1_rule,STIG-ID|SRG-OS-000120-ESXI5"
  info        : "Systems must employ cryptographic hashes for passwords using the SHA-2 family of algorithms or FIPS 140-2 approved successors. The use of unapproved algorithms may result in weak password hashes more vulnerable to compromise."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Temporarily disable Lockdown Mode and enable the ESXi Shell via the vSphere Client. Open the vSphere/VMware Infrastructure (VI) Client and log in with appropriate credentials. If connecting to vCenter Server, click on the desired host. Click the Configuration tab. Click Software, Security Profile, Services, Properties, ESXi Shell and Options, respectively. Start the ESXi Shell service, where/as required. As root, log in to the host and verify the expected setting is configured in the /etc/pam.d/system-auth file. The entry format will look similar to 'password sufficient /lib/security/$ISA/pam_unix.so use_authtok nullok shadow'. Edit the file and replace the existing hash key ( md5, des, or sha256) with sha512 or append sha512, if there is no existing key. For example: 'password sufficient /lib/security/$ISA/pam_unix.so use_authtok nullok shadow sha512'. Re-enable Lockdown Mode on the host"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000121-ESXI5 - All accounts on the system must have unique user or account names"
  reference   : "CAT|II,CCI|CCI-000804,Group-ID|V-39388,PCI-DSS|7.1.4,Rule-ID|SV-51246r1_rule,STIG-ID|SRG-OS-000121-ESXI5"
  info        : "A unique user name is the first part of the identification and authentication process. If user names are not unique, there can be no accountability on the system for auditing purposes. Multiple accounts sharing the same name could result in the Denial-of-Service to one or both of the accounts or unauthorized access to files or privileges."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Change user account names, or delete accounts, so each account has a unique name. From the vSphere Client/vCenter: Click on the 'Users and Groups' tab. Click on the 'Users' button. Right click and select 'Add'. Specify the desired User Name, Password, etc and Click 'OK'"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-000126-ESXI5 - System must set a timeout for the ESXi Shell to disable idle sessions after a predetermined period"
  reference   : "800-171|3.1.11,800-53|AC-12,CAT|II,CCI|CCI-000879,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv6|16.4,Group-ID|V-39392,HIPAA|164.312(a)(2)(iii),ITSG-33|AC-12,NIAv2|NS49,PCI-DSSv3.1|12.3.8,PCI-DSSv3.1|8.1.8,PCI-DSSv3.2|12.3.8,PCI-DSSv3.2|8.1.8,PCI-DSS|8.5.15,Rule-ID|SV-51250r2_rule,STIG-ID|SRG-OS-000126-ESXI5"
  info        : "The ESXiShellTimeout setting is the number of seconds that can elapse before a logon occurs after the ESXi Shell is enabled. After the timeout period, if a logon has not occurred, the shell is disabled. Leaving the shell enabled unnecessarily increases the potential for someone to gain privileged access to the host."
  solution    : "From the vSphere client select the host and click 'Configuration >> Advanced Settings'. Select UserVars.ESXiShellTimeOut parameter and configure it to a value not to exceed 900 seconds (15 minutes). A value of 0 disables the ESXi Shell timeout."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ESXiShellTimeOut']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ESXiShellTimeOut']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ESXiShellTimeOut']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>UserVars.ESXiShellTimeout : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "UserVars\.ESXiShellTimeout : "
  expect      : "UserVars\.ESXiShellTimeout : ([1-9]|[1-9][0-9]|[1-8][0-9][0-9]|900)$"
</custom_item>

<report type:"WARNING">
  description : "SRG-OS-000132-ESXI5 - vSphere management traffic must be on a restricted network"
  reference   : "CAT|II,CCI|CCI-001082,Group-ID|V-39393,PCI-DSS|1.1.3,Rule-ID|SV-51251r1_rule,STIG-ID|SRG-OS-000132-ESXI5"
  info        : "The vSphere management network provides access to the vSphere management interface on each component. Services running on the management interface provide an opportunity for an attacker to gain privileged access to the systems. Any remote attack most likely would begin with gaining entry to this network."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "The vSphere management port group should be in a dedicated VLAN on a common vSwitch. The vSwitch can be shared with production (virtual machine) traffic, as long as the vSphere management port group's VLAN is not used by production virtual machines. As root (or using a different administrator Active Directory account), from the vSphere Client/vCenter, select the host; select the Configuration tab; then select Hardware/Networking. Select switch Properties for the Management Network NIC, and select the Ports tab. If any virtual machine traffic is found in the port list, create another vSwitch and migrate either the Management Port group or virtual machine traffic to a different vSwitch. Under the Configuration tab, select the Add Networking wizard, select either the Virtual Machine or VMkernel radio button, click Next and follow the directions for selecting the remaining switch type and connection settings based on the local system's hardware"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000144-ESXI5 - The OS must monitor/control communications at external boundary of the IS and at key internal boundaries"
  reference   : "CAT|II,CCI|CCI-001097,Group-ID|V-39397,PCI-DSS|1.1.3,PCI-DSS|2.2.2,Rule-ID|SV-51255r1_rule,STIG-ID|SRG-OS-000144-ESXI5"
  info        : "Unrestricted access to services running on an ESXi host can exposes a host to outside attacks and unauthorized access. Reduce the risk by configuring the ESXi firewall to allow access from authorized networks only."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "For each host, from the vSphere client, select the host and go to 'Configuration >> Security Profile'. In the 'Firewall' section select 'Properties'. For each enabled service, (e.g., ssh, vSphere Web Access, http client), select 'Firewall', select 'Only allow connections from the following networks', and provide a range of authorized IP addresses"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-000145-ESXI5 - System must be configured with a default gateway for IPv4 if the system uses IPv4, unless the system is a router"
  reference   : "800-171|3.1.3,800-53|AC-4,CAT|II,CCI|CCI-001098,CSF|DE.AE-1,CSF|ID.AM-3,CSF|PR.AC-4,CSF|PR.AC-5,CSF|PR.DS-5,CSF|PR.PT-4,Group-ID|V-39395,ITSG-33|AC-4,PCI-DSS|1.1.2,Rule-ID|SV-51253r1_rule,STIG-ID|SRG-OS-000145-ESXI5"
  info        : "If a system has no default gateway defined, the system is at increased risk of man-in-the-middle, monitoring, and Denial-of-Service attacks."
  solution    : "From the vSphere Client/vCenter, click on the Configuration tab; click on DNS and Routing; click on Properties/DNS and Routing, Configuration/Routing. Add a default gateway (IP address is required). Click 'OK'."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:network/audit:ipRouteConfig/audit:defaultGateway\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - Default Gateway : <xsl:value-of select=\"audit:propSet/audit:val/audit:network/audit:ipRouteConfig/audit:defaultGateway\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Default Gateway : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  not_expect  : "Default Gateway : NOT configured"
</custom_item>

<report type:"WARNING">
  description : "SRG-OS-000147-ESXI5 - OS, at managed interfaces, must deny network traffic by default and must allow network traffic by exception"
  reference   : "CAT|II,CCI|CCI-001109,Group-ID|V-39398,PCI-DSS|1.1.3,PCI-DSS|2.2.2,Rule-ID|SV-51256r1_rule,STIG-ID|SRG-OS-000147-ESXI5"
  info        : "Unrestricted access to services running on an ESXi host can exposes a host to outside attacks and unauthorized access. Reduce the risk by configuring the ESXi firewall to allow access from authorized networks only."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "For each host, from the vSphere client, select the host and go to 'Configuration >> Security Profile'. In the 'Firewall' section select 'Properties'. For each enabled service, (e.g., ssh, vSphere Web Access, http client), select 'Firewall', select 'Only allow connections from the following networks', and provide a range of authorized IP addresses"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000152-ESXI5 - The OS must implement host-based boundary protection mechanisms for servers, workstations, and mobile devices"
  reference   : "CAT|II,CCI|CCI-001118,Group-ID|V-39396,PCI-DSS|1.1.3,PCI-DSS|2.2.2,Rule-ID|SV-51254r1_rule,STIG-ID|SRG-OS-000152-ESXI5"
  info        : "Unrestricted access to services running on an ESXi host can exposes a host to outside attacks and unauthorized access. Reduce the risk by configuring the ESXi firewall to allow access from authorized networks only."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "For each host, from the vSphere client, select the host and go to 'Configuration >> Security Profile'. In the 'Firewall' section select 'Properties'. For each enabled service, (e.g., ssh, vSphere Web Access, http client), select 'Firewall', select 'Only allow connections from the following networks', and provide a range of authorized IP addresses"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000157-ESXI5 - The SSH client must be configured to not use CBC-based ciphers"
  reference   : "CAT|II,CCI|CCI-001127,Group-ID|V-39402,PCI-DSS|2.2.2,Rule-ID|SV-51260r2_rule,STIG-ID|SRG-OS-000157-ESXI5"
  info        : "The Cipher-Block Chaining (CBC) mode of encryption as implemented in the SSHv2 protocol is vulnerable to chosen plain text attacks and must not be used."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode.
Enable the ESXi Shell.

Edit the SSH client configuration and add/modify the 'Ciphers' configuration (examples of disallowed ciphers:  aes128-cbc, aes192-cbc, aes256-cbc, arcfour256blowfish-cbc, cast128-cbc, 3des-cbc).
# vi /etc/ssh/ssh_config

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000158-ESXI5 - SSH client must be configured to only use Message Authentication Codes (MACs) with FIPS 140-2 approved crypto"
  reference   : "CAT|II,CCI|CCI-001128,Group-ID|V-39403,PCI-DSS|2.2.2,Rule-ID|SV-51261r3_rule,STIG-ID|SRG-OS-000158-ESXI5"
  info        : "DoD information systems are required to use FIPS 140-2 approved cryptographic hash functions."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/ssh/ssh_config

Add/modify the attribute line entry to the following (quotes for emphasis only):
'MACs <hmac-sha1 or hmac-sha2 variant(s)>'
The above list 'may' include any number of the following (current) comma-separated variants: hmac-sha1, hmac-sha1-96, hmac-sha2-256, hmac-sha2-256-96, hmac-sha2-512, hmac-sha2-512-96.

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000159-ESXI5 - The SSH client must be configured to only use FIPS 140-2 approved ciphers"
  reference   : "CAT|II,CCI|CCI-001129,Group-ID|V-39404,PCI-DSS|2.2.2,Rule-ID|SV-51262r2_rule,STIG-ID|SRG-OS-000159-ESXI5"
  info        : "DoD information systems are required to use FIPS 140-2 approved ciphers. SSHv2 ciphers meeting this requirement are 3DES and AES."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode.
Enable the ESXi Shell.

Edit the SSH client configuration and add/modify the 'Ciphers' configuration (example: 3des-ctr, aes128-ctr, aes192-ctr, aes256-ctr).

# vi /etc/ssh/ssh_config

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-000163-ESXI5 - OS must terminate the connection at the end of the session or after an org-defined time period of inactivity"
  reference   : "800-171|3.1.11,800-53|AC-12,CAT|II,CCI|CCI-001133,CN-L3|7.1.2.2(d),CN-L3|7.1.3.7(b),CN-L3|8.1.4.1(b),CSCv6|16.4,Group-ID|V-39405,HIPAA|164.312(a)(2)(iii),ITSG-33|AC-12,NIAv2|NS49,PCI-DSSv3.1|12.3.8,PCI-DSSv3.1|8.1.8,PCI-DSSv3.2|12.3.8,PCI-DSSv3.2|8.1.8,PCI-DSS|8.5.15,Rule-ID|SV-51263r2_rule,STIG-ID|SRG-OS-000163-ESXI5"
  info        : "If ESXi Shell is enabled on the host and a user neglects to initiate an SSH session the idle connection will remain available indefinitely increasing the potential for someone to gain privileged access to the host."
  solution    : "From the vSphere client select the host and click 'Configuration >> Advanced Settings'. Select UserVars.ESXiShellTimeOut parameter and configure it to a value not to exceed 900 seconds (15 minutes). A value of 0 disables the ESXi Shell timeout."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ESXiShellTimeOut']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ESXiShellTimeOut']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ESXiShellTimeOut']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>UserVars.ESXiShellTimeout : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "UserVars\.ESXiShellTimeout : "
  expect      : "UserVars\.ESXiShellTimeout : ([1-9]|[1-9][0-9]|[1-8][0-9][0-9]|900)$"
</custom_item>

<report type:"WARNING">
  description : "SRG-OS-000193-ESXI5 - The Image Profile and VIB Acceptance Levels must be verified"
  reference   : "CAT|I,CCI|CCI-001239,Group-ID|V-39407,PCI-DSS|9.6,Rule-ID|SV-51265r1_rule,STIG-ID|SRG-OS-000193-ESXI5"
  info        : "The ESXi Image profile supports four acceptance levels:
 (1) VMwareCertified - VIBs created, tested and signed by VMware
 (2) VMwareAccepted - VIBs created by a VMware partner but tested and signed by VMware
 (3) PartnerSupported - VIBs created, tested and signed by a certified VMware partner
 (4) CommunitySupported - VIBs that have not been tested by VMware or a VMware partner
 Community Supported VIBs are not supported and do not have a digital signature. An unsigned VIB represents untested code installed on an ESXi host. To protect the security and integrity of an ESXi host, unsigned (CommunitySupported) VIBs must not be installed."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host and set the host acceptance level to at least 'PartnerSupported' by running the command:
 esxcli software acceptance set --<level>"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-000197-ESXI5 - Remote logging for ESXi hosts must be configured"
  reference   : "800-171|3.3.8,800-53|AU-9,CAT|II,CCI|CCI-001265,CSF|PR.PT-1,Group-ID|V-39408,ITSG-33|AU-9,PCI-DSSv3.1|10.5.3,PCI-DSSv3.1|10.5.4,PCI-DSSv3.2|10.5.3,PCI-DSSv3.2|10.5.4,PCI-DSS|10.5.3,Rule-ID|SV-51266r1_rule,STIG-ID|SRG-OS-000197-ESXI5"
  info        : "Remote logging to a central log host provides a secure, centralized store for ESXi logs. By gathering host log files onto a central host it can more easily monitor all hosts with a single tool. It can also do aggregate analysis and searching to look for such things as coordinated attacks on multiple hosts. Logging to a secure, centralized log server also helps prevent log tampering and also provides a long-term audit record."
  info        : "Update LOG_HOST to the appropriate value for the local environment"
  solution    : "Step 1: Verify the vSphere Syslog Collector syslog host has been configured. If not, install/enable the vSphere Syslog Collector.
 Step 2: From the vSphere Client: Select the host and click 'Configuration >> Advanced Settings >> Syslog >> Global'.
 Step 3: Set 'Syslog.global.logHost' to the syslog server hostname."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:value/text()\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Syslog.global.logHost : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog\.global\.logHost : "
# Note: Variable @LOG_HOST@ replaced with "192\\.168\\.0\\.1" in field "expect".
  expect      : "Syslog\.global\.logHost : 192\\.168\\.0\\.1"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-000215-ESXI5 - The OS must back up audit records on an org-defined frequency onto a different system or media"
  reference   : "800-171|3.3.8,800-53|AU-9,CAT|II,CCI|CCI-001348,CSF|PR.PT-1,Group-ID|V-39409,ITSG-33|AU-9,PCI-DSSv3.1|10.5.3,PCI-DSSv3.1|10.5.4,PCI-DSSv3.2|10.5.3,PCI-DSSv3.2|10.5.4,PCI-DSS|10.5.3,Rule-ID|SV-51267r1_rule,STIG-ID|SRG-OS-000215-ESXI5"
  info        : "Remote logging to a central log host provides a secure, centralized store for ESXi logs. By gathering host log files onto a central host it can more easily monitor all hosts with a single tool. It can also do aggregate analysis and searching to look for such things as coordinated attacks on multiple hosts. Logging to a secure, centralized log server also helps prevent log tampering and also provides a long-term audit record."
  info        : "Update LOG_HOST to the appropriate value for the local environment"
  solution    : "Step 1: Verify the vSphere Syslog Collector syslog host has been configured. If not, install/enable the vSphere Syslog Collector.
 Step 2: From the vSphere Client: Select the host and click 'Configuration >> Advanced Settings >> Syslog >> Global'.
 Step 3: Set 'Syslog.global.logHost' to the syslog server hostname."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:value/text()\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Syslog.global.logHost : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog\.global\.logHost : "
# Note: Variable @LOG_HOST@ replaced with "192\\.168\\.0\\.1" in field "expect".
  expect      : "Syslog\.global\.logHost : 192\\.168\\.0\\.1"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-000217-ESXI5 - OS must protect audit records of non-local access to privileged accounts and execution of privileged functions"
  reference   : "800-171|3.3.8,800-53|AU-9,CAT|II,CCI|CCI-001352,CSF|PR.PT-1,Group-ID|V-39410,ITSG-33|AU-9,PCI-DSSv3.1|10.5.3,PCI-DSSv3.1|10.5.4,PCI-DSSv3.2|10.5.3,PCI-DSSv3.2|10.5.4,PCI-DSS|10.5.3,Rule-ID|SV-51268r1_rule,STIG-ID|SRG-OS-000215-ESXI5"
  info        : "Remote logging to a central log host provides a secure, centralized store for ESXi logs. By gathering host log files onto a central host it can more easily monitor all hosts with a single tool. It can also do aggregate analysis and searching to look for such things as coordinated attacks on multiple hosts. Logging to a secure, centralized log server also helps prevent log tampering and also provides a long-term audit record."
  info        : "Update LOG_HOST to the appropriate value for the local environment"
  solution    : "Step 1: Verify the vSphere Syslog Collector syslog host has been configured. If not, install/enable the vSphere Syslog Collector.
 Step 2: From the vSphere Client: Select the host and click 'Configuration >> Advanced Settings >> Syslog >> Global'.
 Step 3: Set 'Syslog.global.logHost' to the syslog server hostname."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:value/text()\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logHost']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Syslog.global.logHost : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog\.global\.logHost : "
# Note: Variable @LOG_HOST@ replaced with "192\\.168\\.0\\.1" in field "expect".
  expect      : "Syslog\.global\.logHost : 192\\.168\\.0\\.1"
</custom_item>

<report type:"WARNING">
  description : "SRG-OS-000231-ESXI5 - The operating system must enforce requirements for remote connections to the information system"
  reference   : "CAT|II,CCI|CCI-000066,Group-ID|V-39399,PCI-DSS|1.1.3,PCI-DSS|2.2.2,Rule-ID|SV-51257r1_rule,STIG-ID|SRG-OS-000231-ESXI5"
  info        : "Unrestricted access to services running on an ESXi host can exposes a host to outside attacks and unauthorized access. Reduce the risk by configuring the ESXi firewall to allow access from authorized networks only."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "For each host, from the vSphere client, select the host and go to 'Configuration >> Security Profile'. In the 'Firewall' section select 'Properties'. For each enabled service, (e.g., ssh, vSphere Web Access, http client), select 'Firewall', select 'Only allow connections from the following networks', and provide a range of authorized IP addresses."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000248-ESXI5 - There must be no .rhosts or hosts.equiv files on the system"
  reference   : "CAT|I,CCI|CCI-001436,Group-ID|V-39252,PCI-DSS|2.2.2,Rule-ID|SV-51068r1_rule,STIG-ID|SRG-OS-000248-ESXI5"
  info        : "The .rhosts or hosts.equiv files are used to configure host-based authentication for individual users or the system. Host-based authentication is not sufficient for preventing unauthorized access to the system."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Remove the file(s):
 rm -f /etc/hosts.equiv
 rm -f <user's home directory>/.rhosts"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000250-ESXI5 - SSH daemon must be configured to only use Message Authentication Codes (MACs) with FIPS 140-2 approved crypto"
  reference   : "CAT|I,CCI|CCI-001453,Group-ID|V-39415,PCI-DSS|2.2.2,Rule-ID|SV-51273r2_rule,STIG-ID|SRG-OS-000250-ESXI5"
  info        : "DoD information systems are required to use FIPS 140-2 approved cryptographic hash functions."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Disable lock down mode. Enable the ESXi Shell. Execute the following command(s):
# vi /etc/ssh/sshd_config

Add/modify the attribute line entry to the following (quotes for emphasis only):
'MACs <hmac-sha1 or hmac-sha2 variant(s)>'
The above list 'may' include any number of the following (current) comma-separated variants: hmac-sha1, hmac-sha1-96, hmac-sha2-256, hmac-sha2-256-96, hmac-sha2-512, hmac-sha2-512-96.

Re-enable lock down mode."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-000266-ESXI5 - The system must require that passwords contain at least one special character"
  reference   : "CAT|II,CCI|CCI-001619,Group-ID|V-39416,PCI-DSS|8.5.11,Rule-ID|SV-51274r1_rule,STIG-ID|SRG-OS-000266-ESXI5"
  info        : "To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated. The use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host and ensure the expected settings of the 'min' keyword are configured in the /etc/pam.d/passwd file.
 vi /etc/pam.d/passwd
 Set the 'N4' password complexity field to '14' or greater and set the 'N0' thru 'N3' fields to 'disabled', ie: min=disabled,disabled,disabled,disabled,14"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-99999-ESXI5-000131 - NTP time synchronization must be configured"
  reference   : "800-171|3.3.7,800-53|AU-8(1),CAT|II,CCI|CCI-000366,CSCv6|6.1,CSF|PR.PT-1,Group-ID|V-39292,ISO/IEC-27001|A.12.4.4,ITSG-33|AU-8(1),NESA|T3.6.7,NIAv2|NS44,NIAv2|NS45,NIAv2|NS46,NIAv2|NS47,PCI-DSSv3.1|10.4,PCI-DSSv3.2|10.4,PCI-DSS|1.1.3,PCI-DSS|2.2.2,Rule-ID|SV-51108r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000131"
  info        : "By ensuring that all systems use the same relative time source (including the relevant localization offset), and that the relative time source can be correlated to an agreed-upon time standard (such as Coordinated Universal Time-UTC), it can make it simpler to track and correlate an intruder's actions when reviewing the relevant log files. Incorrect time settings can make it difficult to inspect and correlate log files to detect attacks, and can make auditing inaccurate."
  info        : "Update NTP_SERVER to the appropriate value for the local environment"
  solution    : "From the vSphere Client: Select the host and click 'Configuration >> Time Configuration'. Select the properties link and chose 'Options'. From the General tab start the NTP service and select 'Start and stop with host'. From the NTP Settings tab click the 'Add' button to add the organization-defined NTP servers"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:dateTimeInfo/audit:ntpConfig/audit:server\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - NTP Server : <xsl:value-of select=\"audit:propSet/audit:val/audit:dateTimeInfo/audit:ntpConfig/audit:server\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>NTP Server : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "NTP Server : "
# Note: Variable @NTP_SERVER@ replaced with "0\\.us\\.pool\\.ntp\\.org" in field "expect".
  expect      : "NTP Server : 0\\.us\\.pool\\.ntp\\.org"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-99999-ESXI5-000132 - Persistent logging for all ESXi hosts must be configured"
  reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,CAT|II,CCI|CCI-000366,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,Group-ID|V-39293,ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12,PCI-DSS|10.5.4,Rule-ID|SV-51109r2_rule,STIG-ID|SRG-OS-99999-ESXI5-000132,TBA-FIISB|45.1.1"
  info        : "ESXi can be configured to store log files on an in-memory file system. This occurs when the host's '/scratch' directory is linked to '/tmp/scratch'. When this is done only a single day's worth of logs are stored at any time, in addition, log files will be reinitialized upon each reboot. This presents a security risk as user activity logged on the host is only stored temporarily and will not persistent across reboots. This can also complicate auditing and make it harder to monitor events and diagnose issues. ESXi host logging should always be configured to a persistent datastore.

Note: ESXi automatically creates a persistent 4 GB Fat16 scratch partition on the local target device during installation. If space is not available, ESXi will store temporary data on a space constrained ramdisk. As ramdisk data does not persist across reboots, log and core files will be lost. Syslog.global.logDir points to a location on a local or remote datastore (and path) where log files can be saved to. The format [DatastoreName] DirectoryName/Filename maps to /vmfs/volumes/DatastoreName/DirectoryName/Filename. The [DatastoreName] is case sensitive and if the specified DirectoryName does not exist, it will be created. If the datastore path field is blank, logs are stored in their default location."
  solution    : "From the vSphere Client, select the ESXi hosts and click 'Configuration >> Advanced Settings >> Syslog >> global' and specify a known, persistent datastore for 'Syslog.global.logDir'"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logDir']/audit:value/text()\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logDir']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Syslog.global.logDir']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Syslog.global.logDir : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Syslog\.global\.logDir : "
  not_expect  : "Syslog\.global\.logDir : /tmp/scratch"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-99999-ESXI5-000135 - The system must disable DCUI to prevent local administrative control"
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CCI|CCI-000366,CSF|PR.IP-1,CSF|PR.PT-3,Group-ID|V-39294,ITSG-33|CM-7,NIAv2|SS15a,PCI-DSS|8.5.16,Rule-ID|SV-51110r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000135,SWIFT-CSCv1|2.3"
  info        : "The DCUI allows for low-level host configuration, such as configuring IP address, hostname, and root password, as well as diagnostic capabilities, such as enabling the ESXi shell, viewing log files, restarting agents, and resetting configurations. Actions performed from the DCUI are not tracked by vCenter Server. Even if Lockdown Mode is enabled, someone with the root password can perform administrative tasks in the DCUI bypassing RBAC and auditing controls provided through vCenter. DCUI access can be disabled. Disabling it prevents all local activity and thus forces actions to be performed in vCenter Server where they can be centrally audited and monitored."
  solution    : "From the vSphere Client, select the host and select 'Configuration >> Security Profile'. In the services section select 'Properties'. Select 'Direct Console UI' and click 'Options'. From the pop-up stop the DCUI service and set the startup policy to 'start and stop manually'"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='DCUI']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='DCUI']/audit:label\"/> : running = <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='DCUI']/audit:running\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Direct Console UI : running = NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Direct Console UI : running ="
  expect      : "Direct Console UI : running = False"
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-99999-ESXI5-000136 - The system must disable ESXi Shell unless needed for diagnostics or troubleshooting"
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CCI|CCI-000366,CSF|PR.IP-1,CSF|PR.PT-3,Group-ID|V-39295,ITSG-33|CM-7,NIAv2|SS15a,PCI-DSS|2.2.2,Rule-ID|SV-51111r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000136,SWIFT-CSCv1|2.3"
  info        : "The ESXi Shell is an interactive command line environment available locally from the DCUI or remotely via SSH. Activities performed from the ESXi Shell bypass vCenter RBAC and audit controls. The ESXi shell should only be turned on when needed to troubleshoot/resolve problems that cannot be fixed through the vSphere client."
  solution    : "From the vSphere Client, select the host then select 'Configuration >> Security Profiles'. In the Services section select 'Properties'. Select the 'ESXi Shell' and click Options. Stop the ESXi Shell and select the option to 'Start and stop manually'"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM']/audit:label\"/> : running = <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM']/audit:running\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>ESXi Shell : running = NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "ESXi Shell : running ="
  expect      : "ESXi Shell : running = False"
</custom_item>

<report type:"WARNING">
  description : "SRG-OS-99999-ESXI5-000137 - The system must disable the Managed Object Browser (MOB)"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39296,PCI-DSS|2.2.2,Rule-ID|SV-51112r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000137"
  info        : "The Managed Object Browser (MOB) provides a way to explore the object model used by the VMkernel to manage the host and enables configurations to be changed as well. This interface is meant to be used primarily for debugging the vSphere SDK, but because there are no access controls it could also be used as a method obtain information about a host being targeted for unauthorized access."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the ESXi Shell and disable the MOB.
 vim-cmd proxysvc/remove_service '/mob' 'httpsWithRedirect'."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-99999-ESXI5-000138 - The system must disable SSH"
  reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CAT|II,CCI|CCI-000366,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,Group-ID|V-39390,ITSG-33|CM-7,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSS|2.2.2,Rule-ID|SV-51248r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000138,SWIFT-CSCv1|2.3"
  info        : "The ESXi Shell is an interactive command line interface (CLI) available at the ESXi server console. The ESXi shell provides temporary access to commands essential for server maintenance. Intended primarily for use in break-fix scenarios, the ESXi shell is well suited for checking and modifying configuration details, not always generally accessible, using the vSphere Client. The ESXi shell is accessible remotely using SSH. Under normal operating conditions, SSH access to the host must be disabled. As with the ESXi shell, SSH is also intended only for temporary use during break-fix scenarios, and must be disabled under normal operating conditions. Remote access to the host must therefore be limited to the vSphere Client at all other times."
  solution    : "From the vSphere Client, select the host then select 'Configuration >> Security Profiles'. In the Services section select 'Properties'. Select the 'SSH' and click Options. Configure the SSH option to 'Start and stop manually'"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM-SSH']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM-SSH']/audit:label\"/> : running = <xsl:value-of select=\"audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:service/audit:service[audit:key='TSM-SSH']/audit:running\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>SSH : running = NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "TSM-SSH : running ="
  expect      : "TSM-SSH : running = False"
</custom_item>

<report type:"WARNING">
  description : "SRG-OS-99999-ESXI5-000139 - The system must not provide root/admin level access to CIM-based hardware monitor tools or other 3rd party apps"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39297,PCI-DSS|7.1.1,Rule-ID|SV-51113r2_rule,STIG-ID|SRG-OS-99999-ESXI5-000139"
  info        : "The CIM system provides an interface that enables hardware-level management from remote applications via a set of standard APIs. Create a limited-privilege, read-only service account for CIM. Place the CIM account into the 'root' group. When/where write access is required, create/enable a limited-privilege, service account and grant only the minimum required privileges. CIM accounts should be limited to the 'Host >> Config >> System Management' and 'Host >> CIM >> CIMInteraction' privileges."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "From the vSphere client, select the ESXi host; go to 'Local Users and Groups'. Create a limited-privileged, read-only service account for CIM. Place the CIM account into the 'root' group. Select Users and right-click in the user screen. Select 'Add', then Add a new user. If write access is required only grant the minimum required privileges. CIM accounts should be limited to the 'Host > Config > System Management' and 'Host > CIM > CIMInteraction' privileges"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-99999-ESXI5-000141 - The system must enable bidirectional CHAP authentication for iSCSI traffic"
  reference   : "800-53|IA-3(1),CAT|III,CCI|CCI-000366,CSF|PR.AC-1,Group-ID|V-39298,ITSG-33|IA-3(1),NESA|T5.4.3,PCI-DSS|4.1,Rule-ID|SV-51114r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000141"
  info        : "When enabled, vSphere performs bidirectional authentication of both the iSCSI target and host. There is a potential for a MiTM attack, when not authenticating both the iSCSI target and host, in which an attacker might impersonate either side of the connection to steal data. Bidirectional authentication mitigates this risk."
  solution    : "In the vSphere Client, select the host, and then choose: Configuration >> Storage Adaptors >> iSCSI Initiator Properties >> CHAP >> CHAP (Target Authenticates Host). Select 'Use Chap', and configure the 'Name' and 'Secret' options"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"//audit:returnval/audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:storageDevice/audit:hostBusAdapter[contains (@xsi:type,'InternetScsi')]\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval/audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:storageDevice/audit:hostBusAdapter[contains (@xsi:type,'InternetScsi')]\">"
  xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:device\"/>) - chapAuthEnabled : <xsl:value-of select=\"audit:authenticationProperties/audit:chapAuthEnabled\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"//audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>No iSCSI devices found</xsl:text><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:template>"
  regex       : "chapAuthEnabled : "
  not_expect  : "chapAuthEnabled : False"
</custom_item>

<custom_item>
  type        : AUDIT_VCENTER
  description : "SRG-OS-99999-ESXI5-000143 - The system must enable SSL for NFC"
  reference   : "800-171|3.13.8,800-53|SC-8,CAT|III,CCI|CCI-000366,CSF|PR.DS-2,CSF|PR.DS-5,Group-ID|V-39299,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8,PCI-DSS|4.1,Rule-ID|SV-51115r2_rule,STIG-ID|SRG-OS-99999-ESXI5-000143,TBA-FIISB|29.1"
  info        : "NFC (Network File Copy) is used to migrate or clone a VM between two ESXi hosts over the network. By default, SSL is used only for the authentication of the transfer, but SSL must also be enabled on the data transfer. Without this setting VM contents could potentially be sniffed if the management network is not adequately isolated and secured."
  solution    : "From the vSphere client select 'Administration >> vCenter Server Settings >> Advanced Settings'. Set 'config.nfc.useSSL = true'"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:val[@xsi:type='ArrayOfOptionValue']\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:OptionValue[audit:key='config.nfc.useSSL']\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:OptionValue[audit:key='VirtualCenter.InstanceName']/audit:value\"/> - <xsl:value-of select=\"audit:OptionValue[audit:key='config.nfc.useSSL']/audit:key\"/> : <xsl:value-of select=\"audit:OptionValue[audit:key='config.nfc.useSSL']/audit:value\"/>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:OptionValue[audit:key='VirtualCenter.InstanceName']/audit:value\"/> - <xsl:text>config.nfc.useSSL : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "config\.nfc\.useSSL : "
  not_expect  : "config\.nfc\.useSSL : FALSE"
</custom_item>

<if>
  <condition type:"AND">
    <custom_item>
      type        : AUDIT_VCENTER
      description : "SRG-OS-99999-ESXI5-000144 - The system must ensure proper SNMP configuration"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:OptionValue[contains (audit:key,'snmp.receiver') and contains (audit:key,'.enabled') and contains (audit:value,'true')]\">"
      xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val/audit:OptionValue[contains (audit:key,'snmp.receiver') and contains (audit:key,'.enabled') and contains (audit:value,'true')]\">"
      xsl_stmt    : "<xsl:value-of select=\"../../../audit:propSet/audit:val/audit:OptionValue[audit:key='VirtualCenter.InstanceName']/audit:value\"/> - <xsl:value-of select=\"audit:key\"/> : <xsl:value-of select=\"audit:value\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "snmp\.receiver\.([Xx]|[0-9]+)\.enabled : "
      expect      : "snmp\.receiver\.([Xx]|[0-9]+)\.enabled : True"
    </custom_item>
  </condition>

  <then>
    <custom_item>
      type        : AUDIT_VCENTER
      description : "SRG-OS-99999-ESXI5-000144 - The system must ensure proper SNMP configuration - 'community name public does not exist'"
      reference   : "800-171|3.5.2,800-53|IA-5,CAT|II,CCI|CCI-000366,CN-L3|7.1.2.7(d),CN-L3|8.1.4.1(a),CSF|PR.AC-1,Group-ID|V-39417,HIPAA|164.308(a)(5)(ii)(D),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,NESA|T5.2.1,NESA|T5.2.3,NESA|T5.5.2,NESA|T5.5.3,PCI-DSS|2.1,Rule-ID|SV-51275r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000144"
      info        : "If SNMP is not being used, it must remain disabled. If it is being used, the proper trap destination must be configured. If SNMP is not properly configured, monitoring information can be sent to a malicious host that can then use this information to plan an attack. SNMP must be configured on each ESXi host using Power/v CLI. vSphere PowerCLI is a command line tool used to automate vSphere management. PowerCLI is distributed as a Windows PowerShell snapin, and includes 300+ PowerShell cmdlets and use documentation."
      solution    : "If SNMP is not being used, configure 'enabled' = 0. From the Power/v CLI, execute 'vicfg-snmp.pl --server <server_name> -D'.
   If SNMP is being used, ensure the community name is configured:
   From the vSphere CLI, type 'vicfg-snmp.pl --server hostname --username <username> --password <password> -c <community_name>'.
   To enable SNMP from the vSphere CLI, type.
   vicfg-snmp.pl --server <hostname> --username <username> --password <password> --enable"
      see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:OptionValue[contains (audit:key,'snmp.receiver') and contains (audit:key,'.community') and contains (audit:value,'public')]\">"
      xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val/audit:OptionValue[contains (audit:key,'snmp.receiver') and contains (audit:key,'.community') and contains (audit:value,'public')]\">"
      xsl_stmt    : "<xsl:value-of select=\"../../../audit:propSet/audit:val/audit:OptionValue[audit:key='VirtualCenter.InstanceName']/audit:value\"/> - <xsl:value-of select=\"audit:key\"/> : <xsl:value-of select=\"audit:value\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "snmp\.receiver\.[0-9]+\.community : "
      not_expect  : "snmp\.receiver\.[0-9]+\.community : [Pp][Uu][Bb][Ll][Ii][Cc]"
    </custom_item>

    <custom_item>
      type        : AUDIT_VCENTER
      description : "SRG-OS-99999-ESXI5-000144 - The system must ensure proper SNMP configuration - 'community name private does not exist'"
      reference   : "800-171|3.5.2,800-53|IA-5,CAT|II,CCI|CCI-000366,CN-L3|7.1.2.7(d),CN-L3|8.1.4.1(a),CSF|PR.AC-1,Group-ID|V-39417,HIPAA|164.308(a)(5)(ii)(D),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,NESA|T5.2.1,NESA|T5.2.3,NESA|T5.5.2,NESA|T5.5.3,PCI-DSS|2.1,Rule-ID|SV-51275r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000144"
      info        : "If SNMP is not being used, it must remain disabled. If it is being used, the proper trap destination must be configured. If SNMP is not properly configured, monitoring information can be sent to a malicious host that can then use this information to plan an attack. SNMP must be configured on each ESXi host using Power/v CLI. vSphere PowerCLI is a command line tool used to automate vSphere management. PowerCLI is distributed as a Windows PowerShell snapin, and includes 300+ PowerShell cmdlets and use documentation."
      solution    : "If SNMP is not being used, configure 'enabled' = 0. From the Power/v CLI, execute 'vicfg-snmp.pl --server <server_name> -D'.
   If SNMP is being used, ensure the community name is configured:
   From the vSphere CLI, type 'vicfg-snmp.pl --server hostname --username <username> --password <password> -c <community_name>'.
   To enable SNMP from the vSphere CLI, type.
   vicfg-snmp.pl --server <hostname> --username <username> --password <password> --enable"
      see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:OptionValue[contains (audit:key,'snmp.receiver') and contains (audit:key,'.community') and contains (audit:value,'public')]\">"
      xsl_stmt    : "<xsl:for-each select=\"audit:propSet/audit:val/audit:OptionValue[contains (audit:key,'snmp.receiver') and contains (audit:key,'.community') and contains (audit:value,'public')]\">"
      xsl_stmt    : "<xsl:value-of select=\"../../../audit:propSet/audit:val/audit:OptionValue[audit:key='VirtualCenter.InstanceName']/audit:value\"/> - <xsl:value-of select=\"audit:key\"/> : <xsl:value-of select=\"audit:value\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:template>"
      regex       : "snmp\.receiver\.[0-9]+\.community : "
      not_expect  : "snmp\.receiver\.[0-9]+\.community : [Pp][Rr][Ii][Vv][Aa][Tt][Ee]"
    </custom_item>
  </then>
</if>

<custom_item>
  type        : AUDIT_VCENTER
  description : "SRG-OS-99999-ESXI5-000145 - The system must ensure the vpxuser auto-password change meets policy"
  reference   : "800-171|3.5.10,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-53|IA-5,CAT|II,CCI|CCI-000366,CIP|007-6-R5,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,Group-ID|V-39300,HIPAA|164.308(a)(5)(ii)(D),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,PCI-DSSv3.1|8.2.4,PCI-DSSv3.2|8.2.4,PCI-DSS|8.5.9,Rule-ID|SV-51116r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000145,TBA-FIISB|26.2.2"
  info        : "By default, the vpxuser password will be automatically changed by vCenter every 30 days. Ensure this setting meets your policies; if not, configure to meet password aging policies. NOTE: It is very important the password aging policy not be shorter than the default interval that is set to automatically change the vpxuser password, to preclude the possibility that vCenter might get locked out of an ESXi host."
  solution    : "From the vSphere client select 'Administration >> vCenter Server Settings >> Advanced Settings'. Set the 'VirtualCenter.VimPasswordExpirationInDays' to 60 or less. Note that it is strongly recommended that this value not be changed from '30'"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:val[@xsi:type='ArrayOfOptionValue']\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:OptionValue[audit:key[text()='config.VirtualCenter.VimPasswordExpirationInDays']]/audit:value\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:OptionValue[audit:key='VirtualCenter.InstanceName']/audit:value\"/> - config.VirtualCenter.VimPasswordExpirationInDays : <xsl:value-of select=\"audit:OptionValue[audit:key[text()='config.VirtualCenter.VimPasswordExpirationInDays']]/audit:value\"/>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:OptionValue[audit:key='VirtualCenter.InstanceName']/audit:value\"/> - <xsl:text>config.VirtualCenter.VimPasswordExpirationInDays : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "config.VirtualCenter.VimPasswordExpirationInDays : "
  expect      : "config.VirtualCenter.VimPasswordExpirationInDays : (60|[1-5][0-9]|[0-9])$"
</custom_item>

<custom_item>
  type        : AUDIT_VCENTER
  description : "SRG-OS-99999-ESXI5-000145 - The system must ensure the vpxuser auto-password change meets policy."
  reference   : "800-171|3.5.10,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-53|IA-5,CAT|II,CCI|CCI-000366,CIP|007-6-R5,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,Group-ID|V-39301,HIPAA|164.308(a)(5)(ii)(D),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,PCI-DSSv3.1|8.2.4,PCI-DSSv3.2|8.2.4,PCI-DSS|8.5.9,Rule-ID|SV-51117r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000145,TBA-FIISB|26.2.2"
  info        : "By default, the vpxuser password will be automatically changed by vCenter every 30 days. Ensure this setting meets your policies; if not, configure to meet password aging policies. NOTE: It is very important the password aging policy not be shorter than the default interval that is set to automatically change the vpxuser password, to preclude the possibility that vCenter might get locked out of an ESXi host."
  solution    : "From the vSphere client select 'Administration >> vCenter Server Settings >> Advanced Settings'. Set the 'VirtualCenter.VimPasswordExpirationInDays' to 60 or less. Note that it is strongly recommended that this value not be changed from '30'"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:val[@xsi:type='ArrayOfOptionValue']\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:OptionValue[audit:key[text()='config.VirtualCenter.VimPasswordExpirationInDays']]/audit:value\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:OptionValue[audit:key='VirtualCenter.InstanceName']/audit:value\"/> - config.VirtualCenter.VimPasswordExpirationInDays : <xsl:value-of select=\"audit:OptionValue[audit:key[text()='config.VirtualCenter.VimPasswordExpirationInDays']]/audit:value\"/>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:OptionValue[audit:key='VirtualCenter.InstanceName']/audit:value\"/> - <xsl:text>config.VirtualCenter.VimPasswordExpirationInDays : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "config.VirtualCenter.VimPasswordExpirationInDays : "
  expect      : "config.VirtualCenter.VimPasswordExpirationInDays : (60|[1-5][0-9]|[0-9])$"
</custom_item>

<custom_item>
  type        : AUDIT_VCENTER
  description : "SRG-OS-99999-ESXI5-000146 - The system must ensure the vpxuser password meets length policy"
  reference   : "800-171|3.5.10,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-53|IA-5,CAT|II,CCI|CCI-000366,CIP|007-6-R5,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,Group-ID|V-39302,HIPAA|164.308(a)(5)(ii)(D),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5,PCI-DSSv3.1|8.2.3,PCI-DSSv3.2|8.2.3,PCI-DSS|8.5.10,Rule-ID|SV-51118r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000146,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4"
  info        : "The vpxuser password default length is 32 characters. Ensure this setting meets site policies; if not, configure to meet password length policies. Longer passwords make brute-force password attacks more difficult. The vpxuser password is added by vCenter, meaning no manual intervention is normally required. The vpxuser password length must never be modified to less than the default length of 32 characters."
  solution    : "From the vSphere client select 'Administration >> vCenter Server Settings >> Advanced Settings'. Set the 'config.vpxd.hostPasswordLength' to comply with site requirements. Default is 32 characters. Note that the vpxuser password is added by vCenter, meaning no manual intervention is required. The vpxuser password length must never be modified to less than the default length of 32 characters"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:val[@xsi:type='ArrayOfOptionValue']\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:OptionValue[audit:key[text()='config.vpxd.hostPasswordLength']]/audit:value\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:OptionValue[audit:key='VirtualCenter.InstanceName']/audit:value\"/> - config.vpxd.hostPasswordLength : <xsl:value-of select=\"audit:OptionValue[audit:key[text()='config.vpxd.hostPasswordLength']]/audit:value\"/>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:OptionValue[audit:key='VirtualCenter.InstanceName']/audit:value\"/> - <xsl:text>config.vpxd.hostPasswordLength : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "config.vpxd.hostPasswordLength : "
  expect      : "config.vpxd.hostPasswordLength : (3[2-9]|[4-9][0-9]|[1-9][0-9][0-9]+)"
</custom_item>

<if>
  <condition type:"AND">
    <custom_item>
      type        : AUDIT_ESX
      description : "ESXi : enable-chap-auth"
      xsl_stmt    : "<xsl:template match=\"/\">"
      xsl_stmt    : "<xsl:choose>"
      xsl_stmt    : "<xsl:when test=\"//audit:returnval/audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:storageDevice/audit:hostBusAdapter[contains (@xsi:type,'InternetScsi')]\">"
      xsl_stmt    : "<xsl:for-each select=\"//audit:returnval/audit:propSet/audit:val[@xsi:type='HostConfigInfo']/audit:storageDevice/audit:hostBusAdapter[contains (@xsi:type,'InternetScsi')]\">"
      xsl_stmt    : "<xsl:value-of select=\"../../../../audit:propSet[audit:name='name']/audit:val\"/> (<xsl:value-of select=\"audit:device\"/>) - chapAuthEnabled : <xsl:value-of select=\"audit:authenticationProperties/audit:chapAuthEnabled\"/><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:for-each>"
      xsl_stmt    : "</xsl:when>"
      xsl_stmt    : "<xsl:otherwise>"
      xsl_stmt    : "<xsl:value-of select=\"//audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>No iSCSI devices found</xsl:text><xsl:text>&#10;</xsl:text>"
      xsl_stmt    : "</xsl:otherwise>"
      xsl_stmt    : "</xsl:choose>"
      xsl_stmt    : "</xsl:template>"
      regex       : "chapAuthEnabled : "
      expect      : "chapAuthEnabled : True"
    </custom_item>
  </condition>

  <then>
    <report type:"WARNING">
      description : "SRG-OS-99999-ESXI5-000147 - The system must ensure uniqueness of CHAP authentication secrets"
      reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39303,PCI-DSS|4.1,Rule-ID|SV-51119r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000147"
      info        : "The mutual authentication secret for each host must be different and the secret for each client authenticating to the server must be different as well. This ensures if a single host is compromised, an attacker cannot create another arbitrary host and authenticate to the storage device. With a single shared secret, compromise of one host can allow an attacker to authenticate to the storage device."
      info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : "From the vSphere Client, select the host, and then choose: Configuration - Storage Adaptors - iSCSI Initiator Properties - CHAP - CHAP (Target Authenticates Host) - configure the authentication secret"
      see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
    </report>
  </then>
</if>

<report type:"WARNING">
  description : "SRG-OS-99999-ESXI5-000150 - SAN resources must be masked and zoned appropriately"
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-39304,PCI-DSS|1.1.1,Rule-ID|SV-51120r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000150"
  info        : "SAN activity must be segregated via zoning and LUN masking. Use of zoning must also take into account any host groups on the SAN device(s)."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "If SAN devices are used, a vendor-specific procedure must be developed and documented to mask/zone host LUNs"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-99999-ESXI5-000151 - The system must prevent unintended use of dvfilter network APIs"
  reference   : "800-171|3.1.1,800-53|AC-3,CAT|III,CCI|CCI-000366,CN-L3|8.1.10.2(c),CN-L3|8.1.4.11(b),CN-L3|8.1.4.2(f),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-4,CSF|PR.PT-3,Group-ID|V-39346,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,PCI-DSS|2.2.3,Rule-ID|SV-51204r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000151,TBA-FIISB|31.1"
  info        : "If products that use the dvfilter network API are not used, the host should not be configured to send network information to a VM. If the API is enabled, an attacker might attempt to connect a VM to it, thereby potentially providing access to the network of other VMs on the host. If a product uses this API, the host must be verified as being correctly configured."
  solution    : "From the vSphere client select the host and click 'Configuration >> Advanced Settings >> Net' Set the value of Net.DVFilterBindIpAddress to blank if a dvfilter-based network security appliance is not used or (where used) set the value of Net.DVFilterBindIpAddress to match the dvfilter-based network security appliance."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='Net.DVFilterBindIpAddress']/audit:value/text()\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Net.DVFilterBindIpAddress']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Net.DVFilterBindIpAddress']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Net.DVFilterBindIpAddress : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Net\.DVFilterBindIpAddress : "
  expect      : "Net\.DVFilterBindIpAddress : NOT configured"
</custom_item>

<report type:"WARNING">
  description : "SRG-OS-99999-ESXI5-000152 - Keys from SSH authorized_keys file must be removed"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39347,PCI-DSS|3.5.2,Rule-ID|SV-51205r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000152"
  info        : "ESXi hosts come with SSH which can be enabled to allow remote access without requiring user authentication. To enable password free access copy the remote users public key into the '/etc/ssh/keys-root/authorized_keys' file on the ESXi host. The presence of the remote user's public key in the 'authorized_keys' file identifies the user as trusted, meaning the user is granted access to the host without providing a password. Note: Lockdown mode does not apply to root users who log in using authorized keys. When you use an authorized key file for root user authentication, root users are not prevented from accessing a host with SSH even when the host is in lockdown mode."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "As root, log in to the host and zero/remove /etc/ssh/keys-root/authorized_keys file:
 >/etc/ssh/keys-root/authorized_keys
 or
 rm /etc/ssh/keys-root/authorized_keys"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-99999-ESXI5-000154 - The system must use Active Directory for local user authentication"
  reference   : "800-171|3.5.1,800-53|IA-2,CAT|III,CCI|CCI-000366,CN-L3|7.1.3.1(a),CN-L3|7.1.3.1(e),CN-L3|8.1.4.1(a),CN-L3|8.1.4.2(a),CN-L3|8.5.4.1(a),CSF|PR.AC-1,Group-ID|V-39348,ITSG-33|IA-2,NESA|T2.3.8,NESA|T5.3.1,NESA|T5.4.2,NESA|T5.5.1,NESA|T5.5.2,NESA|T5.5.3,NIAv2|AM14b,NIAv2|AM2,NIAv2|AM8,PCI-DSS|7.1.4,Rule-ID|SV-51206r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000154,TBA-FIISB|35.1,TBA-FIISB|36.1"
  info        : "Creating local user accounts on each host presents challenges with having to synchronize account names and passwords across multiple hosts. Join ESXi hosts to an Active Directory domain to eliminate the need to create and maintain local user accounts. Using Active Directory for user authentication simplifies the ESXi host configuration and reduces the risk for configuration issues that could lead to unauthorized access. Note that when adding ESXi hosts to Active Directory, if the group 'ESX Admins' exists, all user/group accounts assigned to the group will have full administrative access to the host."
  solution    : "Perform the following steps to configure the ESXi host to use Active Directory:
 (1) Log into the ESXi host using the vSphere Client and authenticating with the root account (or an equivalent account).
 (2) Select the ESXi host from the inventory and click the Configuration tab.
 (3) From the Software section, select Authentication Services.
 (4) Click Properties in the upper-right corner.
 (5) From the Directory Services Configuration dialog box, select Active Directory from the Select Directory Service Type drop-down list.
 (6) Supply the DNS domain name of the Active Directory domain this ESXi host will use for authentication.
 (7) Click the Join Domain button.
 (8) Specify a username and password that has permission to allow the host to join the domain.
 Once the ESXi host is joined to Active Directory, users will be able to authenticate to an ESXi host using their Active Directory credentials. Using the vSphere Client or the vCLI, users can use either the domain\username or username@domain syntax."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ActiveDirectoryPreferredDomainControllers']/audit:value/text()\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ActiveDirectoryPreferredDomainControllers']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='UserVars.ActiveDirectoryPreferredDomainControllers']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>UserVars.ActiveDirectoryPreferredDomainControllers : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "UserVars\.ActiveDirectoryPreferredDomainControllers : "
  expect      : ""
</custom_item>

<custom_item>
  type        : AUDIT_ESX
  description : "SRG-OS-99999-ESXI5-000155 - Active Directory ESX Admin group membership must be verified unused"
  reference   : "800-171|3.1.5,800-53|AC-6,CAT|III,CCI|CCI-000366,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.10.6(a),CN-L3|8.1.4.2(d),CSCv6|5.1,CSF|PR.AC-4,CSF|PR.DS-5,Group-ID|V-39349,ISO/IEC-27001|A.9.2.3,ITSG-33|AC-6,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSS|7.1.2,Rule-ID|SV-51207r1_rule,STIG-ID|SRG-OS-99999-ESXI5-000155,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
  info        : "When adding ESXi hosts to Active Directory, if the group 'ESX Admins' exists, all user/group accounts assigned to the group will have full administrative access to the host. Discretion should be used when managing membership to the 'ESX Admins' group."
  solution    : "From the vSphere Client/vCenter, select the host, then Configuration >> Software/Advanced Settings >> HostAgent.
 Change the 'Config.HostAgent.plugins.hostsvc.esxAdminsGroup' to a pre-defined group other than the default 'ESX Admins'.
 Note: The new administrator group must have been previously defined on the Active Directory server."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:option[audit:key='Config.HostAgent.plugins.hostsvc.esxAdminsGroup']/audit:value/text()\">"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Config.HostAgent.plugins.hostsvc.esxAdminsGroup']/audit:key\"/> : <xsl:value-of select=\"audit:propSet/audit:val/audit:option[audit:key='Config.HostAgent.plugins.hostsvc.esxAdminsGroup']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:value-of select=\"audit:propSet[audit:name='name']/audit:val\"/> - <xsl:text>Config.HostAgent.plugins.hostsvc.esxAdminsGroup : NOT configured</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
  regex       : "Config\.HostAgent\.plugins\.hostsvc\.esxAdminsGroup : "
  not_expect  : "ESX Admins"
</custom_item>

<report type:"WARNING">
  description : "SRG-OS-99999-ESXI5-000156 - The contents of exposed configuration files must be verified"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39350,PCI-DSS|2.2.2,Rule-ID|SV-51208r2_rule,STIG-ID|SRG-OS-99999-ESXI5-000156"
  info        : "Although most configurations on ESXi are controlled via an API, there are a limited set of configuration files that are used directly to govern host behavior. These specific files are exposed via the vSphere HTTPS-based file transfer API. Any changes to these files should be correlated with an approved administrative action, such as an authorized configuration change. Tampering with these files has the potential to enable unauthorized access to the host configuration and virtual machines. WARNING: do not attempt to monitor files that are NOT exposed via this file-transfer API, since this can result in a destabilized system."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Temporarily disable Lockdown Mode and enable the ESXi Shell via the vSphere Client.

Open the vSphere/VMware Infrastructure (VI) Client and log in with appropriate credentials.
If connecting to vCenter Server, click on the desired host.
Click the Configuration tab.
Click Software, Security Profile, Services, Properties, ESXi Shell, and Options, respectively.
Start the ESXi Shell service, where/as required.

As root, log in to the host and run the following command(s):

Determine if the MOB is enabled.
# vim-cmd proxysvc/service_list

If enabled, disable the MOB with the following command.
# vim-cmd proxysvc/remove_service '/mob' 'httpsWithRedirect'

NOTE: Some third-party tools use MOB to gather information. Testing should be done after disabling the MOB to verify third-party applications are still functioning as expected. To re-enable the MOB:
# vim-cmd proxysvc/add_np_service '/mob' 'httpsWithRedirect'.

Re-enable Lockdown Mode on the host."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-99999-ESXI5-000158 - Unauthorized kernel modules must not be loaded on the host"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39351,PCI-DSS|2.2.2,Rule-ID|SV-51209r2_rule,STIG-ID|SRG-OS-99999-ESXI5-000158"
  info        : "VMware provides digital signatures for kernel modules.  By default the ESXi host does not permit loading of kernel modules that lack a valid digital signature.  However, this behavior can be overridden allowing unauthorized kernel modules to be loaded.  Untested or  malicious kernel modules loaded onto an ESXi host can put the host at risk for instability and/or exploitation. The ESXi host must be monitored for unsigned kernel modules."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Temporarily disable Lockdown Mode and enable the ESXi Shell via the vSphere Client. Open the vSphere/VMware Infrastructure (VI) Client and log in with appropriate credentials. If connecting to vCenter Server, click on the desired host. Click the Configuration tab. Click Software, Security Profile, Services, Properties, ESXi Shell, and Options, respectively. Start the ESXi Shell service, where/as required. As root, log in to and secure the host by individually disabling unsigned modules and removing the offending VIBs from the host. Note that in order to disable kernel modules, from the vSphere Client, VMs must first be evacuated and the host must then be placed into maintenance mode.
# esxcli system modules set -e false -m <module>
Re-enable Lockdown Mode on the host."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-99999-ESXI5-000160 - The system must use the vSphere Auth Proxy to protect passwords when adding ESXi hosts to Active Directory"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39352,PCI-DSS|7.1.4,Rule-ID|SV-51210r2_rule,STIG-ID|SRG-OS-99999-ESXI5-000160"
  info        : "ESXi hosts configured to join an Active Directory domain using host profiles do not protect the passwords used for host authentication. To avoid transmitting clear text passwords, the vSphere Authentication Proxy must be used to configure hosts in an Active Directory."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "From the vSphere client, select 'Host Profiles'. Right click the Host Profile and select Edit. Choose 'Authentication configuration >> Active Directory Configuration >> Join Domain Method'. Set the Join Domain Method to 'Use vSphere Authentication Proxy to add the host to domain'"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

<report type:"WARNING">
  description : "SRG-OS-99999-ESXI5-000161 - The system must zero out VMDK files prior to deletion"
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-39353,PCI-DSS|9.10.2,Rule-ID|SV-51211r2_rule,STIG-ID|SRG-OS-99999-ESXI5-000161"
  info        : "The virtual disk must be zeroed prior to deletion in order to prevent sensitive data in VMDK files from being recovered."
  info        : "NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  solution    : "Create and document a procedure to zero sensitive data prior to removal of the vmdk file. Command line interface commands such as vmkfstools, dd, and rm must be used, per the examples below.

vmkfstools --writezeroes <path+vmdk_flat_file>
or
dd if=/dev/zero of=<path+vmdk_flat_file>

Note: The vSphere Client does not automatically zero out a VMDK file when it is destroyed."
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_ESXi5_Server_V1R10_STIG.zip"
</report>

</check_type>
