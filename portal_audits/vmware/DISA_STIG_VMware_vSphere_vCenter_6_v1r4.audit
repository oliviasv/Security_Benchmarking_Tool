#
# This script is Copyright (C) 2004-2020 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
# $Revision: 1.5 $
# $Date: 2020/04/22 $
#
# Description : This .audit is based on the DISA STIG for VMware vSphere vCenter Server for Windows
#               Security Technical Implementation Guide Version 1 Release 4 from content located at:
#               http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip
#
# NOTE : Some queries in this .audit require site-specific data to be known to the query in order to function properly.
#        Please note the following queries and edit their values accordingly.
#
#<ui_metadata>
#<display_name>DISA STIG VMware vSphere vCenter 6.x v1r4</display_name>
#<spec>
#  <type>DISA STIG</type>
#  <name>VMware vSphere vCenter</name>
#  <version>1.4.0</version>
#</spec>
#<labels>vmware,vsphere,vcenter,disa</labels>
#<benchmark_refs>CAT,CCI,Rule-ID,STIG-ID,Vuln-ID,Group-ID</benchmark_refs>
#</ui_metadata>

<check_type:"VMware">

<report type:"PASSED">
  description : "DISA STIG VMware 6 vSphere vCenter Server for Windows Security Technical Implementation Guide Version 1 Release 4"
</report>

<report type:"WARNING">
  description : "VCWN-06-000001 - The system must prohibit password reuse for a minimum of five generations."
  info        : "Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks.   To meet password policy requirements, passwords need to be changed at specific policy-based intervals.   If the information system or application allows the user to consecutively reuse their password when that password has exceeded its defined lifetime, the end result is a password that is not changed as per policy requirements.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000200,Group-ID|V-63149,Rule-ID|SV-77639r1_rule,STIG-ID|VCWN-06-000001"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Administration >> Single Sign-On >> Configuration >> Policies >> Password Policy.

Click 'Edit' and enter '5' into the 'Restrict reuse' setting and click 'OK'."
</report>

<report type:"WARNING">
  description : "VCWN-06-000002 - The system must not automatically refresh client sessions."
  info        : "Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle session will also free up resources committed by the managed network element. Automatic client session refreshes keep unused sessions online, blocking session timeouts.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-001133,Group-ID|V-63943,Rule-ID|SV-78433r1_rule,STIG-ID|VCWN-06-000002"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "You can change the refresh rate value by editing the webclient.properties file.

On the system where vCenter is installed locate the webclient.properties file.

Windows: C:\ProgramData\VMware\vCenterServer\cfg\vsphere-client
Appliance: /etc/vmware/vsphere-client/

Edit the file to include the line 'refresh.rate = -1' where -1 indicates sessions are not automatically refreshed.  Uncomment the line if necessary.

After editing the file the vSphere Web Client service must be restarted."
</report>

<report type:"WARNING">
  description : "VCWN-06-000003 - The system must enforce a 60-day maximum password lifetime restriction."
  info        : "Any password, no matter how complex, can eventually be cracked. Therefore, passwords need to be changed at specific intervals.   One method of minimizing this risk is to use complex passwords and periodically change them. If the application does not limit the lifetime of passwords and force users to change their passwords, there is the risk that the system and/or application passwords could be compromised.   This requirement does not include emergency administration accounts which are meant for access to the application in case of failure. These accounts are not required to have maximum password lifetime restrictions.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000199,Group-ID|V-63945,Rule-ID|SV-78435r1_rule,STIG-ID|VCWN-06-000003"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Administration >> Single Sign-On >> Configuration >> Policies >> Password Policy.  Click 'Edit' and enter '60' into the 'Maximum lifetime' setting and click 'OK'."
</report>

<report type:"WARNING">
  description : "VCWN-06-000004 - The system must terminate management sessions after 10 minutes of inactivity."
  info        : "Terminating an idle session within a short time period reduces the window of opportunity for unauthorized personnel to take control of a management session enabled on the console or console port that has been left unattended. In addition, quickly terminating an idle session will also free up resources committed by the managed network element.   Terminating network connections associated with communications sessions includes, for example, de-allocating associated TCP/IP address/port pairs at the operating system level, or de-allocating networking assignments at the application level if multiple application sessions are using a single, operating system level network connection. This does not mean that the application terminates all sessions or network access; it only ends the inactive session and releases the resources associated with that session.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-001133,Group-ID|V-63947,Rule-ID|SV-78437r1_rule,STIG-ID|VCWN-06-000004"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "You can change the timeout value by editing the webclient.properties file.

On the system where vCenter is installed locate the webclient.properties file.

Windows: C:\ProgramData\VMware\vCenterServer\cfg\vsphere-client
Appliance: /etc/vmware/vsphere-client/

Edit the file to include the line 'session.timeout = 10' where 10 is the timeout value in minutes.  Uncomment the line if necessary.

After editing the file the vSphere Web Client service must be restarted."
</report>

<report type:"WARNING">
  description : "VCWN-06-000005 - The vCenter Server users must have the correct roles assigned."
  info        : "Users and service accounts must only be assigned privileges they require. Least Privilege requires that these privileges must only be assigned if needed, to reduce risk of confidentiality, availability or integrity loss.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-001082,Group-ID|V-63949,Rule-ID|SV-78439r1_rule,STIG-ID|VCWN-06-000005"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "To create a new role with specific permissions do the following:

From the vSphere Web Client go to Administration >> Access Control >> Roles. Click the green plus sign and enter a name for the role and select only the specific permissions required.  Users can then be assigned to the newly created role."
</report>

<report type:"WARNING">
  description : "VCWN-06-000007 - The system must limit the effects of information-flooding types of Denial of Service (DoS) attacks."
  info        : "DoS is a condition when a resource is not available for legitimate users. When this occurs, the organization either cannot accomplish its mission or must operate at degraded capacity.  Managing excess capacity ensures that sufficient capacity is available to counter flooding attacks. Employing increased capacity and service redundancy may reduce the susceptibility to some DoS attacks. Managing excess capacity may include, for example, establishing selected usage priorities, quotas, or partitioning.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-001095,Group-ID|V-63951,Rule-ID|SV-78441r2_rule,STIG-ID|VCWN-06-000007"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Networking >> Select a distributed switch >> Manage >> Settings >> Properties.  In the Properties pane click 'Edit' and change Network I/O Control to enabled.

or

From a PowerCLI command prompt while connected to the vCenter server run the following command:

(Get-VDSwitch 'DVSwitch Name' | Get-View).EnableNetworkResourceManagement($true)"
</report>

<report type:"WARNING">
  description : "VCWN-06-000008 - The system must provide an immediate real-time alert to the SA and ISSO, at a minimum, of all audit failure events."
  info        : "It is critical for the appropriate personnel to be aware if an ESXi host is at risk of failing to process audit logs as required. Without a real-time alert, security personnel may be unaware of an impending failure of the audit capability, and system operation may be adversely affected.  To ensure the appropriate personnel are alerted if an audit failure occurs a vCenter alarm can be created to trigger when an ESXi host can no longer reach its syslog server.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|III,CCI|CCI-000139,Group-ID|V-63953,Rule-ID|SV-78443r1_rule,STIG-ID|VCWN-06-000008"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Client select the vCenter server at the top of the hierarchy and go to >> Alarms >> Definitions >> Right click in the empty space and select New Alarm.  On the General tab provide an alarm name and description, Select Hosts for alarm type and 'Monitor for specific events occurring on this object', check 'Enable this alarm'.  On the Triggers tab click Add and in the event column enter 'esx.problem.vmsyslogd.remote.failure' and click OK.

Note - This alarm will only trigger if syslog is configured for TCP or SSL connections and not UDP."
</report>

<report type:"WARNING">
  description : "VCWN-06-000009 - The system must use Active Directory authentication."
  info        : "The application must ensure users are authenticated with an individual authenticator prior to using a group authenticator.  Using Active Directory for authentication provides more robust account management capabilities.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000770,Group-ID|V-63955,Rule-ID|SV-78445r1_rule,STIG-ID|VCWN-06-000009"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "If the server hosting vCenter is not joined to the domain follow the OS specific procedures to join it to Active Directory.

If local accounts are used for normal operations then Active Directory accounts should be created and used."
</report>

<report type:"WARNING">
  description : "VCWN-06-000010 - The system must limit the use of the built-in SSO administrative account."
  info        : "Use of the SSO administrator account should be limited as it is a shared account and individual accounts must be used wherever possible.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000770,Group-ID|V-63959,Rule-ID|SV-78449r1_rule,STIG-ID|VCWN-06-000010"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "A policy should be developed to limit the use of the built-in SSO administrator account."
</report>

<report type:"WARNING">
  description : "VCWN-06-000012 - The system must disable the distributed virtual switch health check."
  info        : "Network Healthcheck is disabled by default. Once enabled, the healthcheck packets contain information on host#, vds#, port#, which an attacker would find useful. It is recommended that network healthcheck be used for troubleshooting, and turned off when troubleshooting is finished.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-63961,Rule-ID|SV-78451r1_rule,STIG-ID|VCWN-06-000012"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Networking >> Select a distributed switch >> Manage >> Settings >> Health Check. Click the edit button and disable both health checks.

or

From a PowerCLI command prompt while connected to the vCenter server run the following command:

Get-View -ViewType DistributedVirtualSwitch | ?{($_.config.HealthCheckConfig | ?{$_.enable -notmatch 'False'})}| %{$_.UpdateDVSHealthCheckConfig(@((New-Object Vmware.Vim.VMwareDVSVlanMtuHealthCheckConfig -property @{enable=0}),(New-Object Vmware.Vim.VMwareDVSTeamingHealthCheckConfig -property @{enable=0})))}"
</report>

<report type:"WARNING">
  description : "VCWN-06-000013 - The distributed port group Forged Transmits policy must be set to reject."
  info        : "If the virtual machine operating system changes the MAC address, the operating system can send frames with an impersonated source MAC address at any time. This allows an operating system to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network.

When the Forged transmits option is set to Accept, ESXi does not compare source and effective MAC addresses.

To protect against MAC impersonation, you can set the Forged transmits option to Reject. If you do, the host compares the source MAC address being transmitted by the guest operating system with the effective MAC address for its virtual machine adapter to see if they match. If the addresses do not match, the ESXi host drops the packet.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-63963,Rule-ID|SV-78453r2_rule,STIG-ID|VCWN-06-000013"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Client go to Home >> Networking.

Select a distributed port group and click edit and go to security and set 'Forged Transmits' to reject.

or

From a PowerCLI command prompt while connected to the vCenter server run the following commands:

Get-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -ForgedTransmits $false
Get-VDPortgroup | ?{$_.IsUplink -eq $false} | Get-VDSecurityPolicy | Set-VDSecurityPolicy -ForgedTransmits $false"
</report>

<report type:"WARNING">
  description : "VCWN-06-000014 - The system must ensure the distributed port group MAC Address Change policy is set to reject."
  info        : "If the virtual machine operating system changes the MAC address, it can send frames with an impersonated source MAC address at any time. This allows it to stage malicious attacks on the devices in a network by impersonating a network adaptor authorized by the receiving network. This will prevent VMs from changing their effective MAC address. It will affect applications that require this functionality. This will also affect how a layer 2 bridge will operate. This will also affect applications that require a specific MAC address for licensing.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|I,CCI|CCI-000366,Group-ID|V-63965,Rule-ID|SV-78455r1_rule,STIG-ID|VCWN-06-000014"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Client go to Home >> Networking. Select a distributed port group and click edit and go to security and set 'MAC Address Changes' to reject.

or

From a PowerCLI command prompt while connected to the vCenter server run the following commands:

Get-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -MacChanges $false
Get-VDPortgroup | Get-VDSecurityPolicy | Set-VDSecurityPolicy -MacChanges $false"
</report>

<report type:"WARNING">
  description : "VCWN-06-000015 - The system must ensure the distributed port group Promiscuous Mode policy is set to reject."
  info        : "When promiscuous mode is enabled for a virtual switch all virtual machines connected to the Portgroup have the potential of reading all packets across that network, meaning only the virtual machines connected to that Portgroup. Promiscuous mode is disabled by default on the ESXi Server, and this is the recommended setting.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-63967,Rule-ID|SV-78457r1_rule,STIG-ID|VCWN-06-000015"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Client go to Home >> Networking. Select a distributed port group and click edit and go to security and set 'Promiscuous Mode' to reject.

or

From a PowerCLI command prompt while connected to the vCenter server run the following commands:

Get-VDSwitch | Get-VDSecurityPolicy | Set-VDSecurityPolicy -AllowPromiscuous $false
Get-VDPortgroup | Get-VDSecurityPolicy | Set-VDSecurityPolicy -AllowPromiscuous $false"
</report>

<report type:"WARNING">
  description : "VCWN-06-000016 - The system must only send NetFlow traffic to authorized collectors."
  info        : "The distributed virtual switch can export NetFlow information about traffic crossing the switch. NetFlow exports are not encrypted and can contain information about the virtual network making it easier for a MITM attack to be executed successfully. If NetFlow export is required, verify that all NetFlow target IP's are correct.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-63969,Rule-ID|SV-78459r1_rule,STIG-ID|VCWN-06-000016"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "To remove collector IPs do the following:

From the vSphere Web Client go to Networking >> Select a distributed switch >> Manage >> Settings >> NetFlow.  View the NetFlow pane and click edit and remove any unknown collector IPs.

or

From a PowerCLI command prompt while connected to the vCenter server run the following commands:

$dvs = Get-VDSwitch dvswitch | Get-View
ForEach($vs in $dvs){
$spec = New-Object VMware.Vim.VMwareDVSConfigSpec
$spec.configversion = $vs.Config.ConfigVersion
$spec.IpfixConfig = New-Object VMware.Vim.VMwareIpfixConfig
$spec.IpfixConfig.CollectorIpAddress = ''
$spec.IpfixConfig.CollectorPort = '0'
$spec.IpfixConfig.ActiveFlowTimeout = '60'
$spec.IpfixConfig.IdleFlowTimeout = '15'
$spec.IpfixConfig.SamplingRate = '0'
$spec.IpfixConfig.InternalFlowsOnly = $False
$vs.ReconfigureDvs_Task($spec)
}

Note: This will reset the NetFlow collector configuration back to the defaults.

To disable NetFlow on a distributed port group do the following:

From the vSphere Web Client go to Networking >> Select a distributed port group >> Manage >> Settings >> Policies.  Go to Monitoring and change NetFlow to disabled.

or

From a PowerCLI command prompt while connected to the vCenter server run the following commands:

$pgs = Get-VDPortgroup | Get-View
ForEach($pg in $pgs){
$spec = New-Object VMware.Vim.DVPortgroupConfigSpec
$spec.configversion = $pg.Config.ConfigVersion
$spec.defaultPortConfig = New-Object VMware.Vim.VMwareDVSPortSetting
$spec.defaultPortConfig.ipfixEnabled = New-Object VMware.Vim.BoolPolicy
$spec.defaultPortConfig.ipfixEnabled.inherited = $false
$spec.defaultPortConfig.ipfixEnabled.value = $false
$pg.ReconfigureDVPortgroup_Task($spec)
}"
</report>

<report type:"WARNING">
  description : "VCWN-06-000017 - The system must not override port group settings at the port level on distributed switches."
  info        : "Port-level configuration overrides are disabled by default. Once enabled, this allows for different security settings to be set from what is established at the Port-Group level. There are cases where particular VMs require unique configurations, but this should be monitored so it is only used when authorized. If overrides are not monitored, anyone who gains access to a VM with a less secure VDS configuration could surreptitiously exploit that broader access.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-63971,Rule-ID|SV-78461r1_rule,STIG-ID|VCWN-06-000017"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Networking >> Select a distributed port group >> Manage >> Settings >> Properties.  Click Edit and change all Override port policies to disabled.

From a PowerCLI command prompt while connected to the vCenter server run the following commands:

$pgs = Get-VDPortgroup | Get-View
ForEach($pg in $pgs){
$spec = New-Object VMware.Vim.DVPortgroupConfigSpec
$spec.configversion = $pg.Config.ConfigVersion
$spec.Policy = New-Object VMware.Vim.VMwareDVSPortgroupPolicy
$spec.Policy.VlanOverrideAllowed = $False
$spec.Policy.UplinkTeamingOverrideAllowed = $False
$spec.Policy.SecurityPolicyOverrideAllowed = $False
$spec.Policy.IpfixOverrideAllowed = $False
$spec.Policy.BlockOverrideAllowed = $False
$spec.Policy.ShapingOverrideAllowed = $False
$spec.Policy.VendorConfigOverrideAllowed = $False
$spec.Policy.TrafficFilterOverrideAllowed = $False
$spec.Policy.PortConfigResetAtDisconnect = $True
$pg.ReconfigureDVPortgroup_Task($spec)
}"
</report>

<report type:"WARNING">
  description : "VCWN-06-000018 - All port groups must be configured to a value other than that of the native VLAN."
  info        : "ESXi does not use the concept of native VLAN. Frames with VLAN specified in the port group will have a tag, but frames with VLAN not specified in the port group are not tagged and therefore will end up as belonging to native VLAN of the physical switch. For example, frames on VLAN 1 from a Cisco physical switch will be untagged, because this is considered as the native VLAN. However, frames from ESXi specified as VLAN 1 will be tagged with a '1'; therefore, traffic from ESXi that is destined for the native VLAN will not be correctly routed (because it is tagged with a '1' instead of being untagged), and traffic from the physical switch coming from the native VLAN will not be visible (because it is not tagged). If the ESXi virtual switch port group uses the native VLAN ID, traffic from those VMs will not be visible to the native VLAN on the switch, because the switch is expecting untagged traffic.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-63973,Rule-ID|SV-78463r1_rule,STIG-ID|VCWN-06-000018"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Networking >> Select a distributed port group >> Manage >> Settings >> Policies.  Click Edit and under the VLAN section change the VLAN ID to a non-native VLAN and click OK.

or

From a PowerCLI command prompt while connected to the vCenter server run the following command:

Get-VDPortgroup 'portgroup name' | Set-VDVlanConfiguration -VlanId 'New VLAN#'"
</report>

<report type:"WARNING">
  description : "VCWN-06-000019 - All port groups must not be configured to VLAN 4095 unless Virtual Guest Tagging (VGT) is required."
  info        : "When a port group is set to VLAN 4095, this activates VGT mode. In this mode, the vSwitch passes all network frames to the guest VM without modifying the VLAN tags, leaving it up to the guest to deal with them. VLAN 4095 should be used only if the guest has been specifically configured to manage VLAN tags itself. If VGT is enabled inappropriately, it might cause denial-of-service or allow a guest VM to interact with traffic on an unauthorized VLAN.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-63975,Rule-ID|SV-78465r1_rule,STIG-ID|VCWN-06-000019"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "To change the VLAN ID of distributed virtual port groups do the following:

From the vSphere Web Client go to Networking >> Select a distributed port group >> Manage >> Settings >> Policies.  Click Edit and under the VLAN section change the VLAN ID to not be 4095 and click OK.

or

From a PowerCLI command prompt while connected to the vCenter server run the following command:

Get-VDPortgroup 'portgroup name' | Set-VDVlanConfiguration -VlanId 'New VLAN#'"
</report>

<report type:"WARNING">
  description : "VCWN-06-000020 - All port groups must not be configured to VLAN values reserved by upstream physical switches."
  info        : "Certain physical switches reserve certain VLAN IDs for internal purposes and often disallow traffic configured to these values. For example, Cisco Catalyst switches typically reserve VLANs 1001-1024 and 4094, while Nexus switches typically reserve 3968-4047 and 4094. Check with the documentation for your specific switch. Using a reserved VLAN might result in a denial of service on the network.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-63977,Rule-ID|SV-78467r1_rule,STIG-ID|VCWN-06-000020"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Networking >> Select a distributed port group >> Manage >> Settings >> Policies.  Click Edit and under the VLAN section change the VLAN ID to not be a reserved VLAN ID and click OK.

or

From a PowerCLI command prompt while connected to the vCenter server run the following command:

Get-VDPortgroup 'portgroup name' | Set-VDVlanConfiguration -VlanId 'New VLAN#'"
</report>

<custom_item>
  type        : AUDIT_VCENTER
  description : "VCWN-06-000021 - The system must enable SSL for Network File Copy (NFC)."
  info        : "NFC is the mechanism used to migrate or clone a VM between two ESXi hosts over the network. By default, NFC over SSL is enabled (i.e., 'True') within a vSphere cluster but the value of the setting is null. Clients check the value of the setting and default to not using SSL for performance reasons if the value is null. This behavior can be changed by ensuring the setting has been explicitly created and set to 'True'. This will force clients to use SSL. Without this setting VM contents could potentially be sniffed if the management network is not adequately isolated and secured."
  reference   : "800-171|3.13.8,800-53|SC-8(1),CAT|II,CCI|CCI-000366,CSF|PR.DS-2,CSF|PR.DS-5,Group-ID|V-63979,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,Rule-ID|SV-78469r1_rule,STIG-ID|VCWN-06-000021,SWIFT-CSCv1|2.1,TBA-FIISB|29.1"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to vCenter Inventory Lists >> vCenter Servers >> Select your vCenter Server >> Manage >> Settings >> Advanced Settings.  Click Edit and edit the config.nfc.useSSL setting to true or if the value does not exist create it by entering the values in the Key and Value fields and clicking Add.

or

From a PowerCLI command prompt while connected to the vCenter server run the following command:

If the setting already exists:

Get-AdvancedSetting -Entity <vcenter server name> -Name config.nfc.useSSL | Set-AdvancedSetting -Value true

If the setting does not exist:

New-AdvancedSetting -Entity <vcenter server name> -Name config.nfc.useSSL -Value true"
  regex       : "config.nfc.useSSL : "
  expect      : "config.nfc.useSSL : true"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:OptionValue[audit:key='config.nfc.useSSL']\">"
  xsl_stmt    : "<xsl:text>config.nfc.useSSL : </xsl:text><xsl:value-of select=\"audit:propSet/audit:val/audit:OptionValue[audit:key='config.nfc.useSSL']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:text>config.nfc.useSSL : NOT configured</xsl:text><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
</custom_item>

<report type:"WARNING">
  description : "VCWN-06-000022 - The vCenter Server services must be ran using a service account instead of a built-in Windows account."
  info        : "You can use the Microsoft Windows built-in system account or a domain user account to run vCenter Server.  The Microsoft Windows built-in system account has more permissions and rights on the server than the vCenter Server system requires, which can contribute to security problems. With a domain user account, you can enable Windows authentication for SQL Server; it also allows more granular security and logging. The installing account only needs to be a member of the Administrators group, and have permission to act as part of the operating system and log on as a service. If you are using SQL Server for the vCenter database, you must configure the SQL Server database to allow the domain account access to SQL Server.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-63981,Rule-ID|SV-78471r1_rule,STIG-ID|VCWN-06-000022"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "For each of the following services open the services console on the vCenter server and right click and select properties on the service.  Go to the Log On tab and configure the service to run as a service account and restart the service.

VMware Content Library Service
VMware Inventory Service
VMware Performance Charts
VMware VirtualCenter Server"
</report>

<custom_item>
  type        : AUDIT_VCENTER
  description : "VCWN-06-000023 - The system must ensure the vpxuser auto-password change meets policy."
  info        : "By default, the vpxuser password will be automatically changed by vCenter every 30 days. Ensure this setting meets your policies; if not, configure to meet password aging policies.   Note: It is very important the password aging policy not be shorter than the default interval that is set to automatically change the vpxuser password, to preclude the possibility that vCenter might get locked out of an ESXi host."
  reference   : "800-171|3.5.10,800-171|3.5.7,800-171|3.5.8,800-171|3.5.9,800-53|IA-5(1),CAT|II,CCI|CCI-000366,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,Group-ID|V-63983,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1),NESA|T5.2.3,NIAv2|AM20,NIAv2|AM21,Rule-ID|SV-78473r1_rule,STIG-ID|VCWN-06-000023,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.2"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to vCenter Inventory Lists >> vCenter Servers >> Select your vCenter Server >> Manage >> Settings >> Advanced Settings.  Click Edit and edit the VirtualCenter.VimPasswordExpirationInDays setting to 30 or if the value does not exist create it by entering the values in the Key and Value fields and clicking Add.

or

From a PowerCLI command prompt while connected to the vCenter server run the following command:

If the setting already exists:

Get-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays | Set-AdvancedSetting -Value 30

If the setting does not exist:

New-AdvancedSetting -Entity <vcenter server name> -Name VirtualCenter.VimPasswordExpirationInDays -Value 30"
  regex       : "VirtualCenter.VimPasswordExpirationInDays : "
  expect      : "VirtualCenter.VimPasswordExpirationInDays : 30$"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:OptionValue[audit:key='VirtualCenter.VimPasswordExpirationInDays']\">"
  xsl_stmt    : "<xsl:text>VirtualCenter.VimPasswordExpirationInDays : </xsl:text><xsl:value-of select=\"audit:propSet/audit:val/audit:OptionValue[audit:key='VirtualCenter.VimPasswordExpirationInDays']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:text>VirtualCenter.VimPasswordExpirationInDays : NOT configured</xsl:text><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
</custom_item>

<custom_item>
  type        : AUDIT_VCENTER
  description : "VCWN-06-000024 - The system must ensure the vpxuser password meets length policy."
  info        : "The vpxuser password default length is 32 characters. Ensure this setting meets site policies; if not, configure to meet password length policies. Longer passwords make brute-force password attacks more difficult. The vpxuser password is added by vCenter, meaning no manual intervention is normally required. The vpxuser password length must never be modified to less than the default length of 32 characters."
  reference   : "800-171|3.5.7,800-53|IA-5(1),CAT|II,CCI|CCI-000366,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,Group-ID|V-63985,ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1),NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,Rule-ID|SV-78475r1_rule,STIG-ID|VCWN-06-000024,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to vCenter Inventory Lists >> vCenter Servers >> Select your vCenter Server >> Manage >> Settings >> Advanced Settings.  Click Edit and edit the config.vpxd.hostPasswordLength setting to 32 or if the value does not exist create it by entering the values in the Key and Value fields and clicking Add.

or

From a PowerCLI command prompt while connected to the vCenter server run the following command:

If the setting already exists:

Get-AdvancedSetting -Entity <vcenter server name> -Name config.vpxd.hostPasswordLength | Set-AdvancedSetting -Value 32

If the setting does not exist:

New-AdvancedSetting -Entity <vcenter server name> -Name config.vpxd.hostPasswordLength -Value 32"
  regex       : "config.vpxd.hostPasswordLength : "
  expect      : "config.vpxd.hostPasswordLength : 32"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:OptionValue[audit:key='config.vpxd.hostPasswordLength']\">"
  xsl_stmt    : "<xsl:text>config.vpxd.hostPasswordLength : </xsl:text><xsl:value-of select=\"audit:propSet/audit:val/audit:OptionValue[audit:key='config.vpxd.hostPasswordLength']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:text>config.vpxd.hostPasswordLength : NOT configured</xsl:text><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
</custom_item>

<report type:"WARNING">
  description : "VCWN-06-000025 - The system must disable the managed object browser at all times, when not required for troubleshooting or maintenance."
  info        : "The managed object browser provides a way to explore the object model used by the vCenter to manage the vSphere environment; it enables configurations to be changed as well. This interface is used primarily for debugging, and might potentially be used to perform malicious configuration changes or actions.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-63987,Rule-ID|SV-78477r1_rule,STIG-ID|VCWN-06-000025"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "If the datastore browser is enabled and required for object maintenance, no fix is immediately required.

Disable the managed object browser:
Determine the location of the vpxd.cfg file on the Windows host.
Edit the file and locate the <vpxd> ... </vpxd> element.
Ensure the following element is set. <enableDebugBrowse>false</enableDebugBrowse>

Restart the vCenter Service to ensure the configuration file change(s) are in effect."
</report>

<report type:"WARNING">
  description : "VCWN-06-000026 - Privilege re-assignment must be checked after the vCenter Server restarts."
  info        : "Check for privilege reassignment when you restart vCenter Server. If the user or user group that is assigned the Administrator role on the root folder cannot be verified as a valid user or group during a restart, the role is removed from that user or group. In its place, vCenter Server grants the Administrator role to the vCenter Single Sign-On account administrator@vsphere.local. This account can then act as the administrator.  Reestablish a named administrator account and assign the Administrator role to that account to avoid using the anonymous administrator@vsphere.local account.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-63989,Rule-ID|SV-78479r1_rule,STIG-ID|VCWN-06-000026"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "As the SSO Administrator, log in to the vCenter Server and restore a legitimate administrator account per site-specific user/group/role requirements."
</report>

<report type:"WARNING">
  description : "VCWN-06-000027 - The system must minimize access to the vCenter server."
  info        : "After someone has logged in to the vCenter Server system, it becomes more difficult to prevent what they can do. In general, logging in to the vCenter Server system should be limited to very privileged administrators, and then only for the purpose of administering vCenter Server or the host OS. Anyone logged in to the vCenter Server can potentially cause harm, either intentionally or unintentionally, by altering settings and modifying processes. They also have potential access to vCenter credentials, such as the SSL certificate.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|I,CCI|CCI-000366,Group-ID|V-63991,Rule-ID|SV-78481r1_rule,STIG-ID|VCWN-06-000027"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "Remove all unnecessary users and/or groups from the local administrators group of the vCenter server."
</report>

<report type:"WARNING">
  description : "VCWN-06-000028 - Log files must be cleaned up after failed installations of the vCenter Server."
  info        : "In certain cases, if the vCenter installation fails, a log file (with a name of the form 'hs_err_pidXXXX') is created that contains the database password in plain text. An attacker who breaks into the vCenter Server  could potentially steal this password and access the vCenter Database.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-63993,Rule-ID|SV-78483r1_rule,STIG-ID|VCWN-06-000028"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "Develop a site policy for handling failed installation cleanup of the Windows host prior to deployment. Using the Windows host search function, determine the existence of any log files of format 'hs_err_pid' and remove them."
</report>

<report type:"WARNING">
  description : "VCWN-06-000029 - The system must enable all tasks to be shown to Administrators in the Web Client."
  info        : "By default not all tasks are shown in the web client to administrators and only that user's tasks will be shown.  Enabling all tasks to be shown will allow the administrator to potentially see any malicious activity they may miss with the view disabled.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-63995,Rule-ID|SV-78485r1_rule,STIG-ID|VCWN-06-000029"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "Edit the webclient.properties file to set the show.allusers.tasks setting to true.

The default locations for the webclient.properties file are:

Windows - C:\ProgramData\VMware\vCenterServer\cfg\vsphere-client\

Appliance - /etc/vmware/vsphere-client/

After editing the file the vSphere Web Client service will need to be restarted."
</report>

<report type:"WARNING">
  description : "VCWN-06-000030 - The vCenter Administrator role must be secured and assigned to specific users other than a Windows Administrator."
  info        : "By default, vCenter Server grants full administrative rights to the local administrator's account, which can be accessed by domain administrators. Separation of duties dictates that full vCenter Administrative rights should be granted only to those administrators who are required to have it. This privilege should not be granted to any group whose membership is not strictly controlled. Therefore, administrative rights should be removed from the local Windows server to users who are not vCenter administrators.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-63999,Rule-ID|SV-78489r1_rule,STIG-ID|VCWN-06-000030"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "Under the computer management console for windows view the local administrators group and remove any users or groups that are not vCenter administrators."
</report>

<report type:"WARNING">
  description : "VCWN-06-000031 - Connectivity between Update Manager and public patch repos restricted by use of a separate Update Manager Download Server."
  info        : "The Update Manager Download Service (UMDS) is an optional module of the Update Manager. UMDS downloads upgrades for virtual appliances, patch metadata, patch binaries, and notifications that would not otherwise be available to the Update Manager server. For security reasons and deployment restrictions, the Update Manager must be installed in a secured network that is disconnected from the Internet. The Update Manager requires access to patch information to function properly. UMDS must be installed on a separate system that has Internet access to download upgrades, patch binaries, and patch metadata, and then export the downloads to a portable media drive so that they become accessible to the Update Manager server.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-64003,Rule-ID|SV-78493r1_rule,STIG-ID|VCWN-06-000031"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "Configure the Update Manager Server to use a separate Update Manager Download Server; the use of physical media to transfer updated files to the Update Manager server (air-gap model) must be enforced and documented with organization policies. Configure the Update Manager Download Server and enable the Download Service. Patches must not be directly accessible to the Update Manager Server application from the Internet.

To configure a Web server or local disk repository as a download source (i.e., 'Direct connection to Internet' must not be selected as the source), from the vSphere Client/vCenter Server system, click Update Manager under Solutions and Applications. On the Configuration tab, under Settings, click Download Settings. In the Download Sources pane, select Use a shared repository. Enter the <site-specific> path or the URL to the shared repository. Click Validate URL to validate the path. Click Apply."
</report>

<report type:"WARNING">
  description : "VCWN-06-000032 - A least-privileges assignment must be used for the Update Manager database user."
  info        : "Least-privileges mitigate attacks if the Update Manager database account is compromised. The VMware Update Manager requires certain privileges for the database user in order to install, and the installer will automatically check for these. The privileges on the VUM database user must be reduced for normal operation.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-64005,Rule-ID|SV-78495r1_rule,STIG-ID|VCWN-06-000032"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "For Oracle DB normal runtime operation, set the following permissions.
grant connect to vumAdmin
grant resource to vumAdmin
grant create any job to vumAdmin
grant create view to vumAdmin
grant create any sequence to vumAdmin
grant create any table to vumAdmin
grant lock any table to vumAdmin
grant create procedure to vumAdmin
grant create type to vumAdmin
grant execute on dbms_lock to vumAdmin
grant unlimited tablespace to vumAdmin
# To ensure space limitation is not an issue

For SQL DB normal operation, make sure that the database user has either a sysadmin server role or the db_owner fixed database role on the Update Manager database and the MSDB database.

The db_owner role on the MSDB database is required for installation and upgrade only.

Note: While current, it is always best to check both the latest VMware Update Manager Administration Guide and the vendor database documentation for any updates to these configurations."
</report>

<report type:"WARNING">
  description : "VCWN-06-000033 - A least-privileges assignment must be used for the vCenter Server database user."
  info        : "Least-privileges mitigates attacks if the vCenter database account is compromised. vCenter requires very specific privileges on the database. Privileges normally required only for installation and upgrade must be removed for/during normal operation. These privileges may be reinstated if/when any future upgrade must be performed.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-64007,Rule-ID|SV-78497r2_rule,STIG-ID|VCWN-06-000033"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "Configure correct permissions and roles for SQL:

Grant these privileges to a vCenter database administrator role used only for initial setup and periodic maintenance of the database:
Schema permissions ALTER, REFERENCES, and INSERT.
Permissions CREATE TABLE, VIEW, and CREATE PROCEDURES.

Grant these privileges to a vCenter database user role:
SELECT, INSERT, DELETE, UPDATE, and EXECUTE.
EXECUTE permissions on sp_add_job, sp_delete_job, sp_add_jobstep, sp_update_job, sp_add_jobserver, sp_add_jobschedule, and sp_add_category stored procedures.
SELECT permission on syscategories, sysjobsteps, sysjobs_view, and sysjobs tables.

Grant the permissions VIEW SERVER STATE and VIEW ANY DEFINITIONS to the vCenter database user.

For more information, refer to the following website: http://pubs.vmware.com/vsphere-60/index.jsp#com.vmware.vsphere.install.doc/GUID-36B92A8C-074A-4657-9938-62AB97225B91.html"
</report>

<report type:"WARNING">
  description : "VCWN-06-000034 - The system must use unique service accounts when applications connect to vCenter."
  info        : "In order to not violate non-repudiation (i.e., deny the authenticity of who is connecting to vCenter), when applications need to connect to vCenter they should use unique service accounts.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-64009,Rule-ID|SV-78499r1_rule,STIG-ID|VCWN-06-000034"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "For applications sharing service accounts create a new service account to assign to the application so that no application shares a service account with another.

When standing up a new application that requires access to vCenter always create a new service account prior to installation and grant only the permissions needed for that application."
</report>

<report type:"WARNING">
  description : "VCWN-06-000035 - vSphere Client plugins must be verified."
  info        : "The vCenter Server includes a vSphere Client extensibility framework, which provides the ability to extend the vSphere Client with menu selections or toolbar icons that provide access to vCenter Server add-on components or external, Web-based functionality. vSphere Client plugins or extensions run at the same privilege level as the user. Malicious extensions might masquerade as useful add-ons while compromising the system by stealing credentials or incorrectly configuring the system.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-64011,Rule-ID|SV-78501r1_rule,STIG-ID|VCWN-06-000035"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Administration >> Client Plug-Ins and right click the unknown plug-in and click disable then proceed to remove the plug-in.

To remove plug-ins do the following:

If you have vCenter Server in linked mode, perform this procedure on the vCenter Server that is used to install the plug-in initially, then restart the vCenter Server services on the linked vCenter Server.

In a web browser, navigate to http://vCenter_Server_name_or_IP/mob.

Where vCenter_Server_name_or_IP/mob is the name of your vCenter Server or its IP address.

Click Content.
Click ExtensionManager.
Select and copy the name of the plug-in you want to remove from the list of values under Properties. For a list of default plug-ins, see the Additional Information section of this article.
Click UnregisterExtension. A new window appears.
Paste the name of the plug-in and click Invoke Method. This removes the plug-in.
Close the window.
Refresh the Managed Object Type:ManagedObjectReference:ExtensionManager window to verify that the plug-in is removed successfully.

Note: If the plug-in still appears, you may have to restart the vSphere Client.
Note: You may have to enable the Managed Object Browser(mob) temporarily if previously disabled."
</report>

<custom_item>
  type        : AUDIT_VCENTER
  description : "VCWN-06-000036 - The system must produce audit records containing information to establish what type of events occurred."
  info        : "Without establishing what types of events occurred, it would be difficult to establish, correlate, and investigate the events leading up to an outage or attack."
  reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,CAT|III,CCI|CCI-002702,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,Group-ID|V-64013,ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,Rule-ID|SV-78503r1_rule,STIG-ID|VCWN-06-000036,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to vCenter Inventory Lists >> vCenter Servers >> Select your vCenter Server >> Manage >> Settings >> Advanced Settings.  Click Edit and edit the config.log.level setting to info or if the value does not exist create it by entering the values in the Key and Value fields and clicking Add.

or

From a PowerCLI command prompt while connected to the vCenter server run the following command:

If the setting already exists:

Get-AdvancedSetting -Entity <vcenter server name> -Name config.log.level | Set-AdvancedSetting -Value info

If the setting does not exist:

New-AdvancedSetting -Entity <vcenter server name> -Name config.log.level -Value info"
  regex       : "config.log.level : "
  expect      : "config.log.level : info"
  xsl_stmt    : "<xsl:template match=\"/\">"
  xsl_stmt    : "<xsl:for-each select=\"//audit:returnval\">"
  xsl_stmt    : "<xsl:choose>"
  xsl_stmt    : "<xsl:when test=\"audit:propSet/audit:val/audit:OptionValue[audit:key='config.log.level']\">"
  xsl_stmt    : "<xsl:text>config.log.level : </xsl:text><xsl:value-of select=\"audit:propSet/audit:val/audit:OptionValue[audit:key='config.log.level']/audit:value\"/><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:when>"
  xsl_stmt    : "<xsl:otherwise>"
  xsl_stmt    : "<xsl:text>config.log.level : NOT configured</xsl:text><xsl:text>&#10;</xsl:text>"
  xsl_stmt    : "</xsl:otherwise>"
  xsl_stmt    : "</xsl:choose>"
  xsl_stmt    : "</xsl:for-each>"
  xsl_stmt    : "</xsl:template>"
</custom_item>

<report type:"WARNING">
  description : "VCWN-06-000039 - Passwords must be at least 15 characters in length."
  info        : "The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.  Password complexity, or strength, is a measure of the effectiveness of a password in resisting attempts at guessing and brute-force attacks. Password length is one factor of several that helps to determine strength and how long it takes to crack a password. The shorter the password, the lower the number of possible combinations that need to be tested before the password is compromised.   Use of more characters in a password helps to exponentially increase the time and/or resources required to compromise the password.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000205,Group-ID|V-64015,Rule-ID|SV-78505r1_rule,STIG-ID|VCWN-06-000039"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Administration >> Single Sign-On >> Configuration >> Policies >> Password Policy.  Click Edit. Set the Minimum Length to 15 and click OK."
</report>

<report type:"WARNING">
  description : "VCWN-06-000040 - Passwords must contain at least one uppercase character."
  info        : "To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated. The use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000192,Group-ID|V-64017,Rule-ID|SV-78507r1_rule,STIG-ID|VCWN-06-000040"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Administration >> Single Sign-On >> Configuration >> Policies >> Password Policy.  Click Edit. Set Upper-case Characters to at least 1 and click OK."
</report>

<report type:"WARNING">
  description : "VCWN-06-000041 - Passwords must contain at least one lowercase character."
  info        : "To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated. The use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000193,Group-ID|V-64019,Rule-ID|SV-78509r1_rule,STIG-ID|VCWN-06-000041"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Administration >> Single Sign-On >> Configuration >> Policies >> Password Policy.  Click Edit. Set Lower-case Characters to at least 1 and click OK."
</report>

<report type:"WARNING">
  description : "VCWN-06-000042 - Passwords must contain at least one numeric character."
  info        : "To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated. The use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000194,Group-ID|V-64021,Rule-ID|SV-78511r1_rule,STIG-ID|VCWN-06-000042"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Administration >> Single Sign-On >> Configuration >> Policies >> Password Policy.  Click Edit. Set Numeric Characters to at least 1 and click OK."
</report>

<report type:"WARNING">
  description : "VCWN-06-000043 - Passwords must contain at least one special character."
  info        : "To enforce the use of complex passwords, minimum numbers of characters of different classes are mandated. The use of complex passwords reduces the ability of attackers to successfully obtain valid passwords using guessing or exhaustive search techniques. Complexity requirements increase the password search space by requiring users to construct passwords from a larger character set than they may otherwise use.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-001619,Group-ID|V-64023,Rule-ID|SV-78513r1_rule,STIG-ID|VCWN-06-000043"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Administration >> Single Sign-On >> Configuration >> Policies >> Password Policy.  Click Edit. Set Special Characters to at least 1 and click OK."
</report>

<report type:"WARNING">
  description : "VCWN-06-000045 - The system must limit the maximum number of failed login attempts to three."
  info        : "By limiting the number of failed login attempts, the risk of unauthorized access via user password guessing, otherwise known as brute-forcing, is reduced. Limits are imposed by locking the account.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-002238,Group-ID|V-64025,Rule-ID|SV-78515r1_rule,STIG-ID|VCWN-06-000045"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Administration >> Single Sign-On >> Configuration >> Policies >> Lockout Policy.  Click Edit. Set the Maximum number of failed login attempts to 3 and click OK."
</report>

<report type:"WARNING">
  description : "VCWN-06-000046 - The system must set the interval for counting failed login attempts to at least 15 minutes."
  info        : "By limiting the number of failed login attempts, the risk of unauthorized access via user password guessing, otherwise known as brute-forcing, is reduced. Limits are imposed by locking the account.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-002238,Group-ID|V-64027,Rule-ID|SV-78517r1_rule,STIG-ID|VCWN-06-000046"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Administration >> Single Sign-On >> Configuration >> Policies >> Lockout Policy.  Click Edit. Set the Time interval between failures to 900 and click OK."
</report>

<report type:"WARNING">
  description : "VCWN-06-000047 - The system must require an administrator to unlock an account locked due to excessive login failures."
  info        : "By limiting the number of failed login attempts, the risk of unauthorized access via user password guessing, otherwise known as brute-forcing, is reduced. Limits are imposed by locking the account.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-002238,Group-ID|V-64029,Rule-ID|SV-78519r1_rule,STIG-ID|VCWN-06-000047"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Administration >> Single Sign-On >> Configuration >> Policies >> Lockout Policy.  Click Edit. Set the Unlock time to 0 and click OK."
</report>

<report type:"WARNING">
  description : "VCWN-06-000048 - The system must alert administrators on permission creation operations."
  info        : "If personnel are not notified of permission events, they will not be aware of possible unsecure situations.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-001294,Group-ID|V-64031,Rule-ID|SV-78521r1_rule,STIG-ID|VCWN-06-000048"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Client select the vCenter server at the top of the hierarchy and go to >> Alarms >> Definitions >> Right click in the empty space and select New Alarm.  On the General tab provide an alarm name and description, Select vCenter for alarm type and 'Monitor for specific events occurring on this object', check 'Enable this alarm'.  On the Triggers tab click Add three triggers and in the event column enter 'vim.event.PermissionAddedEvent', 'vim.event.PermissionRemovedEvent', and 'vim.event.PermissionUpdatedEvent' for the three triggers and click OK."
</report>

<report type:"WARNING">
  description : "VCWN-06-000049 - The system must alert administrators on permission deletion operations."
  info        : "If personnel are not notified of permission events, they will not be aware of possible unsecure situations.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-001294,Group-ID|V-64033,Rule-ID|SV-78523r1_rule,STIG-ID|VCWN-06-000049"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Client select the vCenter server at the top of the hierarchy and go to >> Alarms >> Definitions >> Right click in the empty space and select New Alarm.  On the General tab provide an alarm name and description, Select vCenter for alarm type and 'Monitor for specific events occurring on this object', check 'Enable this alarm'.  On the Triggers tab click Add three triggers and in the event column enter 'vim.event.PermissionAddedEvent', 'vim.event.PermissionRemovedEvent', and 'vim.event.PermissionUpdatedEvent' for the three triggers and click OK."
</report>

<report type:"WARNING">
  description : "VCWN-06-000050 - The system must alert administrators on permission update operations."
  info        : "If personnel are not notified of permission events, they will not be aware of possible unsecure situations.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-001294,Group-ID|V-64035,Rule-ID|SV-78525r1_rule,STIG-ID|VCWN-06-000050"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Client select the vCenter server at the top of the hierarchy and go to >> Alarms >> Definitions >> Right click in the empty space and select New Alarm.  On the General tab provide an alarm name and description, Select vCenter for alarm type and 'Monitor for specific events occurring on this object', check 'Enable this alarm'.  On the Triggers tab click Add three triggers and in the event column enter 'vim.event.PermissionAddedEvent', 'vim.event.PermissionRemovedEvent', and 'vim.event.PermissionUpdatedEvent' for the three triggers and click OK."
</report>

<report type:"WARNING">
  description : "VCWN-06-100005 - The vCenter Server users must have the correct roles assigned."
  info        : "Users and service accounts must only be assigned privileges they require. Least Privilege requires that these privileges must only be assigned if needed, to reduce risk of confidentiality, availability or integrity loss.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-001084,Group-ID|V-64037,Rule-ID|SV-78527r1_rule,STIG-ID|VCWN-06-100005"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "To create a new role with specific permissions do the following:

From the vSphere Web Client go to Administration >> Access Control >> Roles. Click the green plus sign and enter a name for the role and select only the specific permissions required.  Users can then be assigned to the newly created role."
</report>

<report type:"WARNING">
  description : "VCWN-06-000051 - The system must protect the confidentiality and integrity of transmitted info by isolating IP-based storage traffic."
  info        : "Virtual machines might share virtual switches and VLANs with the IP-based storage configurations. IP-based storage includes VSAN, iSCSI, and NFS. This configuration might expose IP-based storage traffic to unauthorized virtual machine users. IP-based storage frequently is not encrypted. It can be viewed by anyone with access to this network. To restrict unauthorized users from viewing the IP-based storage traffic, the IP-based storage network must be logically separated from the production traffic. Configuring the IP-based storage adaptors on separate VLANs or network segments from other VMkernels and Virtual Machines will limit unauthorized users from viewing the traffic.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|II,CCI|CCI-000366,Group-ID|V-73137,Rule-ID|SV-87789r1_rule,STIG-ID|VCWN-06-000051"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "Configuration of an IP-Based VMkernel will be unique to each environment but for example to modify the IP address and VLAN information to the correct network on a standard switch for an iSCSI VMkernel do the following:

From the vSphere Client select the ESXi host and go to Configuration > Networking > On the vSwitch that contains the iSCSI VMkernel select Properties. Select the iSCSI VMkernel and click Edit > On the General tab uncheck everything and set the appropriate VLAN ID > Go to the IP Settings tab > Enter the appropriate IP address and subnet information and click OK."
</report>

<report type:"WARNING">
  description : "VCWN-06-000052 - The system must enable the VSAN Health Check."
  info        : "VSAN Health Check is enabled by default in vSphere 6.0 update 1 and later, it has to be manually installed and enabled on vSphere 6.0.0 prior to usage. The VSAN Health Check is used for additional alerting capabilities, performance stress testing prior to production usage, and verifying that the underlying hardware officially is supported by being in compliance with the VSAN Hardware Compatibility Guide

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-73139,Rule-ID|SV-87791r1_rule,STIG-ID|VCWN-06-000052"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "If VSAN Health Check is not installed (6.0 GA only):
Download the VSAN Health Check Plugin and install to the vCenter Server. Then restart the vCenter Server services. DRS must be configured for fully automated on the cluster. Then each ESXi host must have the VSAN Health Check VIB installed on the ESXi hosts.

If VSAN Health Check is installed:
From the vSphere Web Client go to Host and Clusters > Select a VSAN enabled 'Cluster' > Manage > Settings > Virtual SAN > Health > 'Health Service Status' and click 'Edit Settings'. Select the check box for 'Turn On Periodical Health Check' and configure the time interval as necessary."
</report>

<report type:"WARNING">
  description : "VCWN-06-000053 - The connectivity between VSAN Health Check and public Hardware Compatibility List must be disabled or restricted."
  info        : "The VSAN Health Check is able to download the hardware compatibility list from VMware in order to check compliance against the underlying VSAN Cluster hosts. To ensure the vCenter server is not directly downloading content from the internet this functionality must be disabled or if this feature is necessary an external proxy server must be configured.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-73141,Rule-ID|SV-87793r1_rule,STIG-ID|VCWN-06-000053"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "If no clusters are enabled for VSAN, this is not applicable.

If VSAN Health Check is not installed (6.0 GA only):
Download the VSAN Health Check Plugin and install to the vCenter Server. Then restart the vCenter Server services. DRS must be configured for fully automated on the cluster. Then each ESXi host must have the VSAN Health Check VIB installed on the ESXi hosts.

If VSAN Health Check is installed:
From the vSphere Web Client go to Host and Clusters > Select a VSAN Enabled Cluster > Manage > Settings > General > Internet Connectivity > Edit

If the HCL internet download is not required then ensure that 'Enable Internet access for this cluster' is disabled.

If the HCL internet download is required then ensure that 'Enable Internet access for this cluster' is enabled and that a proxy host is appropriately configured."
</report>

<report type:"WARNING">
  description : "VCWN-06-000054 - The system must configure the VSAN Datastore name to a unique name."
  info        : "VSAN Datastore name by default is 'vsanDatastore'. If more than one VSAN cluster is present in vCenter both datastores will have the same name by default potentially leading to confusion and manually misplaced workloads.

   NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
  reference   : "CAT|III,CCI|CCI-000366,Group-ID|V-73143,Rule-ID|SV-87795r1_rule,STIG-ID|VCWN-06-000054"
  see_also    : "http://iasecontent.disa.mil/stigs/zip/U_VMware_vSphere_6-0_vCenter_Server_for_Windows_V1R4_STIG.zip"
  solution    : "From the vSphere Web Client go to Host and Clusters > Select a Cluster > Related Objects > Datastores. Right click on the datastore named 'vsanDatastore' and select 'Rename'. Rename the datastore based on operational naming standards.

or

From a PowerCLI command prompt while connected to the vCenter server run the following command:

If($(Get-Cluster | where {$_.VsanEnabled} | Measure).Count -gt 0){
Write-Host 'VSAN Enabled Cluster found'
$Clusters = Get-Cluster | where {$_.VsanEnabled}
Foreach ($clus in $clusters){
 $clus | Get-Datastore | where {$_.type -match 'vsan'} | Set-Datastore -Name $(($clus.name) + '_VSAN_Datastore')
}
}
else{
Write-Host 'VSAN is not enabled, this finding is not applicable'
}"
</report>

</check_type>
