#
# This script is Copyright (C) 2004-2020 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
#
# $Revision: 1.25 $
# $Date: 2020/07/14 $
#
# Description	: This .audit is designed against the CIS Security Configuration
# 	  Benchmark For Apache Tomcat 5.5/6.0 Version 1.0.0 December 12th, 2009.
#
# NOTE          : The audits contained in this document audit are for Level 2 items
# 			  of the CIS Apache Tomcat 5.5/6.0 Benchmark version 1.0.0 and are
# 				  specific to Apache Tomcat version 6.0.x.
#
# NOTE		: In order for the .audit to run correctly the CATALINA_HOME item
# 			  will need to be changed to the absolute path to your Tomcat
# 			  installation directory.
#
#<ui_metadata>
#<display_name>CIS Apache Tomcat5.5/6.0 L2 v1.0</display_name>
#<spec>
#  <type>CIS</type>
#  <name>Apache Tomcat5.5/6.0 L2</name>
#  <version>1.0.0</version>
#</spec>
#<labels>unix,cis,apache,tomcat,agent</labels>
#<variables>
#  <variable>
#    <name>CATALINA_HOME</name>
#    <default>/usr/share/tomcat6</default>
#    <description>Catalina home</description>
#    <info>The absolute path to your Tomcat installation directory. It should not end in a slash.</info>
#  </variable>
#  <variable>
#    <name>WEB_APP_DIR</name>
#    <default>yourappname</default>
#    <description>Web application directory</description>
#    <info>The path to your web application directory from within CATALINA_HOME.</info>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Unix">

<if>
  <condition type:"AND">
    <custom_item>
      type        : CMD_EXEC
      description : "Tomcat found"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "cmd".
      cmd         : "java -cp /usr/share/tomcat6/lib/catalina.jar org.apache.catalina.util.ServerInfo | /bin/egrep 'version'"
      expect      : "Tomcat"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "CIS_v1.0.0_Apache_Tomcat_Level_2.audit Level 2"
    </report>

#
## 1.1 Pre-Installation
#

    <report type:"PASSED">
      description : "1.1.1 Do not install Tomcat on a multi-use system"
      info        : "Servers often expose a variety of services or daemons. It is recommended that the number of services and daemons executing on the Tomcat server be limited to those necessary."
      info        : "NOTE: Nessus did not perform this check as it requires manual verification. Please run 'chkconfig --list' and review the services running to ensure only those necessary are enabled."
      reference   : "LEVEL|2NS"
      see_also    : "https://workbench.cisecurity.org/files/261"
    </report>

#
## 1.2 Installation
#
#
## 1.3 Remove Extraneous Resources
#

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "description".
      description : "1.3.1 Remove extraneous files and directories (/usr/share/tomcat6/webapps/js-examples)"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/webapps/js-examples"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "description".
      description : "1.3.1 Remove extraneous files and directories (/usr/share/tomcat6/webapps/servlet-example)"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/webapps/servlet-example"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "description".
      description : "1.3.1 Remove extraneous files and directories (/usr/share/tomcat6/webapps/webdav)"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/webapps/webdav"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "description".
      description : "1.3.1 Remove extraneous files and directories (/usr/share/tomcat6/webapps/tomcat-docs)"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/webapps/tomcat-docs"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "description".
      description : "1.3.1 Remove extraneous files and directories (/usr/share/tomcat6/webapps/balancer)"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/webapps/balancer"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "description".
      description : "1.3.1 Remove extraneous files and directories (/usr/share/tomcat6/webapps/ROOT/admin)"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/webapps/ROOT/admin"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "description".
      description : "1.3.1 Remove extraneous files and directories (/usr/share/tomcat6/webapps/examples)"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/webapps/examples"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "description".
      description : "1.3.1 Remove extraneous files and directories (/usr/share/tomcat6/server/webapps/host-manager.xml)"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      info        : "NOTE: The manager files should not exist unless the manager application is being utilized."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/server/webapps/host-manager.xml"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "description".
      description : "1.3.1 Remove extraneous files and directories (/usr/share/tomcat6/server/webapps/manager)"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      info        : "NOTE: The manager files should not exist unless the manager application is being utilized."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/server/webapps/manager"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "description".
      description : "1.3.1 Remove extraneous files and directories (/usr/share/tomcat6/conf/Catalina/localhost/host-manager.xml)"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      info        : "NOTE: The manager files should not exist unless the manager application is being utilized."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/conf/Catalina/localhost/host-manager.xml"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "description".
      description : "1.3.1 Remove extraneous files and directories(/usr/share/tomcat6/conf/Catalina/localhost/manager.xml)"
      info        : "The installation may provide example applications, documentation, and other directories which may not serve a production use."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      info        : "NOTE: The manager files should not exist unless the manager application is being utilized."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/conf/Catalina/localhost/manager.xml"
    </custom_item>

#
## 1.4 Limit Platform Information Leaks
#

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK_NOT
      description : "1.4.1 Alter the Advertised server.info String (verify server.info is not set to default)"
      info        : "The server.info attribute contains the name of the application service. This value is presented to Tomcat clients when clients connect to the Tomcat server."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-53|SC-30(5),LEVEL|2S,NIAv2|GS8f,NIAv2|NS1,NIAv2|NS28"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/lib/org/apache/catalina/util/ServerInfo.properties"
      regex       : "^[\\s\\t]*server\.info=Apache Tomcat\/[0-9]+$"
      expect      : "^[\\s\\t]*server\.info=Apache Tomcat\/[0-9]+$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK_NOT
      description : "1.4.2 Alter the Advertised server.number String (verify server.number is not set to default)"
      info        : "The server.number attribute contains the name of the application service. This value is presented to Tomcat clients when clients connect to the Tomcat server."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      info        : "The expected server version may require updating if a newer version of Tomcat is being audited."
      reference   : "800-53|SC-30(5),LEVEL|2S,NIAv2|GS8f,NIAv2|NS1,NIAv2|NS28"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/lib/org/apache/catalina/util/ServerInfo.properties"
      regex       : "^[\\s\\t]*server\.number=[0-9]+$"
      expect      : "^[\\s\\t]*server\.number=[0-9]+$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK_NOT
      description : "1.4.3 Alter the Advertised server.built String (verify server.built is not set to default)"
      info        : "The server.built attribute contains the name of the application service. This value is presented to Tomcat clients when clients connect to the Tomcat server."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-53|SC-30(5),LEVEL|2S,NIAv2|GS8f,NIAv2|NS1,NIAv2|NS28"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/lib/org/apache/catalina/util/ServerInfo.properties"
      regex       : "^[\\s\\t]*server\.built=.*$"
      expect      : "^[\\s\\t]*server\.built=February 2 2011 2003"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.4.1/1.4.2/1.4.3 Alter the Advertised server.info String (verify catalina.jar is not the default)"
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      info        : "This check compares the md5sum of the catalina.jar to determine if the file has been changed."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/lib/catalina.jar"
      md5         : "b993af23c023d90ef888390a0fc6eee3"
    </custom_item>

    <if>
      <condition type:"OR">
        <custom_item>
          system      : "Linux"
          type        : FILE_CONTENT_CHECK
          description : "1.4.4 Disable X-Powered-By HTTP Header and Rename the Server Value for all Connectors (Check if xpoweredBy is listed for any connectors)."
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
          file        : "/usr/share/tomcat6/conf/server.xml"
          regex       : "xpoweredBy"
          expect      : "xpoweredBy"
          required    : YES
        </custom_item>
      </condition>

      <then>
        <custom_item>
          system      : "Linux"
          type        : CMD_EXEC
          description : "1.4.4 Disable X-Powered-By HTTP Header and Rename the Server Value for all Connecters (verify if xpoweredBy is set to false)"
          info        : "The xpoweredBy setting determines if Apache Tomcat will advertise its presence via the x-Powered-By HTTP header. It is recommended that this value be set to false. The server attribute overrides the default value that is sent down in the HTTP header, further masking Apache Tomcat."
          info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
          info        : "NOTE: Review the list of connectors found to ensure xpoweredBy is configured false."
          reference   : "800-53|SC-30(5),LEVEL|2S,NIAv2|GS8f,NIAv2|NS1,NIAv2|NS28"
          see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "cmd".
          cmd         : "/bin/egrep -o \"xpoweredBy=\\\".+\\\"\" /usr/share/tomcat6/conf/server.xml | /bin/awk -F= '{print tolower($2)}' | /bin/sed s/\\\"//g | while read line; do if test \"$line\" = \"false\"; then echo Passed: \"$line\"; else echo Failure: \"$line\"; fi ; done"
          expect      : ""
        </custom_item>
      </then>

      <else>
        <report type:"PASSED">
          description : "1.4.4 Disable X-Powered-By HTTP Header and Rename the Server Value for all Connecters (verify if xpoweredBy is set to false)"
          info        : "The xpoweredBy setting determines if Apache Tomcat will advertise its presence via the x-Powered-By HTTP header. It is recommended that this value be set to false. The server attribute overrides the default value that is sent down in the HTTP header, further masking Apache Tomcat."
          info        : "No Connecter was found with X-Powered-By HTTP Header enabled in the server.xml configuration file."
          reference   : "LEVEL|2S"
          see_also    : "https://workbench.cisecurity.org/files/261"
        </report>
      </else>
    </if>

    <if>
      <condition type:"OR">
        <custom_item>
          system      : "Linux"
          type        : FILE_CONTENT_CHECK
          description : "1.4.4 Disable X-Powered-By HTTP Header and Rename the Server Value for all Connectors (Check if server value is listed for any connectors)."
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
          file        : "/usr/share/tomcat6/conf/server.xml"
          regex       : "server="
          expect      : "server="
          required    : YES
        </custom_item>
      </condition>

      <then>
        <custom_item>
          system      : "Linux"
          type        : CMD_EXEC
          description : "1.4.4 Disable X-Powered-By HTTP Header and Rename the Server Value for all Connecters (verify the server value is blank)"
          info        : "The xpoweredBy setting determines if Apache Tomcat will advertise its presence via the x-Powered-By HTTP header. It is recommended that this value be set to false. The server attribute overrides the default value that is sent down in the HTTP header, further masking Apache Tomcat."
          info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
          reference   : "800-53|SC-30(5),LEVEL|2S,NIAv2|GS8f,NIAv2|NS1,NIAv2|NS28"
          see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "cmd".
          cmd         : "/bin/egrep '<Connector port=' -A 4 /usr/share/tomcat6/conf/server.xml | /bin/egrep 'server=\"\\\"\\\"\"' -o | /bin/awk -F= '{print $2}'"
          expect      : ""
        </custom_item>
      </then>

      <else>
        <report type:"PASSED">
          description : "1.4.4 Disable X-Powered-By HTTP Header and Rename the Server Value for all Connecters (verify the server value is blank)"
          info        : "The xpoweredBy setting determines if Apache Tomcat will advertise its presence via the x-Powered-By HTTP header. It is recommended that this value be set to false. The server attribute overrides the default value that is sent down in the HTTP header, further masking Apache Tomcat."
          info        : "No Connecter was found with a server value in the server.xml configuration file."
          reference   : "LEVEL|2S"
          see_also    : "https://workbench.cisecurity.org/files/261"
        </report>
      </else>
    </if>

#
## 1.5 Protect the Shutdown Port
#

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "1.5.2 Disable the Shutdown port."
      info        : "Tomcat listens on TCP port 8005 to accept shutdown requests. By connecting to this port and sending the SHUTDOWN command, all applications within Tomcat are halted. The shutdown port is not exposed to the network as it is bound to the loopback interface. If this functionality is not used, it is recommended that the Shutdown port be disabled."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|2NS,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/conf/server.xml"
      regex       : "^[\\s\\t]*<Server port=\"-1\" shutdown="
      expect      : "^[\\s\\t]*<Server port=\"-1\" shutdown="
      required    : NO
    </custom_item>

#
## 1.7 Configure Realms
#

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK_NOT
      description : "1.7.1 Use secure Realms"
      info        : "A realm is a database of usernames and passwords used to identify valid users of web applications. Review the Realms configuration to ensure Tomcat is configured to use JDBCRealm, DataSourceRealm, JNDIRealm, or JAASRealm. Specifically, Tomcat should not utilize MemoryRealm."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|2S,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/conf/server.xml"
      regex       : "^[\\s\\t]*<Realm className=\".+MemoryRealm\""
      expect      : "^[\\s\\t]*<Realm className=\".+MemoryRealm\""
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "1.7.2 Use LockOut Realms (check failureCount is set to 3)"
      info        : "A LockOut realm wraps around standard realms adding the ability to lock a user out after multiple failed logins."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.1.8,800-53|AC-7,CIP|007-6-R5,CN-L3|8.1.4.1(b),ITSG-33|AC-7,LEVEL|2S,NIAv2|AM24,PCI-DSSv3.1|8.1.6,PCI-DSSv3.2|8.1.6,TBA-FIISB|36.2.4,TBA-FIISB|45.1.2"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "cmd".
      cmd         : "/bin/egrep '<Realm className=\"org.apache.catalina.realm.LockOutRealm\"' -A 4 /usr/share/tomcat6/conf/server.xml | /bin/egrep 'failureCount=\"[0-9]+\"' -o| /bin/awk -F= '{print $2}' | /bin/sed s/\\\"//g"
      expect      : "^[0-3]$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "1.7.2 Use LockOut Realms (check lockOutTime is set to 600)"
      info        : "A LockOut realm wraps around standard realms adding the ability to lock a user out after multiple failed logins."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.1.8,800-53|AC-7,CIP|007-6-R5,CN-L3|8.1.4.1(b),ITSG-33|AC-7,LEVEL|2S,NIAv2|AM24,PCI-DSSv3.1|8.1.6,PCI-DSSv3.2|8.1.6,TBA-FIISB|36.2.4,TBA-FIISB|45.1.2"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "cmd".
      cmd         : "/bin/egrep '<Realm className=\"org.apache.catalina.realm.LockOutRealm\"' -A 4 /usr/share/tomcat6/conf/server.xml | /bin/egrep 'lockoutTime=\"[0-9]+\"' -o| /bin/awk -F= '{print $2}' | /bin/sed s/\\\"//g"
      expect      : "^([6-9][0-9]{2}|[1-9][0-9]{3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "1.7.2 Use LockOut Realms (check cacheSize is set to 1000)"
      info        : "A LockOut realm wraps around standard realms adding the ability to lock a user out after multiple failed logins."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.1.8,800-53|AC-7,CIP|007-6-R5,CN-L3|8.1.4.1(b),ITSG-33|AC-7,LEVEL|2S,NIAv2|AM24,PCI-DSSv3.1|8.1.6,PCI-DSSv3.2|8.1.6,TBA-FIISB|36.2.4,TBA-FIISB|45.1.2"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "cmd".
      cmd         : "/bin/egrep '<Realm className=\"org.apache.catalina.realm.LockOutRealm\"' -A 4 /usr/share/tomcat6/conf/server.xml | /bin/egrep 'cacheSize=\"[0-9]+\"' -o| /bin/awk -F= '{print $2}' |/bin/sed s/\\\"//g"
      expect      : "^([0-9]{1,3}|1000)$"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "1.7.2 Use LockOut Realms (check cacheRemovalWarningTime is set to 3600)"
      info        : "A LockOut realm wraps around standard realms adding the ability to lock a user out after multiple failed logins."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.1.8,800-53|AC-7,CIP|007-6-R5,CN-L3|8.1.4.1(b),ITSG-33|AC-7,LEVEL|2S,NIAv2|AM24,PCI-DSSv3.1|8.1.6,PCI-DSSv3.2|8.1.6,TBA-FIISB|36.2.4,TBA-FIISB|45.1.2"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "cmd".
      cmd         : "/bin/egrep '<Realm className=\"org.apache.catalina.realm.LockOutRealm\"' -A 4 /usr/share/tomcat6/conf/server.xml | /bin/egrep 'cacheRemovalWarningTime=\"[0-9]+\"' -o| /bin/awk -F= '{print $2}' | /bin/sed s/\\\"//g"
      expect      : "^([0-9]{1,3}|[12][0-9]{3}|3[0-5][0-9]{2}|3600)$"
    </custom_item>

#
## 1.8 Connector Security
#

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "1.8.1 Setup Client-cert Authentication (verify clientAuth is set to true)"
      info        : "Client-cert authentication requires that each client connecting to the server has a certificate used to authenticate. This is generally regarded as stronger authentication than a password as it requires the client to have the cert and not just know a password."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.5.2,800-53|IA-5,CSF|PR.AC-1,ITSG-33|IA-5,LEVEL|2S,NESA|T5.2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "cmd".
      cmd         : "/bin/egrep '<Connector port=' -A 4 /usr/share/tomcat6/conf/server.xml | /bin/egrep 'clientAuth=\"[A-Za-z]+\"' -o | /bin/awk -F= '{print $2}'|/bin/sed s/\\\"//g"
      expect      : "[Tt][Rr][Uu][Ee]"
    </custom_item>

#
## 1.9 Establish and Protect Logging Facilities
#

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK
      description : "1.9.1 Application specific logging"
      info        : "By default, java.util.logging does not provide the capabilities to configure per-web application settings, only per VM. In order to overcome this limitation Tomcat implements JULI as a wrapper for java.util.logging. JULI provides additional configuration functionality so you can set each web application with different logging specifications."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      info        : "NOTE: WEB_APP_DIR needs to be changed to the path to your web applications directory."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|2S,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
# Note: Variable @WEB_APP_DIR@ replaced with "yourappname" in field "file".
      file        : "/usr/share/tomcat6/yourappname/WEB-INF/classes/logging.properties"
      file_type   : "f"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "1.9.3 Ensure className is set correctly in context.xml"
      info        : "Ensure the className attribute is set to FastCommonAccessLogValve. The className attribute determines the access log valve to be used for logging."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      info        : "NOTE: WEB_APP_DIR needs to be changed to the path to your web applications directory."
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-3,CN-L3|7.1.2.3(a),CN-L3|7.1.2.3(b),CN-L3|7.1.3.3(a),CN-L3|8.1.4.3(b),CSCv6|6.2,CSF|PR.PT-1,ITSG-33|AU-3,LEVEL|2S,NESA|T3.6.2,NIAv2|AM34a,NIAv2|AM34b,NIAv2|AM34c,NIAv2|AM34d,NIAv2|AM34e,NIAv2|AM34f,NIAv2|AM34g,PCI-DSSv3.1|10.3,PCI-DSSv3.2|10.3,SWIFT-CSCv1|6.4"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
# Note: Variable @WEB_APP_DIR@ replaced with "yourappname" in field "file".
      file        : "/usr/share/tomcat6/yourappname/META_INF/context.xml"
      regex       : "^[\\s\\t]*<Valve className=\"org\.apache\.catalina\.valves\.FastCommonAccessLogValve\""
      expect      : "^[\\s\\t]*<Valve className=\"org\.apache\.catalina\.valves\.FastCommonAccessLogValve\""
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "1.9.7 Configure log file size limit"
      info        : "By default, the logging.properties file will have no defined limit for the log file size. This is a potential denial of service attack as it would be possible to fill a drive or partition containing the log files."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-53|AU-11,CIP|007-6-R4,CSF|PR.PT-1,ITSG-33|AU-11,LEVEL|2S,NESA|M5.2.3,NESA|T3.6.2,NIAv2|SM7,PCI-DSSv3.1|10.7,PCI-DSSv3.2|10.7"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/conf/logging.properties"
      regex       : "java\.util\.logging\.FileHandler\.limit[\\s\\t]*=[\\s\\t]*([1-9][0-9]{0,2}|1000)"
      expect      : "java\.util\.logging\.FileHandler\.limit[\\s\\t]*=[\\s\\t]*([1-9][0-9]{0,2}|1000)"
    </custom_item>

#
## 1.11 Application Deployment
#

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "1.11.2 Disabling auto deployment of applications"
      info        : "Tomcat allows auto deployment of applications while Tomcat is running. It is recommended that this capability be disabled."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/conf/server.xml"
      regex       : "autoDeploy=\"[Ff][Aa][Ll][Ss][Ee]\""
      expect      : "autoDeploy=\"[Ff][Aa][Ll][Ss][Ee]\""
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "1.11.3 Disable deploy on startup applications"
      info        : "Tomcat allows auto deployment of applications. It is recommended that this capability be disabled."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/conf/server.xml"
      regex       : "deployOnStartup=\"[Ff][Aa][Ll][Ss][Ee]\""
      expect      : "deployOnStartup=\"[Ff][Aa][Ll][Ss][Ee]\""
    </custom_item>

#
## 1.12 Miscellaneous Configuration Settings
#

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "1.12.2 Restrict access to the web administration"
      info        : "Limit access to the web administration application to only those with a required need."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-53|AC-6(3),CSF|PR.AC-4,ISO/IEC-27001|A.9.1.2,ISO/IEC-27001|A.9.4.4,ITSG-33|AC-6(3),LEVEL|2NS,NESA|T5.1.1,NESA|T5.5.4,SWIFT-CSCv1|5.1"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/conf/server.xml"
      regex       : "^[\\s\\t]*<Valve className=\"org\.apache\.catalina\.valves\.RemoteAddrValve\" allow=\"127\.0\.0\.1\""
      expect      : "<Valve className=\"org\.apache\.catalina\.valves\.RemoteAddrValve\" allow=\"127\.0\.0\.1\""
      required    : NO
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "1.12.3 Restrict manager application"
      info        : "Limit access to the manager application to only those with a required need."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-53|AC-6(3),CSF|PR.AC-4,ISO/IEC-27001|A.9.1.2,ISO/IEC-27001|A.9.4.4,ITSG-33|AC-6(3),LEVEL|2NS,NESA|T5.1.1,NESA|T5.5.4,SWIFT-CSCv1|5.1"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "cmd".
      cmd         : "/bin/cat /usr/share/tomcat6/webapps/host-manager/manager.xml | /bin/egrep '<Valve className=\"org\.apache\.catalina\.valves\.RemoteAddrValve\" allow=\"127\\\\.0\\\\.0\\\\.1\"'"
      expect      : "<Valve className=\"org\.apache\.catalina\.valves\.RemoteAddrValve\" allow=\"127\\\\.0\\\\.0\\\\.1\""
      required    : NO
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.12.5 Rename the manager application (verify the default manager.xml has been renamed)"
      info        : "The manager application allows administrators to manage Tomcat remotely via a web interface. The manager application should be renamed to make it harder for attackers or automated scripts to locate."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/webapps/host-manager/manager.xml"
      file_type   : "f"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CHECK_NOT
      description : "1.12.5 Rename the manager application (verify the default manager directory has been removed/renamed)"
      info        : "The manager application allows administrators to manage Tomcat remotely via a web interface. The manager application should be renamed to make it harder for attackers or automated scripts to locate."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|2S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/webapps/manager"
      file_type   : "d"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "1.12.8 Do not allow additional path delimiters (verify ALLOW_BACKSLASH is set to false)"
      info        : "Being able to specify different path-delimiters on Tomcat creates the possibility that an attacker can access applications that were previously blocked by a proxy like mod_proxy."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-53|SI-10,CN-L3|8.1.4.4(d),ITSG-33|SI-10,LEVEL|2S,NESA|T7.3.1,NESA|T7.3.2,NIAv2|SS6e"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/bin/catalina.sh"
      regex       : "-Dorg\.apache\.catalina\.connector\. CoyoteAdapter\.ALL_BACKSLASH[\\s\\t]*=[\\s\\t]*[Ff][Aa][Ll][Ss][Ee]"
      expect      : "-Dorg\.apache\.catalina\.connector\. CoyoteAdapter\.ALL_BACKSLASH[\\s\\t]*=[\\s\\t]*[Ff][Aa][Ll][Ss][Ee]"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "1.12.8 Do not allow additional path delimiters (verify ALLOW_ENCODED_SLASH is set to false)"
      info        : "Being able to specify different path-delimiters on Tomcat creates the possibility that an attacker can access applications that were previously blocked by a proxy like mod_proxy."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-53|SI-10,CN-L3|8.1.4.4(d),ITSG-33|SI-10,LEVEL|2S,NESA|T7.3.1,NESA|T7.3.2,NIAv2|SS6e"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/bin/catalina.sh"
      regex       : "-Dorg\.apache\.tomcat\.util\.buf\. UDecoder\.ALLOW_ENCODED_SLASH[\\s\\t]*=[\\s\\t]*[Ff][Aa][Ll][Ss][Ee]"
      expect      : "-Dorg\.apache\.tomcat\.util\.buf\. UDecoder\.ALLOW_ENCODED_SLASH[\\s\\t]*=[\\s\\t]*[Ff][Aa][Ll][Ss][Ee]"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "1.12.9 Do not allow custom header status messages"
      info        : "Being able to specify custom status messages opens up the possibility for additional headers to be injected. If custom header status messages are required make sure they are only in US-ASCII and do not include any user-supplied data."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-53|SC-30(5),LEVEL|2S,NIAv2|GS8f,NIAv2|NS1,NIAv2|NS28"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/bin/catalina.sh"
      regex       : "-Dorg\.apache\.coyote\.USE_CUSTOM_STATUS_MSG_IN_HEADER[\\s\\t]*=[\\s\\t]*[Ff][Aa][Ll][Ss][Ee]"
      expect      : "-Dorg\.apache\.coyote\.USE_CUSTOM_STATUS_MSG_IN_HEADER[\\s\\t]*=[\\s\\t]*[Ff][Aa][Ll][Ss][Ee]"
    </custom_item>

    <custom_item>
      system        : "Linux"
      type          : CMD_EXEC
      description   : "1.12.10 Configure connection Timeout"
      info          : "The connectionTimeout setting allows Tomcat to close idle sockets after a specific amount of time to save system resources."
      info          : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      info          : "Review the list of connectors found to ensure the connectionTimeout are configured to 60000 or greater."
      reference     : "800-171|3.13.9,800-53|SC-10,ITSG-33|SC-10,LEVEL|2S,NESA|T2.3.8,NESA|T4.5.1,NESA|T5.5.1,SWIFT-CSCv1|2.6"
      see_also      : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "cmd".
      cmd           : "/bin/egrep -o \"connectionTimeout=\\\"[0-9]+\\\" \" /usr/share/tomcat6/conf/server.xml |/bin/awk -F= '{print $2}' | /bin/sed s/\\\"//g | while read line; do if test \"$line\" -ge 60000; then echo Passed: \"$line\"; else echo Failure: \"$line\";fi;done"
      expect        : ""
      dont_echo_cmd : YES
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "1.12.11 Configure maxHttpHeaderSize"
      info        : "The maxHttpHeaderSize limits the size of the request and response headers defined in bytes. If not specified, the default is 8192 bytes."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      info        : "Review the list of connectors found to ensure maxHttpHeaderSize is configured to 8192."
      reference   : "800-53|SC-5,CSF|DE.CM-1,CSF|PR.DS-4,ITSG-33|SC-5,LEVEL|2S,NESA|T3.3.1,NIAv2|GS10c,NIAv2|GS8e"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "cmd".
      cmd         : "/bin/egrep -o \"maxHttpHeaderSize=\\\"[0-9]+\\\"\" /usr/share/tomcat6/conf/server.xml | /bin/awk -F= '{print $2}' | /bin/sed s/\\\"//g | while read line; do if test \"$line\" -le 8192; then echo Passed: \"$line\"; else echo Failure: \"$line\"; fi ; done"
      expect      : ""
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "1.12.12 Force SSL for all applications"
      info        : "Use the transport-guarantee attribute to ensure SSL protection when accessing all applications. This can be overridden to be disabled on a per application basis in the application configuration."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.13.8,800-53|SC-8(1),CSF|PR.DS-2,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ISO/IEC-27001|A.13.2.3,ITSG-33|SC-8(1),LEVEL|2S,NESA|T7.4.1,NIAv2|NS5d,NIAv2|NS6b,SWIFT-CSCv1|2.1,TBA-FIISB|29.1"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/conf/web.xml"
      regex       : "<transport-guarantee>CONFIDENTIAL</transport-guarantee>"
      expect      : "<transport-guarantee>CONFIDENTIAL</transport-guarantee>"
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : FILE_CONTENT_CHECK
      description : "1.12.13 Increase the entropy in session identifiers"
      info        : "Having a server that has deterministic session identifiers can lead to session hijacking. Specifying a randomClass attribute allows for truly random session identifiers."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.13.15,800-53|SC-23(3),ITSG-33|SC-23(3),LEVEL|2S"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "file".
      file        : "/usr/share/tomcat6/conf/context.xml"
      regex       : "randomClass=\"java\.security\.SecureRandom\""
      expect      : "randomClass=\"java\.security\.SecureRandom\""
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "1.12.17 Do not resolve hosts on logging valves (verify context.xml has resolveHosts set to false)"
      info        : "Setting resolveHosts to true on logging valves requires a DNS lookup before logging the information. This adds additional resources when logging."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|2S,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "cmd".
      cmd         : "/bin/find /usr/share/tomcat6 -name context.xml -exec bash -c 'if test -f {}; then /bin/cat {} | /bin/egrep -q \"resolveHosts=\\\"[Tt][Rr][Uu][Ee]\\\"\"; if test $? -gt 0; then echo {};fi; fi' \\;"
      expect      : ""
    </custom_item>

    <custom_item>
      system      : "Linux"
      type        : CMD_EXEC
      description : "1.12.17 Do not resolve hosts on logging valves (verify server.xml has resolveHosts set to false)"
      info        : "Setting resolveHosts to true on logging valves requires a DNS lookup before logging the information. This adds additional resources when logging."
      info        : "NOTE: CATALINA_HOME needs to be the absolute path to your Tomcat installation directory."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|2S,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/261"
# Note: Variable @CATALINA_HOME@ replaced with "/usr/share/tomcat6" in field "cmd".
      cmd         : "/bin/find /usr/share/tomcat6 -name server.xml -exec bash -c 'if test -f {}; then /bin/cat {} | /bin/egrep -q \"resolveHosts=\\\"[Tt][Rr][Uu][Ee]\\\"\"; if test $? -gt 0; then echo {};fi; fi' \\;"
      expect      : ""
    </custom_item>
  </then>

  <else>
    <report type:"WARNING">
      description : "CIS_v1.0.0_Apache_Tomcat_Level_2.audit Level 2"
      info        : "NOTE: Nessus has not identified that the chosen audit applies to the target device."
      see_also    : "https://workbench.cisecurity.org/files/261"
    </report>
  </else>
</if>

</check_type>
