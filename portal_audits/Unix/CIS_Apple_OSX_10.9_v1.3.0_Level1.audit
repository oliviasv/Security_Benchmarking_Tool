#
# This script is Copyright (C) 2004-2020 and is owned by Tenable, Inc. or an Affiliate thereof.
#
# This script is released under the Tenable Subscription License and
# may not be used from within scripts released under another license
# without authorization from Tenable, Inc.
#
# See the following licenses for details:
#
# http://static.tenable.com/prod_docs/Nessus_6_SLA_and_Subscription_Agreement.pdf
#
# @PROFESSIONALFEED@
#
# $Revision: 1.9 $
# $Date: 2020/07/14 $
#
# description : This .audit file is written against the Center for Internet
#     Security benchmark for Apple OSX 10.9, version 1.3.0.
#     https://workbench.cisecurity.org/files/299
#
#<ui_metadata>
#<display_name>CIS Apple OSX 10.9 L1 v1.3.0</display_name>
#<spec>
#  <type>CIS</type>
#  <name>Apple OSX 10.9 L1</name>
#  <version>1.3.0</version>
#  <link>https://workbench.cisecurity.org/files/299</link>
#</spec>
#<labels>unix,cis,macosx,macosx_10,macosx_10.9,agent</labels>
#<benchmark_refs>LEVEL</benchmark_refs>
#<variables>
#  <variable>
#    <name>ACCESS_WARNING</name>
#    <default>[Aa]uthorized us(e|es) only</default>
#    <description>Login Window Text</description>
#    <info>An access warning informs the user that the system is reserved for authorized use only, and that the use of the system may be monitored.</info>
#  </variable>
#</variables>
#</ui_metadata>

<check_type:"Unix">

<if>
  <condition type:"AND">
    <custom_item>
      type        : CMD_EXEC
      description : "Mac OSX 10.9 Mavericks is installed"
      cmd         : "/usr/bin/sw_vers | /usr/bin/grep 'ProductVersion'"
      expect      : "^ProductVersion[\\s]*:[\\s]*10\.9"
    </custom_item>
  </condition>

  <then>
    <report type:"PASSED">
      description : "Apple OSX 10.9 Level 1, version 1.3.0"
      see_also    : "https://workbench.cisecurity.org/files/299"
    </report>

    <custom_item>
      type        : CMD_EXEC
      description : "1.1 Verify all Apple provided software is current"
      info        : "Software vendors release security patches and software updates for their products when security vulnerabilities are discovered. There is no simple way to complete this action without a network connection to an Apple software repository. Please ensure appropriate access for this control. This check is only for what Apple provides through software update.  It is important that these updates be applied in a timely manner to prevent unauthorized persons from exploiting the identified vulnerabilities."
      solution    : "Perform the following to ensure the system is configured as prescribed: Choose Apple (&#239;&#163;&#191;) menu &gt; Software Update #x2013; If prompted, enter an admin name and password. Install all available updates and software patches that are applicable. Alternatively: In Terminal, run the following:softwareupdate -l In Terminal, run the following for any packages that show up in step 1:sudo softwareupdate -i packagename Impact: Missing patches can lead to more exploit opportunities."
      reference   : "800-171|3.14.1,800-53|SI-2,CN-L3|8.1.10.5(a),CN-L3|8.1.10.5(b),CN-L3|8.1.4.4(e),CN-L3|8.5.4.1(b),CN-L3|8.5.4.1(d),CN-L3|8.5.4.1(e),CSF|ID.RA-1,CSF|PR.IP-12,ITSG-33|SI-2,LEVEL|1S,NESA|T7.6.2,NESA|T7.7.1,NIAv2|AM38,NIAv2|AM39,NIAv2|PR9,NIAv2|SS14b,SWIFT-CSCv1|2.2"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/sbin/softwareupdate -l 2>&1"
      expect      : "No new software available"
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "1.2 Enable Auto Update Checks"
      info         : "Auto Update verifies that your system has the newest security patches and software updates. If \"Automatically check for updates\" is not selected background updates for new malware definition files from Apple for XProtect and Gatekeeper will not occur. http://macops.ca/os-x-admins-your-clients-are-not-getting-background-security-updates/ https://derflounder.wordpress.com/2014/12/17/forcing-xprotect-blacklist-updates-on-mavericks-and-yosemite/  It is important that a system has the newest updates applied so as to prevent unauthorized persons from exploiting identified vulnerabilities."
      solution     : "Perform the following to implement the prescribed state: Open a terminal session and enter the following command to enable the auto update feature: sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate AutomaticCheckEnabled -int 1 Impact: Without automatic update, updates may not be made in a timely manner and the system will be exposed to additional risk."
      reference    : "800-171|3.14.1,800-53|SI-2(5),CSF|ID.RA-1,CSF|PR.IP-12,LEVEL|1S,NIAv2|NS26b,SWIFT-CSCv1|2.2"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "1"
      plist_item   : "AutomaticCheckEnabled"
      plist_name   : "/Library/Preferences/com.apple.SoftwareUpdate"
      plist_option : CANNOT_BE_NULL
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "1.3 Enable app update installs"
      info         : "Ensure that application updates are installed after they are available from Apple. These updates do not require reboots or admin privileges for end users.  Patches need to be applied in a timely manner to reduce the risk of vulnerabilities being exploited"
      solution     : "Perform the following to implement the prescribed state: Open a terminal session and enter the following command to enable the auto update feature: sudo defaults write /Library/Preferences/com.apple.storeagent AutoUpdate -int 1 The remediation requires a log out and log in to show in the GUI. Please note that. Impact: Unpatched software may be exploited"
      reference    : "800-171|3.14.1,800-53|SI-2(5),CSF|ID.RA-1,CSF|PR.IP-12,LEVEL|1S,NIAv2|NS26b,SWIFT-CSCv1|2.2"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "1"
      plist_item   : "AutoUpdate"
      plist_name   : "/Library/Preferences/com.apple.storeagent"
      plist_option : CANNOT_BE_NULL
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "1.4 Enable system data files and security update installs - ConfigDataInstall"
      info         : "Ensure that system and security updates are installed after they are available from Apple. This setting enables definition updates for XProtect and Gatekeeper, with this setting in place new malware and adware that Apple has added to the list of malware or untrusted software will not execute. These updates do not require reboots or end user admin rights. http://www.thesafemac.com/tag/xprotect/ https://support.apple.com/en-us/HT202491  Patches need to be applied in a timely manner to reduce the risk of vulnerabilities being exploited"
      solution     : "Perform the following to implement the prescribed state: Open a terminal session and enter the following command to enable install system data files and security updates: sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate ConfigDataInstall -bool true &amp;&amp; sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate CriticalUpdateInstall -bool true Impact: Unpatched software may be exploited"
      reference    : "800-171|3.14.1,800-53|SI-2(5),CSF|ID.RA-1,CSF|PR.IP-12,LEVEL|1S,NIAv2|NS26b,SWIFT-CSCv1|2.2"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "1"
      plist_item   : "ConfigDataInstall"
      plist_name   : "/Library/Preferences/com.apple.SoftwareUpdate"
      plist_option : CANNOT_BE_NULL
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "1.4 Enable system data files and security update installs - CriticalUpdateInstall"
      info         : "Ensure that system and security updates are installed after they are available from Apple. This setting enables definition updates for XProtect and Gatekeeper, with this setting in place new malware and adware that Apple has added to the list of malware or untrusted software will not execute. These updates do not require reboots or end user admin rights. http://www.thesafemac.com/tag/xprotect/ https://support.apple.com/en-us/HT202491  Patches need to be applied in a timely manner to reduce the risk of vulnerabilities being exploited"
      solution     : "Perform the following to implement the prescribed state: Open a terminal session and enter the following command to enable install system data files and security updates: sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate ConfigDataInstall -bool true &amp;&amp; sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate CriticalUpdateInstall -bool true Impact: Unpatched software may be exploited"
      reference    : "800-171|3.14.1,800-53|SI-2(5),CSF|ID.RA-1,CSF|PR.IP-12,LEVEL|1S,NIAv2|NS26b,SWIFT-CSCv1|2.2"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "1"
      plist_item   : "CriticalUpdateInstall"
      plist_name   : "/Library/Preferences/com.apple.SoftwareUpdate"
      plist_option : CANNOT_BE_NULL
    </custom_item>

    <if>
      <condition type:"AND">
        <custom_item>
          type         : MACOSX_DEFAULTS_READ
          description  : "2.1.1 Turn off Bluetooth, if no paired devices exist"
          regex        : "0"
          plist_item   : "ControllerPowerState"
          plist_name   : "/Library/Preferences/com.apple.Bluetooth"
          plist_option : CANNOT_BE_NULL
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "2.1.1 Turn off Bluetooth, if no paired devices exist"
          info        : "Bluetooth devices use a wireless communications system that replaces the cables used by other peripherals to connect to a system. It is by design a peer-to-peer network technology and typically lacks centralized administration and security enforcement infrastructure.  Bluetooth is particularly susceptible to a diverse set of security vulnerabilities involving identity detection, location tracking, denial of service, unintended control and access of data and voice channels, and unauthorized device control and data access."
          solution    : "Perform the following to implement the prescribed state: In Terminal, run the following commands: sudo defaults write /Library/Preferences/com.apple.Bluetooth \ ControllerPowerState -int 0 sudo killall -HUP blued Impact: There have been many Bluetooth exploits , while Bluetooth can be hardened it does create a local wireless network that can be attacked to compromise both devices and information."
          reference   : "LEVEL|1S"
          see_also    : "https://workbench.cisecurity.org/files/299"
        </report>
      </then>

      <else>
        <if>
          <condition type:"AND">
            <custom_item>
              type        : CMD_EXEC
              description : "2.1.1 Turn off Bluetooth, if no paired devices exist"
              cmd         : "/usr/sbin/system_profiler | /usr/bin/grep 'Bluetooth:' -A 20 | /usr/bin/grep Connectable"
              expect      : "Connectable: Yes"
            </custom_item>
          </condition>

          <then>
            <report type:"PASSED">
              description : "2.1.1 Disable Bluetooth, if no paired devices exist"
              info        : "Bluetooth devices use a wireless communications system that replaces the cables used by other peripherals to connect to a system. It is by design a peer-to-peer network technology and typically lacks centralized administration and security enforcement infrastructure.  Bluetooth is particularly susceptible to a diverse set of security vulnerabilities involving identity detection, location tracking, denial of service, unintended control and access of data and voice channels, and unauthorized device control and data access."
              solution    : "Perform the following to implement the prescribed state: In Terminal, run the following commands: sudo defaults write /Library/Preferences/com.apple.Bluetooth \ ControllerPowerState -int 0 sudo killall -HUP blued Impact: There have been many Bluetooth exploits , while Bluetooth can be hardened it does create a local wireless network that can be attacked to compromise both devices and information."
              reference   : "LEVEL|1S"
              see_also    : "https://workbench.cisecurity.org/files/299"
            </report>
          </then>

          <else>
            <report type:"FAILED">
              description : "2.1.1 Disable Bluetooth, if no paired devices exist"
              info        : "Bluetooth devices use a wireless communications system that replaces the cables used by other peripherals to connect to a system. It is by design a peer-to-peer network technology and typically lacks centralized administration and security enforcement infrastructure.  Bluetooth is particularly susceptible to a diverse set of security vulnerabilities involving identity detection, location tracking, denial of service, unintended control and access of data and voice channels, and unauthorized device control and data access."
              solution    : "Perform the following to implement the prescribed state: In Terminal, run the following commands: sudo defaults write /Library/Preferences/com.apple.Bluetooth \ ControllerPowerState -int 0 sudo killall -HUP blued Impact: There have been many Bluetooth exploits , while Bluetooth can be hardened it does create a local wireless network that can be attacked to compromise both devices and information."
              reference   : "LEVEL|1S"
              see_also    : "https://workbench.cisecurity.org/files/299"
            </report>
          </else>
        </if>
      </else>
    </if>

    <custom_item>
      type        : CMD_EXEC
      description : "2.1.2 Turn off Bluetooth \"Discoverable\" mode when not pairing devices"
      info        : "When Bluetooth is set to discoverable mode, the Mac sends a signal indicating that it's available to pair with another Bluetooth device. When a device is \"discoverable\" it broadcasts information about itself and it's location. Starting with OS X 10.9 Discoverable mode is enabled while the Bluetooth System Preference is open and turned off once closed. Systems that have the Bluetooth System Preference open at the time of audit will show as Discoverable.  When in the discoverable state an unauthorized user could gain access to the system by pairing it with a remote device."
      solution    : "Perform the following to implement the prescribed state: Starting with OS X (10.9) Bluetooth is only set to Discoverable when the Bluetooth System Preference is selected. To ensure that the computer is not Discoverable do not leave that preference open. Impact: The system will need to be made Discoverable in order to easily pair Bluetooth peripherals"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|1S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/sbin/system_profiler SPBluetoothDataType | /usr/bin/grep -i discoverable"
      expect      : "Discoverable:[\\s]*Off"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.1.3 Show Bluetooth status in menu bar"
      info        : "By showing the Bluetooth status in the menu bar, a small Bluetooth icon is placed in the menu bar. This icon quickly shows the status of Bluetooth, and can allow the user to quickly turn Bluetooth on or off.  Enabling \"Show Bluetooth status in menu bar\" is a security awareness method that helps understand the current state of Bluetooth, including whether it is enabled, Discoverable, what paired devices exist and are currently active."
      solution    : "In System Preferences: Bluetooth, turn Show Bluetooth Status In Menu Bar on. Alternatively run the following in the command line: defaults write com.apple.systemuiserver menuExtras -array-add \"/System/Library/CoreServices/Menu Extras/Bluetooth.menu\" Impact: Bluetooth is a useful wireless tool that has been widely exploited when configured improperly. The user should have insight into the Bluetooth status."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|1S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/defaults read com.apple.systemuiserver menuExtras | /usr/bin/grep Bluetooth.menu"
      expect      : "/System/Library/CoreServices/Menu Extras/Bluetooth\\.menu"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.2.2 Ensure time set is within appropriate limits"
      info        : "Correct date and time settings are required for authentication protocols, file creation, modification dates and log entries. Ensure that time on the computer is within acceptable limits. Truly accurate time is measured within milliseconds, for this audit a drift under four and a half minutes passes the control check. Since Kerberos is one of the important features of OS X integration into Directory systems the guidance here is to warn you before there could be an impact to operations. From the perspective of accurate time this check is not strict, it may be too great for your organization, adjust to a smaller offset value as needed.  Kerberos may not operate correctly if the time on the Mac is off by more than 5 minutes. This in turn can affect Apple's single sign-on feature, Active Directory logons, and other features. Audit check is for more than 4 minutes and 30 seconds ahead or behind.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution    : "Perform the following to implement the prescribed state: In Terminal, run the following command:sudo systemsetup -getnetworktimeserver Use \"Network Time Server:\" your.time.server to capture drift sudo ntpdate -sv your.time.server Impact: Accurate time is required for many computer functions."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|1S,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "ntpdate -svd `sudo /usr/sbin/systemsetup -getnetworktimeserver | cut -d \' \' -f 4` | egrep offset"
      expect      : ""
      severity    : MEDIUM
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.2.3 Restrict NTP server to loopback interface"
      info        : "The Apple System Preference setting to \"Set date and time automatically\" enables both an NTP client that can synchronize the time from known time server(s) and an open listening NTP server that can be used by any other computer that can connect to port 123 on the time syncing computer. This open listening service can allow for both exploits of future NTP vulnerabilities and allow for open ports that can be used for fingerprinting to target exploits. Access to this port should be restricted. Editing the /etc/ntp-restrict.conf file by adding a control on the loopback interface limits external access. Add the following restrict lo interface ignore wildcard interface listen lo  Mobile workstations on untrusted networks should not have open listening services available to other nodes on the network."
      solution    : "Perform the following to implement the prescribed state: Run the following command in Terminal: sudo vim /etc/ntp-restrict.conf Add the following lines to the file restrict lo interface ignore wildcard interface listen lo"
      reference   : "800-171|3.13.2,800-171|3.13.5,800-53|SC-7(13),CN-L3|8.1.10.6(h),CSF|PR.AC-5,CSF|PR.PT-4,ITSG-33|SC-7(13),LEVEL|1S,NIAv2|GS7d,SWIFT-CSCv1|3.1"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/bin/cat /etc/ntp-restrict.conf | /usr/bin/grep \'restrict lo\'"
      expect      : "restrict[\\s]*lo"
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "2.3.1 Set an inactivity interval of 20 minutes or less for the screen saver"
      info         : "A locking screensaver is one of the standard security controls to limit access to a computer and the current user's session when the computer is temporarily unused or unattended. In OS X the screensaver starts after a value selected in a drop down menu, 10 minutes and 20 minutes are both options and either is acceptable. Any value can be selected through the command line or script but a number that is not reflected in the GUI can be problematic. 20 minutes is the default for new accounts.  Setting an inactivity interval for the screensaver prevents unauthorized persons from viewing a system left unattended for an extensive period of time."
      solution     : "Perform the following to implement the prescribed state: Open System Preferences Select Desktop &amp; Screen Saver Select Screen Saver Set Start after to 20 minutes or less Alternatively: In Terminal, run one of the the following commands:defaults -currentHost write com.apple.screensaver idleTime -int 600 defaults -currentHost write com.apple.screensaver idleTime -int 1200 There are anomalies if the command line is used make the setting something other than what is available in the GUI Menu. Choose either 10 minutes or 20 minutes, Impact: If the screensaver is not set users may leave the computer available for an unauthorized person to access information."
      reference    : "800-171|3.1.10,800-53|AC-11,CN-L3|8.1.4.1(b),CSCv6|16.5,ISO/IEC-27001|A.11.2.8,ITSG-33|AC-11,LEVEL|1S,NIAv2|AM23c,NIAv2|AM23d"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "^([1-9]|[1-9][0-9]|[1-9][0-9][0-9]|1[0-1][0-9][0-9]|1200)$"
      plist_item   : "idleTime"
      plist_name   : "com.apple.screensaver"
      plist_option : CANNOT_BE_NULL
      plist_user   : "all"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.3.3 Verify Display Sleep is set to a value larger than the Screen Saver"
      info        : "If the Screen Saver is used to lock the screen, verify the Display Sleep settings are longer than the Screen Saver setting. If the display goes to sleep before the screen saver activates, the computer will appear to be off, but will be unprotected.  Users of the system can easily assume that the computer is protected when the display goes to sleep. The computer should be configured so that the screen is locked whenever the display turns off automatically."
      solution    : "In System Preferences: Energy Saver, drag the slider for \"Put the display(s) to sleep...\" to a reasonable number, but longer than the screen saver setting. The Mac will display a warning if the number is too short. Alternatively, use the following command: sudo pmset -c displaysleep 0 Note: The -c flag means \"wall power.\" Different settings must be used for other power sources. Impact: If the display sleeps before the screensaver is active the computer may be unlocked and available for an unauthorized user."
      reference   : "800-171|3.1.10,800-53|AC-11,CN-L3|8.1.4.1(b),CSCv6|16.5,ISO/IEC-27001|A.11.2.8,ITSG-33|AC-11,LEVEL|1NS,NIAv2|AM23c,NIAv2|AM23d"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/pmset -g | /usr/bin/grep displaysleep"
      expect      : "^[\\s]*displaysleep[\\s]+(0|[1-9]\\d{1,})[\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.3.4 Set a screen corner to Start Screen Saver"
      info        : "The intent of this control is to resemble control-alt-delete on Windows Systems as a means of quickly locking the screen. If the user of the system is stepping away from the computer the best practice is to lock the screen and setting a hot corner is an appropriate method.  Ensuring the user has a quick method to lock their screen may reduce opportunity for individuals in close physical proximity of the device to see screen contents."
      solution    : "In System Preferences: Desktop &amp; Screen Saver: Screen Saver: Hot Corners, make sure at least one Active Screen Corner is set to Start Screen Saver. Make sure the user knows about this feature. The screen corners can be set using the defaults command, but the permutations of combinations are many. The plist file to check is ~/Library/Preferences/com.apple.dock and the keys are wvous-bl-cornerwvous-br-corner wvous-tl-corner wvous-tr-corner There are also modifier keys to check and various values for each of these keys. A value of 5 means the corner will start the screen saver. The corresponding wvous-xx-modifier key should be set to 0."
      reference   : "800-171|3.1.10,800-53|AC-11,CN-L3|8.1.4.1(b),ISO/IEC-27001|A.11.2.8,ITSG-33|AC-11,LEVEL|1S,NESA|T2.3.8,NESA|T2.3.9,NIAv2|AM23a,NIAv2|AM23b"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/defaults read ~/Library/Preferences/com.apple.dock | /usr/bin/grep -i corner"
      expect      : "\".*-corner\"[\\s]*=[\\s]*5;$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.4.1 Disable Remote Apple Events"
      info        : "Apple Events is a technology that allows one program to communicate with other programs. Remote Apple Events allows a program on one computer to communicate with a program on a different computer.  Disabling Remote Apple Events mitigates the risk of an unauthorized program gaining access to the system."
      solution    : "Perform the following to implement the prescribed state: Run the following command in Terminal: sudo systemsetup -setremoteappleevents off Impact: With remote Apple events turned on, an AppleScript program running on another Mac can interact with the local computer."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|1S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/sbin/systemsetup -getremoteappleevents"
      expect      : "^Remote Apple Events:[\\s]*Off"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.4.2 Disable Internet Sharing"
      info        : "Internet Sharing uses the open source natd process to share an internet connection with other computers and devices on a local network. This allows the Mac to function as a router and share the connection to other, possibly unauthorized, devices.  Disabling Internet Sharing reduces the remote attack surface of the system."
      solution    : "Perform the following to implement the prescribed state: Open System Preferences Select Sharing Uncheck Internet Sharing Impact: Internet sharing allows the computer to function as a router and other computers to use it for access. This can expose both the computer itself and the networks it is accessing to unacceptable access from unapproved devices."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|1S,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/defaults read /Library/Preferences/SystemConfiguration/com.apple.nat | /usr/bin/grep -i Enabled | /usr/bin/grep -v 0 | /usr/bin/awk \'{print} END {if (NR == 0) print\"pass\"}\'"
      expect      : "pass"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.4.3 Disable Screen Sharing"
      info        : "Screen sharing allows a computer to connect to another computer on a network and display the computer#x2019;s screen. While sharing the computer#x2019;s screen, the user can control what happens on that computer, such as opening documents or applications, opening, moving, or closing windows, and even shutting down the computer.  Disabling screen sharing mitigates the risk of remote connections being made without the user of the console knowing that they are sharing the computer."
      solution    : "Perform the following to implement the prescribed state: Open System Preferences Select Sharing Uncheck Screen Sharing"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|1S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/bin/launchctl load /System/Library/LaunchDaemons/com.apple.screensharing.plist"
      expect      : "nothing[\\s]+found[\\s]+to[\\s]+load"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.4.4 Disable Printer Sharing"
      info        : "By enabling Printer sharing the computer is set up as a print server to accept print jobs from other computers. Dedicated print servers or direct IP printing should be used instead.  Disabling Printer Sharing mitigates the risk of attackers attempting to exploit the print server to gain access to the system."
      solution    : "Perform the following to implement the prescribed state: Open System Preferences Select Sharing Uncheck Printer Sharing"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|1S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/sbin/system_profiler SPPrintersDataType"
      expect      : "The[\\s]*printers[\\s]*list[\\s]*is[\\s]*empty"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.4.5 Disable Remote Login"
      info        : "Remote Login allows an interactive terminal connection to a computer.  Disabling Remote Login mitigates the risk of an unauthorized person gaining access to the system via Secure Shell (SSH). While SSH is an industry standard to connect to posix servers, the scope of the benchmark is for Apple OSX clients, not servers. OS X does have an IP based firewall available (pf, ipfw has been deprecated) that is not enabled or configured. There are more details and links in section 7.5. OS X no longer has TCP Wrappers support built-in and does not have strong Brute-Force password guessing mitigations, or frequent patching of openssh by Apple. Most OS X computers are mobile workstations, managing IP based firewall rules on mobile devices can be very resource intensive. All of these factors can be parts of running a hardened SSH server."
      solution    : "Perform the following to implement the prescribed state: Run the following command in Terminal: sudo systemsetup -setremotelogin off Impact: The SSH server built-in to OS X should not be enabled on a standard user computer, particularly one that changes locations and IP addresses. A standard user that runs local applications including email, web browser and productivity tools should not use the same device as a server. There are Enterprise management tool-sets that do utilize SSH, if they are in use, the computer should be locked down to only respond to known trusted IP addresses and appropriate admin service accounts. For OS X computers that are being used for specialized functions there are several options to harden the SSH server to protect against unauthorized access including brute force attacks. There are some basic criteria that need to be considered: Do not open an SSH server to the internet without controls in place to mitigate SSH brute force attacks, this is particularly important for systems bound to Directory environments. It is great to have controls in place to protect the system but if they trigger after the user is already locked out of their account they are not optimal. If authorization happens after authentication directory accounts for users that don't even use the system can be locked out. Do not use SSH key pairs when there is no insight to the security on the client system that will authenticate into the server with a private key. If an attacker gets access to the remote system and can find the key they may not need a password or a key logger to access the SSH server. Detailed instructions on hardening an SSH server, if needed, are available in the CIS Linux Benchmarks but it is beyond the scope of this benchmark"
      reference   : "800-171|3.1.1,800-171|3.1.2,800-53|AC-17,CIP|005-5-R2,CN-L3|8.1.10.6(i),CN-L3|8.1.4.4(c),CSF|PR.AC-3,CSF|PR.PT-4,ISO/IEC-27001|A.6.2.2,ITSG-33|AC-17,LEVEL|1S,NESA|T5.4.5,SWIFT-CSCv1|2.6"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "sudo /usr/sbin/systemsetup -getremotelogin"
      expect      : "^Remote[\\s]*Login:[\\s]*Off$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.4.6 Disable DVD or CD Sharing"
      info        : "DVD or CD Sharing allows users to remotely access the system's optical drive.  Disabling DVD or CD Sharing minimizes the risk of an attacker using the optical drive as a vector for attack and exposure of sensitive data."
      solution    : "Perform the following to implement the prescribed state: Open System Preferences Select Sharing Uncheck DVD or CD Sharing Impact: Many Apple devices are now sold without optical drives and drive sharing may be needed for legacy optical media."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|1S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/bin/launchctl list | /usr/bin/egrep ODSAgent | /usr/bin/awk \'{print} END {if (NR == 0) print \"none\"}\'"
      expect      : "none"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.4.7 Disable Bluetooth Sharing"
      info        : "Bluetooth Sharing allows files to be exchanged with Bluetooth enabled devices.  Disabling Bluetooth Sharing minimizes the risk of an attacker using Bluetooth to remotely attack the system."
      solution    : "Perform the following to implement the prescribed state: Open System Preferences Select Sharing Uncheck Bluetooth Sharing"
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|1S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "system_profiler SPBluetoothDataType | grep State | /usr/bin/awk \'{print} END {if (NR == 0) print \"none\"}\'"
      expect      : "(none|State:[\\s]*Disabled)"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.4.8 Disable File Sharing - AppleFileServer"
      info        : "Apple's File Sharing uses a combination of SMB (Windows sharing) and AFP (Mac sharing) Three common ways to share files using File Sharing are: Apple File Protocol (AFP)AFP automatically uses encrypted logins, so this method of sharing files is fairly secure. The entire hard disk is shared to administrator user accounts. Individual home folders are shared to their respective user accounts. Users' \"Public\" folders (and the \"Drop Box\" folder inside) are shared to any user account that has sharing access to the computer (i.e. anyone in the \"staff\" group, including the guest account if it is enabled). Server Message Block (SMB), Common Internet File System (CIFS)When Windows (or possibly Linux) computers need to access file shared on a Mac, SMB/CIFS file sharing is commonly used. Apple warns that SMB sharing stores passwords is a less secure fashion than AFP sharing and anyone with system access can gain access to the password for that account. When sharing with SMB, each user that will access the Mac must have SMB enabled.  By disabling file sharing, the remote attack surface and risk of unauthorized access to files stored on the system is reduced."
      solution    : "Perform the following to implement the prescribed state: Run the following command in Terminal to turn off AFP from the command line:sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.AppleFileServer.plist Run the following command in Terminal to turn off SMB sharing from the CLI: sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.smbd.plist Impact: File Sharing can be used to share documents with other users but hardened servers should be used rather than user endpoints. Turning on file sharing increases the visibility and attack surface of a system unnecessarily."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|1S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/bin/launchctl list | /usr/bin/grep AppleFileServer | /usr/bin/awk \'{print} END {if (NR == 0) print \"none\"}\'"
      expect      : "none"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.4.8 Disable File Sharing - smb"
      info        : "Apple's File Sharing uses a combination of SMB (Windows sharing) and AFP (Mac sharing) Three common ways to share files using File Sharing are: Apple File Protocol (AFP)AFP automatically uses encrypted logins, so this method of sharing files is fairly secure. The entire hard disk is shared to administrator user accounts. Individual home folders are shared to their respective user accounts. Users' \"Public\" folders (and the \"Drop Box\" folder inside) are shared to any user account that has sharing access to the computer (i.e. anyone in the \"staff\" group, including the guest account if it is enabled). Server Message Block (SMB), Common Internet File System (CIFS)When Windows (or possibly Linux) computers need to access file shared on a Mac, SMB/CIFS file sharing is commonly used. Apple warns that SMB sharing stores passwords is a less secure fashion than AFP sharing and anyone with system access can gain access to the password for that account. When sharing with SMB, each user that will access the Mac must have SMB enabled.  By disabling file sharing, the remote attack surface and risk of unauthorized access to files stored on the system is reduced."
      solution    : "Perform the following to implement the prescribed state: Run the following command in Terminal to turn off AFP from the command line:sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.AppleFileServer.plist Run the following command in Terminal to turn off SMB sharing from the CLI: sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.smbd.plist Impact: File Sharing can be used to share documents with other users but hardened servers should be used rather than user endpoints. Turning on file sharing increases the visibility and attack surface of a system unnecessarily."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|1S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "sudo /bin/launchctl list | /usr/bin/egrep \'(smdb|nmdb)\' | /usr/bin/awk \'{print} END {if (NR == 0) print \"none\"}\'"
      expect      : "none"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.4.9 Disable Remote Management - 'ARDAgent is not running'"
      info        : "Remote Management is the client portion of Apple Remote Desktop (ARD). Remote Management can be used by remote administrators to view the current Screen, install software, report on, and generally manage client Macs. The screen sharing options in Remote Management are identical to those in the Screen Sharing section. In fact, only one of the two can be configured. If Remote Management is used, refer to the Screen Sharing section above on issues regard screen sharing. Remote Management should only be enabled when a Directory is in place to manage the accounts with access. Computers will be available on port 5900 on an OS X System and could accept connections from untrusted hosts depending on the configuration, definitely a concern for mobile systems.  Remote management should only be enabled on trusted networks with strong user controls present in a Directory system. Mobile devices without strict controls are vulnerable to exploit and monitoring."
      solution    : "In System Preferences: Sharing, turn off Remote Management. Impact: Many organizations utilize ARD for client management."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|1S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/bin/ps -ef | /usr/bin/egrep ARDAgent | /usr/bin/grep -v egrep | /usr/bin/awk '{print} END {if (NR == 0) print \"none\"}'"
      expect      : "none"
    </custom_item>

    <custom_item>
      type        : FILE_CHECK_NOT
      description : "2.4.9 Disable Remote Management - 'ARDAgent file does not exist'"
      info        : "Remote Management is the client portion of Apple Remote Desktop (ARD). Remote Management can be used by remote administrators to view the current Screen, install software, report on, and generally manage client Macs. The screen sharing options in Remote Management are identical to those in the Screen Sharing section. In fact, only one of the two can be configured. If Remote Management is used, refer to the Screen Sharing section above on issues regard screen sharing. Remote Management should only be enabled when a Directory is in place to manage the accounts with access. Computers will be available on port 5900 on an OS X System and could accept connections from untrusted hosts depending on the configuration, definitely a concern for mobile systems.  Remote management should only be enabled on trusted networks with strong user controls present in a Directory system. Mobile devices without strict controls are vulnerable to exploit and monitoring."
      solution    : "In System Preferences: Sharing, turn off Remote Management. Impact: Many organizations utilize ARD for client management."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CIP|007-6-R1,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSCv6|9.1,CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|1S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,PCI-DSSv3.1|2.2.2,PCI-DSSv3.1|2.2.3,PCI-DSSv3.2|2.2.2,PCI-DSSv3.2|2.2.3,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      file        : "/System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/MacOS/ARDAgent"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.6.1 Enable FileVault - Encryption Status"
      info        : "FileVault secures a system's data by automatically encrypting its boot volume and requiring a password or recovery key to access it.  Encrypting sensitive data minimizes the likelihood of unauthorized users gaining access to it."
      solution    : "Perform the following to implement the prescribed state: Open System Preferences Select Security &amp; Privacy Select FileVault Select Turn on FileVault"
      reference   : "800-171|3.13.11,800-53|SC-13,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,LEVEL|1S,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/sbin/diskutil cs list | /usr/bin/grep -i encryption"
      expect      : "Encryption Status:[\\s]*Unlocked"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.6.1 Enable FileVault - Encryption Type"
      info        : "FileVault secures a system's data by automatically encrypting its boot volume and requiring a password or recovery key to access it.  Encrypting sensitive data minimizes the likelihood of unauthorized users gaining access to it."
      solution    : "Perform the following to implement the prescribed state: Open System Preferences Select Security &amp; Privacy Select FileVault Select Turn on FileVault"
      reference   : "800-171|3.13.11,800-53|SC-13,CSF|PR.DS-5,ISO/IEC-27001|A.10.1.1,ITSG-33|SC-13,LEVEL|1S,NESA|M5.2.6,NESA|T7.4.1,NIAv2|CY3,NIAv2|CY4,NIAv2|CY5b,NIAv2|CY5c,NIAv2|CY5d,NIAv2|CY7,NIAv2|NS5e"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/sbin/diskutil cs list | /usr/bin/grep -i encryption"
      expect      : "Encryption Type:[\\s]*AES-XTS"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.6.2 Enable Gatekeeper"
      info        : "Gatekeeper is Apple's application white-listing control that restricts downloaded applications from launching. It functions as a control to limit applications from unverified sources from running without authorization.  Disallowing unsigned software will reduce the risk of unauthorized or malicious applications from running on the system."
      solution    : "Perform the following to implement the prescribed state: Open System Preferences Select Security &amp; Privacy Select General Select Allow applications downloaded from: Mac App Store and identified developers Alternatively, perform the following to ensure the system is configured as: Run the following command in Terminal: sudo spctl --master-enable"
      reference   : "800-171|3.4.8,800-53|CM-7(4),CSF|PR.IP-1,CSF|PR.PT-3,ISO/IEC-27001|A.12.6.2,LEVEL|1S,NIAv2|SS13a,SWIFT-CSCv1|2.3,TBA-FIISB|44.2.2,TBA-FIISB|49.2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/sbin/spctl --status"
      expect      : "assessments[\\s]*enabled"
    </custom_item>

    <custom_item>
      type          : CMD_EXEC
      description   : "2.6.3 Enable Firewall"
      info          : "A firewall is a piece of software that blocks unwanted incoming connections to a system. Apple has posted general documentation about the application firewall. http://support.apple.com/en-us/HT201642  A firewall minimizes the threat of unauthorized users from gaining access to your system while connected to a network or the Internet."
      solution      : "Perform the following to implement the prescribed state: Open System Preferences Select Security &amp; Privacy Select Firewall Select Turn On Firewall Alternatively: Run the following command in Terminal: defaults write /Library/Preferences/com.apple.alf globalstate - int &lt;value&gt; Where &lt;value&gt; is: 1 = on for specific services 2 = on for essential services Impact: The firewall may block legitimate traffic. Applications that are unsigned will require special handling."
      reference     : "800-171|3.13.1,800-53|SC-7(12),CSCv6|9.2,ITSG-33|SC-7(12),LEVEL|1S,NIAv2|AM38,NIAv2|SS13d,NIAv2|SS26"
      see_also      : "https://workbench.cisecurity.org/files/299"
      cmd           : "/usr/bin/defaults read /Library/Preferences/com.apple.alf globalstate"
      expect        : "[12]"
      dont_echo_cmd : YES
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.6.4 Enable Firewall Stealth Mode"
      info        : "While in Stealth mode the computer will not respond to unsolicited probes, dropping that traffic. http://support.apple.com/en-us/HT201642  Stealth mode on the firewall minimizes the threat of system discovery tools while connected to a network or the Internet."
      solution    : "Perform the following to implement the prescribed state: Open System Preferences Select Security &amp; Privacy Select Firewall Options Select Enable stealth mode Alternatively: Run the following command in Terminal: sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setstealthmode on Impact: Traditional network discovery tools like ping will not succeed. Other network tools that measure activity and approved applications will work as expected."
      reference   : "800-171|3.13.1,800-53|SC-7(12),CSCv6|9.2,ITSG-33|SC-7(12),LEVEL|1S,NIAv2|AM38,NIAv2|SS13d,NIAv2|SS26"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/libexec/ApplicationFirewall/socketfilterfw --getstealthmode"
      expect      : "Stealth mode enabled"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.6.5 Review Application Firewall Rules"
      info        : "A firewall is a piece of software that blocks unwanted incoming connections to a system. Apple has posted general documentation about the application firewall. http://support.apple.com/en-us/HT201642 A computer should have a limited number of applications open to incoming connectivity. This rule will check for whether there are more than 10 rules for inbound connections.  A firewall minimizes the threat of unauthorized users from gaining access to your system while connected to a network or the Internet. Which applications are allowed access to accept incoming connections through the firewall is important to understand."
      solution    : "Perform the following to implement the prescribed state: Open System Preferences Select Security &amp; Privacy Select Firewall Select Turn On Firewall Alternatively: Run the following command in Terminal: defaults write /Library/Preferences/com.apple.alf globalstate - int &lt;value&gt; Where &lt;value&gt; is: 1 = on for specific services 2 = on for essential services Impact: The firewall may block legitimate traffic. Applications that are unsigned will require special handling."
      reference   : "800-171|3.13.1,800-53|SC-7(12),CSCv6|9.2,ITSG-33|SC-7(12),LEVEL|1S,NIAv2|AM38,NIAv2|SS13d,NIAv2|SS26"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/libexec/ApplicationFirewall/socketfilterfw --listapps | /usr/bin/grep Allow | /usr/bin/wc -l"
      expect      : "^[\\s]*([0-9]|10)[\\s]*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "2.8.2 Time Machine Volumes Are Encrypted"
      info        : "One of the most important security tools for data protection on MacOS is FileVault. With encryption in place it makes it difficult for an outside party to access your data if they get physical possession of the computer. One very large weakness in data protection with FileVault is the level of protection on backup volumes. If the internal drive is encrypted but the external backup volume that goes home in the same laptop bag is not it is self-defeating. Apple tries to make this mistake easily avoided by providing a checkbox to enable encryption when setting-up a time machine backup. Using this option does require some password management, particularly if a large drive is used with multiple computers. A unique complex password to unlock the drive can be stored in keychains on multiple systems for ease of use. While some portable drives may contain non-sensitive data and encryption may make interoperability with other systems difficult backup volumes should be protected just like boot volumes.  Backup volumes need to be encrypted.

NOTE: Nessus has provided the target output to assist in reviewing the benchmark to ensure target compliance."
      solution    : "Ensure that backup volumes are encrypted using the Time Machine control or using Disk Utility"
      reference   : "800-171|3.13.16,800-53|SC-28(1),CSF|PR.DS-1,ITSG-33|SC-28(1),LEVEL|1NS,TBA-FIISB|28.1"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/tmutil destinationinfo"
      expect      : ""
      severity    : MEDIUM
    </custom_item>

    <if>
      <condition type:"AND">
        <custom_item>
          type         : MACOSX_DEFAULTS_READ
          description  : "Remote control infrared receiver disabled"
          regex        : "0"
          plist_item   : "DeviceEnabled"
          plist_name   : "/Library/Preferences/com.apple.driver.AppleIRController"
          plist_option : CANNOT_BE_NULL
        </custom_item>
      </condition>

      <then>
        <report type:"PASSED">
          description : "2.9 Pair the remote control infrared receiver if enabled"
          info        : "An infrared receiver is a piece of hardware that sends information from an infrared remote control to another device by receiving and decoding signals. If a remote is used with a computer, a specific remote, or \"pair\", can be set-up to work with the computer. This will allow only the paired remote to work on that computer. If a remote is needed the receiver should only be accessible by a paired device. Many models do not have infrared hardware. The audit check looks for the hardware first.  An infrared remote can be used from a distance to circumvent physical security controls. A remote could also be used to page through a document or presentation, thus revealing sensitive information."
          solution    : "Perform one of the following to implement the prescribed state: Disable the remote control infrared receiver: Open System Preferences Select Security &amp; Privacy Select the General tab Select Advanced Check Disable remote control infrared receiver Pair a remote control infrared receiver Holding the remote close to the computer, point the remote at the front of the computer. Pair the Apple Remote. If you have an Apple Remote with seven buttons, press and hold both the Right and Menu buttons on the remote until the paired-remote icon appears on your screen If you have an Apple Remote with six buttons, press and hold both the Next and Menu buttons on the remote until the paired-remote icon appears on your screen"
          reference   : "LEVEL|1S"
          see_also    : "https://workbench.cisecurity.org/files/299"
        </report>
      </then>

      <else>
        <custom_item>
          type         : MACOSX_DEFAULTS_READ
          description  : "2.9 Pair the remote control infrared receiver if enabled - 'DeviceEnabled = 1'"
          info         : "An infrared receiver is a piece of hardware that sends information from an infrared remote control to another device by receiving and decoding signals. If a remote is used with a computer, a specific remote, or \"pair\", can be set-up to work with the computer. This will allow only the paired remote to work on that computer. If a remote is needed the receiver should only be accessible by a paired device. Many models do not have infrared hardware. The audit check looks for the hardware first.  An infrared remote can be used from a distance to circumvent physical security controls. A remote could also be used to page through a document or presentation, thus revealing sensitive information."
          solution     : "Perform one of the following to implement the prescribed state: Disable the remote control infrared receiver: Open System Preferences Select Security &amp; Privacy Select the General tab Select Advanced Check Disable remote control infrared receiver Pair a remote control infrared receiver Holding the remote close to the computer, point the remote at the front of the computer. Pair the Apple Remote. If you have an Apple Remote with seven buttons, press and hold both the Right and Menu buttons on the remote until the paired-remote icon appears on your screen If you have an Apple Remote with six buttons, press and hold both the Next and Menu buttons on the remote until the paired-remote icon appears on your screen"
          reference    : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|1S,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,SWIFT-CSCv1|2.3"
          see_also     : "https://workbench.cisecurity.org/files/299"
          regex        : "1"
          plist_item   : "DeviceEnabled"
          plist_name   : "/Library/Preferences/com.apple.driver.AppleIRController"
          plist_option : CANNOT_BE_NULL
        </custom_item>

        <custom_item>
          type        : CMD_EXEC
          description : "2.9 Pair the remote control infrared receiver if enabled - 'UIDFilter != none'"
          info        : "An infrared receiver is a piece of hardware that sends information from an infrared remote control to another device by receiving and decoding signals. If a remote is used with a computer, a specific remote, or \"pair\", can be set-up to work with the computer. This will allow only the paired remote to work on that computer. If a remote is needed the receiver should only be accessible by a paired device. Many models do not have infrared hardware. The audit check looks for the hardware first.  An infrared remote can be used from a distance to circumvent physical security controls. A remote could also be used to page through a document or presentation, thus revealing sensitive information."
          solution    : "Perform one of the following to implement the prescribed state: Disable the remote control infrared receiver: Open System Preferences Select Security &amp; Privacy Select the General tab Select Advanced Check Disable remote control infrared receiver Pair a remote control infrared receiver Holding the remote close to the computer, point the remote at the front of the computer. Pair the Apple Remote. If you have an Apple Remote with seven buttons, press and hold both the Right and Menu buttons on the remote until the paired-remote icon appears on your screen If you have an Apple Remote with six buttons, press and hold both the Next and Menu buttons on the remote until the paired-remote icon appears on your screen"
          reference   : "800-171|3.1.18,800-53|AC-19,CSF|PR.AC-3,ISO/IEC-27001|A.6.2.1,ITSG-33|AC-19,LEVEL|1S"
          see_also    : "https://workbench.cisecurity.org/files/299"
          cmd         : "/usr/bin/defaults read /Library/Preferences/com.apple.driver.AppleIRController | /usr/bin/grep UIDFilter | /usr/bin/grep none | /usr/bin/awk '{print} END {if (NR == 0) print \"none\"}'"
          expect      : "none"
        </custom_item>
      </else>
    </if>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "2.10 Enable Secure Keyboard Entry in terminal.app"
      info         : "Secure Keyboard Entry prevents other applications on the system and/or network from detecting and recording what is typed into Terminal.  Enabling Secure Keyboard Entry minimizes the risk of a key logger from detecting what is entered in Terminal."
      solution     : "Perform the following to implement the prescribed state: Open Terminal Select Terminal Select Secure Keyboard Entry"
      reference    : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|1S,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,SWIFT-CSCv1|2.3"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "1"
      plist_item   : "SecureKeyboardEntry"
      plist_name   : "-app Terminal"
      plist_option : CANNOT_BE_NULL
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "3.1.1 Retain system.log for 90 or more days"
      info        : "OSX writes information pertaining to system-related events to the file /var/log/system.log and has a configurable retention policy for this file. The default logging setting limits the file size of the logs and the maximum size for all logs with it's own rule in asl.conf. The default allows for an errant application to fill the log files and does not enforce sufficient log retention. The Benchmark recommends a value based on standard use cases. The value should align with local requirements within the organization. The default value has an \"all_max\" file limitation, no reference to a minimum retention and a less precise rotation argument. The maximum file size limitation string should be removed \"all_max=\" An organization appropriate retention should be added \"ttl=\" The rotation should be set with time stamps \"rotate=utc\" or \"rotate=local\"  Archiving and retaining system.log for 90 or more days is beneficial in the event of an incident as it will allow the user to view the various changes to the system along with the date and time they occurred."
      solution    : "Perform the following to implement the prescribed state: Run the following command in Terminal: sudo vim /etc/asl.conf Replace or edit the current setting with a compliant setting &gt; system.log mode=0640 format=bsd rotate=utc compress file_max=5M ttl=90 Impact: Without log files system maintenance and security forensics cannot be properly performed."
      reference   : "800-53|AU-11,CIP|007-6-R4,CSF|PR.PT-1,ITSG-33|AU-11,LEVEL|1S,NESA|M5.2.3,NESA|T3.6.2,NIAv2|SM7,PCI-DSSv3.1|10.7,PCI-DSSv3.2|10.7"
      see_also    : "https://workbench.cisecurity.org/files/299"
      file        : "/etc/asl.conf"
      regex       : "^[^#]+system\.log.+ttl="
      expect      : "^[^#]+system\.log.+ttl=([9]\\d|[1-9]\\d{2,})"
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "3.1.2 Retain appfirewall.log for 90 or more days"
      info        : "OSX writes information pertaining to system-related events to the file /var/log/ appfirewall . log and has a configurable retention policy for this file. The default logging setting limits the file size of the logs and the maximum size for all logs with it's own rule in asl.conf. The default allows for an errant application to fill the log files and does not enforce sufficient log retention. The Benchmark recommends a value based on standard use cases. The value should align with local requirements within the organization. The default value has an \"all_max\" file limitation, no reference to a minimum retention and a less precise rotation argument. The maximum file size limitation string should be removed \"all_max=\" An organization appropriate retention should be added \"ttl=\" The rotation should be set with time stamps \"rotate=utc\" or \"rotate=local\"  Archiving and retaining appfirewall.log for 90 or more days is beneficial in the event of an incident as it will allow the user to view the various changes to the system along with the date and time they occurred."
      solution    : "Perform the following to implement the prescribed state: Run the following command in Terminal: sudo vim /etc/asl.conf Replace or edit the current setting with a compliant setting &gt; appfirewall.log mode=0640 format=bsd rotate=utc compress file_max=5M ttl=90 Impact: Without log files system maintenance and security forensics cannot be properly performed."
      reference   : "800-53|AU-11,CIP|007-6-R4,CSF|PR.PT-1,ITSG-33|AU-11,LEVEL|1S,NESA|M5.2.3,NESA|T3.6.2,NIAv2|SM7,PCI-DSSv3.1|10.7,PCI-DSSv3.2|10.7"
      see_also    : "https://workbench.cisecurity.org/files/299"
      file        : "/etc/asl.conf"
      regex       : "^[^#]+appfirewall\\.log.+ttl="
      expect      : "^[^#]+appfirewall\\.log.+ttl=([9]\\d|[1-9]\\d{2,})"
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "3.1.3 Retain authd.log for 90 or more days"
      info        : "OSX writes information pertaining to system-related events to the file /var/log/ authd.log and has a configurable retention policy for this file. The default logging setting limits the file size of the logs and the maximum size for all logs with it's own rule in asl.conf. The default allows for an errant application to fill the log files and does not enforce sufficient log retention. The Benchmark recommends a value based on standard use cases. The value should align with local requirements within the organization. The default value has an \"all_max\" file limitation, no reference to a minimum retention and a less precise rotation argument. The maximum file size limitation string should be removed \"all_max=\" An organization appropriate retention should be added \"ttl=\" The rotation should be set with time stamps \"rotate=utc\" or \"rotate=local\"  Archiving and retaining authd.log for 90 or more days is beneficial in the event of an incident as it will allow the user to view the various changes to the system along with the date and time they occurred."
      solution    : "Perform the following to implement the prescribed state: Perform the following to implement the prescribed state: Run the following command in Terminal: sudo vim /etc/asl/com.apple.authd Replace or edit the current setting with a compliant setting * file /var/log/authd.log mode=0640 format=bsd rotate=utc compress file_max=5M ttl=90 Impact: Without log files system maintenance and security forensics cannot be properly performed."
      reference   : "800-53|AU-11,CIP|007-6-R4,CSF|PR.PT-1,ITSG-33|AU-11,LEVEL|1S,NESA|M5.2.3,NESA|T3.6.2,NIAv2|SM7,PCI-DSSv3.1|10.7,PCI-DSSv3.2|10.7"
      see_also    : "https://workbench.cisecurity.org/files/299"
      file        : "/etc/asl/com.apple.authd"
      regex       : "^[^#]+authd\\.log.+ttl="
      expect      : "^[^#]+authd\\.log.+ttl=([9]\\d|[1-9]\\d{2,})"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "3.2 Enable security auditing"
      info        : "OSX's audit facility, auditd, receives notifications from the kernel when certain system calls, such as open, fork, and exit, are made. These notifications are captured and written to an audit log.  Logs generated by auditd may be useful when investigating a security incident as they may help reveal the vulnerable application and the actions taken by a malicious actor."
      solution    : "Perform the following to implement the prescribed state: Run the following command in Terminal: sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.auditd.plist"
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12,LEVEL|1S,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/bin/launchctl list | /usr/bin/grep -i auditd"
      expect      : "com.apple.auditd"
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "3.3 Configure Security Auditing Flags - 'audit successful/failed login/logout events'"
      info        : "Auditing is the capture and maintenance of information about security-related events.  Maintaining an audit trail of system activity logs can help identify configuration errors, troubleshoot service disruptions, and analyze compromises or attacks that have occurred, have begun, or are about to begin. Audit logs are necessary to provide a trail of evidence in case the system or network is compromised."
      solution    : "Perform the following to implement the prescribed state: Open a terminal session and edit the /etc/security/audit_control file. Find the line beginning with \"flags\" Add the following flags: lo, ad, fd, fm, -all. Save the file."
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12,LEVEL|1S,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1"
      see_also    : "https://workbench.cisecurity.org/files/299"
      file        : "/etc/security/audit_control"
      regex       : "^flags:"
      expect      : "^flags:.*(?=.*lo).*$"
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "3.3 Configure Security Auditing Flags - 'audit successful/failed administrative events'"
      info        : "Auditing is the capture and maintenance of information about security-related events.  Maintaining an audit trail of system activity logs can help identify configuration errors, troubleshoot service disruptions, and analyze compromises or attacks that have occurred, have begun, or are about to begin. Audit logs are necessary to provide a trail of evidence in case the system or network is compromised."
      solution    : "Perform the following to implement the prescribed state: Open a terminal session and edit the /etc/security/audit_control file. Find the line beginning with \"flags\" Add the following flags: lo, ad, fd, fm, -all. Save the file."
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12,LEVEL|1S,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1"
      see_also    : "https://workbench.cisecurity.org/files/299"
      file        : "/etc/security/audit_control"
      regex       : "^flags:"
      expect      : "^flags:.*(?=.*ad).*$"
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "3.3 Configure Security Auditing Flags - 'audit successful/failed file deletion events'"
      info        : "Auditing is the capture and maintenance of information about security-related events.  Maintaining an audit trail of system activity logs can help identify configuration errors, troubleshoot service disruptions, and analyze compromises or attacks that have occurred, have begun, or are about to begin. Audit logs are necessary to provide a trail of evidence in case the system or network is compromised."
      solution    : "Perform the following to implement the prescribed state: Open a terminal session and edit the /etc/security/audit_control file. Find the line beginning with \"flags\" Add the following flags: lo, ad, fd, fm, -all. Save the file."
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12,LEVEL|1S,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1"
      see_also    : "https://workbench.cisecurity.org/files/299"
      file        : "/etc/security/audit_control"
      regex       : "^flags:"
      expect      : "^flags:.*(?=.*fd).*$"
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "3.3 Configure Security Auditing Flags - 'audit successful/failed file attribute modification events'"
      info        : "Auditing is the capture and maintenance of information about security-related events.  Maintaining an audit trail of system activity logs can help identify configuration errors, troubleshoot service disruptions, and analyze compromises or attacks that have occurred, have begun, or are about to begin. Audit logs are necessary to provide a trail of evidence in case the system or network is compromised."
      solution    : "Perform the following to implement the prescribed state: Open a terminal session and edit the /etc/security/audit_control file. Find the line beginning with \"flags\" Add the following flags: lo, ad, fd, fm, -all. Save the file."
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12,LEVEL|1S,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1"
      see_also    : "https://workbench.cisecurity.org/files/299"
      file        : "/etc/security/audit_control"
      regex       : "^flags:"
      expect      : "^flags:.*(?=.*fm).*$"
    </custom_item>

    <custom_item>
      type        : FILE_CONTENT_CHECK
      description : "3.3 Configure Security Auditing Flags - 'audit all failed events across all audit classes'"
      info        : "Auditing is the capture and maintenance of information about security-related events.  Maintaining an audit trail of system activity logs can help identify configuration errors, troubleshoot service disruptions, and analyze compromises or attacks that have occurred, have begun, or are about to begin. Audit logs are necessary to provide a trail of evidence in case the system or network is compromised."
      solution    : "Perform the following to implement the prescribed state: Open a terminal session and edit the /etc/security/audit_control file. Find the line beginning with \"flags\" Add the following flags: lo, ad, fd, fm, -all. Save the file."
      reference   : "800-171|3.3.1,800-171|3.3.2,800-53|AU-12,CN-L3|7.1.3.3(a),CN-L3|7.1.3.3(b),CN-L3|7.1.3.3(c),CN-L3|8.1.3.5(a),CN-L3|8.1.3.5(b),CN-L3|8.1.4.3(a),CSF|DE.CM-1,CSF|DE.CM-3,CSF|DE.CM-7,CSF|PR.PT-1,ISO/IEC-27001|A.12.4.1,ITSG-33|AU-12,LEVEL|1S,NESA|T3.6.2,NESA|T3.6.5,NESA|T3.6.6,NIAv2|SM8,SWIFT-CSCv1|6.4,TBA-FIISB|45.1.1"
      see_also    : "https://workbench.cisecurity.org/files/299"
      file        : "/etc/security/audit_control"
      regex       : "^flags:"
      expect      : "^flags:.*(?=.*-all).*$"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "3.5 Retain install.log for 365 or more days"
      info        : "OSX writes information pertaining to system-related events to the file /var/log/ install.log and has a configurable retention policy for this file. The default logging setting limits the file size of the logs and the maximum size for all logs. The default allows for an errant application to fill the log files and does not enforce sufficient log retention. The Benchmark recommends a value based on standard use cases. The value should align with local requirements within the organization. The default value has an \"all_max\" file limitation, no reference to a minimum retention and a less precise rotation argument. The maximum file size limitation string should be removed \"all_max=\" An organization appropriate retention should be added \"ttl=\" The rotation should be set with time stamps \"rotate=utc\" or \"rotate=local\"  Archiving and retaining install.log for at least a year is beneficial in the event of an incident as it will allow the user to view the various changes to the system along with the date and time they occurred."
      solution    : "Perform the following to implement the prescribed state: Perform the following to implement the prescribed state: Run the following command in Terminal: sudo vim /etc/asl/com.apple.install Replace or edit the current setting with a compliant setting * file /var/log/install.log mode=0640 format=bsd rotate=utc compress file_max=5M ttl=365 Impact: Without log files system maintenance and security forensics cannot be properly performed."
      reference   : "800-53|AU-11,CIP|007-6-R4,CSF|PR.PT-1,ITSG-33|AU-11,LEVEL|1S,NESA|M5.2.3,NESA|T3.6.2,NIAv2|SM7,PCI-DSSv3.1|10.7,PCI-DSSv3.2|10.7"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/grep -i install\\.log /etc/asl/com.apple.install | /usr/bin/grep -i ttl"
      expect      : "ttl=(36[5-9]|3[7-9][0-9]|[4-9]\d{2,}|[1-9]\d{3,})"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "4.2 Enable \"Show Wi-Fi status in menu bar\""
      info        : "The Wi-Fi status in the menu bar indicates if the system's wireless internet capabilities are enabled. If so, the system will scan for available wireless networks to connect to. At the time of this revision all computers Apple builds have wireless, that has not always been the case, This control only pertains to systems that have a wireless NIC. Operating systems running in a virtual environment may not score as expected either.  Enabling \"Show Wi-Fi status in menu bar\" is a security awareness method that helps mitigate public area wireless exploits by making the user aware of their wireless connectivity status."
      solution    : "Perform the following to implement the prescribed state: Open System Preferences Select Network Check Show Wi-Fi status in menu bar Alternatively run the following in the command line: Open /System/Library/CoreServices/Menu\ Extras/AirPort.menu/ Impact: The user of the system should have a quick check on their wireless network status available"
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|1S,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/defaults read com.apple.systemuiserver menuExtras | /usr/bin/grep AirPort\\.menu"
      expect      : "AirPort\\.menu"
    </custom_item>

    <custom_item>
      type          : CMD_EXEC
      description   : "4.4 Ensure http server is not running"
      info          : "Mac OS X used to have a graphical front-end to the embedded Apache web server in the Operating System. Personal web sharing could be enabled to allow someone on another computer to download files or information from the user's computer. Personal web sharing from a user endpoint has long been considered questionable and Apple has removed that capability from the GUI. Apache however is still part of the Operating System and can be easily turned on to share files and provide remote connectivity to an end user computer. Web sharing should only be done through hardened web servers and appropriate cloud services.  Web serving should not be done from a user desktop. Dedicated webservers or appropriate cloud storage should be used. Open ports make it easier to exploit the computer."
      solution      : "Ensure that the Web Server is not running and is not set to start at boot Stop the Web Server sudo apachectl stop Ensure that the web server will not auto-start at boot sudo defaults write /System/Library/LaunchDaemons/org.apache.httpd Disabled -bool true Impact: The web server is both a point of attack for the system and a means for unauthorized file transfers."
      reference     : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|1S,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,SWIFT-CSCv1|2.3"
      see_also      : "https://workbench.cisecurity.org/files/299"
      cmd           : "/bin/ps -ef | /usr/bin/grep -i httpd | /usr/bin/grep -v grep"
      expect        : ""
      dont_echo_cmd : YES
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "4.5 Ensure ftp server is not running"
      info        : "Mac OS X used to have a graphical front-end to the embedded ftp server in the Operating System. Ftp sharing could be enabled to allow someone on another computer to download files or information from the user's computer. Running an Ftp server from a user endpoint has long been considered questionable and Apple has removed that capability from the GUI. The Ftp server however is still part of the Operating System and can be easily turned on to share files and provide remote connectivity to an end user computer. Ftp servers meet a specialized need to distribute files without strong authentication and should only be done through hardened servers. Cloud services or other distribution methods should be considered  Ftp servers should not be run on an end user desktop. Dedicated servers or appropriate cloud storage should be used. Open ports make it easier to exploit the computer."
      solution    : "Ensure that the FTP Server is not running and is not set to start at boot Stop the ftp Server sudo -s launchctl unload -w /System/Library/LaunchDaemons/ftp.plist Impact: The ftp server is both a point of attack for the system and a means for unauthorized file transfers. The ftp server is another avenue to attempt brute forcing password for existing valid users."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|1S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/bin/launchctl list | /usr/bin/egrep ftpd | /usr/bin/cut -d\'.\' -f3 | /usr/bin/egrep \'^ftpd\'"
      expect      : ""
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "4.6 Ensure nfs server is not running"
      info        : "Mac OS X can act as an NFS fileserver. NFS sharing could be enabled to allow someone on another computer to mount shares and gain access to information from the user's computer. File sharing from a user endpoint has long been considered questionable and Apple has removed that capability from the GUI. NFSD is still part of the Operating System and can be easily turned on to export shares and provide remote connectivity to an end user computer.  File serving should not be done from a user desktop, dedicated servers should be used. Open ports make it easier to exploit the computer."
      solution    : "Ensure that the NFS Server is not running and is not set to start at boot Stop the NFS Server sudo nfsd disable Remove the exported Directory listing rm /etc/export Impact: The nfs server is both a point of attack for the system and a means for unauthorized file transfers."
      reference   : "800-171|3.4.6,800-171|3.4.7,800-53|CM-7,CN-L3|7.1.3.5(c),CN-L3|7.1.3.7(d),CN-L3|8.1.4.4(b),CSF|PR.IP-1,CSF|PR.PT-3,ITSG-33|CM-7,LEVEL|1S,NIAv2|SS13b,NIAv2|SS14a,NIAv2|SS14c,NIAv2|SS15a,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/bin/ps -ef | /usr/bin/grep -i nfsd | /usr/bin/grep -v grep | /usr/bin/awk \'{print} END {if (NR == 0) print \"pass\"}\'"
      expect      : "pass"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.1.1 Secure Home Folders"
      info        : "By default OS X allows all valid users into the top level of every other users home folder, and restricts access to the Apple default folders within. Another user on the same system can see you have a \"Documents\" folder but cannot see inside it. This configuration does work for personal file sharing but can expose user files to standard accounts on the system. The best parallel for Enterprise environments is that everyone who has a Dropbox account can see everything that is at the top level but can't see your pictures, in the parallel with OS X they can see into every new Directory that is created because of the default permissions. Home folders should be restricted to access only by the user. Sharing should be used on dedicated servers or cloud instances that are managing access controls. Some environments may encounter problems if execute rights are removed as well as read and write. Either no access or execute only for group or others is acceptable  Allowing all users to view the top level of all networked user's home folder may not be desirable since it may lead to the revelation of sensitive information."
      solution    : "Perform the following to implement the prescribed state: Run one of the following commands in Terminal: sudo chmod -R og-rwx /Users/&lt;username&gt; sudo chmod -R og-rw /Users/&lt;username&gt; Substitute user name in &lt;username&gt;. This command has to be run for each user account with a local home folder. Impact: If implemented, users will not be able to use the \"Public\" folders in other users' home folders. \"Public\" folders with appropriate permissions would need to be set up in the /Shared folder."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|1S,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/find /Users -type d ! -perm -1000 -maxdepth 1 -a -perm +0066 | /usr/bin/egrep -v \'^/Users$\' | /usr/bin/awk \'{print} END {if (NR == 0) print \"none\"}\'"
      expect      : "none"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.1.2 Repair permissions regularly to ensure binaries and other System files have appropriate permissions"
      info        : "Software installations, Upgrades and updates and end user activity can all end up changing the access controls on the Operating System. On a normal system lots of files get touched and changed and proper maintenance is necessary for good security. The standard software load on an end user system has so many moving parts that have regular updates to require periodic file permissions repair. We believe that a weekly permissions check should be scheduled to fix anything needed.  Permission problems can lead to exploitable gaps in the operating system. Without expected controls in place the system is more likely to be successfully attacked."
      solution    : "Manually run the check using Disk Utility or through the command line. A schedule should be set in ls /etc/periodic/weekly/ diskutil repairPermissions / Impact: System executables and other important files could be modified much more easily if appropriate permissions are not in place."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSCv6|3.1,CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|1NS,NESA|T3.2.1,PCI-DSSv3.1|2.2.4,PCI-DSSv3.2|2.2.4,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/sbin/diskutil verifyPermissions / | /usr/bin/awk \'{print} END {if (NR == 0) print \"pass\"}\'"
      expect      : "pass"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.1.3 Check System Wide Applications for appropriate permissions"
      info        : "Applications in the System Applications Directory (/Applications) should be world executable since that is their reason to be on the system. They should not be world writable and allow any process or user to alter them for other processes or users to then execute modified versions  Unauthorized modifications of applications could lead to the execution of malicious code."
      solution    : "Change permissions so that \"Others\" can only execute. (Example Below) sudo chmod -R o-w /Applications/Bad\ Permissions.app/ Impact: Applications changed will no longer be world writable"
      reference   : "800-53|AC-6(7),CSF|PR.AC-4,ISO/IEC-27001|A.9.2.5,LEVEL|1S,NESA|M1.1.3,NESA|T5.1.1"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/find /Applications -iname \'*\.app\' -type d -perm -2 -ls | /usr/bin/awk \'{print} END {if (NR == 0) print \"none\"}\'"
      expect      : "none"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.1.4 Check System folder for world writable files"
      info        : "Software sometimes insists on being installed in the /System Directory and have inappropriate world writable permissions.  Folders in /System should not be world writable. The audit check excludes the \"Drop Box\" folder that is part of Apple's default user template."
      solution    : "Change permissions so that \"Others\" can only execute. (Example Below) sudo chmod -R o-w /Bad/Directory"
      reference   : "800-171|3.1.5,800-53|AC-6,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.10.6(a),CN-L3|8.1.4.2(d),CSF|PR.AC-4,CSF|PR.DS-5,ITSG-33|AC-6,LEVEL|1S,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/find /System -type d -perm -2 -ls | /usr/bin/grep -v \'Public/Drop Box\' | /usr/bin/awk \'{print} END {if (NR == 0) print \"none\"}\'"
      expect      : "none"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.2.1 Configure account lockout threshold"
      info        : "The account lockout threshold specifies the amount of times a user can enter an incorrect password before a lockout will occur.  The account lockout feature mitigates brute-force password attacks on the system."
      solution    : "Perform the following to implement the prescribed state for all pwpolicy controls Run the following command in Terminal: sudo pwpolicy -setglobalpolicy \"maxFailedLoginAttempts=5 minChars=15 requiresNumeric=1 requiresAlpha=1 requiresSymbol=1\" Impact: The number of incorrect log on attempts should be reasonably small to minimize the possibility of a successful password attack, while allowing for honest errors made during a normal user log on."
      reference   : "800-171|3.1.8,800-53|AC-7,CN-L3|8.1.4.1(b),CSCv6|16.7,ITSG-33|AC-7,LEVEL|1S,NESA|T5.5.1,NIAv2|AM24,TBA-FIISB|36.2.4,TBA-FIISB|45.1.2,TBA-FIISB|45.2.1,TBA-FIISB|45.2.2"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/pwpolicy -getglobalpolicy | /usr/bin/tr \' \' \'\\n\' | /usr/bin/grep maxFailedLoginAttempts"
      expect      : "maxFailedLoginAttempts[\\s]*=[\\s]*[12345]"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.2.2 Set a minimum password length"
      info        : "A minimum password length is the fewest number of characters a password can contain to meet a system's requirements.  Information systems that are not protected with strong password schemes including passwords of minimum length provide a greater opportunity for attackers to crack the password and gain access to the system."
      solution    : "Perform the following to implement the prescribed state for all pwpolicy controls Run the following command in Terminal: sudo pwpolicy -setglobalpolicy \"maxFailedLoginAttempts=5 minChars=15 requiresNumeric=1 requiresAlpha=1 requiresSymbol=1\" Impact: Short passwords can be easily attacked."
      reference   : "800-171|3.5.7,800-53|IA-5(1),CIP|007-6-R5,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,HIPAA|164.308(a)(5)(ii)(D),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1),LEVEL|1S,NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,PCI-DSSv3.1|8.2.3,PCI-DSSv3.2|8.2.3,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/pwpolicy -getglobalpolicy | /usr/bin/tr \' \' \'\\n\' | /usr/bin/grep minChars"
      expect      : "minChars[\\s]*=[\\s]*(1[5-9]|[2-9][0-9]|[1-9]\d{2,})"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.2.3 Complex passwords must contain an Alphabetic Character"
      info        : "Complex passwords contain one character from each of the following classes: English uppercase letters, English lowercase letters, Westernized Arabic numerals, and non-alphanumeric characters.  The more complex a password the more resistant it will be against persons seeking unauthorized access to a system."
      solution    : "Perform the following to implement the prescribed state for all pwpolicy controls Run the following command in Terminal: sudo pwpolicy -setglobalpolicy \"maxFailedLoginAttempts=5 minChars=15 requiresNumeric=1 requiresAlpha=1 requiresSymbol=1\" Impact: Password policy should be in effect to reduce the risk of exposed services being compromised easily through dictionary attacks or other social engineering attempts."
      reference   : "800-171|3.5.7,800-53|IA-5(1),CIP|007-6-R5,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,HIPAA|164.308(a)(5)(ii)(D),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1),LEVEL|1S,NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,PCI-DSSv3.1|8.2.3,PCI-DSSv3.2|8.2.3,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/pwpolicy -getglobalpolicy | /usr/bin/tr \' \' \'\\n\' | /usr/bin/grep requiresAlpha"
      expect      : "requiresAlpha[\\s]*=[\\s]*[1-9]"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.2.4 Complex passwords must contain a Numeric Character"
      info        : "Complex passwords contain one character from each of the following classes: English uppercase letters, English lowercase letters, Westernized Arabic numerals, and non-alphanumeric characters.  The more complex a password the more resistant it will be against persons seeking unauthorized access to a system."
      solution    : "Perform the following to implement the prescribed state for all pwpolicy controls Run the following command in Terminal: sudo pwpolicy -setglobalpolicy \"maxFailedLoginAttempts=5 minChars=15 requiresNumeric=1 requiresAlpha=1 requiresSymbol=1\" Impact: Password policy should be in effect to reduce the risk of exposed services being compromised easily through dictionary attacks or other social engineering attempts."
      reference   : "800-171|3.5.7,800-53|IA-5(1),CIP|007-6-R5,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,HIPAA|164.308(a)(5)(ii)(D),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1),LEVEL|1S,NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,PCI-DSSv3.1|8.2.3,PCI-DSSv3.2|8.2.3,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/pwpolicy -getglobalpolicy | /usr/bin/tr \' \' \'\\n\' | /usr/bin/grep requiresNumeric"
      expect      : "requiresNumeric[\\s]*=[\\s]*[1-9]"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.2.5 Complex passwords must contain a Symbolic Character"
      info        : "Complex passwords contain one character from each of the following classes: English uppercase letters, English lowercase letters, Westernized Arabic numerals, and non-alphanumeric characters.  The more complex a password the more resistant it will be against persons seeking unauthorized access to a system."
      solution    : "Perform the following to implement the prescribed state for all pwpolicy controls Run the following command in Terminal: sudo pwpolicy -setglobalpolicy \"maxFailedLoginAttempts=5 minChars=15 requiresNumeric=1 requiresAlpha=1 requiresSymbol=1\" Impact: Password policy should be in effect to reduce the risk of exposed services being compromised easily through dictionary attacks or other social engineering attempts."
      reference   : "800-171|3.5.7,800-53|IA-5(1),CIP|007-6-R5,CN-L3|7.1.2.7(e),CN-L3|7.1.3.1(b),CSF|PR.AC-1,HIPAA|164.308(a)(5)(ii)(D),ISO/IEC-27001|A.9.4.3,ITSG-33|IA-5(1),LEVEL|1S,NESA|T5.2.3,NIAv2|AM19a,NIAv2|AM19b,NIAv2|AM19c,NIAv2|AM19d,NIAv2|AM22a,PCI-DSSv3.1|8.2.3,PCI-DSSv3.2|8.2.3,SWIFT-CSCv1|4.1,TBA-FIISB|26.2.1,TBA-FIISB|26.2.4"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/pwpolicy -getglobalpolicy | /usr/bin/tr \' \' \'\\n\' | /usr/bin/grep requiresSymbol"
      expect      : "requiresSymbol[\\s]*=[\\s]*[1-9]"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.3 Reduce the sudo timeout period"
      info        : "The sudo command allows the user to run programs as the root user. Working as the root user allows the user an extremely high level of configurability within the system.  The sudo command stays logged in as the root user for five minutes before timing out and re-requesting a password. This five minute window should be eliminated since it leaves the system extremely vulnerable. This is especially true if an exploit were to gain access to the system, since they would be able to make changes as a root user."
      solution    : "Perform the following to implement the prescribed state: Run the following command in Terminal: sudo visudo In the \"# Defaults specification\" section, add the line: Defaults timestamp_timeout=0"
      reference   : "800-171|3.1.1,800-53|AC-3(7),CN-L3|7.1.2.2(g),CN-L3|7.1.3.2(c),CSF|PR.AC-4,CSF|PR.PT-3,HIPAA|164.310(a)(2)(iii),LEVEL|1S"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/bin/cat /etc/sudoers | /usr/bin/grep -v \'#[\\s]*Defaults\' | /usr/bin/grep timestamp"
      expect      : "Defaults[\\s]*timestamp_timeout[\\s]*=[\\s]*0"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.7 Do not enable the \"root\" account"
      info        : "The root account is a superuser account that has access privileges to perform any actions and read/write to any file on the computer. In the UNIX/Linux world, the system administrator commonly uses the root account to perform administrative functions.  Enabling and using the root account puts the system at risk since any successful exploit or mistake while the root account is in use could have unlimited access privileges within the system. Using the sudo command allows users to perform functions as a root user while limiting and password protecting the access privileges. By default the root account is not enabled on a Mac OS X client computer. It is enabled on Mac OS X Server. An administrator can escalate privileges using the sudo command (use -s or -i to get a root shell)."
      solution    : "Open System Preferences, Uses &amp; Groups. Click the lock icon to unlock it. In the Network Account Server section, click Join or Edit. Click Open Directory Utility. Click the lock icon to unlock it. Select the Edit menu &gt; Disable Root User. Impact: Some legacy posix software might expect an available root account."
      reference   : "800-171|3.1.5,800-53|AC-6,CN-L3|7.1.3.2(b),CN-L3|7.1.3.2(g),CN-L3|8.1.10.6(a),CN-L3|8.1.4.2(d),CSF|PR.AC-4,CSF|PR.DS-5,ITSG-33|AC-6,LEVEL|1S,NESA|T5.1.1,NESA|T5.2.2,NESA|T5.4.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.3,NIAv2|AM1,NIAv2|AM23f,NIAv2|SS13c,NIAv2|SS15c,PCI-DSSv3.1|7.1.2,PCI-DSSv3.2|7.1.2,SWIFT-CSCv1|5.1,TBA-FIISB|31.4.2,TBA-FIISB|31.4.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/dscl . -read /Users/root AuthenticationAuthority"
      expect      : "(No such key: AuthenticationAuthority|Disabled)"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.8 Disable automatic login"
      info        : "The automatic login feature saves a user's system access credentials and bypasses the login screen, instead the system automatically loads to the user's desktop screen.  Disabling automatic login decreases the likelihood of an unauthorized person gaining access to a system."
      solution    : "Perform the following to implement the prescribed state: Run the following command in Terminal: sudo defaults delete /Library/Preferences/com.apple.loginwindow autoLoginUser Impact: If Automatic login is not disabled an unauthorized user could login without supplying a user password or credential."
      reference   : "800-53|AC-14,ITSG-33|AC-14,LEVEL|1S,NESA|T5.6.1"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/defaults read /Library/Preferences/com.apple.loginwindow | /usr/bin/grep autoLoginUser | /usr/bin/awk \'{print} END {if (NR == 0) print \"none\"}\'"
      expect      : "none"
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "5.9 Require a password to wake the computer from sleep or screen saver"
      info         : "Sleep and screensaver modes are low power modes that reduces electrical consumption while the system is not in use.  Prompting for a password when waking from sleep or screensaver mode mitigates the threat of an unauthorized person gaining access to a system in the user's absence."
      solution     : "Perform the following to implement the prescribed state: Run the following command in Terminal: The current user will need to log off and on for changes to take effect. defaults write com.apple.screensaver askForPassword -int 1 The current user will need to log off and on for changes to take effect. Impact: Without a screenlock in place anyone with physical access to the computer would be logged in and able to use the active users session."
      reference    : "800-171|3.1.10,800-53|AC-11,CN-L3|8.1.4.1(b),CSCv6|16.5,ISO/IEC-27001|A.11.2.8,ITSG-33|AC-11,LEVEL|1S,NIAv2|AM23c,NIAv2|AM23d"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "1"
      plist_item   : "askForPassword"
      plist_name   : "com.apple.screensaver"
      plist_option : CANNOT_BE_NULL
      plist_user   : "all"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.10 Require an administrator password to access system-wide preferences"
      info        : "System Preferences controls system and user settings on an OS X Computer. System Preferences allows the user to tailor their experience on the computer as well as allowing the System Administrator to configure global security settings. Some of the settings should only be altered by the person responsible for the computer.  By requiring a password to unlock System-wide System Preferences the risk is mitigated of a user changing configurations that affect the entire system and requires an admin user to re-authenticate to make changes"
      solution    : "In System Preferences: Security, General tab under Advanced, check \"Require an administrator password to access system-wide preferences\" Impact: If Automatic login is not disabled an unauthorized user could login without supplying a user password or credential."
      reference   : "800-171|3.4.2,800-53|CM-6,CN-L3|8.1.10.6(d),CSF|PR.IP-1,ITSG-33|CM-6,LEVEL|1S,NESA|T3.2.1,SWIFT-CSCv1|2.3"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/security authorizationdb read system.preferences | /usr/bin/grep \'<key>shared</key>\' -A1"
      expect      : "<false/>"
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "5.11 Disable ability to login to another user's active and locked session"
      info        : "OSX has a privilege that can be granted to any user that will allow that user to unlock active user's sessions.  Disabling the admins and/or user's ability to log into another user's active and locked session prevents unauthorized persons from viewing potentially sensitive and/or personal information."
      solution    : "Perform the following to implement the prescribed state: Run the following command in Terminal: sudo vi /etc/pam.d/screensaver Locate \"account required pam_group.so no_warn group=admin,wheel fail_safe\" Remove \"admin,\" Save Impact: While Fast user switching is a workaround for some lab environments especially where there is even less of an expectation of privacy this setting change may impact some maintenance workflows"
      reference   : "800-53|AC-10,ITSG-33|AC-10,LEVEL|1S,NESA|T5.5.1"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/usr/bin/grep -i \'group=admin,wheel fail_safe\' /etc/pam.d/screensaver | /usr/bin/awk \'{print} END {if (NR == 0) print \"none\"}\'"
      expect      : "none"
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "5.12 Create a custom message for the Login Screen"
      info         : "An access warning informs the user that the system is reserved for authorized use only, and that the use of the system may be monitored.  An access warning may reduce a casual attacker's tendency to target the system. Access warnings may also aid in the prosecution of an attacker by evincing the attacker's knowledge of the system's private status, acceptable use policy, and authorization requirements."
      solution     : "Perform the following to implement the prescribed state: To add text with elevated privileges:sudo defaults write /Library/Preferences/com.apple.loginwindow \ LoginwindowText \"your text here\" To remove the text with elevated privileges:sudo defaults delete /Library/Preferences/com.apple.loginwindow \ LoginwindowText Impact: If users are not informed of their responsibilities there may be unapproved activity. Users that are not approved for access may take the lack of a warning banner as implied consent to access."
      reference    : "800-171|3.1.9,800-53|AC-8,ITSG-33|AC-8,LEVEL|1S,NESA|M1.3.6,NESA|M5.2.5,NESA|T5.5.1,NIAv2|AM10a,NIAv2|AM10b,NIAv2|AM10c,NIAv2|AM10d,NIAv2|AM10e,TBA-FIISB|45.2.4"
      see_also     : "https://workbench.cisecurity.org/files/299"
# Note: Variable @ACCESS_WARNING@ replaced with "[Aa]uthorized us(e|es) only" in field "regex".
      regex        : "[Aa]uthorized us(e|es) only"
      plist_item   : "LoginwindowText"
      plist_name   : "/Library/Preferences/com.apple.loginwindow"
      plist_option : CANNOT_BE_NULL
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "5.14 Do not enter a password-related hint"
      info         : "Password hints help the user recall their passwords for various systems and/or accounts. In most cases, password hints are simple and closely related to the user's password.  Password hints that are closely related to the user's password are a security vulnerability, especially in the social media age. Unauthorized users are more likely to guess a user's password if there is a password hint. The password hint is very susceptible to social engineering attacks and information exposure on social media networks"
      solution     : "Open System Preferences Select Users &amp; Groups Highlight the user Select Change Password Verify that no text is entered in the Pas sword hint box"
      reference    : "800-171|3.5.11,800-53|IA-6,ITSG-33|IA-6,LEVEL|1NS,NESA|T5.5.1"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "0"
      plist_item   : "RetriesUntilHint"
      plist_name   : "/Library/Preferences/com.apple.loginwindow"
      plist_option : CAN_BE_NULL
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "6.1.1 Display login window as name and password"
      info         : "The login window prompts a user for his/her credentials, verifies their authorization level and then allows or denies the user access to the system.  Prompting the user to enter both their username and password makes it twice as hard for unauthorized users to gain access to the system since they must discover two attributes."
      solution     : "Perform the following to implement the prescribed state: Open System Preferences Select Users and Groups Select Login Options Select Name and Password Alternatively: Run the following command in Terminal: sudo defaults write /Library/Preferences/com.apple.loginwindow \ SHOWFULLNAME -bool yes"
      reference    : "800-171|3.1.7,800-53|AC-6(10),CSF|PR.AC-4,LEVEL|1S"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "1"
      plist_item   : "SHOWFULLNAME"
      plist_name   : "/Library/Preferences/com.apple.loginwindow"
      plist_option : CANNOT_BE_NULL
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "6.1.2 Disable \"Show password hints\""
      info         : "Password hints are user created text displayed when an incorrect password is used for an account.  Password hints make it easier for unauthorized persons to gain access to systems by providing information to anyone that the user provided to assist remembering the password. This info could include the password itself or other information that might be readily discerned with basic knowledge of the end user."
      solution     : "Perform the following to implement the prescribed state: Open System Preferences Select Users &amp; Groups Select Login Options Uncheck Show password hints Alternatively: Run the following command in Terminal: sudo defaults write /Library/Preferences/com.apple.loginwindow \ RetriesUntilHint -int 0 Impact: The user can set the hint to any value including the password itself or clues that allow trivial social engineering attacks."
      reference    : "800-171|3.5.11,800-53|IA-6,ITSG-33|IA-6,LEVEL|1S,NESA|T5.5.1"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "0"
      plist_item   : "RetriesUntilHint"
      plist_name   : "/Library/Preferences/com.apple.loginwindow"
      plist_option : CAN_BE_NULL
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "6.1.3 Disable guest account login"
      info         : "The guest account allows users access to the system without having to create an account or password. Guest users are unable to make setting changes, cannot remotely login to the system and all created files, caches, and passwords are deleted upon logging out.  Disabling the guest account mitigates the risk of an untrusted user doing basic reconnaissance and possibly using privilege escalation attacks to take control of the system."
      solution     : "Perform the following to implement the prescribed state: Open System Preferences Select Users &amp; Groups Select Guest User Uncheck Allow guests to log in to this computer Alternatively: Run the following command in Terminal: sudo defaults write /Library/Preferences/com.apple.loginwindow GuestEnabled -bool NO Impact: A guest user can use that access to find out additional information about the system and might be able to use privilege escalation vulnerabilities to establish greater access."
      reference    : "800-171|3.1.1,800-53|AC-3,CN-L3|8.1.10.2(c),CN-L3|8.1.4.11(b),CN-L3|8.1.4.2(f),CN-L3|8.5.3.1,CN-L3|8.5.4.1(a),CSF|PR.AC-4,CSF|PR.PT-3,ISO/IEC-27001|A.9.4.1,ISO/IEC-27001|A.9.4.5,ITSG-33|AC-3,LEVEL|1S,NESA|T4.2.1,NESA|T5.4.4,NESA|T5.4.5,NESA|T5.5.4,NESA|T5.6.1,NESA|T7.5.2,NESA|T7.5.3,NIAv2|AM3,NIAv2|SS29,TBA-FIISB|31.1"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "0"
      plist_item   : "GuestEnabled"
      plist_name   : "/Library/Preferences/com.apple.loginwindow.plist"
      plist_option : CANNOT_BE_NULL
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "6.1.4 Disable \"Allow guests to connect to shared folders\""
      info         : "Allowing guests to connect to shared folders enables users to access selected shared folders and their contents from different computers on a network.  Not allowing guests to connect to shared folders mitigates the risk of an untrusted user doing basic reconnaissance and possibly use privilege escalation attacks to take control of the system."
      solution     : "Perform the following to implement the prescribed state: Open System Preferences Select Users &amp; Groups Select Guest User Uncheck Allow guests to connect to shared folders Alternatively: For AFP sharing: Run the following command in Terminal: sudo defaults write /Library/Preferences/com.apple.AppleFileServer guestAccess -bool no For SMB sharing: Run the following command in Terminal: sudo defaults write /Library/Preferences/SystemConfiguration/com.apple.smb.server AllowGuestAccess -bool no Impact: Unauthorized users could access shared files on the system."
      reference    : "800-171|3.1.1,800-53|AC-2,CN-L3|7.1.3.2(d),CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,LEVEL|1S,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "0"
      plist_item   : "guestAccess"
      plist_name   : "/Library/Preferences/com.apple.AppleFileServer"
      plist_option : CAN_BE_NULL
    </custom_item>

    <custom_item>
      type        : CMD_EXEC
      description : "6.1.5 Remove Guest home folder"
      info        : "In the previous two controls the guest account login has been disabled and sharing to guests has been disabled as well. There is no need for the legacy Guest home folder to remain in the file system. When normal user accounts are removed you have the option to archive it, leave it in place or delete. In the case of the guest folder the folder remains in place without a GUI option to remove it. If at some point in the future a Guest account is needed it will be re-created. The presence of the Guest home folder can cause automated audits to fail when looking for compliant settings within all User folders as well. Rather than ignoring the folders continued existence it is best removed.  The Guest home folders are unneeded after the Guest account is disabled and could be used inappropriately."
      solution    : "Perform the following to implement the prescribed state: Run the following command in Terminal: rm -R /Users/Guest Make sure there is no ouput Impact: The Guest account should not be necessary after it is disabled and it will be automatically re-created if the Guest account is re-eanbled"
      reference   : "800-171|3.1.1,800-53|AC-2,CN-L3|7.1.3.2(d),CSF|DE.CM-1,CSF|DE.CM-3,CSF|PR.AC-1,CSF|PR.AC-4,ISO/IEC-27001|A.9.2.1,ITSG-33|AC-2,LEVEL|1S,NIAv2|AM28,NIAv2|NS5j,NIAv2|SS14e"
      see_also    : "https://workbench.cisecurity.org/files/299"
      cmd         : "/bin/ls /Users/ | /usr/bin/grep Guest | /usr/bin/awk \'{print} END {if (NR == 0) print \"none\"}\'"
      expect      : "none"
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "6.2 Turn on filename extensions"
      info         : "A filename extension is a suffix added to a base filename that indicates the base filename's file format.  Visible filename extensions allows the user to identify the file type and the application it is associated with which leads to quick identification of misrepresented malicious files."
      solution     : "Perform the following to implement the prescribed state: Select Finder Select Preferences Check Show all filename extensions Alternatively, use the following command: defaults write NSGlobalDomain AppleShowAllExtensions -bool true Impact: The user of the system can open files of unknown or unexpected filetypes if the extension is not visible."
      reference    : "800-171|3.14.1,800-53|SI-2(5),CSF|ID.RA-1,CSF|PR.IP-12,LEVEL|1S,NIAv2|NS26b,SWIFT-CSCv1|2.2"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "1"
      plist_item   : "AppleShowAllExtensions"
      plist_name   : "NSGlobalDomain"
      plist_option : CANNOT_BE_NULL
    </custom_item>

    <custom_item>
      type         : MACOSX_DEFAULTS_READ
      description  : "6.3 Disable the automatic run of safe files in Safari"
      info         : "Safari will automatically run or execute what it considers safe files. This can include installers and other files that execute on the operating system. Safari bases file safety by using a list of filetypes maintained by Apple. The list of files include text, image, video and archive formats that would be run in the context of the OS rather than the browser.  Hackers have taken advantage of this setting via drive-by attacks. These attacks occur when a user visits a legitimate website that has been corrupted. The user unknowingly downloads a malicious file either by closing an infected pop-up or hovering over a malicious banner. An attacker can create a malicious file that will fall within Safari's safe file list that will download and execute without user input."
      solution     : "Perform the following to implement the prescribed state: Open Safari Select Safari from the menu bar Select Preferences Select General Uncheck Open \"safe\" files after downloading Alternatively run the following command in Terminal: defaults write com.apple.Safari AutoOpenSafeDownloads -boolean no Impact: Apple considers many files that the operating system itself auto-executes as \"safe files.\" Many of these files could be malicious and could execute locally without the user even knowing that a file of a specific type had been download."
      reference    : "800-171|3.13.13,800-53|SC-18(3),CSF|DE.CM-5,ITSG-33|SC-18(3),LEVEL|1S,NIAv2|NS26f"
      see_also     : "https://workbench.cisecurity.org/files/299"
      regex        : "0"
      plist_item   : "AutoOpenSafeDownloads"
      plist_name   : "com.apple.Safari"
      plist_option : CANNOT_BE_NULL
      plist_user   : "all"
    </custom_item>

    <report type:"WARNING">
      description : "7.6 Automatic Actions for Optical Media"
      info        : "Managing automatic actions, while useful in very few situations, is unlikely to increase security on the computer and does complicate the users experience and add additional complexity to the configuration. These settings are user controlled and can be changed without Administrator privileges unless controlled through MCX settings or Parental Controls. Unlike Windows Auto-run the optical media is accessed through Operating System applications, those same applications can open and access the media directly. If optical media is not allowed in the environment the optical media drive should be disabled in hardware and software.

NOTE: Nessus has not performed this check. Please review the benchmark to ensure target compliance."
      solution    : ""
      reference   : "LEVEL|1NS"
      see_also    : "https://workbench.cisecurity.org/files/299"
    </report>
  </then>

  <else>
    <report type:"WARNING">
      description : "Apple OSX 10.9 Level 1, version 1.3.0"
      info        : "NOTE: Nessus has not identified that the chosen audit applies to the target device."
    </report>
  </else>
</if>

</check_type>
